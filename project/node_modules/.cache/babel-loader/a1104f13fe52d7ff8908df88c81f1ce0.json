{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { Component, removeClass } from '@syncfusion/ej2-base';\nimport { EventHandler, isNullOrUndefined } from '@syncfusion/ej2-base';\n\nvar SignatureBase =\n/** @class */\nfunction (_super) {\n  __extends(SignatureBase, _super);\n\n  function SignatureBase() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    /* minDistance(distance between the two point) was calaculated for smoothness.*/\n\n\n    _this.minDistance = 5;\n    _this.previous = 0;\n    /* interval handles for the smoothness in the mouse move event.*/\n\n    _this.interval = 30;\n    _this.timeout = null;\n    _this.isSignatureEmpty = true;\n    _this.backgroundLoaded = null;\n    _this.clearArray = [];\n    _this.isBlazor = false;\n    return _this;\n  }\n  /**\r\n   * To Initialize the component rendering\r\n   *\r\n   * @private\r\n   * @param {HTMLCanvasElement} element - Specifies the canvas element.\r\n   * @param {parameter} parameter - Specifies only for the blazor parameter.\r\n   * @param {BlazorDotnetObject} dotnetRef - Specifies for blazor client to server communication.\r\n   * @returns {void}\r\n   */\n\n\n  SignatureBase.prototype.initialize = function (element, parameter, dotnetRef) {\n    this.element = element;\n    this.canvasContext = this.element.getContext('2d');\n    this.canvasContext.canvas.tabIndex = 0;\n\n    if (parameter) {\n      this.setBlazorParameter(parameter);\n      this.dotnetRef = dotnetRef;\n    }\n\n    this.setHTMLProperties();\n\n    if (isNullOrUndefined(this.signatureValue)) {\n      this.updateSnapCollection(true);\n    }\n\n    this.wireEvents();\n    this.isSignatureEmpty = true;\n\n    if (!this.isBlazor) {\n      this.trigger('created', null);\n    }\n  };\n\n  SignatureBase.prototype.setBlazorParameter = function (parameter) {\n    this.isBlazor = true;\n    this.backgroundColor = parameter.backgroundColor;\n    this.backgroundImage = parameter.backgroundImage;\n    this.disabled = parameter.disabled;\n    this.isReadOnly = parameter.isReadOnly;\n    this.maxStrokeWidth = parameter.maxStrokeWidth || 2;\n    this.minStrokeWidth = parameter.minStrokeWidth || 0.5;\n    this.velocity = parameter.velocity || 0.7;\n    this.strokeColor = parameter.strokeColor || '#000000';\n    this.saveWithBackground = parameter.saveWithBackground;\n    this.interval = 30;\n    this.previous = 0;\n    this.minDistance = 5;\n    this.signatureValue = parameter.signatureValue;\n\n    if (this.signatureValue) {\n      this.loadPersistedSignature();\n    }\n  };\n\n  SignatureBase.prototype.wireEvents = function () {\n    if (isNullOrUndefined(this.pointColl) && !this.isReadOnly && !this.disabled) {\n      EventHandler.add(this.canvasContext.canvas, 'mousedown touchstart', this.mouseDownHandler, this);\n      EventHandler.add(this.canvasContext.canvas, 'keydown', this.keyboardHandler, this);\n      window.addEventListener('resize', this.resizeHandler.bind(this));\n    } else if (this.pointColl) {\n      EventHandler.add(this.canvasContext.canvas, 'mousemove touchmove', this.mouseMoveHandler, this);\n      EventHandler.add(this.canvasContext.canvas, 'mouseup touchend', this.mouseUpHandler, this);\n      EventHandler.add(document, 'mouseup', this.mouseUpHandler, this);\n    }\n  };\n\n  SignatureBase.prototype.unwireEvents = function (type) {\n    if (type === 'mouseup' || type === 'touchend') {\n      EventHandler.remove(this.canvasContext.canvas, 'mousemove touchmove', this.mouseMoveHandler);\n      EventHandler.remove(this.canvasContext.canvas, 'mouseup touchend', this.mouseUpHandler);\n      EventHandler.remove(document, 'mouseup', this.mouseUpHandler);\n    } else {\n      EventHandler.remove(this.canvasContext.canvas, 'mousedown touchstart', this.mouseDownHandler);\n      EventHandler.remove(this.canvasContext.canvas, 'mousemove touchmove', this.mouseMoveHandler);\n      EventHandler.remove(this.canvasContext.canvas, 'mouseup touchend', this.mouseUpHandler);\n      EventHandler.remove(document, 'mouseup', this.mouseUpHandler);\n      EventHandler.remove(this.canvasContext.canvas, 'keydown', this.keyboardHandler);\n      window.removeEventListener('resize', this.resizeHandler);\n    }\n  };\n\n  SignatureBase.prototype.setHTMLProperties = function () {\n    if (this.element.height === 150) {\n      this.element.height = this.element.offsetHeight;\n    }\n\n    if (this.element.width === 300) {\n      this.element.width = this.element.offsetWidth;\n    }\n\n    this.canvasContext.scale(1, 1);\n    this.canvasContext.fillStyle = this.strokeColor;\n\n    if (this.backgroundImage) {\n      this.canvasContext.canvas.style.backgroundImage = 'url(' + this.backgroundImage + ')';\n    } else if (this.backgroundColor) {\n      this.canvasContext.canvas.style.backgroundColor = this.backgroundColor;\n    }\n  };\n\n  SignatureBase.prototype.mouseDownHandler = function (e) {\n    if (e.buttons === 1 || e.buttons === 2 || e.type === 'touchstart') {\n      if (e.type === 'touchstart') {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      this.beginStroke(e);\n      this.wireEvents();\n    }\n  };\n\n  SignatureBase.prototype.mouseMoveHandler = function (e) {\n    if (e.buttons === 1 || e.buttons === 2 || e.type === 'touchmove') {\n      if (e.type === 'touchmove') {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      if (this.interval) {\n        this.updateStrokeWithThrottle(e);\n      } else {\n        this.updateStroke(e);\n      }\n    }\n  };\n\n  SignatureBase.prototype.mouseUpHandler = function (e) {\n    var args = {\n      actionName: 'strokeUpdate'\n    };\n\n    if (e.type === 'touchstart') {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n\n    this.endDraw();\n    this.updateSnapCollection();\n    this.unwireEvents(e.type);\n\n    if (!this.isBlazor) {\n      this.trigger('change', args);\n    } else {\n      this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'mouseUp');\n    }\n\n    this.signatureValue = this.snapColl[this.incStep];\n  };\n\n  SignatureBase.prototype.keyboardHandler = function (e) {\n    var _this = this;\n\n    var args = {\n      fileName: 'Signature',\n      type: 'Png',\n      cancel: false\n    };\n\n    switch (e.key) {\n      case 'Delete':\n        this.clear();\n        break;\n\n      case e.ctrlKey && 's':\n        if (!this.isBlazor) {\n          this.trigger('beforeSave', args, function (observableSaveArgs) {\n            if (!args.cancel) {\n              _this.save(observableSaveArgs.type, observableSaveArgs.fileName);\n            }\n          });\n        } else {\n          this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'beforeSave');\n        }\n\n        e.preventDefault();\n        e.stopImmediatePropagation();\n        break;\n\n      case e.ctrlKey && 'z':\n        this.undo();\n        break;\n\n      case e.ctrlKey && 'y':\n        this.redo();\n        break;\n    }\n  };\n\n  SignatureBase.prototype.resizeHandler = function () {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    var proxy = this;\n    this.canvasContext.canvas.width = this.element.offsetWidth;\n    this.canvasContext.canvas.height = this.element.offsetHeight;\n    this.canvasContext.scale(1, 1);\n    var restoreImg = new Image();\n    restoreImg.src = this.snapColl[this.incStep];\n\n    restoreImg.onload = function () {\n      proxy.canvasContext.clearRect(0, 0, proxy.element.width, proxy.element.height);\n      proxy.canvasContext.drawImage(restoreImg, 0, 0, proxy.element.width, proxy.element.height);\n    };\n  };\n\n  SignatureBase.prototype.beginStroke = function (e) {\n    this.refresh();\n    this.updateStroke(e);\n  };\n\n  SignatureBase.prototype.updateStroke = function (e) {\n    var point = this.createPoint(e);\n    this.addPoint(point);\n  };\n\n  SignatureBase.prototype.updateStrokeWithThrottle = function (args) {\n    var now = Date.now();\n    var remaining = this.interval - (now - this.previous);\n    this.storedArgs = args;\n\n    if (remaining <= 0 || remaining > this.interval) {\n      if (this.timeout) {\n        clearTimeout(this.timeout);\n        this.timeout = null;\n      }\n\n      this.previous = now;\n      this.updateStroke(this.storedArgs);\n\n      if (!this.timeout) {\n        this.storedArgs = null;\n      }\n    } else if (!this.timeout) {\n      this.timeout = window.setTimeout(this.delay.bind(this), remaining);\n    }\n  };\n\n  SignatureBase.prototype.delay = function () {\n    this.previous = Date.now();\n    this.timeout = null;\n    this.updateStroke(this.storedArgs);\n\n    if (!this.timeout) {\n      this.storedArgs = null;\n    }\n  };\n\n  SignatureBase.prototype.createPoint = function (e) {\n    var rect = this.canvasContext.canvas.getBoundingClientRect();\n\n    if (e.type === 'mousedown' || e.type === 'mousemove') {\n      return this.point(e.clientX - rect.left, e.clientY - rect.top, new Date().getTime());\n    } else {\n      return this.point(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top, new Date().getTime());\n    }\n  };\n  /* Returns the current point corrdinates(x, y) and time.*/\n\n\n  SignatureBase.prototype.point = function (pointX, pointY, time) {\n    this.pointX = pointX;\n    this.pointY = pointY;\n    this.time = time || new Date().getTime();\n    return {\n      x: this.pointX,\n      y: this.pointY,\n      time: this.time\n    };\n  };\n\n  SignatureBase.prototype.addPoint = function (point) {\n    var points = this.pointColl;\n    var controlPoint1;\n    var controlPoint2;\n    var lastPoint = points.length > 0 && points[points.length - 1];\n    var isLastPointTooClose = lastPoint ? this.distanceTo(lastPoint) <= this.minDistance : false;\n\n    if (!lastPoint || !(lastPoint && isLastPointTooClose)) {\n      points.push(point);\n\n      if (points.length > 2) {\n        if (points.length === 3) {\n          points.unshift(points[0]);\n        }\n\n        controlPoint1 = this.calculateCurveControlPoints(points[0], points[1], points[2]).controlPoint2;\n        controlPoint2 = this.calculateCurveControlPoints(points[1], points[2], points[3]).controlPoint1;\n        this.startPoint = points[1];\n        this.controlPoint1 = controlPoint1;\n        this.controlPoint2 = controlPoint2;\n        this.endPoint = points[2];\n        this.startDraw();\n        points.shift();\n      }\n    }\n  };\n\n  SignatureBase.prototype.startDraw = function () {\n    var velocity;\n    velocity = this.pointVelocityCalc(this.startPoint);\n    velocity = this.velocity * velocity + (1 - this.velocity) * this.lastVelocity;\n    var newWidth = Math.max(this.maxStrokeWidth / (velocity + 1), this.minStrokeWidth);\n    this.curveDraw(this.lastWidth, newWidth);\n    this.lastVelocity = velocity;\n    this.lastWidth = newWidth;\n  };\n\n  SignatureBase.prototype.endDraw = function () {\n    var canDrawCurve = this.pointColl.length > 2;\n    var point = this.pointColl[0];\n\n    if (!canDrawCurve && point) {\n      this.strokeDraw(point);\n    }\n  };\n  /* Calculate the Bezier (x, y) coordinate of the curve. */\n\n\n  SignatureBase.prototype.curveDraw = function (startWidth, endWidth) {\n    var context = this.canvasContext;\n    var width;\n    var i;\n    var t1;\n    var t2;\n    var t3;\n    var u1;\n    var u2;\n    var u3;\n    var x;\n    var y;\n    var widthValue = endWidth - startWidth;\n    var bezierLength = this.bezierLengthCalc();\n    var drawSteps = Math.ceil(bezierLength) * 2;\n    context.beginPath();\n\n    for (i = 0; i < drawSteps; i++) {\n      t1 = i / drawSteps;\n      t2 = t1 * t1;\n      t3 = t2 * t1;\n      u1 = 1 - t1;\n      u2 = u1 * u1;\n      u3 = u2 * u1;\n      x = u3 * this.startPoint.x;\n      x += 3 * u2 * t1 * this.controlPoint1.x;\n      x += 3 * u1 * t2 * this.controlPoint2.x;\n      x += t3 * this.endPoint.x;\n      y = u3 * this.startPoint.y;\n      y += 3 * u2 * t1 * this.controlPoint1.y;\n      y += 3 * u1 * t2 * this.controlPoint2.y;\n      y += t3 * this.endPoint.y;\n      width = Math.min(startWidth + t3 * widthValue, this.maxStrokeWidth);\n      this.arcDraw(x, y, width);\n    }\n\n    context.closePath();\n    context.fill();\n    this.isSignatureEmpty = false;\n  };\n\n  SignatureBase.prototype.strokeDraw = function (point) {\n    var context = this.canvasContext;\n    var pointSize = (this.minStrokeWidth + this.maxStrokeWidth) / 2;\n    context.beginPath();\n    this.arcDraw(point.x, point.y, pointSize);\n    context.closePath();\n    context.fill();\n    this.isSignatureEmpty = false;\n  };\n\n  SignatureBase.prototype.arcDraw = function (x, y, size) {\n    var context = this.canvasContext;\n    context.moveTo(x, y);\n    context.arc(x, y, size, 0, 2 * Math.PI, false);\n  };\n  /* Utility functions for Bezier algorithm*/\n\n\n  SignatureBase.prototype.calculateCurveControlPoints = function (p1, p2, p3) {\n    var dx1 = p1.x - p2.x;\n    var dy1 = p1.y - p2.y;\n    var dx2 = p2.x - p3.x;\n    var dy2 = p2.y - p3.y;\n    var m1 = {\n      x: (p1.x + p2.x) / 2.0,\n      y: (p1.y + p2.y) / 2.0\n    };\n    var m2 = {\n      x: (p2.x + p3.x) / 2.0,\n      y: (p2.y + p3.y) / 2.0\n    };\n    var l1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);\n    var l2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);\n    var dxm = m1.x - m2.x;\n    var dym = m1.y - m2.y;\n    var k = l2 / (l1 + l2);\n    var cm = {\n      x: m2.x + dxm * k,\n      y: m2.y + dym * k\n    };\n    var tx = p2.x - cm.x;\n    var ty = p2.y - cm.y;\n    return {\n      controlPoint1: this.point(m1.x + tx, m1.y + ty, 0),\n      controlPoint2: this.point(m2.x + tx, m2.y + ty, 0)\n    };\n  };\n  /* Returns approximated bezier length of the curuve.*/\n\n\n  SignatureBase.prototype.bezierLengthCalc = function () {\n    var steps = 10;\n    var length = 0;\n    var i;\n    var t;\n    var pointx1;\n    var pointy1;\n    var pointx2;\n    var pointy2;\n    var pointx3;\n    var pointy3;\n\n    for (i = 0; i <= steps; i++) {\n      t = i / steps;\n      pointx1 = this.bezierPointCalc(t, this.startPoint.x, this.controlPoint1.x, this.controlPoint2.x, this.endPoint.x);\n      pointy1 = this.bezierPointCalc(t, this.startPoint.y, this.controlPoint1.y, this.controlPoint2.y, this.endPoint.y);\n\n      if (i > 0) {\n        pointx3 = pointx1 - pointx2;\n        pointy3 = pointy1 - pointy2;\n        length += Math.sqrt(pointx3 * pointx3 + pointy3 * pointy3);\n      }\n\n      pointx2 = pointx1;\n      pointy2 = pointy1;\n    }\n\n    return length;\n  };\n  /* Calculate parametric value of x or y given t and the\r\n     four point(startpoint, controlpoint1, controlpoint2, endpoint) coordinates of a cubic bezier curve.*/\n\n\n  SignatureBase.prototype.bezierPointCalc = function (t, startpoint, cp1, cp2, endpoint) {\n    return startpoint * (1.0 - t) * (1.0 - t) * (1.0 - t) + 3.0 * cp1 * (1.0 - t) * (1.0 - t) * t + 3.0 * cp2 * (1.0 - t) * t * t + endpoint * t * t * t;\n  };\n  /* Velocity between the current point and last point.*/\n\n\n  SignatureBase.prototype.pointVelocityCalc = function (startPoint) {\n    return this.time !== startPoint.time ? this.distanceTo(startPoint) / (this.time - startPoint.time) : 0;\n  };\n  /* Distance between the current point and last point.*/\n\n\n  SignatureBase.prototype.distanceTo = function (start) {\n    return Math.sqrt(Math.pow(this.pointX - start.x, 2) + Math.pow(this.pointY - start.y, 2));\n  };\n\n  SignatureBase.prototype.isRead = function (isRead) {\n    if (isRead) {\n      EventHandler.remove(this.canvasContext.canvas, 'mousedown touchstart', this.mouseDownHandler);\n    } else if (!this.disabled) {\n      EventHandler.add(this.canvasContext.canvas, 'mousedown touchstart', this.mouseDownHandler, this);\n    }\n  };\n\n  SignatureBase.prototype.enableOrDisable = function (isDisable) {\n    this.disabled = isDisable;\n\n    if (isDisable) {\n      this.reDraw('0.5');\n      this.isRead(true);\n    } else {\n      this.reDraw('1');\n      this.isRead(false);\n    }\n  };\n\n  SignatureBase.prototype.reDraw = function (opacity) {\n    var data = this.canvasContext.getImageData(0, 0, this.element.width, this.element.height);\n    this.canvasContext.clearRect(0, 0, this.element.width, this.element.height);\n    this.element.style.opacity = opacity;\n    this.canvasContext.putImageData(data, 0, 0);\n  };\n\n  SignatureBase.prototype.updateSnapCollection = function (isClear) {\n    if (isNullOrUndefined(this.incStep)) {\n      this.incStep = -1;\n      this.incStep++;\n      this.snapColl = [];\n      this.clearArray = [];\n    } else {\n      this.incStep++;\n    }\n\n    if (this.incStep < this.snapColl.length) {\n      this.snapColl.length = this.incStep;\n    }\n\n    if (this.incStep > 0) {\n      var canvasNew = this.createElement('canvas', {\n        className: 'e-' + this.getModuleName() + '-wrapper'\n      });\n      var canvasContextNew = canvasNew.getContext('2d');\n      canvasNew.width = this.canvasContext.canvas.width;\n      canvasNew.height = this.canvasContext.canvas.height;\n      canvasContextNew.drawImage(this.canvasContext.canvas, 0, 0, canvasNew.width, canvasNew.height);\n      this.snapColl.push(canvasNew.toDataURL());\n    } else {\n      this.snapColl.push(this.canvasContext.canvas.toDataURL());\n    }\n\n    if (isClear) {\n      this.clearArray.push(this.incStep);\n    }\n  };\n\n  SignatureBase.prototype.setBackgroundImage = function (imageSrc) {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    var proxy = this;\n    var imageObj = new Image();\n    imageObj.crossOrigin = 'anonymous';\n    imageObj.src = imageSrc;\n\n    imageObj.onload = function () {\n      proxy.canvasContext.globalCompositeOperation = 'source-over';\n      proxy.canvasContext.drawImage(imageObj, 0, 0, proxy.element.width, proxy.element.height);\n      proxy.updateSnapCollection();\n      proxy.saveBackground(true);\n    };\n\n    this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\n  };\n\n  SignatureBase.prototype.setBackgroundColor = function (color) {\n    var canvasEle = this.canvasContext;\n    canvasEle.strokeStyle = color;\n    var i;\n    var j;\n\n    for (i = 1; i <= canvasEle.canvas.width; i++) {\n      for (j = 1; j <= canvasEle.canvas.height; j++) {\n        canvasEle.strokeRect(0, 0, i, j);\n      }\n    }\n\n    this.updateSnapCollection();\n  };\n\n  SignatureBase.prototype.loadPersistedSignature = function () {\n    if (isNullOrUndefined(this.signatureValue)) {\n      return;\n    } // eslint-disable-next-line @typescript-eslint/no-this-alias\n\n\n    var proxy = this;\n    var lastImage = new Image();\n    lastImage.src = this.signatureValue;\n\n    lastImage.onload = function () {\n      proxy.canvasContext.clearRect(0, 0, proxy.element.width, proxy.element.height);\n      proxy.canvasContext.drawImage(lastImage, 0, 0);\n      proxy.updateSnapCollection();\n    };\n\n    this.isSignatureEmpty = false;\n  };\n  /**\r\n   * To get the signature as Blob.\r\n   *\r\n   * @param {string} url - specify the url/base 64 string to get blob of the signature.\r\n   * @returns {Blob}.\r\n   */\n\n\n  SignatureBase.prototype.getBlob = function (url) {\n    var arr = url.split(',');\n    var type = arr[0].match(/:(.*?);/)[1];\n    var bstr = atob(arr[1]);\n    var n = bstr.length;\n    var u8arr = new Uint8Array(n);\n\n    while (n--) {\n      u8arr[n] = bstr.charCodeAt(n);\n    }\n\n    return new Blob([u8arr], {\n      type: type\n    });\n  };\n\n  SignatureBase.prototype.download = function (blob, fileName) {\n    var blobUrl = URL.createObjectURL(blob);\n    var a = document.createElement('a');\n    a.href = blobUrl;\n    a.target = '_parent';\n    a.download = fileName;\n    (document.body || document.documentElement).appendChild(a);\n    a.click();\n    a.parentNode.removeChild(a);\n  };\n  /**\r\n   * To refresh the signature.\r\n   *\r\n   * @private\r\n   * @returns {void}.\r\n   */\n\n\n  SignatureBase.prototype.refresh = function () {\n    this.pointColl = [];\n    this.lastVelocity = 0;\n    this.lastWidth = (this.minStrokeWidth + this.maxStrokeWidth) / 2;\n  };\n  /**\r\n   * Erases all the signature strokes signed by user.\r\n   *\r\n   * @returns {void}.\r\n   */\n\n\n  SignatureBase.prototype.clear = function () {\n    var args = {\n      actionName: 'clear'\n    };\n    this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\n    this.refresh();\n    this.updateSnapCollection(true);\n    this.isSignatureEmpty = true;\n\n    if (!this.isBlazor) {\n      this.trigger('change', args);\n    } else {\n      this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'Clear');\n    }\n  };\n  /**\r\n   * Undo the last user action.\r\n   *\r\n   * @returns {void}.\r\n   */\n\n\n  SignatureBase.prototype.undo = function () {\n    var args = {\n      actionName: 'undo'\n    }; // eslint-disable-next-line @typescript-eslint/no-this-alias\n\n    var proxy = this;\n\n    if (this.incStep > 0) {\n      this.incStep--;\n      var undoImg_1 = new Image();\n      undoImg_1.src = this.snapColl[this.incStep];\n\n      undoImg_1.onload = function () {\n        proxy.canvasContext.clearRect(0, 0, proxy.element.width, proxy.element.height);\n        proxy.canvasContext.drawImage(undoImg_1, 0, 0, proxy.element.width, proxy.element.height);\n      };\n    }\n\n    this.isClear();\n\n    if (!this.isBlazor) {\n      this.trigger('change', args);\n    } else {\n      this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'Undo');\n    }\n  };\n  /**\r\n   * Redo the last user action.\r\n   *\r\n   * @returns {void}.\r\n   */\n\n\n  SignatureBase.prototype.redo = function () {\n    var args = {\n      actionName: 'redo'\n    }; // eslint-disable-next-line @typescript-eslint/no-this-alias\n\n    var proxy = this;\n\n    if (this.incStep < this.snapColl.length - 1) {\n      this.incStep++;\n      var redoImg_1 = new Image();\n      redoImg_1.src = this.snapColl[this.incStep];\n\n      redoImg_1.onload = function () {\n        proxy.canvasContext.clearRect(0, 0, proxy.element.width, proxy.element.height);\n        proxy.canvasContext.drawImage(redoImg_1, 0, 0, proxy.element.width, proxy.element.height);\n      };\n    }\n\n    this.isClear();\n\n    if (!this.isBlazor) {\n      this.trigger('change', args);\n    } else {\n      this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'Redo');\n    }\n  };\n\n  SignatureBase.prototype.isClear = function () {\n    if (this.clearArray) {\n      var empty = false;\n\n      for (var i = 0; i < this.clearArray.length; i++) {\n        if (this.clearArray[i] === this.incStep) {\n          this.isSignatureEmpty = true;\n          empty = true;\n        }\n      }\n\n      if (!empty) {\n        this.isSignatureEmpty = false;\n      }\n    }\n  };\n  /**\r\n   * To check whether the signature is empty or not.\r\n   *\r\n   * @returns {boolean}.\r\n   */\n\n\n  SignatureBase.prototype.isEmpty = function () {\n    return this.isSignatureEmpty;\n  };\n  /**\r\n   * To check whether the undo collection is empty or not.\r\n   *\r\n   * @returns {boolean}.\r\n   */\n\n\n  SignatureBase.prototype.canUndo = function () {\n    return this.incStep > 0;\n  };\n  /**\r\n   * To check whether the redo collection is empty or not.\r\n   *\r\n   * @returns {boolean}.\r\n   */\n\n\n  SignatureBase.prototype.canRedo = function () {\n    return this.incStep < this.snapColl.length - 1;\n  };\n  /**\r\n   * To draw the signature based on the given text, with the font family and font size.\r\n   *\r\n   * @param {string} text - specify text to be drawn as signature.\r\n   * @param {string} fontFamily - specify font family of a signature.\r\n   * @param {number} fontSize - specify font size of a signature.\r\n   *\r\n   * @returns {void}.\r\n   */\n\n\n  SignatureBase.prototype.draw = function (text, fontFamily, fontSize) {\n    this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\n    fontFamily = fontFamily || 'Arial';\n    fontSize = fontSize || 30;\n    this.canvasContext.font = fontSize + 'px ' + fontFamily;\n    this.canvasContext.textAlign = 'center';\n    this.canvasContext.textBaseline = 'middle';\n    this.canvasContext.fillText(text, this.element.width / 2, this.element.height / 2);\n    this.updateSnapCollection();\n    this.isSignatureEmpty = false;\n  };\n  /**\r\n   * To load the signature with the given base 64 string, height and width.\r\n   *\r\n   * @param {string} signature - specify the url/base 64 string to be drawn as signature.\r\n   * @param {number} width - specify the width of the loaded signature image.\r\n   * @param {number} height - specify the height of the loaded signature image.\r\n   * @returns {void}.\r\n   */\n\n\n  SignatureBase.prototype.load = function (signature, width, height) {\n    height = height || this.element.height;\n    width = width || this.element.width;\n    this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height); // eslint-disable-next-line @typescript-eslint/no-this-alias\n\n    var proxy = this;\n    var bitmapImage = new Image();\n    bitmapImage.src = signature;\n\n    bitmapImage.onload = function () {\n      Promise.all([createImageBitmap(bitmapImage, 0, 0, width, height)]).then(function (results) {\n        var tempCanvas = document.createElement('canvas');\n        tempCanvas.width = width;\n        tempCanvas.height = height;\n        tempCanvas.getContext('2d').drawImage(results[0], 0, 0);\n        proxy.canvasContext.drawImage(tempCanvas, 0, 0, width, height, 0, 0, proxy.element.width, proxy.element.height);\n        proxy.updateSnapCollection();\n      });\n    };\n\n    this.isSignatureEmpty = false;\n  };\n\n  SignatureBase.prototype.saveBackground = function (savebg) {\n    var imageSrc;\n\n    if (savebg && this.backgroundImage) {\n      imageSrc = this.snapColl[this.incStep - 1];\n    } else {\n      imageSrc = this.snapColl[this.incStep];\n    }\n\n    if (!savebg) {\n      this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\n\n      if (this.backgroundImage) {\n        this.setBackgroundImage(this.backgroundImage);\n      } else if (this.backgroundColor) {\n        this.setBackgroundColor(this.backgroundColor);\n        savebg = true;\n      }\n    }\n\n    if (savebg) {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var proxy_1 = this;\n      var imageObj_1 = new Image();\n      imageObj_1.crossOrigin = 'anonymous';\n      imageObj_1.src = imageSrc;\n\n      imageObj_1.onload = function () {\n        proxy_1.backgroundLoaded = true;\n        proxy_1.canvasContext.globalCompositeOperation = 'source-over';\n        proxy_1.canvasContext.drawImage(imageObj_1, 0, 0, proxy_1.element.width, proxy_1.element.height);\n        proxy_1.save(proxy_1.fileType, proxy_1.fileName);\n      };\n    }\n  };\n  /**\r\n   * To save the signature with the given file type and file name.\r\n   *\r\n   * @param {SignatureFileType} type - specify type of the file to be saved a signature.\r\n   * @param {string} fileName - specify name of the file to be saved a signature.\r\n   *\r\n   * @returns {void}.\r\n   */\n\n\n  SignatureBase.prototype.save = function (type, fileName) {\n    if (this.saveWithBackground && this.backgroundLoaded == null && (this.backgroundImage || this.backgroundColor)) {\n      this.backgroundLoaded = false;\n      this.fileType = type;\n      this.fileName = fileName;\n      this.saveBackground(false);\n    } else if (type === 'Svg') {\n      fileName = fileName || 'Signature';\n      this.toSVG(fileName);\n    } else if (type === 'Jpeg') {\n      fileName = fileName || 'Signature';\n\n      if (!this.saveWithBackground || this.saveWithBackground && !(this.backgroundImage || this.backgroundColor)) {\n        this.toJPEG(fileName);\n      } else {\n        var dataURL = this.canvasContext.canvas.toDataURL('image/jpeg');\n        this.download(this.getBlob(dataURL), fileName + '.' + 'jpeg');\n      }\n    } else {\n      fileName = fileName || 'Signature';\n      var dataURL = this.canvasContext.canvas.toDataURL('image/png');\n      this.download(this.getBlob(dataURL), fileName + '.' + 'png');\n    }\n\n    if (this.saveWithBackground && this.backgroundLoaded) {\n      this.resetSnap();\n    }\n  };\n\n  SignatureBase.prototype.resetSnap = function () {\n    this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height); // eslint-disable-next-line @typescript-eslint/no-this-alias\n\n    var proxy = this;\n    var restoreObj = new Image();\n    restoreObj.src = this.snapColl[this.incStep - 1];\n\n    restoreObj.onload = function () {\n      proxy.canvasContext.drawImage(restoreObj, 0, 0, proxy.element.width, proxy.element.height);\n      proxy.updateSnapCollection();\n    };\n\n    this.backgroundLoaded = null;\n    this.snapColl.pop();\n    this.incStep--;\n    this.snapColl.pop();\n    this.incStep--;\n  };\n\n  SignatureBase.prototype.toJPEG = function (fileName) {\n    var _this = this;\n\n    var imageSrc = this.snapColl[this.incStep];\n    this.setBackgroundColor('#ffffff'); // eslint-disable-next-line @typescript-eslint/no-this-alias\n\n    var proxy = this;\n    var imageObj = new Image();\n    imageObj.crossOrigin = 'anonymous';\n    imageObj.src = imageSrc;\n\n    imageObj.onload = function () {\n      proxy.canvasContext.globalCompositeOperation = 'source-over';\n      proxy.canvasContext.drawImage(imageObj, 0, 0, proxy.element.width, proxy.element.height);\n      var dataURL = proxy.canvasContext.canvas.toDataURL('image/jpeg');\n      proxy.download(proxy.getBlob(dataURL), fileName + '.' + 'jpeg');\n      proxy.canvasContext.clearRect(0, 0, proxy.canvasContext.canvas.width, proxy.canvasContext.canvas.height);\n\n      _this.resizeHandler();\n    };\n\n    this.snapColl.pop();\n    this.incStep--;\n  };\n\n  SignatureBase.prototype.toSVG = function (fileName) {\n    var dataUrl = this.canvasContext.canvas.toDataURL();\n    var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    svg.setAttribute('width', this.canvasContext.canvas.width.toString());\n    svg.setAttribute('height', this.canvasContext.canvas.height.toString());\n    var XLinkNS = 'http://www.w3.org/1999/xlink';\n    var img = document.createElementNS('http://www.w3.org/2000/svg', 'image');\n    img.setAttributeNS(null, 'height', this.canvasContext.canvas.height.toString());\n    img.setAttributeNS(null, 'width', this.canvasContext.canvas.width.toString());\n    img.setAttributeNS(XLinkNS, 'xlink:href', dataUrl);\n    svg.appendChild(img);\n    var prefix = 'data:image/svg+xml;base64,';\n    var header = '<svg' + ' xmlns=\"http://www.w3.org/2000/svg\"' + ' xmlns:xlink=\"http://www.w3.org/1999/xlink\"' + (\" width=\\\"\" + this.canvasContext.canvas.width + \"\\\"\") + (\" height=\\\"\" + this.canvasContext.canvas.height + \"\\\"\") + '>';\n    var footer = '</svg>';\n    var body = svg.innerHTML;\n    var data = header + body + footer;\n    var svgDataUrl = prefix + btoa(data);\n\n    if (fileName == null) {\n      return svgDataUrl;\n    } else {\n      this.download(this.getBlob(svgDataUrl), fileName + '.' + 'svg');\n      return null;\n    }\n  };\n  /**\r\n   * To save the signature as Blob.\r\n   *\r\n   * @returns {Blob}.\r\n   */\n\n\n  SignatureBase.prototype.saveAsBlob = function () {\n    return this.getBlob(this.canvasContext.canvas.toDataURL('image/png'));\n  };\n  /**\r\n   * To get the signature as Base 64.\r\n   *\r\n   * @private\r\n   * @param {SignatureFileType} type - Specifies the type of the image format.\r\n   * @returns {string}.\r\n   */\n\n\n  SignatureBase.prototype.getSignature = function (type) {\n    if (type === 'Jpeg') {\n      var imgData = this.canvasContext.getImageData(0, 0, this.element.width, this.element.height);\n      var data = imgData.data;\n\n      for (var i = 0; i < data.length; i += 4) {\n        if (data[i + 3] < 255) {\n          data[i] = 255 - data[i];\n          data[i + 1] = 255 - data[i + 1];\n          data[i + 2] = 255 - data[i + 2];\n          data[i + 3] = 255 - data[i + 3];\n        }\n      }\n\n      this.canvasContext.putImageData(imgData, 0, 0);\n      var dataURL = this.canvasContext.canvas.toDataURL('image/jpeg');\n      this.resizeHandler();\n      return dataURL;\n    } else if (type === 'Svg') {\n      return this.toSVG(null);\n    } else {\n      return this.canvasContext.canvas.toDataURL('image/png');\n    }\n  };\n  /**\r\n   * Get component name.\r\n   *\r\n   * @returns {string} - Module Name\r\n   * @private\r\n   */\n\n\n  SignatureBase.prototype.getModuleName = function () {\n    return 'signature';\n  };\n  /**\r\n   * To get the properties to be maintained in the persisted state.\r\n   *\r\n   * @returns {string} - Persist data\r\n   */\n\n\n  SignatureBase.prototype.getPersistData = function () {\n    this.signatureValue = this.snapColl[this.incStep];\n    return this.addOnPersist(['signatureValue']);\n  };\n  /**\r\n   * Removes the component from the DOM and detaches all its related event handlers.\r\n   * Also it maintains the initial input element from the DOM.\r\n   *\r\n   * @method destroy\r\n   * @returns {void}\r\n   */\n\n\n  SignatureBase.prototype.destroy = function () {\n    this.unwireEvents(null);\n    removeClass([this.element], 'e-' + this.getModuleName());\n    this.element.removeAttribute('tabindex');\n    this.pointColl = null;\n\n    _super.prototype.destroy.call(this);\n  };\n  /**\r\n   * Modified onPropertyChanged method for both blazor and EJ2 signature component.\r\n   *\r\n   * @private\r\n   * @param {string} key - Specifies the property, which changed.\r\n   * @param {string} value - Specifies the property value changed.\r\n   * @returns {void}\r\n   */\n\n\n  SignatureBase.prototype.propertyChanged = function (key, value) {\n    var canvasNew = this.canvasContext;\n\n    switch (key) {\n      case 'backgroundColor':\n        canvasNew.canvas.style.backgroundColor = value;\n        this.backgroundColor = value;\n        break;\n\n      case 'backgroundImage':\n        canvasNew.canvas.style.backgroundImage = 'url(' + value + ')';\n        this.backgroundImage = value;\n        break;\n\n      case 'strokeColor':\n        canvasNew.fillStyle = value;\n        this.strokeColor = value;\n        break;\n\n      case 'saveWithBackground':\n        this.saveWithBackground = value;\n        break;\n\n      case 'maxStrokeWidth':\n        this.maxStrokeWidth = value;\n        break;\n\n      case 'minStrokeWidth':\n        this.minStrokeWidth = value;\n        break;\n\n      case 'velocity':\n        this.velocity = value;\n        break;\n\n      case 'isReadOnly':\n        this.isRead(value);\n        break;\n\n      case 'disabled':\n        this.enableOrDisable(value);\n        break;\n    }\n  };\n\n  return SignatureBase;\n}(Component);\n\nexport { SignatureBase };","map":{"version":3,"sources":["C:/Users/x/Desktop/openDSA/openDSA_dashboard/project/node_modules/@syncfusion/ej2-inputs/src/common/signature-base.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Component","removeClass","EventHandler","isNullOrUndefined","SignatureBase","_super","_this","apply","arguments","minDistance","previous","interval","timeout","isSignatureEmpty","backgroundLoaded","clearArray","isBlazor","initialize","element","parameter","dotnetRef","canvasContext","getContext","canvas","tabIndex","setBlazorParameter","setHTMLProperties","signatureValue","updateSnapCollection","wireEvents","trigger","backgroundColor","backgroundImage","disabled","isReadOnly","maxStrokeWidth","minStrokeWidth","velocity","strokeColor","saveWithBackground","loadPersistedSignature","pointColl","add","mouseDownHandler","keyboardHandler","window","addEventListener","resizeHandler","bind","mouseMoveHandler","mouseUpHandler","document","unwireEvents","type","remove","removeEventListener","height","offsetHeight","width","offsetWidth","scale","fillStyle","style","e","buttons","preventDefault","stopPropagation","beginStroke","updateStrokeWithThrottle","updateStroke","args","actionName","endDraw","invokeMethodAsync","snapColl","incStep","fileName","cancel","key","clear","ctrlKey","observableSaveArgs","save","stopImmediatePropagation","undo","redo","proxy","restoreImg","Image","src","onload","clearRect","drawImage","refresh","point","createPoint","addPoint","now","Date","remaining","storedArgs","clearTimeout","setTimeout","delay","rect","getBoundingClientRect","clientX","left","clientY","top","getTime","touches","pointX","pointY","time","x","y","points","controlPoint1","controlPoint2","lastPoint","length","isLastPointTooClose","distanceTo","push","unshift","calculateCurveControlPoints","startPoint","endPoint","startDraw","shift","pointVelocityCalc","lastVelocity","newWidth","Math","max","curveDraw","lastWidth","canDrawCurve","strokeDraw","startWidth","endWidth","context","i","t1","t2","t3","u1","u2","u3","widthValue","bezierLength","bezierLengthCalc","drawSteps","ceil","beginPath","min","arcDraw","closePath","fill","pointSize","size","moveTo","arc","PI","p1","p2","p3","dx1","dy1","dx2","dy2","m1","m2","l1","sqrt","l2","dxm","dym","k","cm","tx","ty","steps","t","pointx1","pointy1","pointx2","pointy2","pointx3","pointy3","bezierPointCalc","startpoint","cp1","cp2","endpoint","start","pow","isRead","enableOrDisable","isDisable","reDraw","opacity","data","getImageData","putImageData","isClear","canvasNew","createElement","className","getModuleName","canvasContextNew","toDataURL","setBackgroundImage","imageSrc","imageObj","crossOrigin","globalCompositeOperation","saveBackground","setBackgroundColor","color","canvasEle","strokeStyle","j","strokeRect","lastImage","getBlob","url","arr","split","match","bstr","atob","n","u8arr","Uint8Array","charCodeAt","Blob","download","blob","blobUrl","URL","createObjectURL","a","href","target","body","documentElement","appendChild","click","parentNode","removeChild","undoImg_1","redoImg_1","empty","isEmpty","canUndo","canRedo","draw","text","fontFamily","fontSize","font","textAlign","textBaseline","fillText","load","signature","bitmapImage","Promise","all","createImageBitmap","then","results","tempCanvas","savebg","proxy_1","imageObj_1","fileType","toSVG","toJPEG","dataURL","resetSnap","restoreObj","pop","dataUrl","svg","createElementNS","setAttribute","toString","XLinkNS","img","setAttributeNS","prefix","header","footer","innerHTML","svgDataUrl","btoa","saveAsBlob","getSignature","imgData","getPersistData","addOnPersist","destroy","removeAttribute","call","propertyChanged","value"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { Component, removeClass } from '@syncfusion/ej2-base';\r\nimport { EventHandler, isNullOrUndefined } from '@syncfusion/ej2-base';\r\nvar SignatureBase = /** @class */ (function (_super) {\r\n    __extends(SignatureBase, _super);\r\n    function SignatureBase() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        /* minDistance(distance between the two point) was calaculated for smoothness.*/\r\n        _this.minDistance = 5;\r\n        _this.previous = 0;\r\n        /* interval handles for the smoothness in the mouse move event.*/\r\n        _this.interval = 30;\r\n        _this.timeout = null;\r\n        _this.isSignatureEmpty = true;\r\n        _this.backgroundLoaded = null;\r\n        _this.clearArray = [];\r\n        _this.isBlazor = false;\r\n        return _this;\r\n    }\r\n    /**\r\n     * To Initialize the component rendering\r\n     *\r\n     * @private\r\n     * @param {HTMLCanvasElement} element - Specifies the canvas element.\r\n     * @param {parameter} parameter - Specifies only for the blazor parameter.\r\n     * @param {BlazorDotnetObject} dotnetRef - Specifies for blazor client to server communication.\r\n     * @returns {void}\r\n     */\r\n    SignatureBase.prototype.initialize = function (element, parameter, dotnetRef) {\r\n        this.element = element;\r\n        this.canvasContext = this.element.getContext('2d');\r\n        this.canvasContext.canvas.tabIndex = 0;\r\n        if (parameter) {\r\n            this.setBlazorParameter(parameter);\r\n            this.dotnetRef = dotnetRef;\r\n        }\r\n        this.setHTMLProperties();\r\n        if (isNullOrUndefined(this.signatureValue)) {\r\n            this.updateSnapCollection(true);\r\n        }\r\n        this.wireEvents();\r\n        this.isSignatureEmpty = true;\r\n        if (!this.isBlazor) {\r\n            this.trigger('created', null);\r\n        }\r\n    };\r\n    SignatureBase.prototype.setBlazorParameter = function (parameter) {\r\n        this.isBlazor = true;\r\n        this.backgroundColor = parameter.backgroundColor;\r\n        this.backgroundImage = parameter.backgroundImage;\r\n        this.disabled = parameter.disabled;\r\n        this.isReadOnly = parameter.isReadOnly;\r\n        this.maxStrokeWidth = parameter.maxStrokeWidth || 2;\r\n        this.minStrokeWidth = parameter.minStrokeWidth || 0.5;\r\n        this.velocity = parameter.velocity || 0.7;\r\n        this.strokeColor = parameter.strokeColor || '#000000';\r\n        this.saveWithBackground = parameter.saveWithBackground;\r\n        this.interval = 30;\r\n        this.previous = 0;\r\n        this.minDistance = 5;\r\n        this.signatureValue = parameter.signatureValue;\r\n        if (this.signatureValue) {\r\n            this.loadPersistedSignature();\r\n        }\r\n    };\r\n    SignatureBase.prototype.wireEvents = function () {\r\n        if (isNullOrUndefined(this.pointColl) && !this.isReadOnly && !this.disabled) {\r\n            EventHandler.add(this.canvasContext.canvas, 'mousedown touchstart', this.mouseDownHandler, this);\r\n            EventHandler.add(this.canvasContext.canvas, 'keydown', this.keyboardHandler, this);\r\n            window.addEventListener('resize', this.resizeHandler.bind(this));\r\n        }\r\n        else if (this.pointColl) {\r\n            EventHandler.add(this.canvasContext.canvas, 'mousemove touchmove', this.mouseMoveHandler, this);\r\n            EventHandler.add(this.canvasContext.canvas, 'mouseup touchend', this.mouseUpHandler, this);\r\n            EventHandler.add(document, 'mouseup', this.mouseUpHandler, this);\r\n        }\r\n    };\r\n    SignatureBase.prototype.unwireEvents = function (type) {\r\n        if (type === 'mouseup' || type === 'touchend') {\r\n            EventHandler.remove(this.canvasContext.canvas, 'mousemove touchmove', this.mouseMoveHandler);\r\n            EventHandler.remove(this.canvasContext.canvas, 'mouseup touchend', this.mouseUpHandler);\r\n            EventHandler.remove(document, 'mouseup', this.mouseUpHandler);\r\n        }\r\n        else {\r\n            EventHandler.remove(this.canvasContext.canvas, 'mousedown touchstart', this.mouseDownHandler);\r\n            EventHandler.remove(this.canvasContext.canvas, 'mousemove touchmove', this.mouseMoveHandler);\r\n            EventHandler.remove(this.canvasContext.canvas, 'mouseup touchend', this.mouseUpHandler);\r\n            EventHandler.remove(document, 'mouseup', this.mouseUpHandler);\r\n            EventHandler.remove(this.canvasContext.canvas, 'keydown', this.keyboardHandler);\r\n            window.removeEventListener('resize', this.resizeHandler);\r\n        }\r\n    };\r\n    SignatureBase.prototype.setHTMLProperties = function () {\r\n        if (this.element.height === 150) {\r\n            this.element.height = this.element.offsetHeight;\r\n        }\r\n        if (this.element.width === 300) {\r\n            this.element.width = this.element.offsetWidth;\r\n        }\r\n        this.canvasContext.scale(1, 1);\r\n        this.canvasContext.fillStyle = this.strokeColor;\r\n        if (this.backgroundImage) {\r\n            this.canvasContext.canvas.style.backgroundImage = 'url(' + this.backgroundImage + ')';\r\n        }\r\n        else if (this.backgroundColor) {\r\n            this.canvasContext.canvas.style.backgroundColor = this.backgroundColor;\r\n        }\r\n    };\r\n    SignatureBase.prototype.mouseDownHandler = function (e) {\r\n        if (e.buttons === 1 || e.buttons === 2 || e.type === 'touchstart') {\r\n            if (e.type === 'touchstart') {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n            this.beginStroke(e);\r\n            this.wireEvents();\r\n        }\r\n    };\r\n    SignatureBase.prototype.mouseMoveHandler = function (e) {\r\n        if (e.buttons === 1 || e.buttons === 2 || e.type === 'touchmove') {\r\n            if (e.type === 'touchmove') {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n            if (this.interval) {\r\n                this.updateStrokeWithThrottle(e);\r\n            }\r\n            else {\r\n                this.updateStroke(e);\r\n            }\r\n        }\r\n    };\r\n    SignatureBase.prototype.mouseUpHandler = function (e) {\r\n        var args = { actionName: 'strokeUpdate' };\r\n        if (e.type === 'touchstart') {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n        }\r\n        this.endDraw();\r\n        this.updateSnapCollection();\r\n        this.unwireEvents(e.type);\r\n        if (!this.isBlazor) {\r\n            this.trigger('change', args);\r\n        }\r\n        else {\r\n            this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'mouseUp');\r\n        }\r\n        this.signatureValue = this.snapColl[this.incStep];\r\n    };\r\n    SignatureBase.prototype.keyboardHandler = function (e) {\r\n        var _this = this;\r\n        var args = { fileName: 'Signature', type: 'Png', cancel: false };\r\n        switch (e.key) {\r\n            case 'Delete':\r\n                this.clear();\r\n                break;\r\n            case (e.ctrlKey && 's'):\r\n                if (!this.isBlazor) {\r\n                    this.trigger('beforeSave', args, function (observableSaveArgs) {\r\n                        if (!args.cancel) {\r\n                            _this.save(observableSaveArgs.type, observableSaveArgs.fileName);\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'beforeSave');\r\n                }\r\n                e.preventDefault();\r\n                e.stopImmediatePropagation();\r\n                break;\r\n            case (e.ctrlKey && 'z'):\r\n                this.undo();\r\n                break;\r\n            case (e.ctrlKey && 'y'):\r\n                this.redo();\r\n                break;\r\n        }\r\n    };\r\n    SignatureBase.prototype.resizeHandler = function () {\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var proxy = this;\r\n        this.canvasContext.canvas.width = this.element.offsetWidth;\r\n        this.canvasContext.canvas.height = this.element.offsetHeight;\r\n        this.canvasContext.scale(1, 1);\r\n        var restoreImg = new Image();\r\n        restoreImg.src = this.snapColl[this.incStep];\r\n        restoreImg.onload = function () {\r\n            proxy.canvasContext.clearRect(0, 0, proxy.element.width, proxy.element.height);\r\n            proxy.canvasContext.drawImage(restoreImg, 0, 0, proxy.element.width, proxy.element.height);\r\n        };\r\n    };\r\n    SignatureBase.prototype.beginStroke = function (e) {\r\n        this.refresh();\r\n        this.updateStroke(e);\r\n    };\r\n    SignatureBase.prototype.updateStroke = function (e) {\r\n        var point = this.createPoint(e);\r\n        this.addPoint(point);\r\n    };\r\n    SignatureBase.prototype.updateStrokeWithThrottle = function (args) {\r\n        var now = Date.now();\r\n        var remaining = this.interval - (now - this.previous);\r\n        this.storedArgs = args;\r\n        if (remaining <= 0 || remaining > this.interval) {\r\n            if (this.timeout) {\r\n                clearTimeout(this.timeout);\r\n                this.timeout = null;\r\n            }\r\n            this.previous = now;\r\n            this.updateStroke(this.storedArgs);\r\n            if (!this.timeout) {\r\n                this.storedArgs = null;\r\n            }\r\n        }\r\n        else if (!this.timeout) {\r\n            this.timeout = window.setTimeout(this.delay.bind(this), remaining);\r\n        }\r\n    };\r\n    SignatureBase.prototype.delay = function () {\r\n        this.previous = Date.now();\r\n        this.timeout = null;\r\n        this.updateStroke(this.storedArgs);\r\n        if (!this.timeout) {\r\n            this.storedArgs = null;\r\n        }\r\n    };\r\n    SignatureBase.prototype.createPoint = function (e) {\r\n        var rect = this.canvasContext.canvas.getBoundingClientRect();\r\n        if (e.type === 'mousedown' || e.type === 'mousemove') {\r\n            return this.point(e.clientX - rect.left, e.clientY - rect.top, new Date().getTime());\r\n        }\r\n        else {\r\n            return this.point(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top, new Date().getTime());\r\n        }\r\n    };\r\n    /* Returns the current point corrdinates(x, y) and time.*/\r\n    SignatureBase.prototype.point = function (pointX, pointY, time) {\r\n        this.pointX = pointX;\r\n        this.pointY = pointY;\r\n        this.time = time || new Date().getTime();\r\n        return { x: this.pointX, y: this.pointY, time: this.time };\r\n    };\r\n    SignatureBase.prototype.addPoint = function (point) {\r\n        var points = this.pointColl;\r\n        var controlPoint1;\r\n        var controlPoint2;\r\n        var lastPoint = points.length > 0 && points[points.length - 1];\r\n        var isLastPointTooClose = lastPoint ? this.distanceTo(lastPoint) <= this.minDistance : false;\r\n        if (!lastPoint || !(lastPoint && isLastPointTooClose)) {\r\n            points.push(point);\r\n            if (points.length > 2) {\r\n                if (points.length === 3) {\r\n                    points.unshift(points[0]);\r\n                }\r\n                controlPoint1 = (this.calculateCurveControlPoints(points[0], points[1], points[2])).controlPoint2;\r\n                controlPoint2 = (this.calculateCurveControlPoints(points[1], points[2], points[3])).controlPoint1;\r\n                this.startPoint = points[1];\r\n                this.controlPoint1 = controlPoint1;\r\n                this.controlPoint2 = controlPoint2;\r\n                this.endPoint = points[2];\r\n                this.startDraw();\r\n                points.shift();\r\n            }\r\n        }\r\n    };\r\n    SignatureBase.prototype.startDraw = function () {\r\n        var velocity;\r\n        velocity = this.pointVelocityCalc(this.startPoint);\r\n        velocity = this.velocity * velocity + (1 - this.velocity) * this.lastVelocity;\r\n        var newWidth = Math.max(this.maxStrokeWidth / (velocity + 1), this.minStrokeWidth);\r\n        this.curveDraw(this.lastWidth, newWidth);\r\n        this.lastVelocity = velocity;\r\n        this.lastWidth = newWidth;\r\n    };\r\n    SignatureBase.prototype.endDraw = function () {\r\n        var canDrawCurve = this.pointColl.length > 2;\r\n        var point = this.pointColl[0];\r\n        if (!canDrawCurve && point) {\r\n            this.strokeDraw(point);\r\n        }\r\n    };\r\n    /* Calculate the Bezier (x, y) coordinate of the curve. */\r\n    SignatureBase.prototype.curveDraw = function (startWidth, endWidth) {\r\n        var context = this.canvasContext;\r\n        var width;\r\n        var i;\r\n        var t1;\r\n        var t2;\r\n        var t3;\r\n        var u1;\r\n        var u2;\r\n        var u3;\r\n        var x;\r\n        var y;\r\n        var widthValue = endWidth - startWidth;\r\n        var bezierLength = this.bezierLengthCalc();\r\n        var drawSteps = Math.ceil(bezierLength) * 2;\r\n        context.beginPath();\r\n        for (i = 0; i < drawSteps; i++) {\r\n            t1 = i / drawSteps;\r\n            t2 = t1 * t1;\r\n            t3 = t2 * t1;\r\n            u1 = 1 - t1;\r\n            u2 = u1 * u1;\r\n            u3 = u2 * u1;\r\n            x = u3 * this.startPoint.x;\r\n            x += 3 * u2 * t1 * this.controlPoint1.x;\r\n            x += 3 * u1 * t2 * this.controlPoint2.x;\r\n            x += t3 * this.endPoint.x;\r\n            y = u3 * this.startPoint.y;\r\n            y += 3 * u2 * t1 * this.controlPoint1.y;\r\n            y += 3 * u1 * t2 * this.controlPoint2.y;\r\n            y += t3 * this.endPoint.y;\r\n            width = Math.min(startWidth + t3 * widthValue, this.maxStrokeWidth);\r\n            this.arcDraw(x, y, width);\r\n        }\r\n        context.closePath();\r\n        context.fill();\r\n        this.isSignatureEmpty = false;\r\n    };\r\n    SignatureBase.prototype.strokeDraw = function (point) {\r\n        var context = this.canvasContext;\r\n        var pointSize = (this.minStrokeWidth + this.maxStrokeWidth) / 2;\r\n        context.beginPath();\r\n        this.arcDraw(point.x, point.y, pointSize);\r\n        context.closePath();\r\n        context.fill();\r\n        this.isSignatureEmpty = false;\r\n    };\r\n    SignatureBase.prototype.arcDraw = function (x, y, size) {\r\n        var context = this.canvasContext;\r\n        context.moveTo(x, y);\r\n        context.arc(x, y, size, 0, 2 * Math.PI, false);\r\n    };\r\n    /* Utility functions for Bezier algorithm*/\r\n    SignatureBase.prototype.calculateCurveControlPoints = function (p1, p2, p3) {\r\n        var dx1 = p1.x - p2.x;\r\n        var dy1 = p1.y - p2.y;\r\n        var dx2 = p2.x - p3.x;\r\n        var dy2 = p2.y - p3.y;\r\n        var m1 = { x: (p1.x + p2.x) / 2.0, y: (p1.y + p2.y) / 2.0 };\r\n        var m2 = { x: (p2.x + p3.x) / 2.0, y: (p2.y + p3.y) / 2.0 };\r\n        var l1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);\r\n        var l2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);\r\n        var dxm = (m1.x - m2.x);\r\n        var dym = (m1.y - m2.y);\r\n        var k = l2 / (l1 + l2);\r\n        var cm = { x: m2.x + dxm * k, y: m2.y + dym * k };\r\n        var tx = p2.x - cm.x;\r\n        var ty = p2.y - cm.y;\r\n        return {\r\n            controlPoint1: this.point(m1.x + tx, m1.y + ty, 0),\r\n            controlPoint2: this.point(m2.x + tx, m2.y + ty, 0)\r\n        };\r\n    };\r\n    /* Returns approximated bezier length of the curuve.*/\r\n    SignatureBase.prototype.bezierLengthCalc = function () {\r\n        var steps = 10;\r\n        var length = 0;\r\n        var i;\r\n        var t;\r\n        var pointx1;\r\n        var pointy1;\r\n        var pointx2;\r\n        var pointy2;\r\n        var pointx3;\r\n        var pointy3;\r\n        for (i = 0; i <= steps; i++) {\r\n            t = i / steps;\r\n            pointx1 = this.bezierPointCalc(t, this.startPoint.x, this.controlPoint1.x, this.controlPoint2.x, this.endPoint.x);\r\n            pointy1 = this.bezierPointCalc(t, this.startPoint.y, this.controlPoint1.y, this.controlPoint2.y, this.endPoint.y);\r\n            if (i > 0) {\r\n                pointx3 = pointx1 - pointx2;\r\n                pointy3 = pointy1 - pointy2;\r\n                length += Math.sqrt(pointx3 * pointx3 + pointy3 * pointy3);\r\n            }\r\n            pointx2 = pointx1;\r\n            pointy2 = pointy1;\r\n        }\r\n        return length;\r\n    };\r\n    /* Calculate parametric value of x or y given t and the\r\n       four point(startpoint, controlpoint1, controlpoint2, endpoint) coordinates of a cubic bezier curve.*/\r\n    SignatureBase.prototype.bezierPointCalc = function (t, startpoint, cp1, cp2, endpoint) {\r\n        return startpoint * (1.0 - t) * (1.0 - t) * (1.0 - t) + 3.0 * cp1 * (1.0 - t) * (1.0 - t) * t + 3.0 *\r\n            cp2 * (1.0 - t) * t * t + endpoint * t * t * t;\r\n    };\r\n    /* Velocity between the current point and last point.*/\r\n    SignatureBase.prototype.pointVelocityCalc = function (startPoint) {\r\n        return (this.time !== startPoint.time) ? this.distanceTo(startPoint) / (this.time - startPoint.time) : 0;\r\n    };\r\n    /* Distance between the current point and last point.*/\r\n    SignatureBase.prototype.distanceTo = function (start) {\r\n        return Math.sqrt(Math.pow(this.pointX - start.x, 2) + Math.pow(this.pointY - start.y, 2));\r\n    };\r\n    SignatureBase.prototype.isRead = function (isRead) {\r\n        if (isRead) {\r\n            EventHandler.remove(this.canvasContext.canvas, 'mousedown touchstart', this.mouseDownHandler);\r\n        }\r\n        else if (!this.disabled) {\r\n            EventHandler.add(this.canvasContext.canvas, 'mousedown touchstart', this.mouseDownHandler, this);\r\n        }\r\n    };\r\n    SignatureBase.prototype.enableOrDisable = function (isDisable) {\r\n        this.disabled = isDisable;\r\n        if (isDisable) {\r\n            this.reDraw('0.5');\r\n            this.isRead(true);\r\n        }\r\n        else {\r\n            this.reDraw('1');\r\n            this.isRead(false);\r\n        }\r\n    };\r\n    SignatureBase.prototype.reDraw = function (opacity) {\r\n        var data = this.canvasContext.getImageData(0, 0, this.element.width, this.element.height);\r\n        this.canvasContext.clearRect(0, 0, this.element.width, this.element.height);\r\n        this.element.style.opacity = opacity;\r\n        this.canvasContext.putImageData(data, 0, 0);\r\n    };\r\n    SignatureBase.prototype.updateSnapCollection = function (isClear) {\r\n        if (isNullOrUndefined(this.incStep)) {\r\n            this.incStep = -1;\r\n            this.incStep++;\r\n            this.snapColl = [];\r\n            this.clearArray = [];\r\n        }\r\n        else {\r\n            this.incStep++;\r\n        }\r\n        if (this.incStep < this.snapColl.length) {\r\n            this.snapColl.length = this.incStep;\r\n        }\r\n        if (this.incStep > 0) {\r\n            var canvasNew = this.createElement('canvas', { className: 'e-' + this.getModuleName() + '-wrapper' });\r\n            var canvasContextNew = canvasNew.getContext('2d');\r\n            canvasNew.width = this.canvasContext.canvas.width;\r\n            canvasNew.height = this.canvasContext.canvas.height;\r\n            canvasContextNew.drawImage(this.canvasContext.canvas, 0, 0, canvasNew.width, canvasNew.height);\r\n            this.snapColl.push(canvasNew.toDataURL());\r\n        }\r\n        else {\r\n            this.snapColl.push(this.canvasContext.canvas.toDataURL());\r\n        }\r\n        if (isClear) {\r\n            this.clearArray.push(this.incStep);\r\n        }\r\n    };\r\n    SignatureBase.prototype.setBackgroundImage = function (imageSrc) {\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var proxy = this;\r\n        var imageObj = new Image();\r\n        imageObj.crossOrigin = 'anonymous';\r\n        imageObj.src = imageSrc;\r\n        imageObj.onload = function () {\r\n            proxy.canvasContext.globalCompositeOperation = 'source-over';\r\n            proxy.canvasContext.drawImage(imageObj, 0, 0, proxy.element.width, proxy.element.height);\r\n            proxy.updateSnapCollection();\r\n            proxy.saveBackground(true);\r\n        };\r\n        this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\r\n    };\r\n    SignatureBase.prototype.setBackgroundColor = function (color) {\r\n        var canvasEle = this.canvasContext;\r\n        canvasEle.strokeStyle = color;\r\n        var i;\r\n        var j;\r\n        for (i = 1; i <= canvasEle.canvas.width; i++) {\r\n            for (j = 1; j <= canvasEle.canvas.height; j++) {\r\n                canvasEle.strokeRect(0, 0, i, j);\r\n            }\r\n        }\r\n        this.updateSnapCollection();\r\n    };\r\n    SignatureBase.prototype.loadPersistedSignature = function () {\r\n        if (isNullOrUndefined(this.signatureValue)) {\r\n            return;\r\n        }\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var proxy = this;\r\n        var lastImage = new Image();\r\n        lastImage.src = this.signatureValue;\r\n        lastImage.onload = function () {\r\n            proxy.canvasContext.clearRect(0, 0, proxy.element.width, proxy.element.height);\r\n            proxy.canvasContext.drawImage(lastImage, 0, 0);\r\n            proxy.updateSnapCollection();\r\n        };\r\n        this.isSignatureEmpty = false;\r\n    };\r\n    /**\r\n     * To get the signature as Blob.\r\n     *\r\n     * @param {string} url - specify the url/base 64 string to get blob of the signature.\r\n     * @returns {Blob}.\r\n     */\r\n    SignatureBase.prototype.getBlob = function (url) {\r\n        var arr = url.split(',');\r\n        var type = arr[0].match(/:(.*?);/)[1];\r\n        var bstr = atob(arr[1]);\r\n        var n = bstr.length;\r\n        var u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: type });\r\n    };\r\n    SignatureBase.prototype.download = function (blob, fileName) {\r\n        var blobUrl = URL.createObjectURL(blob);\r\n        var a = document.createElement('a');\r\n        a.href = blobUrl;\r\n        a.target = '_parent';\r\n        a.download = fileName;\r\n        (document.body || document.documentElement).appendChild(a);\r\n        a.click();\r\n        a.parentNode.removeChild(a);\r\n    };\r\n    /**\r\n     * To refresh the signature.\r\n     *\r\n     * @private\r\n     * @returns {void}.\r\n     */\r\n    SignatureBase.prototype.refresh = function () {\r\n        this.pointColl = [];\r\n        this.lastVelocity = 0;\r\n        this.lastWidth = (this.minStrokeWidth + this.maxStrokeWidth) / 2;\r\n    };\r\n    /**\r\n     * Erases all the signature strokes signed by user.\r\n     *\r\n     * @returns {void}.\r\n     */\r\n    SignatureBase.prototype.clear = function () {\r\n        var args = { actionName: 'clear' };\r\n        this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\r\n        this.refresh();\r\n        this.updateSnapCollection(true);\r\n        this.isSignatureEmpty = true;\r\n        if (!this.isBlazor) {\r\n            this.trigger('change', args);\r\n        }\r\n        else {\r\n            this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'Clear');\r\n        }\r\n    };\r\n    /**\r\n     * Undo the last user action.\r\n     *\r\n     * @returns {void}.\r\n     */\r\n    SignatureBase.prototype.undo = function () {\r\n        var args = { actionName: 'undo' };\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var proxy = this;\r\n        if (this.incStep > 0) {\r\n            this.incStep--;\r\n            var undoImg_1 = new Image();\r\n            undoImg_1.src = this.snapColl[this.incStep];\r\n            undoImg_1.onload = function () {\r\n                proxy.canvasContext.clearRect(0, 0, proxy.element.width, proxy.element.height);\r\n                proxy.canvasContext.drawImage(undoImg_1, 0, 0, proxy.element.width, proxy.element.height);\r\n            };\r\n        }\r\n        this.isClear();\r\n        if (!this.isBlazor) {\r\n            this.trigger('change', args);\r\n        }\r\n        else {\r\n            this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'Undo');\r\n        }\r\n    };\r\n    /**\r\n     * Redo the last user action.\r\n     *\r\n     * @returns {void}.\r\n     */\r\n    SignatureBase.prototype.redo = function () {\r\n        var args = { actionName: 'redo' };\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var proxy = this;\r\n        if (this.incStep < this.snapColl.length - 1) {\r\n            this.incStep++;\r\n            var redoImg_1 = new Image();\r\n            redoImg_1.src = this.snapColl[this.incStep];\r\n            redoImg_1.onload = function () {\r\n                proxy.canvasContext.clearRect(0, 0, proxy.element.width, proxy.element.height);\r\n                proxy.canvasContext.drawImage(redoImg_1, 0, 0, proxy.element.width, proxy.element.height);\r\n            };\r\n        }\r\n        this.isClear();\r\n        if (!this.isBlazor) {\r\n            this.trigger('change', args);\r\n        }\r\n        else {\r\n            this.dotnetRef.invokeMethodAsync('TriggerEventAsync', 'Redo');\r\n        }\r\n    };\r\n    SignatureBase.prototype.isClear = function () {\r\n        if (this.clearArray) {\r\n            var empty = false;\r\n            for (var i = 0; i < this.clearArray.length; i++) {\r\n                if (this.clearArray[i] === this.incStep) {\r\n                    this.isSignatureEmpty = true;\r\n                    empty = true;\r\n                }\r\n            }\r\n            if (!empty) {\r\n                this.isSignatureEmpty = false;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * To check whether the signature is empty or not.\r\n     *\r\n     * @returns {boolean}.\r\n     */\r\n    SignatureBase.prototype.isEmpty = function () {\r\n        return this.isSignatureEmpty;\r\n    };\r\n    /**\r\n     * To check whether the undo collection is empty or not.\r\n     *\r\n     * @returns {boolean}.\r\n     */\r\n    SignatureBase.prototype.canUndo = function () {\r\n        return this.incStep > 0;\r\n    };\r\n    /**\r\n     * To check whether the redo collection is empty or not.\r\n     *\r\n     * @returns {boolean}.\r\n     */\r\n    SignatureBase.prototype.canRedo = function () {\r\n        return this.incStep < this.snapColl.length - 1;\r\n    };\r\n    /**\r\n     * To draw the signature based on the given text, with the font family and font size.\r\n     *\r\n     * @param {string} text - specify text to be drawn as signature.\r\n     * @param {string} fontFamily - specify font family of a signature.\r\n     * @param {number} fontSize - specify font size of a signature.\r\n     *\r\n     * @returns {void}.\r\n     */\r\n    SignatureBase.prototype.draw = function (text, fontFamily, fontSize) {\r\n        this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\r\n        fontFamily = fontFamily || 'Arial';\r\n        fontSize = fontSize || 30;\r\n        this.canvasContext.font = fontSize + 'px ' + fontFamily;\r\n        this.canvasContext.textAlign = 'center';\r\n        this.canvasContext.textBaseline = 'middle';\r\n        this.canvasContext.fillText(text, this.element.width / 2, this.element.height / 2);\r\n        this.updateSnapCollection();\r\n        this.isSignatureEmpty = false;\r\n    };\r\n    /**\r\n     * To load the signature with the given base 64 string, height and width.\r\n     *\r\n     * @param {string} signature - specify the url/base 64 string to be drawn as signature.\r\n     * @param {number} width - specify the width of the loaded signature image.\r\n     * @param {number} height - specify the height of the loaded signature image.\r\n     * @returns {void}.\r\n     */\r\n    SignatureBase.prototype.load = function (signature, width, height) {\r\n        height = height || this.element.height;\r\n        width = width || this.element.width;\r\n        this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var proxy = this;\r\n        var bitmapImage = new Image();\r\n        bitmapImage.src = signature;\r\n        bitmapImage.onload = function () {\r\n            Promise.all([\r\n                createImageBitmap(bitmapImage, 0, 0, width, height)\r\n            ]).then(function (results) {\r\n                var tempCanvas = document.createElement('canvas');\r\n                tempCanvas.width = width;\r\n                tempCanvas.height = height;\r\n                tempCanvas.getContext('2d').drawImage(results[0], 0, 0);\r\n                proxy.canvasContext.drawImage(tempCanvas, 0, 0, width, height, 0, 0, proxy.element.width, proxy.element.height);\r\n                proxy.updateSnapCollection();\r\n            });\r\n        };\r\n        this.isSignatureEmpty = false;\r\n    };\r\n    SignatureBase.prototype.saveBackground = function (savebg) {\r\n        var imageSrc;\r\n        if (savebg && this.backgroundImage) {\r\n            imageSrc = this.snapColl[this.incStep - 1];\r\n        }\r\n        else {\r\n            imageSrc = this.snapColl[this.incStep];\r\n        }\r\n        if (!savebg) {\r\n            this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\r\n            if (this.backgroundImage) {\r\n                this.setBackgroundImage(this.backgroundImage);\r\n            }\r\n            else if (this.backgroundColor) {\r\n                this.setBackgroundColor(this.backgroundColor);\r\n                savebg = true;\r\n            }\r\n        }\r\n        if (savebg) {\r\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n            var proxy_1 = this;\r\n            var imageObj_1 = new Image();\r\n            imageObj_1.crossOrigin = 'anonymous';\r\n            imageObj_1.src = imageSrc;\r\n            imageObj_1.onload = function () {\r\n                proxy_1.backgroundLoaded = true;\r\n                proxy_1.canvasContext.globalCompositeOperation = 'source-over';\r\n                proxy_1.canvasContext.drawImage(imageObj_1, 0, 0, proxy_1.element.width, proxy_1.element.height);\r\n                proxy_1.save(proxy_1.fileType, proxy_1.fileName);\r\n            };\r\n        }\r\n    };\r\n    /**\r\n     * To save the signature with the given file type and file name.\r\n     *\r\n     * @param {SignatureFileType} type - specify type of the file to be saved a signature.\r\n     * @param {string} fileName - specify name of the file to be saved a signature.\r\n     *\r\n     * @returns {void}.\r\n     */\r\n    SignatureBase.prototype.save = function (type, fileName) {\r\n        if (this.saveWithBackground && this.backgroundLoaded == null && (this.backgroundImage || this.backgroundColor)) {\r\n            this.backgroundLoaded = false;\r\n            this.fileType = type;\r\n            this.fileName = fileName;\r\n            this.saveBackground(false);\r\n        }\r\n        else if (type === 'Svg') {\r\n            fileName = fileName || 'Signature';\r\n            this.toSVG(fileName);\r\n        }\r\n        else if (type === 'Jpeg') {\r\n            fileName = fileName || 'Signature';\r\n            if (!this.saveWithBackground || this.saveWithBackground && !(this.backgroundImage || this.backgroundColor)) {\r\n                this.toJPEG(fileName);\r\n            }\r\n            else {\r\n                var dataURL = this.canvasContext.canvas.toDataURL('image/jpeg');\r\n                this.download(this.getBlob(dataURL), fileName + '.' + 'jpeg');\r\n            }\r\n        }\r\n        else {\r\n            fileName = fileName || 'Signature';\r\n            var dataURL = this.canvasContext.canvas.toDataURL('image/png');\r\n            this.download(this.getBlob(dataURL), fileName + '.' + 'png');\r\n        }\r\n        if (this.saveWithBackground && this.backgroundLoaded) {\r\n            this.resetSnap();\r\n        }\r\n    };\r\n    SignatureBase.prototype.resetSnap = function () {\r\n        this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var proxy = this;\r\n        var restoreObj = new Image();\r\n        restoreObj.src = this.snapColl[this.incStep - 1];\r\n        restoreObj.onload = function () {\r\n            proxy.canvasContext.drawImage(restoreObj, 0, 0, proxy.element.width, proxy.element.height);\r\n            proxy.updateSnapCollection();\r\n        };\r\n        this.backgroundLoaded = null;\r\n        this.snapColl.pop();\r\n        this.incStep--;\r\n        this.snapColl.pop();\r\n        this.incStep--;\r\n    };\r\n    SignatureBase.prototype.toJPEG = function (fileName) {\r\n        var _this = this;\r\n        var imageSrc = this.snapColl[this.incStep];\r\n        this.setBackgroundColor('#ffffff');\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        var proxy = this;\r\n        var imageObj = new Image();\r\n        imageObj.crossOrigin = 'anonymous';\r\n        imageObj.src = imageSrc;\r\n        imageObj.onload = function () {\r\n            proxy.canvasContext.globalCompositeOperation = 'source-over';\r\n            proxy.canvasContext.drawImage(imageObj, 0, 0, proxy.element.width, proxy.element.height);\r\n            var dataURL = proxy.canvasContext.canvas.toDataURL('image/jpeg');\r\n            proxy.download(proxy.getBlob(dataURL), fileName + '.' + 'jpeg');\r\n            proxy.canvasContext.clearRect(0, 0, proxy.canvasContext.canvas.width, proxy.canvasContext.canvas.height);\r\n            _this.resizeHandler();\r\n        };\r\n        this.snapColl.pop();\r\n        this.incStep--;\r\n    };\r\n    SignatureBase.prototype.toSVG = function (fileName) {\r\n        var dataUrl = this.canvasContext.canvas.toDataURL();\r\n        var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n        svg.setAttribute('width', this.canvasContext.canvas.width.toString());\r\n        svg.setAttribute('height', this.canvasContext.canvas.height.toString());\r\n        var XLinkNS = 'http://www.w3.org/1999/xlink';\r\n        var img = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n        img.setAttributeNS(null, 'height', this.canvasContext.canvas.height.toString());\r\n        img.setAttributeNS(null, 'width', this.canvasContext.canvas.width.toString());\r\n        img.setAttributeNS(XLinkNS, 'xlink:href', dataUrl);\r\n        svg.appendChild(img);\r\n        var prefix = 'data:image/svg+xml;base64,';\r\n        var header = '<svg' + ' xmlns=\"http://www.w3.org/2000/svg\"' + ' xmlns:xlink=\"http://www.w3.org/1999/xlink\"'\r\n            + (\" width=\\\"\" + this.canvasContext.canvas.width + \"\\\"\") + (\" height=\\\"\" + this.canvasContext.canvas.height + \"\\\"\") + '>';\r\n        var footer = '</svg>';\r\n        var body = svg.innerHTML;\r\n        var data = header + body + footer;\r\n        var svgDataUrl = prefix + btoa(data);\r\n        if (fileName == null) {\r\n            return svgDataUrl;\r\n        }\r\n        else {\r\n            this.download(this.getBlob(svgDataUrl), fileName + '.' + 'svg');\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * To save the signature as Blob.\r\n     *\r\n     * @returns {Blob}.\r\n     */\r\n    SignatureBase.prototype.saveAsBlob = function () {\r\n        return this.getBlob(this.canvasContext.canvas.toDataURL('image/png'));\r\n    };\r\n    /**\r\n     * To get the signature as Base 64.\r\n     *\r\n     * @private\r\n     * @param {SignatureFileType} type - Specifies the type of the image format.\r\n     * @returns {string}.\r\n     */\r\n    SignatureBase.prototype.getSignature = function (type) {\r\n        if (type === 'Jpeg') {\r\n            var imgData = this.canvasContext.getImageData(0, 0, this.element.width, this.element.height);\r\n            var data = imgData.data;\r\n            for (var i = 0; i < data.length; i += 4) {\r\n                if (data[i + 3] < 255) {\r\n                    data[i] = 255 - data[i];\r\n                    data[i + 1] = 255 - data[i + 1];\r\n                    data[i + 2] = 255 - data[i + 2];\r\n                    data[i + 3] = 255 - data[i + 3];\r\n                }\r\n            }\r\n            this.canvasContext.putImageData(imgData, 0, 0);\r\n            var dataURL = this.canvasContext.canvas.toDataURL('image/jpeg');\r\n            this.resizeHandler();\r\n            return dataURL;\r\n        }\r\n        else if (type === 'Svg') {\r\n            return this.toSVG(null);\r\n        }\r\n        else {\r\n            return this.canvasContext.canvas.toDataURL('image/png');\r\n        }\r\n    };\r\n    /**\r\n     * Get component name.\r\n     *\r\n     * @returns {string} - Module Name\r\n     * @private\r\n     */\r\n    SignatureBase.prototype.getModuleName = function () {\r\n        return 'signature';\r\n    };\r\n    /**\r\n     * To get the properties to be maintained in the persisted state.\r\n     *\r\n     * @returns {string} - Persist data\r\n     */\r\n    SignatureBase.prototype.getPersistData = function () {\r\n        this.signatureValue = this.snapColl[this.incStep];\r\n        return this.addOnPersist(['signatureValue']);\r\n    };\r\n    /**\r\n     * Removes the component from the DOM and detaches all its related event handlers.\r\n     * Also it maintains the initial input element from the DOM.\r\n     *\r\n     * @method destroy\r\n     * @returns {void}\r\n     */\r\n    SignatureBase.prototype.destroy = function () {\r\n        this.unwireEvents(null);\r\n        removeClass([this.element], 'e-' + this.getModuleName());\r\n        this.element.removeAttribute('tabindex');\r\n        this.pointColl = null;\r\n        _super.prototype.destroy.call(this);\r\n    };\r\n    /**\r\n     * Modified onPropertyChanged method for both blazor and EJ2 signature component.\r\n     *\r\n     * @private\r\n     * @param {string} key - Specifies the property, which changed.\r\n     * @param {string} value - Specifies the property value changed.\r\n     * @returns {void}\r\n     */\r\n    SignatureBase.prototype.propertyChanged = function (key, value) {\r\n        var canvasNew = this.canvasContext;\r\n        switch (key) {\r\n            case 'backgroundColor':\r\n                canvasNew.canvas.style.backgroundColor = value;\r\n                this.backgroundColor = value;\r\n                break;\r\n            case 'backgroundImage':\r\n                canvasNew.canvas.style.backgroundImage = 'url(' + value + ')';\r\n                this.backgroundImage = value;\r\n                break;\r\n            case 'strokeColor':\r\n                canvasNew.fillStyle = value;\r\n                this.strokeColor = value;\r\n                break;\r\n            case 'saveWithBackground':\r\n                this.saveWithBackground = value;\r\n                break;\r\n            case 'maxStrokeWidth':\r\n                this.maxStrokeWidth = value;\r\n                break;\r\n            case 'minStrokeWidth':\r\n                this.minStrokeWidth = value;\r\n                break;\r\n            case 'velocity':\r\n                this.velocity = value;\r\n                break;\r\n            case 'isReadOnly':\r\n                this.isRead(value);\r\n                break;\r\n            case 'disabled':\r\n                this.enableOrDisable(value);\r\n                break;\r\n        }\r\n    };\r\n    return SignatureBase;\r\n}(Component));\r\nexport { SignatureBase };\r\n"]},"metadata":{},"sourceType":"module"}