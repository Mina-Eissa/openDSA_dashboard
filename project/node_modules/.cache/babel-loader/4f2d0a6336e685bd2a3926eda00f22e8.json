{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/* eslint-disable @typescript-eslint/ban-types */\n\n/* eslint-disable jsdoc/require-returns */\n\n/* eslint-disable jsdoc/require-param */\n\n/* eslint-disable valid-jsdoc */\n\n/* eslint-disable @typescript-eslint/no-inferrable-types */\n\n/**\r\n * Selection src file\r\n */\n\n\nimport { Browser } from '@syncfusion/ej2-base';\nimport { remove } from '@syncfusion/ej2-base';\nimport { extend, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { ChartLocation, RectOption, CircleOption, withInBounds, getDraggedRectLocation, removeElement, getElement } from '../../common/utils/helper';\nimport { Rect, PathOption } from '@syncfusion/ej2-svg-base';\nimport { Index } from '../../common/model/base';\nimport { dragComplete, selectionComplete } from '../../common/model/constants';\nimport { BaseSelection } from '../../common/user-interaction/selection';\n/**\r\n * `Selection` module handles the selection for chart.\r\n *\r\n * @private\r\n */\n\nvar Selection =\n/** @class */\nfunction (_super) {\n  __extends(Selection, _super);\n  /**\r\n   * Constructor for selection module.\r\n   *\r\n   * @private\r\n   */\n\n\n  function Selection(chart) {\n    var _this = _super.call(this, chart) || this;\n\n    _this.isdrawRect = true;\n    _this.multiDataIndexes = [];\n    _this.pathIndex = 0;\n    _this.seriesIndex = 0;\n    _this.count = -1;\n    _this.dragRectArray = [];\n    _this.filterArray = [];\n    _this.totalSelectedPoints = [];\n    _this.chart = chart;\n    _this.renderer = chart.renderer;\n    var mode = chart.selectionMode;\n    _this.isMultiDrag = chart.isMultiSelect && mode.indexOf('Drag') > -1;\n\n    _this.addEventListener();\n\n    return _this;\n  }\n  /**\r\n   * Binding events for selection module.\r\n   */\n\n\n  Selection.prototype.addEventListener = function () {\n    if (this.chart.isDestroyed || this.chart.stockChart && this.chart.stockChart.onPanning) {\n      return;\n    }\n\n    var cancelEvent = Browser.isPointer ? 'pointerleave' : 'mouseleave';\n    this.chart.on(Browser.touchMoveEvent, this.mouseMove, this);\n    this.chart.on(cancelEvent, this.completeSelection, this);\n    this.chart.on('click', this.calculateSelectedElements, this);\n    this.chart.on(Browser.touchStartEvent, this.mousedown, this);\n    this.chart.on(Browser.touchEndEvent, this.completeSelection, this);\n  };\n  /**\r\n   * Chart mouse down\r\n   */\n\n\n  Selection.prototype.mousedown = function (e) {\n    var chart = this.chart;\n\n    if (chart.isPointMouseDown || chart.selectionMode === 'None' || chart.isChartDrag) {\n      return;\n    }\n\n    if (chart.isDoubleTap || !chart.isTouch || this.rectPoints) {\n      this.dragStart(chart, chart.chartAxisLayoutPanel.seriesClipRect, chart.mouseDownX, chart.mouseDownY, e);\n    }\n  };\n  /**\r\n   * UnBinding events for selection module.\r\n   */\n\n\n  Selection.prototype.removeEventListener = function () {\n    if (this.chart.isDestroyed) {\n      return;\n    }\n\n    this.chart.off(Browser.touchMoveEvent, this.mouseMove);\n    this.chart.off('pointerleave' || 'mouseleave', this.completeSelection);\n    this.chart.off('click', this.calculateSelectedElements);\n    this.chart.off(Browser.touchStartEvent, this.mousedown);\n    this.chart.off(Browser.touchEndEvent, this.completeSelection);\n  };\n  /**\r\n   * To find private variable values\r\n   */\n\n\n  Selection.prototype.initPrivateVariables = function (chart) {\n    this.styleId = chart.element.id + '_ej2_chart_selection';\n    this.unselected = chart.element.id + '_ej2_deselected';\n    this.closeIconId = chart.element.id + '_ej2_drag_close';\n    this.draggedRectGroup = chart.element.id + '_ej2_drag_group';\n    this.multiRectGroup = chart.element.id + '_ej2_drag_multi_group';\n    this.draggedRect = chart.element.id + '_ej2_drag_rect';\n    this.lassoPath = chart.element.id + '_ej2_drag_path';\n    this.selectedDataIndexes = [];\n    this.rectPoints = null;\n    this.isSeriesMode = chart.selectionMode === 'Series';\n  };\n  /**\r\n   * Method to select the point and series.\r\n   *\r\n   * @returns {void}\r\n   */\n\n\n  Selection.prototype.invokeSelection = function (chart) {\n    this.initPrivateVariables(chart);\n    this.series = extend({}, chart.visibleSeries, null, true);\n    this.seriesStyles();\n    this.currentMode = chart.selectionMode;\n\n    if (!(chart.selectionMode.indexOf('Drag') > -1)) {\n      this.selectDataIndex(chart, this.concatIndexes(chart.selectedDataIndexes, this.selectedDataIndexes));\n    }\n  };\n\n  Selection.prototype.generateStyle = function (series) {\n    if (series) {\n      if (this.styleId.indexOf('selection') > 1 && this.chart.selectionMode !== 'None') {\n        this.unselected = series.unSelectedStyle || this.unselected;\n      }\n\n      if (this.styleId.indexOf('highlight') > 0 && this.chart.highlightMode !== 'None') {\n        this.unselected = series.nonHighlightStyle || this.unselected;\n      }\n\n      return series.selectionStyle || this.styleId + '_series_' + series.index;\n    }\n\n    return 'undefined';\n  };\n  /**\r\n   *  Method to get the selected data index\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.selectDataIndex = function (chart, indexes) {\n    for (var _i = 0, indexes_1 = indexes; _i < indexes_1.length; _i++) {\n      var index = indexes_1[_i];\n      this.performSelection(index, chart, this.getElementByIndex(chart, index)[0]);\n    }\n  };\n  /**\r\n   *  Method to get the selected index element\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.getElementByIndex = function (chart, index, suffix, marker) {\n    if (suffix === void 0) {\n      suffix = '';\n    }\n\n    var elementId = chart.element.id + '_Series_' + index.series + '_Point' + '_' + index.point;\n    var series = chart.series[index.series];\n    elementId = series.type !== 'Scatter' && series.type !== 'Bubble' && marker ? elementId + '_Symbol' + suffix : elementId;\n    return [getElement(elementId), (series.type === 'RangeArea' || series.type === 'SplineRangeArea') && series.marker.visible ? getElement(elementId + '1') : null];\n  };\n  /**\r\n   *  Method to get the selected cluster element\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.getClusterElements = function (chart, index) {\n    var clusters = [];\n    var seriesStyle;\n    var selectedElements;\n\n    for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\n      var series = _a[_i];\n\n      if (series.visible) {\n        index = new Index(series.index, index.point);\n\n        if (series.isRectSeries) {\n          clusters.push(this.getElementByIndex(chart, index)[0]);\n        }\n\n        clusters.push(this.getElementByIndex(chart, index, '', series.marker.visible)[0]);\n        seriesStyle = this.generateStyle(chart.visibleSeries[index.series]);\n        selectedElements = document.querySelectorAll('.' + seriesStyle);\n        this.findTrackballElements(selectedElements, seriesStyle);\n        var clusterIndex = series.marker.visible && series.isRectSeries ? 2 : 1;\n\n        if (!chart.isMultiSelect && selectedElements.length > 0 && selectedElements[0].id !== clusters[clusters.length - clusterIndex].id) {\n          this.removeSelection(chart, index.series, selectedElements, seriesStyle, true);\n        }\n      }\n    }\n\n    return clusters;\n  };\n  /**\r\n   *  Method to get trackball elements\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.findTrackballElements = function (selectedElements, className) {\n    var trackballElements;\n    var elements;\n\n    for (var i = 0; i < selectedElements.length; i++) {\n      if (!isNullOrUndefined(selectedElements[i])) {\n        trackballElements = !isNullOrUndefined(selectedElements[i].parentNode) ? [].slice.call(selectedElements[0].parentNode.querySelectorAll('.' + className)) : [];\n\n        if (trackballElements.length > 0) {\n          elements = [];\n\n          for (var i_1 = 0; i_1 < trackballElements.length; i_1++) {\n            if (trackballElements[i_1].id.indexOf('Trackball') > -1) {\n              elements.push(trackballElements[i_1]);\n            }\n          }\n\n          this.removeStyles(elements);\n        }\n      }\n    }\n  };\n  /**\r\n   *  Method to get the selected element\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.findElements = function (chart, series, index, suffix, marker) {\n    if (suffix === void 0) {\n      suffix = '';\n    }\n\n    if (this.isSeriesMode) {\n      return this.getSeriesElements(series);\n    } else if (this.currentMode === 'Cluster') {\n      return this.getClusterElements(chart, index);\n    } else {\n      return this.getElementByIndex(chart, index, suffix, marker);\n    }\n  };\n  /**\r\n   * To find the selected element.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.isAlreadySelected = function (event) {\n    var targetElem = event.target;\n\n    if (event.type === 'click') {\n      this.currentMode = this.chart.selectionMode;\n      this.styleId = this.chart.element.id + '_ej2_chart_selection';\n    } else if (event.type === 'mousemove' || event.type === 'pointermove') {\n      this.currentMode = this.chart.highlightMode;\n      this.highlightDataIndexes = [];\n      this.styleId = this.chart.element.id + '_ej2_chart_highlight';\n    }\n\n    if (this.chart.highlightMode !== 'None' && this.chart.selectionMode === 'None') {\n      if (event.type === 'click') {\n        return false;\n      }\n    }\n\n    if (this.chart.highlightMode !== 'None' && this.previousSelectedEle && this.previousSelectedEle[0]) {\n      var parentNodeId = targetElem.parentNode.id;\n      var isElement = void 0;\n\n      if (targetElem.parentNode) {\n        isElement = parentNodeId.indexOf('SeriesGroup') > 0 || parentNodeId.indexOf('SymbolGroup') > 0 ? true : false;\n      }\n\n      for (var i = 0; i < this.previousSelectedEle.length; i++) {\n        if (this.previousSelectedEle[i].hasAttribute('class')) {\n          if (this.previousSelectedEle[i].getAttribute('class').indexOf('highlight') > -1 && (isElement || event.type === 'click')) {\n            this.previousSelectedEle[i].removeAttribute('class');\n\n            if (this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor) && this.chart.highlightPattern === 'None') {\n              if (this.previousSelectedEle[i].id.indexOf('Group') > 0) {\n                for (var j = 0; j < this.previousSelectedEle[i].children.length; j++) {\n                  this.previousSelectedEle[i].children[j].setAttribute('fill', this.control.visibleSeries[this.indexFinder(this.previousSelectedEle[i].id).series].interior);\n                }\n              } else {\n                this.previousSelectedEle[i].setAttribute('fill', this.control.visibleSeries[this.indexFinder(this.previousSelectedEle[i].id).series].interior);\n              }\n            }\n\n            this.addOrRemoveIndex(this.highlightDataIndexes, this.indexFinder(this.previousSelectedEle[i].id));\n          } else if (!isElement && this.previousSelectedEle[i].getAttribute('class').indexOf('highlight') > -1) {\n            this.performSelection(this.indexFinder(this.previousSelectedEle[i].id), this.chart, this.previousSelectedEle[i]);\n          }\n        }\n      }\n    }\n\n    return true;\n  };\n  /**\r\n   * To find the selected element.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.calculateSelectedElements = function (event) {\n    if (isNullOrUndefined(event.target)) {\n      return;\n    }\n\n    var targetElement = event.target;\n\n    if (this.chart.selectionMode === 'None' && this.chart.highlightMode === 'None' || targetElement.id.indexOf(this.chart.element.id + '_') === -1) {\n      return;\n    }\n\n    if (event.type === 'mousemove' || event.type === 'pointermove') {\n      if (targetElement.hasAttribute('class') && (targetElement.getAttribute('class').indexOf('highlight') > -1 || targetElement.getAttribute('class').indexOf('selection') > -1)) {\n        return;\n      }\n\n      if (!isNullOrUndefined(targetElement.parentNode) && targetElement.parentNode.hasAttribute('class') && (targetElement.parentNode.getAttribute('class').indexOf('highlight') > 0 || targetElement.parentNode.getAttribute('class').indexOf('selection') > 0)) {\n        return;\n      }\n    }\n\n    this.isAlreadySelected(event);\n\n    if (targetElement.id.indexOf('_Series_') > -1) {\n      var element = void 0;\n\n      if (targetElement.id.indexOf('_Trackball_1') > -1) {\n        element = getElement(targetElement.id.split('_Trackball_')[0] + '_Symbol');\n        element = isNullOrUndefined(element) ? getElement(targetElement.id.split('_Trackball_')[0]) : element;\n      } else if (targetElement.id.indexOf('_Trackball_0') > -1) {\n        return null;\n      }\n\n      this.performSelection(this.indexFinder(targetElement.id), this.chart, element || targetElement);\n    }\n  };\n  /**\r\n   *  Method to perform the selection\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.performSelection = function (index, chart, element) {\n    this.isSeriesMode = this.currentMode === 'Series';\n\n    if (chart.series[index.series].type === 'BoxAndWhisker' && element && element.id === chart.element.id + '_Series_' + index.series + '_Point_' + index.point + '_BoxPath') {\n      element = element.parentNode;\n    }\n\n    if (chart.series[index.series].type === 'Area' && (this.currentMode === 'Point' || this.currentMode === 'Cluster') && element && element.id === this.chart.element.id + '_Series_' + index.series) {\n      var className = this.generateStyle(chart.series[index.series]);\n      var selectionEle = document.querySelectorAll('.' + className);\n      this.findTrackballElements(selectionEle, className);\n      this.blurEffect(chart.element.id, chart.visibleSeries);\n    }\n\n    switch (this.currentMode) {\n      case 'Series':\n        this.selection(chart, index, this.getSeriesElements(chart.series[index.series]));\n        this.selectionComplete(chart, index, this.currentMode);\n        this.blurEffect(chart.element.id, chart.visibleSeries);\n        break;\n\n      case 'Point':\n        if (!isNaN(index.point) && element) {\n          var pointElements = [];\n          pointElements.push(element);\n\n          if (pointElements[0] !== null && chart.series[index.series].marker.visible && (chart.series[index.series].type.indexOf('Column') !== -1 || chart.series[index.series].type.indexOf('Bar') !== -1)) {\n            if (!(element.id.indexOf('_Symbol') !== -1) && getElement(element.id + '_Symbol')) {\n              pointElements.push(getElement(element.id + '_Symbol'));\n            } else if (element.id.indexOf('_Symbol') !== -1 && getElement(element.id.replace('_Symbol', ''))) {\n              pointElements.push(getElement(element.id.replace('_Symbol', '')));\n            }\n          }\n\n          this.selection(chart, index, pointElements);\n          this.selectionComplete(chart, index, this.currentMode);\n          this.blurEffect(chart.element.id, chart.visibleSeries);\n        }\n\n        break;\n\n      case 'Cluster':\n        if (!isNaN(index.point)) {\n          this.clusterSelection(chart, index);\n          this.selectionComplete(chart, index, this.currentMode);\n          this.blurEffect(chart.element.id, chart.visibleSeries);\n        }\n\n        break;\n    }\n  };\n  /**\r\n   *  Method to get the selected data index\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.selectionComplete = function (chart, index, selectionMode) {\n    var points;\n    var pointIndex;\n    var seriesIndex;\n    var selectedPointValues = [];\n    var yValue;\n    var selectedPointX;\n\n    if (selectionMode === 'Cluster') {\n      for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\n        var series = _a[_i];\n\n        if (series.visible) {\n          for (var i = 0; i < this.selectedDataIndexes.length; i++) {\n            pointIndex = chart.isMultiSelect ? this.selectedDataIndexes[i].point : index.point;\n            seriesIndex = series.index;\n            points = series.points;\n\n            if (!isNaN(pointIndex)) {\n              yValue = series.type !== 'RangeArea' || 'SplineRangeArea' ? points[pointIndex].yValue : points[pointIndex].regions[0].y;\n              selectedPointX = points[pointIndex].xValue;\n\n              if (chart.primaryXAxis.valueType === 'Category') {\n                selectedPointX = points[pointIndex].x.toLocaleString();\n              } else if (chart.primaryXAxis.valueType === 'DateTime') {\n                selectedPointX = new Date(points[pointIndex].xValue);\n              }\n\n              if (series.category !== 'Indicator') {\n                selectedPointValues.push({\n                  x: selectedPointX,\n                  y: yValue,\n                  seriesIndex: seriesIndex,\n                  pointIndex: pointIndex\n                });\n              }\n\n              if (series.type === 'RangeArea' || series.type === 'SplineRangeArea') {\n                selectedPointValues.push({\n                  x: selectedPointX,\n                  y: points[pointIndex].regions[0].y,\n                  seriesIndex: seriesIndex,\n                  pointIndex: pointIndex\n                });\n              }\n            }\n          }\n        }\n      }\n    } else if (selectionMode === 'Series') {\n      if (chart.isMultiSelect) {\n        for (var i = 0; i < this.selectedDataIndexes.length; i++) {\n          seriesIndex = this.selectedDataIndexes[i].series;\n          selectedPointValues.push({\n            seriesIndex: seriesIndex\n          });\n        }\n      } else {\n        seriesIndex = this.selectedDataIndexes.length > 0 ? this.selectedDataIndexes[0].series : 0;\n        selectedPointValues.push({\n          seriesIndex: seriesIndex\n        });\n      }\n    } else if (selectionMode === 'Point') {\n      for (var i = 0; i < this.selectedDataIndexes.length; i++) {\n        pointIndex = this.selectedDataIndexes[i].point;\n        seriesIndex = this.selectedDataIndexes[i].series;\n        var series = chart.series[seriesIndex];\n        points = series.points;\n\n        if (!isNaN(pointIndex)) {\n          selectedPointX = points[pointIndex].xValue;\n          yValue = series.type !== 'RangeArea' || 'SplineRangeArea' ? points[pointIndex].yValue : points[pointIndex].regions[0].y;\n\n          if (chart.primaryXAxis.valueType === 'Category') {\n            selectedPointX = points[pointIndex].x.toLocaleString();\n          } else if (chart.primaryXAxis.valueType === 'DateTime') {\n            selectedPointX = new Date(points[pointIndex].xValue);\n          }\n\n          selectedPointValues.push({\n            x: selectedPointX,\n            y: yValue,\n            seriesIndex: seriesIndex,\n            pointIndex: pointIndex\n          });\n        }\n      }\n    }\n\n    var args = {\n      name: selectionComplete,\n      selectedDataValues: selectedPointValues,\n      cancel: false\n    };\n    chart.trigger(selectionComplete, args);\n  };\n  /**\r\n   *  Method to perform selection\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.selection = function (chart, index, selectedElements) {\n    if (!(this.currentMode === 'Lasso')) {\n      if (!chart.isMultiSelect && this.currentMode.indexOf('Drag') === -1 && this.styleId.indexOf('highlight') === -1 && chart.selectionMode !== 'None') {\n        this.removeMultiSelectElements(chart, this.selectedDataIndexes, index, chart.series);\n      }\n    }\n\n    if (!isNullOrUndefined(selectedElements[0])) {\n      if (chart.series[index.series].isRectSeries) {\n        if (selectedElements[0].id) {\n          if (document.getElementById(selectedElements[0].id + '_Symbol')) {\n            selectedElements.push(getElement(selectedElements[0].id + '_Symbol'));\n          } else if (selectedElements[0].id.indexOf('SeriesGroup') !== -1) {\n            if (document.getElementById(selectedElements[0].id.replace('SeriesGroup', 'SymbolGroup'))) {\n              selectedElements.push(getElement(selectedElements[0].id.replace('SeriesGroup', 'SymbolGroup')));\n            }\n          }\n        }\n      }\n\n      var isAdd = void 0;\n      var className = selectedElements[0] && (selectedElements[0].getAttribute('class') || '');\n      var pClassName = selectedElements[0].parentNode && (selectedElements[0].parentNode.getAttribute('class') || '');\n\n      if (className !== '' && this.currentMode !== 'Cluster') {\n        this.findTrackballElements(selectedElements, className);\n      }\n\n      if (selectedElements[0] && className.indexOf(this.getSelectionClass(selectedElements[0].id)) > -1) {\n        this.removeStyles(selectedElements);\n      } else if (selectedElements[0].parentNode && pClassName.indexOf(this.getSelectionClass(selectedElements[0].id)) > -1) {\n        this.removeStyles([selectedElements[0].parentNode]);\n      } else {\n        this.previousSelectedEle = chart.highlightMode !== 'None' ? selectedElements : [];\n        this.applyStyles(selectedElements);\n        isAdd = true;\n      }\n\n      if (this.styleId.indexOf('highlight') > 0 && chart.highlightMode !== 'None') {\n        this.addOrRemoveIndex(this.highlightDataIndexes, index, isAdd);\n      } else {\n        this.addOrRemoveIndex(this.selectedDataIndexes, index, isAdd);\n      }\n    }\n  };\n  /**\r\n   *  Method to get the cluster selection element\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.clusterSelection = function (chart, index) {\n    this.selection(chart, index, this.getClusterElements(chart, new Index(index.series, index.point)));\n  };\n  /**\r\n   * Method to remove the multi selected elements\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.removeMultiSelectElements = function (chart, index, currentIndex, seriesCollection) {\n    var series;\n\n    for (var i = 0; i < index.length; i++) {\n      series = seriesCollection[index[i].series];\n\n      if (this.isSeriesMode && !this.toEquals(index[i], currentIndex, this.isSeriesMode) || this.currentMode === 'Cluster' && !this.toEquals(index[i], currentIndex, false) || !this.isSeriesMode && this.toEquals(index[i], currentIndex, true) && !this.toEquals(index[i], currentIndex, false)) {\n        this.removeStyles(this.findElements(chart, series, index[i], '', false));\n\n        if (series.marker.visible) {\n          this.removeStyles(this.findElements(chart, series, index[i], '', true));\n        }\n\n        index.splice(i, 1);\n        i--;\n      }\n    }\n  };\n  /**\r\n   * Method to remove the selection\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.blurEffect = function (chartId, visibleSeries, legendClick) {\n    if (legendClick === void 0) {\n      legendClick = false;\n    }\n\n    var visibility = this.checkVisibility(this.highlightDataIndexes) || this.checkVisibility(this.selectedDataIndexes); // legend click scenario\n\n    for (var _i = 0, visibleSeries_1 = visibleSeries; _i < visibleSeries_1.length; _i++) {\n      var series = visibleSeries_1[_i];\n\n      if (series.visible) {\n        this.checkSelectionElements(getElement(chartId + 'SeriesGroup' + series.index), this.generateStyle(series), visibility, legendClick, series.index);\n\n        if (!isNullOrUndefined(getElement(chartId + 'SymbolGroup' + series.index))) {\n          this.checkSelectionElements(getElement(chartId + 'SymbolGroup' + series.index), this.generateStyle(series), visibility, legendClick, series.index);\n        }\n      }\n    }\n  };\n  /**\r\n   * Method to add the add/remove class to element\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.checkSelectionElements = function (element, className, visibility, legendClick, series) {\n    var children = this.isSeriesMode ? [element] : element.childNodes;\n\n    if (this.chart.selectionMode !== 'None' && this.chart.highlightMode !== 'None') {\n      children = element.childNodes;\n    }\n\n    var elementClassName;\n    var parentClassName;\n    var legendShape;\n    var selectElement = element;\n\n    for (var i = 0; i < children.length; i++) {\n      elementClassName = children[i].getAttribute('class') || '';\n      parentClassName = children[i].parentNode.getAttribute('class') || '';\n\n      if (this.chart.selectionMode !== 'None' && this.chart.highlightMode !== 'None') {\n        className = elementClassName.indexOf('selection') > 0 || elementClassName.indexOf('highlight') > 0 ? elementClassName : className;\n        className = parentClassName.indexOf('selection') > 0 || parentClassName.indexOf('highlight') > 0 ? parentClassName : className;\n      }\n\n      if (elementClassName.indexOf(className) === -1 && parentClassName.indexOf(className) === -1 && visibility) {\n        this.addSvgClass(children[i], this.unselected);\n      } else {\n        selectElement = children[i];\n        this.removeSvgClass(children[i], this.unselected);\n        this.removeSvgClass(children[i].parentNode, this.unselected);\n      }\n\n      if (children[i].id.indexOf('Trackball') > 0 && selectElement.classList[0] === className) {\n        this.removeSvgClass(children[i], this.unselected);\n        this.removeSvgClass(children[i].parentNode, this.unselected);\n        this.addSvgClass(children[i], className);\n      }\n    }\n\n    if (element.id.indexOf('Symbol') > -1) {\n      if (element.querySelectorAll('.' + className)[0] && element.querySelectorAll('.' + className)[0].getAttribute('class') === className) {\n        var symbolEle = getElement(this.control.element.id + '_Series_' + element.id[element.id.length - 1]);\n        var seriesClassName = symbolEle && symbolEle.hasAttribute('class') ? symbolEle.getAttribute('class') : '';\n\n        if (seriesClassName.indexOf(this.unselected) > -1) {\n          this.removeSvgClass(symbolEle, this.unselected);\n        }\n      }\n    }\n\n    if (this.control.legendModule && this.control.legendSettings.visible) {\n      legendShape = getElement(this.control.element.id + '_chart_legend_shape_' + series);\n\n      if (legendShape) {\n        if (legendShape.hasAttribute('class')) {\n          this.removeSvgClass(legendShape, legendShape.getAttribute('class'));\n\n          if (!isNullOrUndefined(this.chart.highlightColor && this.chart.highlightColor !== '')) {\n            legendShape.setAttribute('stroke', this.control.visibleSeries[series].interior);\n\n            if (this.chart.highlightPattern === 'None') {\n              legendShape.setAttribute('fill', this.control.visibleSeries[series].interior);\n            }\n          }\n        }\n\n        elementClassName = selectElement.getAttribute('class') || '';\n        parentClassName = selectElement.parentNode.getAttribute('class') || '';\n\n        if (elementClassName.indexOf(className) === -1 && parentClassName.indexOf(className) === -1 && visibility) {\n          this.addSvgClass(legendShape, this.unselected);\n          this.removeSvgClass(legendShape, className);\n\n          if (this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor)) {\n            legendShape.setAttribute('stroke', this.control.visibleSeries[series].interior);\n\n            if (this.chart.highlightPattern === 'None') {\n              legendShape.setAttribute('fill', this.control.visibleSeries[series].interior);\n            }\n          }\n        } else {\n          this.removeSvgClass(legendShape, this.unselected);\n\n          if (!isNullOrUndefined(this.chart.highlightColor) && this.chart.highlightColor !== '') {\n            legendShape.setAttribute('stroke', this.control.visibleSeries[series].interior);\n\n            if (this.chart.highlightPattern === 'None') {\n              legendShape.setAttribute('fill', this.control.visibleSeries[series].interior);\n            }\n          }\n\n          if (elementClassName === '' && parentClassName === '' || elementClassName.trim() === 'EJ2-Trackball') {\n            this.removeSvgClass(legendShape, className);\n          } else {\n            this.addSvgClass(legendShape, className);\n\n            if (className.indexOf('highlight') > 0 && this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor)) {\n              legendShape.setAttribute('stroke', this.chart.highlightColor);\n\n              if (this.styleId.indexOf('highlight') > 0 && this.chart.highlightPattern === 'None') {\n                legendShape.setAttribute('fill', this.chart.highlightColor);\n              }\n            }\n          }\n        }\n\n        if (legendClick && parentClassName.indexOf(className) > -1) {\n          this.addSvgClass(legendShape, className);\n        }\n      }\n    }\n  };\n  /**\r\n   *  Method to apply the styles\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.applyStyles = function (elements) {\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n      var element = elements_1[_i];\n\n      if (element) {\n        this.removeSvgClass(element.parentNode, this.unselected);\n        this.removeSvgClass(element, this.unselected);\n        this.addSvgClass(element, this.getSelectionClass(element.id));\n\n        if (this.styleId.indexOf('highlight') > 0 && this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor) && this.chart.highlightPattern === 'None') {\n          if (element.id.indexOf('Group') > 0) {\n            for (var i = 0; i < element.children.length; i++) {\n              element.children[i].setAttribute('fill', this.chart.highlightColor);\n            }\n          } else {\n            element.setAttribute('fill', this.chart.highlightColor);\n          }\n        }\n      }\n    }\n  };\n  /**\r\n   *  Method to get the selection class\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.getSelectionClass = function (id) {\n    return this.generateStyle(this.control.series[this.indexFinder(id).series]);\n  };\n  /**\r\n   *  Method to remove styles\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.removeStyles = function (elements) {\n    for (var _i = 0, elements_2 = elements; _i < elements_2.length; _i++) {\n      var element = elements_2[_i];\n\n      if (element) {\n        this.removeSvgClass(element, this.getSelectionClass(element.id));\n\n        if (this.chart.highlightPattern === 'None' && this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor)) {\n          if (element.id.indexOf('Group') > 0) {\n            for (var i = 0; i < element.children.length; i++) {\n              element.children[i].setAttribute('fill', this.control.visibleSeries[this.indexFinder(element.id).series].interior);\n            }\n          } else {\n            element.setAttribute('fill', this.control.visibleSeries[this.indexFinder(element.id).series].interior);\n          }\n        }\n      }\n    }\n  };\n  /**\r\n   *  Method to remove the selected data index\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.addOrRemoveIndex = function (indexes, index, isAdd) {\n    for (var i = 0; i < indexes.length; i++) {\n      if (this.toEquals(indexes[i], index, this.isSeriesMode)) {\n        indexes.splice(i, 1);\n        i--;\n      }\n    }\n\n    if (isAdd) {\n      indexes.push(index);\n    }\n  };\n  /**\r\n   *  Method to get the equal index\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.toEquals = function (first, second, checkSeriesOnly) {\n    return (first.series === second.series || this.currentMode === 'Cluster' && !checkSeriesOnly) && (checkSeriesOnly || first.point === second.point);\n  };\n  /**\r\n   * To redraw the selected points.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.redrawSelection = function (chart, oldMode, chartRedraw) {\n    this.isSeriesMode = oldMode === 'Series';\n\n    if (!isNullOrUndefined(oldMode)) {\n      if (oldMode.indexOf('Drag') !== -1 || oldMode === 'Lasso' || chartRedraw) {\n        chart.isRedrawSelection = false;\n      } else {\n        chart.isRedrawSelection = true;\n      }\n    }\n\n    var selectedDataIndexes = extend([], this.selectedDataIndexes, null, true);\n    var highlightDataIndexes = extend([], this.highlightDataIndexes, null, true);\n\n    if (this.styleId.indexOf('highlight') > 0 && highlightDataIndexes.length > 0) {\n      this.removeSelectedElements(chart, this.highlightDataIndexes, chart.series);\n      selectedDataIndexes = highlightDataIndexes;\n    } else {\n      this.removeSelectedElements(chart, this.selectedDataIndexes, chart.series);\n    }\n\n    this.blurEffect(chart.element.id, chart.visibleSeries);\n    this.selectDataIndex(chart, selectedDataIndexes);\n  };\n  /** @private */\n\n\n  Selection.prototype.legendSelection = function (chart, series, event) {\n    var targetElement = event.target;\n\n    if (event.type === 'mousemove') {\n      if (event.target.id.indexOf('text') > 1) {\n        targetElement = getElement(event.target.id.replace('text', 'shape'));\n      }\n\n      if (targetElement.hasAttribute('class') && (targetElement.getAttribute('class').indexOf('highlight') > -1 || targetElement.getAttribute('class').indexOf('selection') > -1)) {\n        return;\n      }\n\n      this.currentMode = this.chart.highlightMode;\n    }\n\n    var isPreSelected = this.isAlreadySelected(event);\n\n    if (isPreSelected) {\n      var seriesStyle = this.generateStyle(chart.visibleSeries[series]);\n      var selectedElements = document.querySelectorAll('.' + seriesStyle);\n      this.isSeriesMode = this.currentMode === 'Series';\n      var isBlurEffectNeeded = true;\n\n      if (selectedElements.length > 0) {\n        this.removeSelection(chart, series, selectedElements, seriesStyle, isBlurEffectNeeded);\n      } else {\n        for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\n          var element = _a[_i];\n\n          if (element.index !== series && !chart.isMultiSelect) {\n            seriesStyle = this.generateStyle(chart.visibleSeries[element.index]);\n            selectedElements = document.querySelectorAll('.' + seriesStyle);\n            this.removeSelection(chart, series, selectedElements, seriesStyle, isBlurEffectNeeded);\n          }\n        }\n\n        var seriesElements = this.getSeriesElements(chart.visibleSeries[series]);\n\n        for (var _b = 0, seriesElements_1 = seriesElements; _b < seriesElements_1.length; _b++) {\n          var seriesElement = seriesElements_1[_b];\n\n          if (isNullOrUndefined(seriesElement)) {\n            return;\n          }\n\n          this.checkSelectionElements(seriesElement, seriesStyle, false, true, series);\n        }\n\n        this.isSeriesMode = true;\n        this.selection(chart, new Index(series, NaN), seriesElements);\n        this.isSeriesMode = chart.selectionMode === 'Series';\n        this.blurEffect(chart.element.id, chart.visibleSeries, true);\n      }\n    }\n  };\n\n  Selection.prototype.removeSelection = function (chart, series, selectedElements, seriesStyle, isBlurEffectNeeded) {\n    if (selectedElements.length > 0) {\n      var elements = [];\n\n      for (var i = 0; i < selectedElements.length; i++) {\n        elements.push(selectedElements[i]);\n      }\n\n      this.removeStyles(elements);\n      this.isSeriesMode = true;\n      this.addOrRemoveIndex(this.selectedDataIndexes, new Index(series, NaN));\n\n      for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\n        var value = _a[_i];\n        seriesStyle = this.generateStyle(value);\n\n        if (document.querySelectorAll('.' + seriesStyle).length > 0) {\n          for (var _b = 0, elements_3 = elements; _b < elements_3.length; _b++) {\n            var element = elements_3[_b];\n            this.checkSelectionElements(element, seriesStyle, true, true, series);\n          }\n\n          isBlurEffectNeeded = false;\n          break;\n        }\n      }\n\n      if (isBlurEffectNeeded) {\n        this.isSeriesMode = chart.selectionMode === 'Series';\n        this.blurEffect(chart.element.id, chart.visibleSeries);\n      }\n    }\n  };\n  /** @private */\n\n\n  Selection.prototype.getSeriesElements = function (series) {\n    var seriesElements = [series.seriesElement];\n\n    if (series.marker.visible && series.type !== 'Scatter' && series.type !== 'Bubble' && !series.isRectSeries) {\n      seriesElements.push(series.symbolElement);\n    } else if (series.marker.visible && series.isRectSeries) {\n      seriesElements.push(series.symbolElement);\n    }\n\n    return seriesElements;\n  };\n  /** @private */\n\n\n  Selection.prototype.indexFinder = function (id) {\n    var ids = ['NaN', 'NaN'];\n\n    if (id.indexOf('SeriesGroup') > -1) {\n      ids = id.split('SeriesGroup');\n      ids[0] = ids[1];\n    } else if (id.indexOf('SymbolGroup') > -1) {\n      ids = id.split('SymbolGroup');\n      ids[0] = ids[1];\n    } else if (id.indexOf('_Point_') > -1) {\n      ids = id.split('_Series_')[1].split('_Point_');\n    } else if (id.indexOf('_Series_') > -1) {\n      ids[0] = id.split('_Series_')[1];\n    } else if (id.indexOf('_chart_legend_shape_') > -1) {\n      ids = id.split('_chart_legend_shape_');\n      ids[0] = ids[1];\n    }\n\n    return new Index(parseInt(ids[0], 10), parseInt(ids[1], 10));\n  };\n  /**\r\n   * Drag selection that returns the selected data.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.calculateDragSelectedElements = function (chart, dragRect, isClose) {\n    this.removeSelectedElements(chart, this.selectedDataIndexes, chart.series);\n    var isLasso = chart.selectionMode === 'Lasso';\n    var rect = new Rect(dragRect.x, dragRect.y, dragRect.width, dragRect.height);\n    var axisOffset = new ChartLocation(chart.chartAxisLayoutPanel.seriesClipRect.x, chart.chartAxisLayoutPanel.seriesClipRect.y);\n    this.removeOffset(rect, axisOffset);\n    var points;\n    var index;\n    var selectedPointValues = [];\n    var selectedSeriesValues = [];\n    this.isSeriesMode = false;\n    var isDragResize = chart.allowMultiSelection && (this.rectGrabbing || this.resizing);\n    this.rectPoints = this.dragRectArray[isDragResize ? this.targetIndex : this.count] = new Rect(dragRect.x, dragRect.y, dragRect.width, dragRect.height);\n\n    if (dragRect.width && dragRect.height && !isClose) {\n      var rt = new Rect(dragRect.x, dragRect.y, dragRect.width, dragRect.height);\n      this.removeOffset(rt, axisOffset);\n      this.filterArray[isDragResize ? this.targetIndex : this.count] = rt;\n    }\n\n    var _loop_1 = function (series) {\n      if (series.visible) {\n        points = series.points;\n        selectedPointValues = [];\n        var xAxisOffset_1;\n        var yAxisOffset_1;\n\n        if ((chart.isTransposed || series.type.indexOf('Bar') !== -1) && !(chart.isTransposed && series.type.indexOf('Bar') !== -1)) {\n          xAxisOffset_1 = series.xAxis.rect.y - axisOffset.y;\n          yAxisOffset_1 = series.yAxis.rect.x - axisOffset.x;\n        } else {\n          xAxisOffset_1 = series.xAxis.rect.x - axisOffset.x;\n          yAxisOffset_1 = series.yAxis.rect.y - axisOffset.y;\n        }\n\n        for (var j = 0; j < points.length; j++) {\n          var yValue = series.type !== 'RangeArea' || 'SplineRangeArea' ? points[j].yValue : points[j].regions[0].y;\n          var isCurrentPoint = void 0;\n          var selectedPointX = points[j].xValue;\n\n          if (chart.primaryXAxis.valueType === 'Category') {\n            selectedPointX = points[j].x.toLocaleString();\n          } else if (chart.primaryXAxis.valueType === 'DateTime') {\n            selectedPointX = new Date(points[j].xValue);\n          }\n\n          if (series.type === 'BoxAndWhisker') {\n            isCurrentPoint = points[j].regions.some(function (region) {\n              return withInBounds(region.x + xAxisOffset_1, region.y + yAxisOffset_1, rect);\n            });\n          } else {\n            if (chart.selectionMode === 'Lasso') {\n              isCurrentPoint = points[j].isSelect;\n            } else {\n              isCurrentPoint = chart.allowMultiSelection ? this_1.isPointSelect(points[j], xAxisOffset_1, yAxisOffset_1, this_1.filterArray) : points[j].symbolLocations.some(function (location) {\n                return location && withInBounds(location.x + xAxisOffset_1, location.y + yAxisOffset_1, rect);\n              });\n            }\n          }\n\n          if (isCurrentPoint && series.category !== 'Indicator') {\n            index = new Index(series.index, points[j].index);\n            this_1.selection(chart, index, this_1.findElements(chart, series, index, '', !series.isRectSeries ? series.marker.visible : false));\n            selectedPointValues.push({\n              x: selectedPointX,\n              y: yValue\n            });\n          }\n\n          if (isCurrentPoint && (series.type === 'RangeArea' || series.type === 'SplineRangeArea')) {\n            selectedPointValues.push({\n              x: selectedPointX,\n              y: points[j].regions[0].y\n            });\n          }\n        }\n\n        selectedSeriesValues.push(selectedPointValues);\n      }\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\n      var series = _a[_i];\n\n      _loop_1(series);\n    }\n\n    this.blurEffect(chart.element.id, chart.visibleSeries);\n    var x = isLasso ? chart.mouseDownX : dragRect.x + dragRect.width;\n    var y = isLasso ? chart.mouseDownY : dragRect.y;\n\n    if (!isClose) {\n      this.createCloseButton(x, y);\n    }\n\n    var args = {\n      name: dragComplete,\n      selectedDataValues: selectedSeriesValues,\n      cancel: false\n    };\n    chart.trigger(dragComplete, args);\n  };\n\n  Selection.prototype.removeOffset = function (rect, clip) {\n    rect.x -= clip.x;\n    rect.y -= clip.y;\n  };\n\n  Selection.prototype.isPointSelect = function (points, xAxisOffset, yAxisOffset, rectCollection) {\n    var location = points.symbolLocations[0];\n\n    for (var _i = 0, rectCollection_1 = rectCollection; _i < rectCollection_1.length; _i++) {\n      var rect = rectCollection_1[_i];\n\n      if (rect && location && withInBounds(location.x + xAxisOffset, location.y + yAxisOffset, rect)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n  /**\r\n   * Method to draw dragging rect.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.drawDraggingRect = function (chart, dragRect, target) {\n    var cartesianLayout = chart.chartAxisLayoutPanel.seriesClipRect;\n    var border = chart.chartArea.border.width;\n    var rectFill = chart.themeStyle.selectionRectFill;\n    var rectStroke = chart.themeStyle.selectionRectStroke;\n    var isLasso = chart.selectionMode === 'Lasso';\n\n    if (this.isdrawRect) {\n      cartesianLayout.x = cartesianLayout.x - border / 2;\n      cartesianLayout.y = cartesianLayout.y - border / 2;\n      cartesianLayout.width = cartesianLayout.width + border;\n      cartesianLayout.height = cartesianLayout.height + border;\n      this.isdrawRect = false;\n    }\n\n    switch (chart.selectionMode) {\n      case 'DragX':\n        dragRect.y = cartesianLayout.y;\n        dragRect.height = cartesianLayout.height;\n        break;\n\n      case 'DragY':\n        dragRect.x = cartesianLayout.x;\n        dragRect.width = cartesianLayout.width;\n        break;\n    }\n\n    if ((dragRect.width < 5 || dragRect.height < 5) && !isLasso) {\n      return null;\n    }\n\n    var isDragMode = chart.selectionMode.indexOf('Drag') > -1 || chart.selectionMode === 'Lasso';\n\n    if (chart.allowMultiSelection && isDragMode) {\n      var element = void 0;\n      var dragGroup = void 0;\n      var multiGroup = getElement(this.multiRectGroup);\n\n      if (!multiGroup) {\n        multiGroup = chart.svgRenderer.createGroup({\n          id: this.multiRectGroup\n        });\n        chart.svgObject.appendChild(multiGroup);\n      }\n\n      if (this.rectGrabbing || this.resizing) {\n        var rectElement = void 0;\n        rectElement = getElement(this.draggedRect + this.targetIndex);\n\n        if (rectElement.nextSibling) {\n          remove(rectElement.nextSibling);\n        }\n\n        this.setAttributes(rectElement, dragRect);\n      } else if (!getElement(this.draggedRectGroup + this.count)) {\n        dragGroup = chart.svgRenderer.createGroup({\n          id: this.draggedRectGroup + this.count\n        });\n        var svgElement = document.getElementById(chart.element.id + '_series_svg'); // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\n        chart.enableCanvas ? svgElement.appendChild(dragGroup) : multiGroup.appendChild(dragGroup);\n      }\n\n      if (!(chart.selectionMode === 'Lasso')) {\n        element = chart.svgRenderer.drawRectangle(new RectOption(this.draggedRect + this.count, rectFill, {\n          color: rectStroke,\n          width: 1\n        }, 1, dragRect));\n        element.style.cursor = \"move\";\n      } else {\n        element = chart.svgRenderer.drawPath(new PathOption(this.lassoPath + this.count, rectFill, 3, rectStroke, 1, '', this.path));\n      }\n\n      if (!dragGroup && !this.rectGrabbing && !this.resizing) {\n        getElement(this.draggedRectGroup + this.count).appendChild(element);\n      } else if (!this.rectGrabbing && !this.resizing) {\n        dragGroup.appendChild(element);\n      }\n    } else {\n      var element = isLasso ? getElement(this.lassoPath) : getElement(this.draggedRect);\n\n      if (this.closeIcon) {\n        removeElement(this.closeIconId);\n      }\n\n      if (element) {\n        if (isLasso) {\n          element.setAttribute('d', this.path);\n        } else {\n          this.setAttributes(element, dragRect);\n        }\n      } else {\n        var dragGroup = chart.svgRenderer.createGroup({\n          id: this.draggedRectGroup\n        });\n        var svgElement = document.getElementById(chart.element.id + '_series_svg'); // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\n        chart.enableCanvas ? svgElement.appendChild(dragGroup) : chart.svgObject.appendChild(dragGroup);\n\n        if (!(chart.selectionMode === 'Lasso')) {\n          element = chart.svgRenderer.drawRectangle(new RectOption(this.draggedRect, rectFill, {\n            color: rectStroke,\n            width: 1\n          }, 1, dragRect));\n        } else {\n          element = chart.svgRenderer.drawPath(new PathOption(this.lassoPath, rectFill, 3, rectStroke, 1, '', this.path));\n        }\n\n        dragGroup.appendChild(element);\n      }\n    }\n  };\n  /**\r\n   * To get drag selected group element index from its id\r\n   *\r\n   * @param {string} id element id\r\n   */\n\n\n  Selection.prototype.getIndex = function (id) {\n    var i;\n\n    for (i = id.length - 1; i > 0; i--) {\n      var x = Number(id[i]);\n\n      if (!isNaN(x)) {\n        continue;\n      } else {\n        break;\n      }\n    }\n\n    var index = +id.substr(i + 1, id.length - 1);\n    return index;\n  };\n\n  Selection.prototype.createCloseButton = function (x, y) {\n    var isMultiDrag = this.chart.allowMultiSelection;\n    var circleStroke = this.chart.themeStyle.selectionCircleStroke;\n    var isDrag = this.rectGrabbing || this.resizing;\n    var closeIcon = this.chart.svgRenderer.createGroup({\n      id: this.closeIconId + (isMultiDrag ? isDrag ? this.targetIndex : this.count : ''),\n      style: 'cursor:pointer; visibility: visible;'\n    });\n    closeIcon.appendChild(this.chart.svgRenderer.drawCircle(new CircleOption(this.closeIconId + '_circle' + (isMultiDrag ? isDrag ? this.targetIndex : this.count : ''), '#FFFFFF', {\n      color: circleStroke,\n      width: 1\n    }, 1, x, y, 10)));\n    var direction = 'M ' + (x - 4) + ' ' + (y - 4) + ' L ' + (x + 4) + ' ' + (y + 4) + ' M ' + (x - 4) + ' ' + (y + 4) + ' L ' + (x + 4) + ' ' + (y - 4);\n    closeIcon.appendChild(this.chart.svgRenderer.drawPath({\n      id: this.closeIconId + '_cross' + (isMultiDrag ? isDrag ? this.targetIndex : this.count : ''),\n      d: direction,\n      stroke: circleStroke,\n      'stroke-width': 2,\n      fill: circleStroke\n    }));\n    this.closeIcon = closeIcon;\n    var pathElement = getElement(this.draggedRectGroup + (isMultiDrag ? isDrag ? this.targetIndex : this.count : ''));\n\n    if (pathElement) {\n      pathElement.appendChild(closeIcon);\n    }\n  };\n  /**\r\n   * Method to remove dragged element.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.removeDraggedElements = function (chart, event) {\n    if (event.target.id.indexOf(this.closeIconId) > -1 && event.type.indexOf('move') === -1) {\n      var isSelectedvalues = true;\n\n      if (chart.allowMultiSelection) {\n        var index = this.getIndex(event.target.id);\n        var multiRectGroupElement = getElement(this.multiRectGroup);\n        remove(getElement(this.draggedRectGroup + index));\n        this.dragRectArray[index] = null;\n        this.filterArray[index] = null;\n        this.totalSelectedPoints[index] = null;\n\n        if (multiRectGroupElement && multiRectGroupElement.childElementCount === 0) {\n          removeElement(multiRectGroupElement);\n          this.dragRectArray = [];\n          this.filterArray = [];\n          this.totalSelectedPoints = [];\n        }\n\n        if (this.currentMode === 'Lasso') {\n          if (this.multiDataIndexes[index] != null) {\n            for (var i = 0; i < this.multiDataIndexes[index].length; i++) {\n              this.multiDataIndexes[index][i].isSelect = false;\n            }\n          }\n\n          this.multiDataIndexes[index] = null;\n\n          for (var j = 0; j < this.multiDataIndexes.length; j++) {\n            if (this.multiDataIndexes[j] != null) {\n              isSelectedvalues = false;\n\n              for (var k = 0; k < this.multiDataIndexes[j].length; k++) {\n                this.multiDataIndexes[j][k].isSelect = true;\n              }\n            }\n          }\n\n          this.calculateDragSelectedElements(chart, this.dragRect, true);\n        } else if (this.filterArray.length) {\n          for (var i = 0; i < this.filterArray.length; i++) {\n            if (this.filterArray[i]) {\n              isSelectedvalues = false;\n              this.calculateDragSelectedElements(chart, this.filterArray[i], true);\n            }\n          }\n        } else {\n          this.calculateDragSelectedElements(chart, new Rect(0, 0, 0, 0), true);\n        }\n      } else {\n        remove(getElement(this.draggedRectGroup));\n        this.removeSelectedElements(chart, this.selectedDataIndexes, chart.series);\n      }\n\n      this.blurEffect(chart.element.id, chart.visibleSeries);\n      this.changeCursorStyle(false, chart.svgObject, 'auto');\n\n      if (!chart.allowMultiSelection || isSelectedvalues) {\n        this.rectPoints = null;\n      }\n    }\n  };\n  /**\r\n   * Method to resize the drag rect.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.resizingSelectionRect = function (chart, location, tapped, target) {\n    var rect;\n\n    if (chart.allowMultiSelection && target.id.indexOf('_ej2_drag_rect') > -1 || this.dragRectArray[this.targetIndex]) {\n      if (target.id.indexOf('_ej2_drag_rect') > -1) {\n        this.targetIndex = this.getIndex(target.id);\n      }\n\n      var r = this.dragRectArray[this.targetIndex];\n      rect = new Rect(r.x, r.y, r.width, r.height);\n    }\n\n    if (!chart.allowMultiSelection) {\n      rect = new Rect(this.rectPoints.x, this.rectPoints.y, this.rectPoints.width, this.rectPoints.height);\n    }\n\n    if (rect) {\n      var resize = this.findResizeMode(chart.svgObject, rect, location);\n\n      if (this.resizing) {\n        rect = getDraggedRectLocation(rect.x, rect.y, rect.x + rect.width, rect.y + rect.height, chart.chartAxisLayoutPanel.seriesClipRect);\n        this.drawDraggingRect(chart, rect);\n        this.dragRect = rect;\n      }\n\n      if (tapped) {\n        this.resizing = resize;\n      }\n    } else {\n      return;\n    }\n  };\n\n  Selection.prototype.findResizeMode = function (chartSvgObject, rect, location) {\n    var cursorStyle = 'se-resize';\n    var resize = false;\n\n    if (!this.resizing) {\n      var resizeEdges = [new Rect(rect.x, rect.y, rect.width - 5, 5), new Rect(rect.x, rect.y, 5, rect.height), new Rect(rect.x, rect.y + rect.height - 5, rect.width - 5, 5), new Rect(rect.x + rect.width - 5, rect.y + 5, 5, rect.height - 15), new Rect(rect.x + rect.width - 10, rect.y + rect.height - 10, 10, 10)]; //corner\n\n      for (var i = 0; i < resizeEdges.length; i++) {\n        if (withInBounds(location.x, location.y, resizeEdges[i])) {\n          cursorStyle = i === 4 ? cursorStyle : i % 2 === 0 ? 'ns-resize' : 'ew-resize';\n          resize = true;\n          this.resizeMode = i;\n          break;\n        }\n      }\n    } else {\n      var x = rect.x;\n      var y = rect.y;\n      var width = location.x - x;\n      var height = location.y - y;\n\n      switch (this.resizeMode) {\n        case 0:\n          height = Math.abs(rect.height + rect.y - location.y);\n          rect.y = Math.min(rect.height + rect.y, location.y);\n          rect.height = height;\n          break;\n\n        case 1:\n          width = Math.abs(rect.width + rect.x - location.x);\n          rect.x = Math.min(rect.width + rect.x, location.x);\n          rect.width = width;\n          break;\n\n        case 2:\n          rect.height = Math.abs(height);\n          rect.y = Math.min(location.y, y);\n          break;\n\n        case 3:\n          rect.width = Math.abs(width);\n          rect.x = Math.min(location.x, x);\n          break;\n\n        case 4:\n          rect.width = Math.abs(width);\n          rect.height = Math.abs(height);\n          rect.x = Math.min(location.x, x);\n          rect.y = Math.min(location.y, y);\n          break;\n      }\n    }\n\n    if (this.currentMode !== 'Lasso') {\n      this.changeCursorStyle(resize, getElement(this.chart.allowMultiSelection ? this.draggedRect + this.targetIndex : this.draggedRect), cursorStyle);\n    }\n\n    this.changeCursorStyle(resize, chartSvgObject, cursorStyle);\n    return resize;\n  };\n\n  Selection.prototype.changeCursorStyle = function (isResize, rectelement, cursorStyle) {\n    cursorStyle = isResize ? cursorStyle : this.control.svgObject === rectelement ? 'auto' : 'move';\n\n    if (rectelement) {\n      rectelement.style.cursor = cursorStyle;\n    }\n  };\n\n  Selection.prototype.removeSelectedElements = function (chart, index, seriesCollection) {\n    index = chart.isRedrawSelection ? index : index.splice(0, index.length); // No need to remove selected indexes while redrawing\n\n    var seriesElements;\n\n    for (var _i = 0, seriesCollection_1 = seriesCollection; _i < seriesCollection_1.length; _i++) {\n      var series = seriesCollection_1[_i];\n      seriesElements = this.getSeriesElements(series);\n      this.removeStyles(seriesElements);\n\n      for (var _a = 0, seriesElements_2 = seriesElements; _a < seriesElements_2.length; _a++) {\n        var seriesElement = seriesElements_2[_a];\n        this.removeStyles(this.getChildren(seriesElement));\n      }\n    }\n  };\n\n  Selection.prototype.setAttributes = function (ele, object) {\n    var keys = Object.keys(object);\n\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var key = keys_1[_i];\n      ele.setAttribute(key, object[key]);\n    }\n  };\n  /**\r\n   * Method to move the dragged rect.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.draggedRectMoved = function (chart, grabbedPoint, doDrawing, target) {\n    var rect;\n\n    if ((this.resizing || this.rectGrabbing) && chart.allowMultiSelection) {\n      var r = this.dragRectArray[this.targetIndex];\n      rect = new Rect(r.x, r.y, r.width, r.height);\n    } else {\n      rect = new Rect(this.rectPoints.x, this.rectPoints.y, this.rectPoints.width, this.rectPoints.height);\n    }\n\n    rect.x -= grabbedPoint.x - chart.mouseX;\n    rect.y -= grabbedPoint.y - chart.mouseY;\n    rect = getDraggedRectLocation(rect.x, rect.y, rect.x + rect.width, rect.height + rect.y, chart.chartAxisLayoutPanel.seriesClipRect);\n\n    if (doDrawing) {\n      this.drawDraggingRect(chart, rect, target);\n    } else {\n      this.calculateDragSelectedElements(chart, rect);\n    }\n  };\n  /**\r\n   * To complete the selection.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.completeSelection = function (e) {\n    var chart = this.chart;\n\n    if (chart.selectionMode === 'None') {\n      return;\n    }\n\n    this.currentMode = chart.selectionMode;\n\n    if ((this.dragging || this.resizing) && this.dragRect.width > 5 && this.dragRect.height > 5) {\n      this.calculateDragSelectedElements(chart, this.dragRect);\n    } else if (!chart.allowMultiSelection && this.rectGrabbing && this.rectPoints.width && this.rectPoints.height) {\n      this.draggedRectMoved(chart, this.dragRect);\n    } else if (this.rectGrabbing && this.dragRectArray[this.targetIndex].width && this.dragRectArray[this.targetIndex].height) {\n      this.draggedRectMoved(chart, this.dragRect);\n    }\n\n    if (chart.selectionMode === 'Lasso' && this.dragging && this.path) {\n      if (this.path.indexOf('L') !== -1) {\n        if (!chart.allowMultiSelection) {\n          getElement(this.lassoPath).setAttribute('d', this.path + 'Z');\n          this.pointChecking(getElement(this.lassoPath));\n        } else if (getElement(this.lassoPath + this.count)) {\n          getElement(this.lassoPath + this.count).setAttribute('d', this.path + 'Z');\n          this.pointChecking(getElement(this.lassoPath + this.count));\n        }\n\n        if (this.dragging || this.resizing) {\n          this.calculateDragSelectedElements(chart, this.dragRect);\n        }\n      }\n    }\n\n    this.dragging = false;\n    this.rectGrabbing = false;\n    this.resizing = false;\n    this.removeDraggedElements(chart, e);\n  };\n\n  Selection.prototype.getDragRect = function (chart, seriesClipRect) {\n    return getDraggedRectLocation(chart.mouseDownX, chart.mouseDownY, chart.mouseX, chart.mouseY, seriesClipRect);\n  };\n  /** @private */\n\n\n  Selection.prototype.dragStart = function (chart, seriesClipRect, mouseDownX, mouseDownY, event) {\n    var mode = chart.selectionMode;\n    this.currentMode = chart.selectionMode;\n    this.dragging = (mode.indexOf('Drag') > -1 || mode === 'Lasso') && (chart.isDoubleTap || !chart.isTouch) && chart.chartAreaType !== 'PolarRadar';\n    var target = event.target;\n    this.path = undefined;\n\n    if (this.dragging) {\n      this.count = getElement(this.multiRectGroup) ? this.count + 1 : 0;\n      this.dragRect = new Rect(chart.mouseDownX, chart.mouseDownY, 0, 0);\n\n      if (chart.mouseDownX < seriesClipRect.x || chart.mouseDownX > seriesClipRect.x + seriesClipRect.width || chart.mouseDownY < seriesClipRect.y || chart.mouseDownY > seriesClipRect.y + seriesClipRect.height) {\n        this.dragging = false;\n      }\n    }\n\n    if (mode === 'Lasso') {\n      for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\n        var series = _a[_i];\n\n        if (series.visible) {\n          for (var _b = 0, _c = series.points; _b < _c.length; _b++) {\n            var point = _c[_b];\n\n            if (!chart.allowMultiSelection) {\n              point.isSelect = false;\n            }\n          }\n        }\n      }\n    }\n\n    if (!(mode === 'Lasso')) {\n      if (this.rectPoints && !chart.allowMultiSelection) {\n        this.dragRect = new Rect(chart.mouseDownX, chart.mouseDownY, 0, 0);\n        this.resizingSelectionRect(chart, new ChartLocation(mouseDownX, mouseDownY), true);\n        this.rectGrabbing = withInBounds(mouseDownX, mouseDownY, this.rectPoints);\n      }\n\n      if (chart.allowMultiSelection) {\n        var index = this.getIndex(target.id);\n        this.targetIndex = this.isDragRect(target.id) ? index : undefined;\n\n        if (this.dragRectArray.length && this.isDragRect(target.id)) {\n          this.resizingSelectionRect(chart, new ChartLocation(mouseDownX, mouseDownY), true, target);\n          this.rectGrabbing = withInBounds(mouseDownX, mouseDownY, this.dragRectArray[index]);\n        }\n      }\n    }\n  };\n\n  Selection.prototype.isDragRect = function (id) {\n    return id.indexOf('_ej2_drag_rect') > -1;\n  };\n  /** @private */\n\n\n  Selection.prototype.mouseMove = function (event) {\n    var chart = this.chart;\n    var target = event.target;\n\n    if (chart.highlightMode !== 'None') {\n      if (!isNullOrUndefined(target)) {\n        if (event.target.id.indexOf('text') > 1) {\n          target = getElement(event.target.id.replace('text', 'shape'));\n        }\n\n        if (target.hasAttribute('class') && (target.getAttribute('class').indexOf('highlight') > -1 || target.getAttribute('class').indexOf('selection') > -1)) {\n          return;\n        }\n\n        this.calculateSelectedElements(event);\n        return;\n      }\n    }\n\n    if (chart.selectionMode === 'None') {\n      return;\n    }\n\n    if (event.type === 'touchmove' && (Browser.isIos || Browser.isIos7) && this.dragging && event.preventDefault) {\n      event.preventDefault();\n    }\n\n    var insideMoving = withInBounds(chart.mouseX, chart.mouseY, chart.chartAxisLayoutPanel.seriesClipRect);\n\n    if (insideMoving) {\n      if (this.rectGrabbing && !this.resizing) {\n        this.draggedRectMoved(chart, this.dragRect, true, target);\n      } else if (this.dragging && !this.resizing) {\n        if (chart.selectionMode === 'Lasso') {\n          this.getPath(chart.mouseDownX, chart.mouseDownY, chart.mouseX, chart.mouseY);\n          this.drawDraggingRect(chart, this.dragRect, target);\n        } else {\n          this.dragRect = this.getDragRect(chart, chart.chartAxisLayoutPanel.seriesClipRect);\n          this.drawDraggingRect(chart, this.dragRect, target);\n        }\n      }\n\n      if (this.rectPoints && !chart.allowMultiSelection) {\n        this.resizingSelectionRect(chart, new ChartLocation(chart.mouseX, chart.mouseY), null, target);\n      } else if (chart.allowMultiSelection && !this.dragging || this.resizing) {\n        this.resizingSelectionRect(chart, new ChartLocation(chart.mouseX, chart.mouseY), null, target);\n      }\n    } else {\n      this.completeSelection(event);\n    }\n  };\n\n  Selection.prototype.getPath = function (startX, startY, endX, endY) {\n    if (this.dragging) {\n      if (this.path) {\n        this.path = this.path + ' L' + endX + ' ' + endY;\n      } else {\n        this.path = 'M ' + startX + ' ' + startY;\n      }\n    }\n  };\n\n  Selection.prototype.pointChecking = function (path) {\n    var _this = this;\n\n    var chart = this.chart;\n    var element;\n    var svgRect = getElement(chart.svgId).getBoundingClientRect();\n    var offsetX = chart.chartAxisLayoutPanel.seriesClipRect.x + Math.max(svgRect.left, 0);\n    var offsetY = chart.chartAxisLayoutPanel.seriesClipRect.y + Math.max(svgRect.top, 0);\n    this.multiDataIndexes[this.count] = [];\n\n    for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\n      var series = _a[_i];\n      series.points.filter(function (point) {\n        // To check whether the point have symbol location value or not.\n        if (point.symbolLocations && point.symbolLocations.length) {\n          element = document.elementFromPoint(point.symbolLocations[0].x + offsetX, point.symbolLocations[0].y + offsetY);\n        }\n\n        if (element === path) {\n          point.isSelect = true;\n\n          if (_this.chart.allowMultiSelection && _this.currentMode === 'Lasso') {\n            _this.multiDataIndexes[_this.count][_this.seriesIndex] = point;\n            _this.seriesIndex++;\n          }\n        } else if (!chart.allowMultiSelection) {\n          point.isSelect = false;\n        }\n      });\n    }\n\n    this.seriesIndex = 0;\n  };\n  /**\r\n   * Get module name.\r\n   *\r\n   * @private\r\n   */\n\n\n  Selection.prototype.getModuleName = function () {\n    return 'Selection';\n  };\n  /**\r\n   * To destroy the selection.\r\n   *\r\n   * @returns {void}\r\n   * @private\r\n   */\n\n\n  Selection.prototype.destroy = function () {\n    this.removeEventListener(); // Destroy method performed here\n  };\n\n  return Selection;\n}(BaseSelection);\n\nexport { Selection };","map":{"version":3,"sources":["C:/Users/x/Desktop/openDSA/openDSA_dashboard/project/node_modules/@syncfusion/ej2-react-charts/node_modules/@syncfusion/ej2-charts/src/chart/user-interaction/selection.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Browser","remove","extend","isNullOrUndefined","ChartLocation","RectOption","CircleOption","withInBounds","getDraggedRectLocation","removeElement","getElement","Rect","PathOption","Index","dragComplete","selectionComplete","BaseSelection","Selection","_super","chart","_this","call","isdrawRect","multiDataIndexes","pathIndex","seriesIndex","count","dragRectArray","filterArray","totalSelectedPoints","renderer","mode","selectionMode","isMultiDrag","isMultiSelect","indexOf","addEventListener","isDestroyed","stockChart","onPanning","cancelEvent","isPointer","on","touchMoveEvent","mouseMove","completeSelection","calculateSelectedElements","touchStartEvent","mousedown","touchEndEvent","e","isPointMouseDown","isChartDrag","isDoubleTap","isTouch","rectPoints","dragStart","chartAxisLayoutPanel","seriesClipRect","mouseDownX","mouseDownY","removeEventListener","off","initPrivateVariables","styleId","element","id","unselected","closeIconId","draggedRectGroup","multiRectGroup","draggedRect","lassoPath","selectedDataIndexes","isSeriesMode","invokeSelection","series","visibleSeries","seriesStyles","currentMode","selectDataIndex","concatIndexes","generateStyle","unSelectedStyle","highlightMode","nonHighlightStyle","selectionStyle","index","indexes","_i","indexes_1","length","performSelection","getElementByIndex","suffix","marker","elementId","point","type","visible","getClusterElements","clusters","seriesStyle","selectedElements","_a","isRectSeries","push","document","querySelectorAll","findTrackballElements","clusterIndex","removeSelection","className","trackballElements","elements","i","parentNode","slice","i_1","removeStyles","findElements","getSeriesElements","isAlreadySelected","event","targetElem","target","highlightDataIndexes","previousSelectedEle","parentNodeId","isElement","hasAttribute","getAttribute","removeAttribute","highlightColor","highlightPattern","j","children","setAttribute","control","indexFinder","interior","addOrRemoveIndex","targetElement","split","selectionEle","blurEffect","selection","isNaN","pointElements","replace","clusterSelection","points","pointIndex","selectedPointValues","yValue","selectedPointX","regions","y","xValue","primaryXAxis","valueType","x","toLocaleString","Date","category","args","name","selectedDataValues","cancel","trigger","removeMultiSelectElements","getElementById","isAdd","pClassName","getSelectionClass","applyStyles","currentIndex","seriesCollection","toEquals","splice","chartId","legendClick","visibility","checkVisibility","visibleSeries_1","checkSelectionElements","childNodes","elementClassName","parentClassName","legendShape","selectElement","addSvgClass","removeSvgClass","classList","symbolEle","seriesClassName","legendModule","legendSettings","trim","elements_1","elements_2","first","second","checkSeriesOnly","redrawSelection","oldMode","chartRedraw","isRedrawSelection","removeSelectedElements","legendSelection","isPreSelected","isBlurEffectNeeded","seriesElements","_b","seriesElements_1","seriesElement","NaN","value","elements_3","symbolElement","ids","parseInt","calculateDragSelectedElements","dragRect","isClose","isLasso","rect","width","height","axisOffset","removeOffset","selectedSeriesValues","isDragResize","allowMultiSelection","rectGrabbing","resizing","targetIndex","rt","_loop_1","xAxisOffset_1","yAxisOffset_1","isTransposed","xAxis","yAxis","isCurrentPoint","some","region","isSelect","this_1","isPointSelect","symbolLocations","location","createCloseButton","clip","xAxisOffset","yAxisOffset","rectCollection","rectCollection_1","drawDraggingRect","cartesianLayout","border","chartArea","rectFill","themeStyle","selectionRectFill","rectStroke","selectionRectStroke","isDragMode","dragGroup","multiGroup","svgRenderer","createGroup","svgObject","appendChild","rectElement","nextSibling","setAttributes","svgElement","enableCanvas","drawRectangle","color","style","cursor","drawPath","path","closeIcon","getIndex","Number","substr","circleStroke","selectionCircleStroke","isDrag","drawCircle","direction","stroke","fill","pathElement","removeDraggedElements","isSelectedvalues","multiRectGroupElement","childElementCount","k","changeCursorStyle","resizingSelectionRect","tapped","r","resize","findResizeMode","chartSvgObject","cursorStyle","resizeEdges","resizeMode","Math","abs","min","isResize","rectelement","seriesCollection_1","seriesElements_2","getChildren","ele","object","keys","keys_1","key","draggedRectMoved","grabbedPoint","doDrawing","mouseX","mouseY","dragging","pointChecking","getDragRect","chartAreaType","undefined","_c","isDragRect","isIos","isIos7","preventDefault","insideMoving","getPath","startX","startY","endX","endY","svgRect","svgId","getBoundingClientRect","offsetX","max","left","offsetY","top","filter","elementFromPoint","getModuleName","destroy"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\n/* eslint-disable @typescript-eslint/ban-types */\r\n/* eslint-disable jsdoc/require-returns */\r\n/* eslint-disable jsdoc/require-param */\r\n/* eslint-disable valid-jsdoc */\r\n/* eslint-disable @typescript-eslint/no-inferrable-types */\r\n/**\r\n * Selection src file\r\n */\r\nimport { Browser } from '@syncfusion/ej2-base';\r\nimport { remove } from '@syncfusion/ej2-base';\r\nimport { extend, isNullOrUndefined } from '@syncfusion/ej2-base';\r\nimport { ChartLocation, RectOption, CircleOption, withInBounds, getDraggedRectLocation, removeElement, getElement } from '../../common/utils/helper';\r\nimport { Rect, PathOption } from '@syncfusion/ej2-svg-base';\r\nimport { Index } from '../../common/model/base';\r\nimport { dragComplete, selectionComplete } from '../../common/model/constants';\r\nimport { BaseSelection } from '../../common/user-interaction/selection';\r\n/**\r\n * `Selection` module handles the selection for chart.\r\n *\r\n * @private\r\n */\r\nvar Selection = /** @class */ (function (_super) {\r\n    __extends(Selection, _super);\r\n    /**\r\n     * Constructor for selection module.\r\n     *\r\n     * @private\r\n     */\r\n    function Selection(chart) {\r\n        var _this = _super.call(this, chart) || this;\r\n        _this.isdrawRect = true;\r\n        _this.multiDataIndexes = [];\r\n        _this.pathIndex = 0;\r\n        _this.seriesIndex = 0;\r\n        _this.count = -1;\r\n        _this.dragRectArray = [];\r\n        _this.filterArray = [];\r\n        _this.totalSelectedPoints = [];\r\n        _this.chart = chart;\r\n        _this.renderer = chart.renderer;\r\n        var mode = chart.selectionMode;\r\n        _this.isMultiDrag = chart.isMultiSelect && (mode.indexOf('Drag') > -1);\r\n        _this.addEventListener();\r\n        return _this;\r\n    }\r\n    /**\r\n     * Binding events for selection module.\r\n     */\r\n    Selection.prototype.addEventListener = function () {\r\n        if (this.chart.isDestroyed || (this.chart.stockChart && this.chart.stockChart.onPanning)) {\r\n            return;\r\n        }\r\n        var cancelEvent = Browser.isPointer ? 'pointerleave' : 'mouseleave';\r\n        this.chart.on(Browser.touchMoveEvent, this.mouseMove, this);\r\n        this.chart.on(cancelEvent, this.completeSelection, this);\r\n        this.chart.on('click', this.calculateSelectedElements, this);\r\n        this.chart.on(Browser.touchStartEvent, this.mousedown, this);\r\n        this.chart.on(Browser.touchEndEvent, this.completeSelection, this);\r\n    };\r\n    /**\r\n     * Chart mouse down\r\n     */\r\n    Selection.prototype.mousedown = function (e) {\r\n        var chart = this.chart;\r\n        if (chart.isPointMouseDown || chart.selectionMode === 'None' || chart.isChartDrag) {\r\n            return;\r\n        }\r\n        if (chart.isDoubleTap || !chart.isTouch || this.rectPoints) {\r\n            this.dragStart(chart, chart.chartAxisLayoutPanel.seriesClipRect, chart.mouseDownX, chart.mouseDownY, e);\r\n        }\r\n    };\r\n    /**\r\n     * UnBinding events for selection module.\r\n     */\r\n    Selection.prototype.removeEventListener = function () {\r\n        if (this.chart.isDestroyed) {\r\n            return;\r\n        }\r\n        this.chart.off(Browser.touchMoveEvent, this.mouseMove);\r\n        this.chart.off('pointerleave' || 'mouseleave', this.completeSelection);\r\n        this.chart.off('click', this.calculateSelectedElements);\r\n        this.chart.off(Browser.touchStartEvent, this.mousedown);\r\n        this.chart.off(Browser.touchEndEvent, this.completeSelection);\r\n    };\r\n    /**\r\n     * To find private variable values\r\n     */\r\n    Selection.prototype.initPrivateVariables = function (chart) {\r\n        this.styleId = chart.element.id + '_ej2_chart_selection';\r\n        this.unselected = chart.element.id + '_ej2_deselected';\r\n        this.closeIconId = chart.element.id + '_ej2_drag_close';\r\n        this.draggedRectGroup = chart.element.id + '_ej2_drag_group';\r\n        this.multiRectGroup = chart.element.id + '_ej2_drag_multi_group';\r\n        this.draggedRect = chart.element.id + '_ej2_drag_rect';\r\n        this.lassoPath = chart.element.id + '_ej2_drag_path';\r\n        this.selectedDataIndexes = [];\r\n        this.rectPoints = null;\r\n        this.isSeriesMode = chart.selectionMode === 'Series';\r\n    };\r\n    /**\r\n     * Method to select the point and series.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    Selection.prototype.invokeSelection = function (chart) {\r\n        this.initPrivateVariables(chart);\r\n        this.series = extend({}, chart.visibleSeries, null, true);\r\n        this.seriesStyles();\r\n        this.currentMode = chart.selectionMode;\r\n        if (!(chart.selectionMode.indexOf('Drag') > -1)) {\r\n            this.selectDataIndex(chart, this.concatIndexes(chart.selectedDataIndexes, this.selectedDataIndexes));\r\n        }\r\n    };\r\n    Selection.prototype.generateStyle = function (series) {\r\n        if (series) {\r\n            if (this.styleId.indexOf('selection') > 1 && this.chart.selectionMode !== 'None') {\r\n                this.unselected = series.unSelectedStyle || this.unselected;\r\n            }\r\n            if (this.styleId.indexOf('highlight') > 0 && this.chart.highlightMode !== 'None') {\r\n                this.unselected = series.nonHighlightStyle || this.unselected;\r\n            }\r\n            return (series.selectionStyle || this.styleId + '_series_' + series.index);\r\n        }\r\n        return 'undefined';\r\n    };\r\n    /**\r\n     *  Method to get the selected data index\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.selectDataIndex = function (chart, indexes) {\r\n        for (var _i = 0, indexes_1 = indexes; _i < indexes_1.length; _i++) {\r\n            var index = indexes_1[_i];\r\n            this.performSelection(index, chart, this.getElementByIndex(chart, index)[0]);\r\n        }\r\n    };\r\n    /**\r\n     *  Method to get the selected index element\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.getElementByIndex = function (chart, index, suffix, marker) {\r\n        if (suffix === void 0) { suffix = ''; }\r\n        var elementId = chart.element.id + '_Series_' + index.series + '_Point' + '_' + index.point;\r\n        var series = chart.series[index.series];\r\n        elementId = (series.type !== 'Scatter' && series.type !== 'Bubble' && marker) ? (elementId + '_Symbol' + suffix) : elementId;\r\n        return [getElement(elementId), ((series.type === 'RangeArea' || series.type === 'SplineRangeArea') && series.marker.visible) ?\r\n                getElement(elementId + '1') : null];\r\n    };\r\n    /**\r\n     *  Method to get the selected cluster element\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.getClusterElements = function (chart, index) {\r\n        var clusters = [];\r\n        var seriesStyle;\r\n        var selectedElements;\r\n        for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\r\n            var series = _a[_i];\r\n            if (series.visible) {\r\n                index = new Index(series.index, index.point);\r\n                if (series.isRectSeries) {\r\n                    clusters.push(this.getElementByIndex(chart, index)[0]);\r\n                }\r\n                clusters.push(this.getElementByIndex(chart, index, '', series.marker.visible)[0]);\r\n                seriesStyle = this.generateStyle(chart.visibleSeries[index.series]);\r\n                selectedElements = document.querySelectorAll('.' + seriesStyle);\r\n                this.findTrackballElements(selectedElements, seriesStyle);\r\n                var clusterIndex = series.marker.visible && series.isRectSeries ? 2 : 1;\r\n                if (!chart.isMultiSelect && selectedElements.length > 0 &&\r\n                    selectedElements[0].id !== clusters[clusters.length - clusterIndex].id) {\r\n                    this.removeSelection(chart, index.series, selectedElements, seriesStyle, true);\r\n                }\r\n            }\r\n        }\r\n        return clusters;\r\n    };\r\n    /**\r\n     *  Method to get trackball elements\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.findTrackballElements = function (selectedElements, className) {\r\n        var trackballElements;\r\n        var elements;\r\n        for (var i = 0; i < selectedElements.length; i++) {\r\n            if (!isNullOrUndefined(selectedElements[i])) {\r\n                trackballElements = !isNullOrUndefined(selectedElements[i].parentNode) ?\r\n                    [].slice.call(selectedElements[0].parentNode.querySelectorAll('.' + className)) : [];\r\n                if (trackballElements.length > 0) {\r\n                    elements = [];\r\n                    for (var i_1 = 0; i_1 < trackballElements.length; i_1++) {\r\n                        if (trackballElements[i_1].id.indexOf('Trackball') > -1) {\r\n                            elements.push(trackballElements[i_1]);\r\n                        }\r\n                    }\r\n                    this.removeStyles(elements);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *  Method to get the selected element\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.findElements = function (chart, series, index, suffix, marker) {\r\n        if (suffix === void 0) { suffix = ''; }\r\n        if (this.isSeriesMode) {\r\n            return this.getSeriesElements(series);\r\n        }\r\n        else if (this.currentMode === 'Cluster') {\r\n            return this.getClusterElements(chart, index);\r\n        }\r\n        else {\r\n            return this.getElementByIndex(chart, index, suffix, marker);\r\n        }\r\n    };\r\n    /**\r\n     * To find the selected element.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.isAlreadySelected = function (event) {\r\n        var targetElem = event.target;\r\n        if (event.type === 'click') {\r\n            this.currentMode = this.chart.selectionMode;\r\n            this.styleId = this.chart.element.id + '_ej2_chart_selection';\r\n        }\r\n        else if (event.type === 'mousemove' || event.type === 'pointermove') {\r\n            this.currentMode = this.chart.highlightMode;\r\n            this.highlightDataIndexes = [];\r\n            this.styleId = this.chart.element.id + '_ej2_chart_highlight';\r\n        }\r\n        if (this.chart.highlightMode !== 'None' && this.chart.selectionMode === 'None') {\r\n            if (event.type === 'click') {\r\n                return false;\r\n            }\r\n        }\r\n        if ((this.chart.highlightMode !== 'None' && this.previousSelectedEle && this.previousSelectedEle[0])) {\r\n            var parentNodeId = targetElem.parentNode.id;\r\n            var isElement = void 0;\r\n            if (targetElem.parentNode) {\r\n                isElement = (parentNodeId.indexOf('SeriesGroup') > 0 || parentNodeId.indexOf('SymbolGroup') > 0) ? true : false;\r\n            }\r\n            for (var i = 0; i < this.previousSelectedEle.length; i++) {\r\n                if (this.previousSelectedEle[i].hasAttribute('class')) {\r\n                    if (this.previousSelectedEle[i].getAttribute('class').indexOf('highlight') > -1 &&\r\n                        (isElement || event.type === 'click')) {\r\n                        this.previousSelectedEle[i].removeAttribute('class');\r\n                        if (this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor) && this.chart.highlightPattern === 'None') {\r\n                            if (this.previousSelectedEle[i].id.indexOf('Group') > 0) {\r\n                                for (var j = 0; j < this.previousSelectedEle[i].children.length; j++) {\r\n                                    this.previousSelectedEle[i].children[j].setAttribute('fill', this.control.visibleSeries[this.indexFinder(this.previousSelectedEle[i].id).series].interior);\r\n                                }\r\n                            }\r\n                            else {\r\n                                this.previousSelectedEle[i].setAttribute('fill', this.control.visibleSeries[this.indexFinder(this.previousSelectedEle[i].id).series].interior);\r\n                            }\r\n                        }\r\n                        this.addOrRemoveIndex(this.highlightDataIndexes, this.indexFinder(this.previousSelectedEle[i].id));\r\n                    }\r\n                    else if (!isElement && this.previousSelectedEle[i].getAttribute('class').indexOf('highlight') > -1) {\r\n                        this.performSelection(this.indexFinder(this.previousSelectedEle[i].id), this.chart, this.previousSelectedEle[i]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * To find the selected element.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.calculateSelectedElements = function (event) {\r\n        if (isNullOrUndefined(event.target)) {\r\n            return;\r\n        }\r\n        var targetElement = event.target;\r\n        if ((this.chart.selectionMode === 'None' && this.chart.highlightMode === 'None') ||\r\n            targetElement.id.indexOf(this.chart.element.id + '_') === -1) {\r\n            return;\r\n        }\r\n        if (event.type === 'mousemove' || event.type === 'pointermove') {\r\n            if (targetElement.hasAttribute('class') && (targetElement.getAttribute('class').indexOf('highlight') > -1 ||\r\n                targetElement.getAttribute('class').indexOf('selection') > -1)) {\r\n                return;\r\n            }\r\n            if (!isNullOrUndefined(targetElement.parentNode) && targetElement.parentNode.hasAttribute('class') &&\r\n                (targetElement.parentNode.getAttribute('class').indexOf('highlight') > 0 ||\r\n                    targetElement.parentNode.getAttribute('class').indexOf('selection') > 0)) {\r\n                return;\r\n            }\r\n        }\r\n        this.isAlreadySelected(event);\r\n        if (targetElement.id.indexOf('_Series_') > -1) {\r\n            var element = void 0;\r\n            if (targetElement.id.indexOf('_Trackball_1') > -1) {\r\n                element = getElement(targetElement.id.split('_Trackball_')[0] + '_Symbol');\r\n                element = isNullOrUndefined(element) ? getElement(targetElement.id.split('_Trackball_')[0]) : element;\r\n            }\r\n            else if (targetElement.id.indexOf('_Trackball_0') > -1) {\r\n                return null;\r\n            }\r\n            this.performSelection(this.indexFinder(targetElement.id), this.chart, element || targetElement);\r\n        }\r\n    };\r\n    /**\r\n     *  Method to perform the selection\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.performSelection = function (index, chart, element) {\r\n        this.isSeriesMode = this.currentMode === 'Series';\r\n        if (chart.series[index.series].type === 'BoxAndWhisker' && element &&\r\n            element.id === chart.element.id + '_Series_' + index.series + '_Point_' + index.point + '_BoxPath') {\r\n            element = element.parentNode;\r\n        }\r\n        if (chart.series[index.series].type === 'Area' && (this.currentMode === 'Point' || this.currentMode === 'Cluster') && element &&\r\n            (element.id === this.chart.element.id + '_Series_' + index.series)) {\r\n            var className = this.generateStyle(chart.series[index.series]);\r\n            var selectionEle = document.querySelectorAll('.' + className);\r\n            this.findTrackballElements(selectionEle, className);\r\n            this.blurEffect(chart.element.id, chart.visibleSeries);\r\n        }\r\n        switch (this.currentMode) {\r\n            case 'Series':\r\n                this.selection(chart, index, this.getSeriesElements(chart.series[index.series]));\r\n                this.selectionComplete(chart, index, this.currentMode);\r\n                this.blurEffect(chart.element.id, chart.visibleSeries);\r\n                break;\r\n            case 'Point':\r\n                if (!isNaN(index.point) && element) {\r\n                    var pointElements = [];\r\n                    pointElements.push(element);\r\n                    if (pointElements[0] !== null && chart.series[index.series].marker.visible &&\r\n                        (chart.series[index.series].type.indexOf('Column') !== -1 || chart.series[index.series].type.indexOf('Bar') !== -1)) {\r\n                        if (!(element.id.indexOf('_Symbol') !== -1) && getElement(element.id + '_Symbol')) {\r\n                            pointElements.push(getElement(element.id + '_Symbol'));\r\n                        }\r\n                        else if (element.id.indexOf('_Symbol') !== -1 && getElement(element.id.replace('_Symbol', ''))) {\r\n                            pointElements.push(getElement(element.id.replace('_Symbol', '')));\r\n                        }\r\n                    }\r\n                    this.selection(chart, index, pointElements);\r\n                    this.selectionComplete(chart, index, this.currentMode);\r\n                    this.blurEffect(chart.element.id, chart.visibleSeries);\r\n                }\r\n                break;\r\n            case 'Cluster':\r\n                if (!isNaN(index.point)) {\r\n                    this.clusterSelection(chart, index);\r\n                    this.selectionComplete(chart, index, this.currentMode);\r\n                    this.blurEffect(chart.element.id, chart.visibleSeries);\r\n                }\r\n                break;\r\n        }\r\n    };\r\n    /**\r\n     *  Method to get the selected data index\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.selectionComplete = function (chart, index, selectionMode) {\r\n        var points;\r\n        var pointIndex;\r\n        var seriesIndex;\r\n        var selectedPointValues = [];\r\n        var yValue;\r\n        var selectedPointX;\r\n        if (selectionMode === 'Cluster') {\r\n            for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\r\n                var series = _a[_i];\r\n                if (series.visible) {\r\n                    for (var i = 0; i < this.selectedDataIndexes.length; i++) {\r\n                        pointIndex = chart.isMultiSelect ? this.selectedDataIndexes[i].point : index.point;\r\n                        seriesIndex = series.index;\r\n                        points = series.points;\r\n                        if (!isNaN(pointIndex)) {\r\n                            yValue = (series.type !== 'RangeArea' || 'SplineRangeArea') ? points[pointIndex].yValue :\r\n                                points[pointIndex].regions[0].y;\r\n                            selectedPointX = points[pointIndex].xValue;\r\n                            if (chart.primaryXAxis.valueType === 'Category') {\r\n                                selectedPointX = points[pointIndex].x.toLocaleString();\r\n                            }\r\n                            else if (chart.primaryXAxis.valueType === 'DateTime') {\r\n                                selectedPointX = new Date(points[pointIndex].xValue);\r\n                            }\r\n                            if (series.category !== 'Indicator') {\r\n                                selectedPointValues.push({\r\n                                    x: selectedPointX, y: yValue, seriesIndex: seriesIndex,\r\n                                    pointIndex: pointIndex\r\n                                });\r\n                            }\r\n                            if (series.type === 'RangeArea' || series.type === 'SplineRangeArea') {\r\n                                selectedPointValues.push({\r\n                                    x: selectedPointX, y: points[pointIndex].regions[0].y,\r\n                                    seriesIndex: seriesIndex, pointIndex: pointIndex\r\n                                });\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (selectionMode === 'Series') {\r\n            if (chart.isMultiSelect) {\r\n                for (var i = 0; i < this.selectedDataIndexes.length; i++) {\r\n                    seriesIndex = this.selectedDataIndexes[i].series;\r\n                    selectedPointValues.push({\r\n                        seriesIndex: seriesIndex\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                seriesIndex = (this.selectedDataIndexes.length > 0) ? this.selectedDataIndexes[0].series : 0;\r\n                selectedPointValues.push({\r\n                    seriesIndex: seriesIndex\r\n                });\r\n            }\r\n        }\r\n        else if (selectionMode === 'Point') {\r\n            for (var i = 0; i < this.selectedDataIndexes.length; i++) {\r\n                pointIndex = this.selectedDataIndexes[i].point;\r\n                seriesIndex = this.selectedDataIndexes[i].series;\r\n                var series = chart.series[seriesIndex];\r\n                points = series.points;\r\n                if (!isNaN(pointIndex)) {\r\n                    selectedPointX = points[pointIndex].xValue;\r\n                    yValue = (series.type !== 'RangeArea' || 'SplineRangeArea') ? points[pointIndex].yValue :\r\n                        points[pointIndex].regions[0].y;\r\n                    if (chart.primaryXAxis.valueType === 'Category') {\r\n                        selectedPointX = points[pointIndex].x.toLocaleString();\r\n                    }\r\n                    else if (chart.primaryXAxis.valueType === 'DateTime') {\r\n                        selectedPointX = new Date(points[pointIndex].xValue);\r\n                    }\r\n                    selectedPointValues.push({\r\n                        x: selectedPointX, y: yValue, seriesIndex: seriesIndex,\r\n                        pointIndex: pointIndex\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        var args = {\r\n            name: selectionComplete,\r\n            selectedDataValues: selectedPointValues,\r\n            cancel: false\r\n        };\r\n        chart.trigger(selectionComplete, args);\r\n    };\r\n    /**\r\n     *  Method to perform selection\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.selection = function (chart, index, selectedElements) {\r\n        if (!(this.currentMode === 'Lasso')) {\r\n            if (!chart.isMultiSelect && (this.currentMode.indexOf('Drag') === -1 && this.styleId.indexOf('highlight') === -1 &&\r\n                chart.selectionMode !== 'None')) {\r\n                this.removeMultiSelectElements(chart, this.selectedDataIndexes, index, chart.series);\r\n            }\r\n        }\r\n        if (!isNullOrUndefined(selectedElements[0])) {\r\n            if (chart.series[index.series].isRectSeries) {\r\n                if (selectedElements[0].id) {\r\n                    if (document.getElementById(selectedElements[0].id + '_Symbol')) {\r\n                        selectedElements.push(getElement(selectedElements[0].id + '_Symbol'));\r\n                    }\r\n                    else if (selectedElements[0].id.indexOf('SeriesGroup') !== -1) {\r\n                        if (document.getElementById(selectedElements[0].id.replace('SeriesGroup', 'SymbolGroup'))) {\r\n                            selectedElements.push(getElement(selectedElements[0].id.replace('SeriesGroup', 'SymbolGroup')));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            var isAdd = void 0;\r\n            var className = selectedElements[0] && (selectedElements[0].getAttribute('class') || '');\r\n            var pClassName = selectedElements[0].parentNode &&\r\n                (selectedElements[0].parentNode.getAttribute('class') || '');\r\n            if (className !== '' && this.currentMode !== 'Cluster') {\r\n                this.findTrackballElements(selectedElements, className);\r\n            }\r\n            if (selectedElements[0] && className.indexOf(this.getSelectionClass(selectedElements[0].id)) > -1) {\r\n                this.removeStyles(selectedElements);\r\n            }\r\n            else if (selectedElements[0].parentNode && pClassName.indexOf(this.getSelectionClass(selectedElements[0].id)) > -1) {\r\n                this.removeStyles([selectedElements[0].parentNode]);\r\n            }\r\n            else {\r\n                this.previousSelectedEle = chart.highlightMode !== 'None' ? selectedElements : [];\r\n                this.applyStyles(selectedElements);\r\n                isAdd = true;\r\n            }\r\n            if (this.styleId.indexOf('highlight') > 0 && chart.highlightMode !== 'None') {\r\n                this.addOrRemoveIndex(this.highlightDataIndexes, index, isAdd);\r\n            }\r\n            else {\r\n                this.addOrRemoveIndex(this.selectedDataIndexes, index, isAdd);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *  Method to get the cluster selection element\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.clusterSelection = function (chart, index) {\r\n        this.selection(chart, index, this.getClusterElements(chart, new Index(index.series, index.point)));\r\n    };\r\n    /**\r\n     * Method to remove the multi selected elements\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.removeMultiSelectElements = function (chart, index, currentIndex, seriesCollection) {\r\n        var series;\r\n        for (var i = 0; i < index.length; i++) {\r\n            series = seriesCollection[index[i].series];\r\n            if ((this.isSeriesMode && !this.toEquals(index[i], currentIndex, this.isSeriesMode)) ||\r\n                (this.currentMode === 'Cluster' && !this.toEquals(index[i], currentIndex, false)) ||\r\n                (!this.isSeriesMode && this.toEquals(index[i], currentIndex, true) && !this.toEquals(index[i], currentIndex, false))) {\r\n                this.removeStyles(this.findElements(chart, series, index[i], '', false));\r\n                if (series.marker.visible) {\r\n                    this.removeStyles(this.findElements(chart, series, index[i], '', true));\r\n                }\r\n                index.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Method to remove the selection\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.blurEffect = function (chartId, visibleSeries, legendClick) {\r\n        if (legendClick === void 0) { legendClick = false; }\r\n        var visibility = (this.checkVisibility(this.highlightDataIndexes) ||\r\n            this.checkVisibility(this.selectedDataIndexes)); // legend click scenario\r\n        for (var _i = 0, visibleSeries_1 = visibleSeries; _i < visibleSeries_1.length; _i++) {\r\n            var series = visibleSeries_1[_i];\r\n            if (series.visible) {\r\n                this.checkSelectionElements(getElement(chartId + 'SeriesGroup' + series.index), this.generateStyle(series), visibility, legendClick, series.index);\r\n                if (!isNullOrUndefined(getElement(chartId + 'SymbolGroup' + series.index))) {\r\n                    this.checkSelectionElements(getElement(chartId + 'SymbolGroup' + series.index), this.generateStyle(series), visibility, legendClick, series.index);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Method to add the add/remove class to element\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.checkSelectionElements = function (element, className, visibility, legendClick, series) {\r\n        var children = (this.isSeriesMode ? [element] : element.childNodes);\r\n        if (this.chart.selectionMode !== 'None' && this.chart.highlightMode !== 'None') {\r\n            children = element.childNodes;\r\n        }\r\n        var elementClassName;\r\n        var parentClassName;\r\n        var legendShape;\r\n        var selectElement = element;\r\n        for (var i = 0; i < children.length; i++) {\r\n            elementClassName = children[i].getAttribute('class') || '';\r\n            parentClassName = children[i].parentNode.getAttribute('class') || '';\r\n            if (this.chart.selectionMode !== 'None' && this.chart.highlightMode !== 'None') {\r\n                className = elementClassName.indexOf('selection') > 0 ||\r\n                    elementClassName.indexOf('highlight') > 0 ? elementClassName : className;\r\n                className = (parentClassName.indexOf('selection') > 0 ||\r\n                    parentClassName.indexOf('highlight') > 0) ? parentClassName : className;\r\n            }\r\n            if (elementClassName.indexOf(className) === -1 &&\r\n                parentClassName.indexOf(className) === -1 && visibility) {\r\n                this.addSvgClass(children[i], this.unselected);\r\n            }\r\n            else {\r\n                selectElement = children[i];\r\n                this.removeSvgClass(children[i], this.unselected);\r\n                this.removeSvgClass(children[i].parentNode, this.unselected);\r\n            }\r\n            if (children[i].id.indexOf('Trackball') > 0 && selectElement.classList[0] === className) {\r\n                this.removeSvgClass(children[i], this.unselected);\r\n                this.removeSvgClass(children[i].parentNode, this.unselected);\r\n                this.addSvgClass(children[i], className);\r\n            }\r\n        }\r\n        if (element.id.indexOf('Symbol') > -1) {\r\n            if ((element.querySelectorAll('.' + className)[0]) && element.querySelectorAll('.' + className)[0].getAttribute('class')\r\n                === className) {\r\n                var symbolEle = getElement(this.control.element.id + '_Series_' + element.id[element.id.length - 1]);\r\n                var seriesClassName = symbolEle && symbolEle.hasAttribute('class') ? symbolEle.getAttribute('class') : '';\r\n                if (seriesClassName.indexOf(this.unselected) > -1) {\r\n                    this.removeSvgClass(symbolEle, this.unselected);\r\n                }\r\n            }\r\n        }\r\n        if (this.control.legendModule && this.control.legendSettings.visible) {\r\n            legendShape = getElement(this.control.element.id + '_chart_legend_shape_' + series);\r\n            if (legendShape) {\r\n                if (legendShape.hasAttribute('class')) {\r\n                    this.removeSvgClass(legendShape, legendShape.getAttribute('class'));\r\n                    if (!isNullOrUndefined(this.chart.highlightColor && this.chart.highlightColor !== '')) {\r\n                        legendShape.setAttribute('stroke', this.control.visibleSeries[series].interior);\r\n                        if (this.chart.highlightPattern === 'None') {\r\n                            legendShape.setAttribute('fill', this.control.visibleSeries[series].interior);\r\n                        }\r\n                    }\r\n                }\r\n                elementClassName = selectElement.getAttribute('class') || '';\r\n                parentClassName = selectElement.parentNode.getAttribute('class') || '';\r\n                if (elementClassName.indexOf(className) === -1 && parentClassName.indexOf(className) === -1 && visibility) {\r\n                    this.addSvgClass(legendShape, this.unselected);\r\n                    this.removeSvgClass(legendShape, className);\r\n                    if (this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor)) {\r\n                        legendShape.setAttribute('stroke', this.control.visibleSeries[series].interior);\r\n                        if (this.chart.highlightPattern === 'None') {\r\n                            legendShape.setAttribute('fill', this.control.visibleSeries[series].interior);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this.removeSvgClass(legendShape, this.unselected);\r\n                    if (!isNullOrUndefined(this.chart.highlightColor) && this.chart.highlightColor !== '') {\r\n                        legendShape.setAttribute('stroke', this.control.visibleSeries[series].interior);\r\n                        if (this.chart.highlightPattern === 'None') {\r\n                            legendShape.setAttribute('fill', this.control.visibleSeries[series].interior);\r\n                        }\r\n                    }\r\n                    if ((elementClassName === '' && parentClassName === '') || elementClassName.trim() === 'EJ2-Trackball') {\r\n                        this.removeSvgClass(legendShape, className);\r\n                    }\r\n                    else {\r\n                        this.addSvgClass(legendShape, className);\r\n                        if (className.indexOf('highlight') > 0 && this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor)) {\r\n                            legendShape.setAttribute('stroke', this.chart.highlightColor);\r\n                            if (this.styleId.indexOf('highlight') > 0 && this.chart.highlightPattern === 'None') {\r\n                                legendShape.setAttribute('fill', this.chart.highlightColor);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (legendClick && parentClassName.indexOf(className) > -1) {\r\n                    this.addSvgClass(legendShape, className);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *  Method to apply the styles\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.applyStyles = function (elements) {\r\n        for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\r\n            var element = elements_1[_i];\r\n            if (element) {\r\n                this.removeSvgClass(element.parentNode, this.unselected);\r\n                this.removeSvgClass(element, this.unselected);\r\n                this.addSvgClass(element, this.getSelectionClass(element.id));\r\n                if (this.styleId.indexOf('highlight') > 0 && this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor) && this.chart.highlightPattern === 'None') {\r\n                    if (element.id.indexOf('Group') > 0) {\r\n                        for (var i = 0; i < element.children.length; i++) {\r\n                            element.children[i].setAttribute('fill', this.chart.highlightColor);\r\n                        }\r\n                    }\r\n                    else {\r\n                        element.setAttribute('fill', this.chart.highlightColor);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *  Method to get the selection class\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.getSelectionClass = function (id) {\r\n        return this.generateStyle(this.control.series[this.indexFinder(id).series]);\r\n    };\r\n    /**\r\n     *  Method to remove styles\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.removeStyles = function (elements) {\r\n        for (var _i = 0, elements_2 = elements; _i < elements_2.length; _i++) {\r\n            var element = elements_2[_i];\r\n            if (element) {\r\n                this.removeSvgClass(element, this.getSelectionClass(element.id));\r\n                if (this.chart.highlightPattern === 'None' && this.chart.highlightColor !== '' && !isNullOrUndefined(this.chart.highlightColor)) {\r\n                    if (element.id.indexOf('Group') > 0) {\r\n                        for (var i = 0; i < element.children.length; i++) {\r\n                            element.children[i].setAttribute('fill', this.control.visibleSeries[this.indexFinder(element.id).series].interior);\r\n                        }\r\n                    }\r\n                    else {\r\n                        element.setAttribute('fill', this.control.visibleSeries[this.indexFinder(element.id).series].interior);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *  Method to remove the selected data index\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.addOrRemoveIndex = function (indexes, index, isAdd) {\r\n        for (var i = 0; i < indexes.length; i++) {\r\n            if (this.toEquals(indexes[i], index, this.isSeriesMode)) {\r\n                indexes.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n        if (isAdd) {\r\n            indexes.push(index);\r\n        }\r\n    };\r\n    /**\r\n     *  Method to get the equal index\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.toEquals = function (first, second, checkSeriesOnly) {\r\n        return ((first.series === second.series || (this.currentMode === 'Cluster' && !checkSeriesOnly))\r\n            && (checkSeriesOnly || (first.point === second.point)));\r\n    };\r\n    /**\r\n     * To redraw the selected points.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.redrawSelection = function (chart, oldMode, chartRedraw) {\r\n        this.isSeriesMode = oldMode === 'Series';\r\n        if (!isNullOrUndefined(oldMode)) {\r\n            if (oldMode.indexOf('Drag') !== -1 || oldMode === 'Lasso' || chartRedraw) {\r\n                chart.isRedrawSelection = false;\r\n            }\r\n            else {\r\n                chart.isRedrawSelection = true;\r\n            }\r\n        }\r\n        var selectedDataIndexes = extend([], this.selectedDataIndexes, null, true);\r\n        var highlightDataIndexes = extend([], this.highlightDataIndexes, null, true);\r\n        if (this.styleId.indexOf('highlight') > 0 && highlightDataIndexes.length > 0) {\r\n            this.removeSelectedElements(chart, this.highlightDataIndexes, chart.series);\r\n            selectedDataIndexes = highlightDataIndexes;\r\n        }\r\n        else {\r\n            this.removeSelectedElements(chart, this.selectedDataIndexes, chart.series);\r\n        }\r\n        this.blurEffect(chart.element.id, chart.visibleSeries);\r\n        this.selectDataIndex(chart, selectedDataIndexes);\r\n    };\r\n    /** @private */\r\n    Selection.prototype.legendSelection = function (chart, series, event) {\r\n        var targetElement = event.target;\r\n        if (event.type === 'mousemove') {\r\n            if (event.target.id.indexOf('text') > 1) {\r\n                targetElement = getElement(event.target.id.replace('text', 'shape'));\r\n            }\r\n            if (targetElement.hasAttribute('class') && (targetElement.getAttribute('class').indexOf('highlight') > -1 ||\r\n                targetElement.getAttribute('class').indexOf('selection') > -1)) {\r\n                return;\r\n            }\r\n            this.currentMode = this.chart.highlightMode;\r\n        }\r\n        var isPreSelected = this.isAlreadySelected(event);\r\n        if (isPreSelected) {\r\n            var seriesStyle = this.generateStyle(chart.visibleSeries[series]);\r\n            var selectedElements = (document.querySelectorAll('.' + seriesStyle));\r\n            this.isSeriesMode = this.currentMode === 'Series';\r\n            var isBlurEffectNeeded = true;\r\n            if (selectedElements.length > 0) {\r\n                this.removeSelection(chart, series, selectedElements, seriesStyle, isBlurEffectNeeded);\r\n            }\r\n            else {\r\n                for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\r\n                    var element = _a[_i];\r\n                    if (element.index !== series && !chart.isMultiSelect) {\r\n                        seriesStyle = this.generateStyle(chart.visibleSeries[element.index]);\r\n                        selectedElements = document.querySelectorAll('.' + seriesStyle);\r\n                        this.removeSelection(chart, series, selectedElements, seriesStyle, isBlurEffectNeeded);\r\n                    }\r\n                }\r\n                var seriesElements = this.getSeriesElements(chart.visibleSeries[series]);\r\n                for (var _b = 0, seriesElements_1 = seriesElements; _b < seriesElements_1.length; _b++) {\r\n                    var seriesElement = seriesElements_1[_b];\r\n                    if (isNullOrUndefined(seriesElement)) {\r\n                        return;\r\n                    }\r\n                    this.checkSelectionElements(seriesElement, seriesStyle, false, true, series);\r\n                }\r\n                this.isSeriesMode = true;\r\n                this.selection(chart, new Index(series, NaN), seriesElements);\r\n                this.isSeriesMode = chart.selectionMode === 'Series';\r\n                this.blurEffect(chart.element.id, chart.visibleSeries, true);\r\n            }\r\n        }\r\n    };\r\n    Selection.prototype.removeSelection = function (chart, series, selectedElements, seriesStyle, isBlurEffectNeeded) {\r\n        if (selectedElements.length > 0) {\r\n            var elements = [];\r\n            for (var i = 0; i < selectedElements.length; i++) {\r\n                elements.push(selectedElements[i]);\r\n            }\r\n            this.removeStyles(elements);\r\n            this.isSeriesMode = true;\r\n            this.addOrRemoveIndex(this.selectedDataIndexes, new Index(series, NaN));\r\n            for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\r\n                var value = _a[_i];\r\n                seriesStyle = this.generateStyle(value);\r\n                if (document.querySelectorAll('.' + seriesStyle).length > 0) {\r\n                    for (var _b = 0, elements_3 = elements; _b < elements_3.length; _b++) {\r\n                        var element = elements_3[_b];\r\n                        this.checkSelectionElements(element, seriesStyle, true, true, series);\r\n                    }\r\n                    isBlurEffectNeeded = false;\r\n                    break;\r\n                }\r\n            }\r\n            if (isBlurEffectNeeded) {\r\n                this.isSeriesMode = chart.selectionMode === 'Series';\r\n                this.blurEffect(chart.element.id, chart.visibleSeries);\r\n            }\r\n        }\r\n    };\r\n    /** @private */\r\n    Selection.prototype.getSeriesElements = function (series) {\r\n        var seriesElements = [series.seriesElement];\r\n        if (series.marker.visible && series.type !== 'Scatter' && series.type !== 'Bubble' && !series.isRectSeries) {\r\n            seriesElements.push(series.symbolElement);\r\n        }\r\n        else if (series.marker.visible && series.isRectSeries) {\r\n            seriesElements.push(series.symbolElement);\r\n        }\r\n        return seriesElements;\r\n    };\r\n    /** @private */\r\n    Selection.prototype.indexFinder = function (id) {\r\n        var ids = ['NaN', 'NaN'];\r\n        if (id.indexOf('SeriesGroup') > -1) {\r\n            ids = id.split('SeriesGroup');\r\n            ids[0] = ids[1];\r\n        }\r\n        else if (id.indexOf('SymbolGroup') > -1) {\r\n            ids = id.split('SymbolGroup');\r\n            ids[0] = ids[1];\r\n        }\r\n        else if (id.indexOf('_Point_') > -1) {\r\n            ids = id.split('_Series_')[1].split('_Point_');\r\n        }\r\n        else if (id.indexOf('_Series_') > -1) {\r\n            ids[0] = id.split('_Series_')[1];\r\n        }\r\n        else if (id.indexOf('_chart_legend_shape_') > -1) {\r\n            ids = id.split('_chart_legend_shape_');\r\n            ids[0] = ids[1];\r\n        }\r\n        return new Index(parseInt(ids[0], 10), parseInt(ids[1], 10));\r\n    };\r\n    /**\r\n     * Drag selection that returns the selected data.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.calculateDragSelectedElements = function (chart, dragRect, isClose) {\r\n        this.removeSelectedElements(chart, this.selectedDataIndexes, chart.series);\r\n        var isLasso = chart.selectionMode === 'Lasso';\r\n        var rect = new Rect(dragRect.x, dragRect.y, dragRect.width, dragRect.height);\r\n        var axisOffset = new ChartLocation(chart.chartAxisLayoutPanel.seriesClipRect.x, chart.chartAxisLayoutPanel.seriesClipRect.y);\r\n        this.removeOffset(rect, axisOffset);\r\n        var points;\r\n        var index;\r\n        var selectedPointValues = [];\r\n        var selectedSeriesValues = [];\r\n        this.isSeriesMode = false;\r\n        var isDragResize = (chart.allowMultiSelection) && (this.rectGrabbing || this.resizing);\r\n        this.rectPoints = this.dragRectArray[isDragResize ? this.targetIndex : this.count] =\r\n            new Rect(dragRect.x, dragRect.y, dragRect.width, dragRect.height);\r\n        if (dragRect.width && dragRect.height && !isClose) {\r\n            var rt = new Rect(dragRect.x, dragRect.y, dragRect.width, dragRect.height);\r\n            this.removeOffset(rt, axisOffset);\r\n            this.filterArray[isDragResize ? this.targetIndex : this.count] = rt;\r\n        }\r\n        var _loop_1 = function (series) {\r\n            if (series.visible) {\r\n                points = series.points;\r\n                selectedPointValues = [];\r\n                var xAxisOffset_1;\r\n                var yAxisOffset_1;\r\n                if ((chart.isTransposed || series.type.indexOf('Bar') !== -1) &&\r\n                    !(chart.isTransposed && series.type.indexOf('Bar') !== -1)) {\r\n                    xAxisOffset_1 = series.xAxis.rect.y - axisOffset.y;\r\n                    yAxisOffset_1 = series.yAxis.rect.x - axisOffset.x;\r\n                }\r\n                else {\r\n                    xAxisOffset_1 = series.xAxis.rect.x - axisOffset.x;\r\n                    yAxisOffset_1 = series.yAxis.rect.y - axisOffset.y;\r\n                }\r\n                for (var j = 0; j < points.length; j++) {\r\n                    var yValue = (series.type !== 'RangeArea' || 'SplineRangeArea') ? points[j].yValue :\r\n                        points[j].regions[0].y;\r\n                    var isCurrentPoint = void 0;\r\n                    var selectedPointX = points[j].xValue;\r\n                    if (chart.primaryXAxis.valueType === 'Category') {\r\n                        selectedPointX = points[j].x.toLocaleString();\r\n                    }\r\n                    else if (chart.primaryXAxis.valueType === 'DateTime') {\r\n                        selectedPointX = new Date(points[j].xValue);\r\n                    }\r\n                    if (series.type === 'BoxAndWhisker') {\r\n                        isCurrentPoint = points[j].regions.some(function (region) {\r\n                            return withInBounds(region.x + xAxisOffset_1, region.y + yAxisOffset_1, rect);\r\n                        });\r\n                    }\r\n                    else {\r\n                        if (chart.selectionMode === 'Lasso') {\r\n                            isCurrentPoint = points[j].isSelect;\r\n                        }\r\n                        else {\r\n                            isCurrentPoint = (chart.allowMultiSelection) ?\r\n                                this_1.isPointSelect(points[j], xAxisOffset_1, yAxisOffset_1, this_1.filterArray) :\r\n                                points[j].symbolLocations.some(function (location) {\r\n                                    return location && withInBounds(location.x + xAxisOffset_1, location.y + yAxisOffset_1, rect);\r\n                                });\r\n                        }\r\n                    }\r\n                    if (isCurrentPoint && series.category !== 'Indicator') {\r\n                        index = new Index(series.index, points[j].index);\r\n                        this_1.selection(chart, index, this_1.findElements(chart, series, index, '', !series.isRectSeries ? series.marker.visible : false));\r\n                        selectedPointValues.push({ x: selectedPointX, y: yValue });\r\n                    }\r\n                    if (isCurrentPoint && (series.type === 'RangeArea' || series.type === 'SplineRangeArea')) {\r\n                        selectedPointValues.push({ x: selectedPointX, y: points[j].regions[0].y });\r\n                    }\r\n                }\r\n                selectedSeriesValues.push(selectedPointValues);\r\n            }\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\r\n            var series = _a[_i];\r\n            _loop_1(series);\r\n        }\r\n        this.blurEffect(chart.element.id, chart.visibleSeries);\r\n        var x = isLasso ? chart.mouseDownX : (dragRect.x + dragRect.width);\r\n        var y = isLasso ? chart.mouseDownY : dragRect.y;\r\n        if (!isClose) {\r\n            this.createCloseButton(x, y);\r\n        }\r\n        var args = {\r\n            name: dragComplete,\r\n            selectedDataValues: selectedSeriesValues,\r\n            cancel: false\r\n        };\r\n        chart.trigger(dragComplete, args);\r\n    };\r\n    Selection.prototype.removeOffset = function (rect, clip) {\r\n        rect.x -= clip.x;\r\n        rect.y -= clip.y;\r\n    };\r\n    Selection.prototype.isPointSelect = function (points, xAxisOffset, yAxisOffset, rectCollection) {\r\n        var location = points.symbolLocations[0];\r\n        for (var _i = 0, rectCollection_1 = rectCollection; _i < rectCollection_1.length; _i++) {\r\n            var rect = rectCollection_1[_i];\r\n            if (rect && location && withInBounds(location.x + xAxisOffset, location.y + yAxisOffset, rect)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    /**\r\n     * Method to draw dragging rect.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.drawDraggingRect = function (chart, dragRect, target) {\r\n        var cartesianLayout = chart.chartAxisLayoutPanel.seriesClipRect;\r\n        var border = chart.chartArea.border.width;\r\n        var rectFill = chart.themeStyle.selectionRectFill;\r\n        var rectStroke = chart.themeStyle.selectionRectStroke;\r\n        var isLasso = chart.selectionMode === 'Lasso';\r\n        if (this.isdrawRect) {\r\n            cartesianLayout.x = cartesianLayout.x - border / 2;\r\n            cartesianLayout.y = cartesianLayout.y - border / 2;\r\n            cartesianLayout.width = cartesianLayout.width + border;\r\n            cartesianLayout.height = cartesianLayout.height + border;\r\n            this.isdrawRect = false;\r\n        }\r\n        switch (chart.selectionMode) {\r\n            case 'DragX':\r\n                dragRect.y = cartesianLayout.y;\r\n                dragRect.height = cartesianLayout.height;\r\n                break;\r\n            case 'DragY':\r\n                dragRect.x = cartesianLayout.x;\r\n                dragRect.width = cartesianLayout.width;\r\n                break;\r\n        }\r\n        if ((dragRect.width < 5 || dragRect.height < 5) && !isLasso) {\r\n            return null;\r\n        }\r\n        var isDragMode = chart.selectionMode.indexOf('Drag') > -1 || chart.selectionMode === 'Lasso';\r\n        if ((chart.allowMultiSelection) && isDragMode) {\r\n            var element = void 0;\r\n            var dragGroup = void 0;\r\n            var multiGroup = getElement(this.multiRectGroup);\r\n            if (!multiGroup) {\r\n                multiGroup = chart.svgRenderer.createGroup({ id: this.multiRectGroup });\r\n                chart.svgObject.appendChild(multiGroup);\r\n            }\r\n            if (this.rectGrabbing || this.resizing) {\r\n                var rectElement = void 0;\r\n                rectElement = getElement(this.draggedRect + this.targetIndex);\r\n                if (rectElement.nextSibling) {\r\n                    remove(rectElement.nextSibling);\r\n                }\r\n                this.setAttributes(rectElement, dragRect);\r\n            }\r\n            else if (!getElement(this.draggedRectGroup + this.count)) {\r\n                dragGroup = chart.svgRenderer.createGroup({ id: this.draggedRectGroup + this.count });\r\n                var svgElement = document.getElementById(chart.element.id + '_series_svg');\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n                chart.enableCanvas ? svgElement.appendChild(dragGroup) : multiGroup.appendChild(dragGroup);\r\n            }\r\n            if (!(chart.selectionMode === 'Lasso')) {\r\n                element = chart.svgRenderer.drawRectangle(new RectOption(this.draggedRect + this.count, rectFill, { color: rectStroke, width: 1 }, 1, dragRect));\r\n                element.style.cursor = \"move\";\r\n            }\r\n            else {\r\n                element = chart.svgRenderer.drawPath(new PathOption(this.lassoPath + this.count, rectFill, 3, rectStroke, 1, '', this.path));\r\n            }\r\n            if (!dragGroup && !this.rectGrabbing && !this.resizing) {\r\n                getElement(this.draggedRectGroup + this.count).appendChild(element);\r\n            }\r\n            else if (!this.rectGrabbing && !this.resizing) {\r\n                dragGroup.appendChild(element);\r\n            }\r\n        }\r\n        else {\r\n            var element = isLasso ?\r\n                getElement(this.lassoPath) : getElement(this.draggedRect);\r\n            if (this.closeIcon) {\r\n                removeElement(this.closeIconId);\r\n            }\r\n            if (element) {\r\n                if (isLasso) {\r\n                    element.setAttribute('d', this.path);\r\n                }\r\n                else {\r\n                    this.setAttributes(element, dragRect);\r\n                }\r\n            }\r\n            else {\r\n                var dragGroup = chart.svgRenderer.createGroup({ id: this.draggedRectGroup });\r\n                var svgElement = document.getElementById(chart.element.id + '_series_svg');\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n                chart.enableCanvas ? svgElement.appendChild(dragGroup) : chart.svgObject.appendChild(dragGroup);\r\n                if (!(chart.selectionMode === 'Lasso')) {\r\n                    element = chart.svgRenderer.drawRectangle(new RectOption(this.draggedRect, rectFill, { color: rectStroke, width: 1 }, 1, dragRect));\r\n                }\r\n                else {\r\n                    element = chart.svgRenderer.drawPath(new PathOption(this.lassoPath, rectFill, 3, rectStroke, 1, '', this.path));\r\n                }\r\n                dragGroup.appendChild(element);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * To get drag selected group element index from its id\r\n     *\r\n     * @param {string} id element id\r\n     */\r\n    Selection.prototype.getIndex = function (id) {\r\n        var i;\r\n        for (i = id.length - 1; i > 0; i--) {\r\n            var x = Number(id[i]);\r\n            if (!isNaN(x)) {\r\n                continue;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n        var index = +id.substr(i + 1, id.length - 1);\r\n        return index;\r\n    };\r\n    Selection.prototype.createCloseButton = function (x, y) {\r\n        var isMultiDrag = this.chart.allowMultiSelection;\r\n        var circleStroke = this.chart.themeStyle.selectionCircleStroke;\r\n        var isDrag = this.rectGrabbing || this.resizing;\r\n        var closeIcon = this.chart.svgRenderer.createGroup({\r\n            id: this.closeIconId + (isMultiDrag ? (isDrag ? this.targetIndex : this.count) : ''),\r\n            style: 'cursor:pointer; visibility: visible;'\r\n        });\r\n        closeIcon.appendChild(this.chart.svgRenderer.drawCircle(new CircleOption(this.closeIconId + '_circle' + (isMultiDrag ? (isDrag ? this.targetIndex : this.count) : ''), '#FFFFFF', { color: circleStroke, width: 1 }, 1, x, y, 10)));\r\n        var direction = 'M ' + (x - 4) + ' ' + (y - 4) + ' L ' + (x + 4) + ' ' + (y + 4) + ' M ' + (x - 4) + ' ' + (y + 4) +\r\n            ' L ' + (x + 4) + ' ' + (y - 4);\r\n        closeIcon.appendChild(this.chart.svgRenderer.drawPath({\r\n            id: this.closeIconId + '_cross' +\r\n                (isMultiDrag ? (isDrag ? this.targetIndex : this.count) : ''), d: direction,\r\n            stroke: circleStroke, 'stroke-width': 2, fill: circleStroke\r\n        }));\r\n        this.closeIcon = closeIcon;\r\n        var pathElement = getElement(this.draggedRectGroup + (isMultiDrag ? (isDrag ? this.targetIndex : this.count) : ''));\r\n        if (pathElement) {\r\n            pathElement.appendChild(closeIcon);\r\n        }\r\n    };\r\n    /**\r\n     * Method to remove dragged element.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.removeDraggedElements = function (chart, event) {\r\n        if ((event.target.id.indexOf(this.closeIconId) > -1) && (event.type.indexOf('move') === -1)) {\r\n            var isSelectedvalues = true;\r\n            if ((chart.allowMultiSelection)) {\r\n                var index = this.getIndex(event.target.id);\r\n                var multiRectGroupElement = getElement(this.multiRectGroup);\r\n                remove(getElement(this.draggedRectGroup + index));\r\n                this.dragRectArray[index] = null;\r\n                this.filterArray[index] = null;\r\n                this.totalSelectedPoints[index] = null;\r\n                if (multiRectGroupElement && multiRectGroupElement.childElementCount === 0) {\r\n                    removeElement(multiRectGroupElement);\r\n                    this.dragRectArray = [];\r\n                    this.filterArray = [];\r\n                    this.totalSelectedPoints = [];\r\n                }\r\n                if (this.currentMode === 'Lasso') {\r\n                    if (this.multiDataIndexes[index] != null) {\r\n                        for (var i = 0; i < this.multiDataIndexes[index].length; i++) {\r\n                            this.multiDataIndexes[index][i].isSelect = false;\r\n                        }\r\n                    }\r\n                    this.multiDataIndexes[index] = null;\r\n                    for (var j = 0; j < this.multiDataIndexes.length; j++) {\r\n                        if (this.multiDataIndexes[j] != null) {\r\n                            isSelectedvalues = false;\r\n                            for (var k = 0; k < this.multiDataIndexes[j].length; k++) {\r\n                                this.multiDataIndexes[j][k].isSelect = true;\r\n                            }\r\n                        }\r\n                    }\r\n                    this.calculateDragSelectedElements(chart, this.dragRect, true);\r\n                }\r\n                else if (this.filterArray.length) {\r\n                    for (var i = 0; i < this.filterArray.length; i++) {\r\n                        if (this.filterArray[i]) {\r\n                            isSelectedvalues = false;\r\n                            this.calculateDragSelectedElements(chart, this.filterArray[i], true);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this.calculateDragSelectedElements(chart, new Rect(0, 0, 0, 0), true);\r\n                }\r\n            }\r\n            else {\r\n                remove(getElement(this.draggedRectGroup));\r\n                this.removeSelectedElements(chart, this.selectedDataIndexes, chart.series);\r\n            }\r\n            this.blurEffect(chart.element.id, chart.visibleSeries);\r\n            this.changeCursorStyle(false, chart.svgObject, 'auto');\r\n            if (!(chart.allowMultiSelection) || isSelectedvalues) {\r\n                this.rectPoints = null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Method to resize the drag rect.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.resizingSelectionRect = function (chart, location, tapped, target) {\r\n        var rect;\r\n        if (((chart.allowMultiSelection) && (target.id.indexOf('_ej2_drag_rect') > -1)) ||\r\n            this.dragRectArray[this.targetIndex]) {\r\n            if (target.id.indexOf('_ej2_drag_rect') > -1) {\r\n                this.targetIndex = this.getIndex(target.id);\r\n            }\r\n            var r = this.dragRectArray[this.targetIndex];\r\n            rect = new Rect(r.x, r.y, r.width, r.height);\r\n        }\r\n        if (!(chart.allowMultiSelection)) {\r\n            rect = new Rect(this.rectPoints.x, this.rectPoints.y, this.rectPoints.width, this.rectPoints.height);\r\n        }\r\n        if (rect) {\r\n            var resize = this.findResizeMode(chart.svgObject, rect, location);\r\n            if (this.resizing) {\r\n                rect = getDraggedRectLocation(rect.x, rect.y, (rect.x + rect.width), (rect.y + rect.height), chart.chartAxisLayoutPanel.seriesClipRect);\r\n                this.drawDraggingRect(chart, rect);\r\n                this.dragRect = rect;\r\n            }\r\n            if (tapped) {\r\n                this.resizing = resize;\r\n            }\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n    };\r\n    Selection.prototype.findResizeMode = function (chartSvgObject, rect, location) {\r\n        var cursorStyle = 'se-resize';\r\n        var resize = false;\r\n        if (!this.resizing) {\r\n            var resizeEdges = [new Rect(rect.x, (rect.y), rect.width - 5, 5),\r\n                new Rect((rect.x), rect.y, 5, rect.height),\r\n                new Rect(rect.x, (rect.y + rect.height - 5), rect.width - 5, 5),\r\n                new Rect((rect.x + rect.width - 5), rect.y + 5, 5, rect.height - 15),\r\n                new Rect((rect.x + rect.width - 10), (rect.y + rect.height - 10), 10, 10)]; //corner\r\n            for (var i = 0; i < resizeEdges.length; i++) {\r\n                if (withInBounds(location.x, location.y, resizeEdges[i])) {\r\n                    cursorStyle = (i === 4) ? cursorStyle : (i % 2 === 0) ? 'ns-resize' : 'ew-resize';\r\n                    resize = true;\r\n                    this.resizeMode = i;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            var x = rect.x;\r\n            var y = rect.y;\r\n            var width = (location.x - x);\r\n            var height = (location.y - y);\r\n            switch (this.resizeMode) {\r\n                case 0:\r\n                    height = Math.abs((rect.height + rect.y) - location.y);\r\n                    rect.y = Math.min((rect.height + rect.y), location.y);\r\n                    rect.height = height;\r\n                    break;\r\n                case 1:\r\n                    width = Math.abs((rect.width + rect.x) - location.x);\r\n                    rect.x = Math.min((rect.width + rect.x), location.x);\r\n                    rect.width = width;\r\n                    break;\r\n                case 2:\r\n                    rect.height = Math.abs(height);\r\n                    rect.y = Math.min(location.y, y);\r\n                    break;\r\n                case 3:\r\n                    rect.width = Math.abs(width);\r\n                    rect.x = Math.min(location.x, x);\r\n                    break;\r\n                case 4:\r\n                    rect.width = Math.abs(width);\r\n                    rect.height = Math.abs(height);\r\n                    rect.x = Math.min(location.x, x);\r\n                    rect.y = Math.min(location.y, y);\r\n                    break;\r\n            }\r\n        }\r\n        if (this.currentMode !== 'Lasso') {\r\n            this.changeCursorStyle(resize, getElement((this.chart.allowMultiSelection) ? this.draggedRect +\r\n                this.targetIndex : this.draggedRect), cursorStyle);\r\n        }\r\n        this.changeCursorStyle(resize, chartSvgObject, cursorStyle);\r\n        return resize;\r\n    };\r\n    Selection.prototype.changeCursorStyle = function (isResize, rectelement, cursorStyle) {\r\n        cursorStyle = isResize ? cursorStyle : (this.control.svgObject === rectelement) ? 'auto' : 'move';\r\n        if (rectelement) {\r\n            rectelement.style.cursor = cursorStyle;\r\n        }\r\n    };\r\n    Selection.prototype.removeSelectedElements = function (chart, index, seriesCollection) {\r\n        index = chart.isRedrawSelection ? index : index.splice(0, index.length); // No need to remove selected indexes while redrawing\r\n        var seriesElements;\r\n        for (var _i = 0, seriesCollection_1 = seriesCollection; _i < seriesCollection_1.length; _i++) {\r\n            var series = seriesCollection_1[_i];\r\n            seriesElements = this.getSeriesElements(series);\r\n            this.removeStyles(seriesElements);\r\n            for (var _a = 0, seriesElements_2 = seriesElements; _a < seriesElements_2.length; _a++) {\r\n                var seriesElement = seriesElements_2[_a];\r\n                this.removeStyles(this.getChildren(seriesElement));\r\n            }\r\n        }\r\n    };\r\n    Selection.prototype.setAttributes = function (ele, object) {\r\n        var keys = Object.keys(object);\r\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\r\n            var key = keys_1[_i];\r\n            ele.setAttribute(key, object[key]);\r\n        }\r\n    };\r\n    /**\r\n     * Method to move the dragged rect.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.draggedRectMoved = function (chart, grabbedPoint, doDrawing, target) {\r\n        var rect;\r\n        if ((this.resizing || this.rectGrabbing) && (chart.allowMultiSelection)) {\r\n            var r = this.dragRectArray[this.targetIndex];\r\n            rect = new Rect(r.x, r.y, r.width, r.height);\r\n        }\r\n        else {\r\n            rect = new Rect(this.rectPoints.x, this.rectPoints.y, this.rectPoints.width, this.rectPoints.height);\r\n        }\r\n        rect.x -= (grabbedPoint.x - chart.mouseX);\r\n        rect.y -= (grabbedPoint.y - chart.mouseY);\r\n        rect = getDraggedRectLocation(rect.x, rect.y, rect.x + rect.width, rect.height + rect.y, chart.chartAxisLayoutPanel.seriesClipRect);\r\n        if (doDrawing) {\r\n            this.drawDraggingRect(chart, rect, target);\r\n        }\r\n        else {\r\n            this.calculateDragSelectedElements(chart, rect);\r\n        }\r\n    };\r\n    /**\r\n     * To complete the selection.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.completeSelection = function (e) {\r\n        var chart = this.chart;\r\n        if (chart.selectionMode === 'None') {\r\n            return;\r\n        }\r\n        this.currentMode = chart.selectionMode;\r\n        if ((this.dragging || this.resizing) && this.dragRect.width > 5 && this.dragRect.height > 5) {\r\n            this.calculateDragSelectedElements(chart, this.dragRect);\r\n        }\r\n        else if (!(chart.allowMultiSelection) && this.rectGrabbing &&\r\n            this.rectPoints.width && this.rectPoints.height) {\r\n            this.draggedRectMoved(chart, this.dragRect);\r\n        }\r\n        else if (this.rectGrabbing && this.dragRectArray[this.targetIndex].width && this.dragRectArray[this.targetIndex].height) {\r\n            this.draggedRectMoved(chart, this.dragRect);\r\n        }\r\n        if (chart.selectionMode === 'Lasso' && this.dragging && this.path) {\r\n            if (this.path.indexOf('L') !== -1) {\r\n                if (!(chart.allowMultiSelection)) {\r\n                    getElement(this.lassoPath).setAttribute('d', this.path + 'Z');\r\n                    this.pointChecking(getElement(this.lassoPath));\r\n                }\r\n                else if (getElement(this.lassoPath + this.count)) {\r\n                    getElement(this.lassoPath + this.count).setAttribute('d', this.path + 'Z');\r\n                    this.pointChecking(getElement(this.lassoPath + this.count));\r\n                }\r\n                if (this.dragging || this.resizing) {\r\n                    this.calculateDragSelectedElements(chart, this.dragRect);\r\n                }\r\n            }\r\n        }\r\n        this.dragging = false;\r\n        this.rectGrabbing = false;\r\n        this.resizing = false;\r\n        this.removeDraggedElements(chart, e);\r\n    };\r\n    Selection.prototype.getDragRect = function (chart, seriesClipRect) {\r\n        return getDraggedRectLocation(chart.mouseDownX, chart.mouseDownY, chart.mouseX, chart.mouseY, seriesClipRect);\r\n    };\r\n    /** @private */\r\n    Selection.prototype.dragStart = function (chart, seriesClipRect, mouseDownX, mouseDownY, event) {\r\n        var mode = chart.selectionMode;\r\n        this.currentMode = chart.selectionMode;\r\n        this.dragging = (mode.indexOf('Drag') > -1 || mode === 'Lasso') && (chart.isDoubleTap || !chart.isTouch) &&\r\n            chart.chartAreaType !== 'PolarRadar';\r\n        var target = event.target;\r\n        this.path = undefined;\r\n        if (this.dragging) {\r\n            this.count = getElement(this.multiRectGroup) ? (this.count + 1) : 0;\r\n            this.dragRect = new Rect(chart.mouseDownX, chart.mouseDownY, 0, 0);\r\n            if (chart.mouseDownX < seriesClipRect.x || chart.mouseDownX > (seriesClipRect.x + seriesClipRect.width) ||\r\n                chart.mouseDownY < seriesClipRect.y || chart.mouseDownY > (seriesClipRect.y + seriesClipRect.height)) {\r\n                this.dragging = false;\r\n            }\r\n        }\r\n        if (mode === 'Lasso') {\r\n            for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\r\n                var series = _a[_i];\r\n                if (series.visible) {\r\n                    for (var _b = 0, _c = series.points; _b < _c.length; _b++) {\r\n                        var point = _c[_b];\r\n                        if (!(chart.allowMultiSelection)) {\r\n                            point.isSelect = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (!(mode === 'Lasso')) {\r\n            if (this.rectPoints && !(chart.allowMultiSelection)) {\r\n                this.dragRect = new Rect(chart.mouseDownX, chart.mouseDownY, 0, 0);\r\n                this.resizingSelectionRect(chart, new ChartLocation(mouseDownX, mouseDownY), true);\r\n                this.rectGrabbing = withInBounds(mouseDownX, mouseDownY, this.rectPoints);\r\n            }\r\n            if ((chart.allowMultiSelection)) {\r\n                var index = this.getIndex(target.id);\r\n                this.targetIndex = this.isDragRect(target.id) ? index : undefined;\r\n                if (this.dragRectArray.length && this.isDragRect(target.id)) {\r\n                    this.resizingSelectionRect(chart, new ChartLocation(mouseDownX, mouseDownY), true, target);\r\n                    this.rectGrabbing = withInBounds(mouseDownX, mouseDownY, this.dragRectArray[index]);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Selection.prototype.isDragRect = function (id) {\r\n        return id.indexOf('_ej2_drag_rect') > -1;\r\n    };\r\n    /** @private */\r\n    Selection.prototype.mouseMove = function (event) {\r\n        var chart = this.chart;\r\n        var target = event.target;\r\n        if (chart.highlightMode !== 'None') {\r\n            if (!isNullOrUndefined(target)) {\r\n                if (event.target.id.indexOf('text') > 1) {\r\n                    target = getElement(event.target.id.replace('text', 'shape'));\r\n                }\r\n                if ((target).hasAttribute('class') && ((target).getAttribute('class').indexOf('highlight') > -1 ||\r\n                    target.getAttribute('class').indexOf('selection') > -1)) {\r\n                    return;\r\n                }\r\n                this.calculateSelectedElements(event);\r\n                return;\r\n            }\r\n        }\r\n        if (chart.selectionMode === 'None') {\r\n            return;\r\n        }\r\n        if (event.type === 'touchmove' && (Browser.isIos || Browser.isIos7) && this.dragging && event.preventDefault) {\r\n            event.preventDefault();\r\n        }\r\n        var insideMoving = withInBounds(chart.mouseX, chart.mouseY, chart.chartAxisLayoutPanel.seriesClipRect);\r\n        if (insideMoving) {\r\n            if (this.rectGrabbing && !this.resizing) {\r\n                this.draggedRectMoved(chart, this.dragRect, true, target);\r\n            }\r\n            else if (this.dragging && !this.resizing) {\r\n                if (chart.selectionMode === 'Lasso') {\r\n                    this.getPath(chart.mouseDownX, chart.mouseDownY, chart.mouseX, chart.mouseY);\r\n                    this.drawDraggingRect(chart, this.dragRect, target);\r\n                }\r\n                else {\r\n                    this.dragRect = this.getDragRect(chart, chart.chartAxisLayoutPanel.seriesClipRect);\r\n                    this.drawDraggingRect(chart, this.dragRect, target);\r\n                }\r\n            }\r\n            if (this.rectPoints && !(chart.allowMultiSelection)) {\r\n                this.resizingSelectionRect(chart, new ChartLocation(chart.mouseX, chart.mouseY), null, target);\r\n            }\r\n            else if (((chart.allowMultiSelection) && !this.dragging) || this.resizing) {\r\n                this.resizingSelectionRect(chart, new ChartLocation(chart.mouseX, chart.mouseY), null, target);\r\n            }\r\n        }\r\n        else {\r\n            this.completeSelection(event);\r\n        }\r\n    };\r\n    Selection.prototype.getPath = function (startX, startY, endX, endY) {\r\n        if (this.dragging) {\r\n            if (this.path) {\r\n                this.path = this.path + ' L' + endX + ' ' + endY;\r\n            }\r\n            else {\r\n                this.path = 'M ' + startX + ' ' + startY;\r\n            }\r\n        }\r\n    };\r\n    Selection.prototype.pointChecking = function (path) {\r\n        var _this = this;\r\n        var chart = this.chart;\r\n        var element;\r\n        var svgRect = getElement(chart.svgId).getBoundingClientRect();\r\n        var offsetX = chart.chartAxisLayoutPanel.seriesClipRect.x + Math.max(svgRect.left, 0);\r\n        var offsetY = chart.chartAxisLayoutPanel.seriesClipRect.y + Math.max(svgRect.top, 0);\r\n        this.multiDataIndexes[this.count] = [];\r\n        for (var _i = 0, _a = chart.visibleSeries; _i < _a.length; _i++) {\r\n            var series = _a[_i];\r\n            series.points.filter(function (point) {\r\n                // To check whether the point have symbol location value or not.\r\n                if (point.symbolLocations && point.symbolLocations.length) {\r\n                    element = document.elementFromPoint(point.symbolLocations[0].x + offsetX, point.symbolLocations[0].y + offsetY);\r\n                }\r\n                if (element === path) {\r\n                    point.isSelect = true;\r\n                    if ((_this.chart.allowMultiSelection) && _this.currentMode === 'Lasso') {\r\n                        _this.multiDataIndexes[_this.count][_this.seriesIndex] = point;\r\n                        _this.seriesIndex++;\r\n                    }\r\n                }\r\n                else if (!(chart.allowMultiSelection)) {\r\n                    point.isSelect = false;\r\n                }\r\n            });\r\n        }\r\n        this.seriesIndex = 0;\r\n    };\r\n    /**\r\n     * Get module name.\r\n     *\r\n     * @private\r\n     */\r\n    Selection.prototype.getModuleName = function () {\r\n        return 'Selection';\r\n    };\r\n    /**\r\n     * To destroy the selection.\r\n     *\r\n     * @returns {void}\r\n     * @private\r\n     */\r\n    Selection.prototype.destroy = function () {\r\n        this.removeEventListener();\r\n        // Destroy method performed here\r\n    };\r\n    return Selection;\r\n}(BaseSelection));\r\nexport { Selection };\r\n"]},"metadata":{},"sourceType":"module"}