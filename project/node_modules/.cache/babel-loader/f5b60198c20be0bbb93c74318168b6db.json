{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { merge, extend, isNullOrUndefined, setValue, getValue } from '@syncfusion/ej2-base';\nimport { DataUtil } from './util';\nimport { Query, Predicate } from './query';\nvar consts = {\n  GroupGuid: '{271bbba0-1ee7}'\n};\n/**\r\n * Adaptors are specific data source type aware interfaces that are used by DataManager to communicate with DataSource.\r\n * This is the base adaptor class that other adaptors can extend.\r\n * @hidden\r\n */\n\nvar Adaptor =\n/** @class */\nfunction () {\n  /**\r\n   * Constructor for Adaptor class\r\n   * @param  {DataOptions} ds?\r\n   * @hidden\r\n   * @returns aggregates\r\n   */\n  function Adaptor(ds) {\n    // common options for all the adaptors \n    this.options = {\n      from: 'table',\n      requestType: 'json',\n      sortBy: 'sorted',\n      select: 'select',\n      skip: 'skip',\n      group: 'group',\n      take: 'take',\n      search: 'search',\n      count: 'requiresCounts',\n      where: 'where',\n      aggregates: 'aggregates',\n      expand: 'expand'\n    };\n    /**\r\n     * Specifies the type of adaptor.\r\n     * @default Adaptor\r\n     */\n\n    this.type = Adaptor;\n    this.dataSource = ds;\n    this.pvt = {};\n  }\n  /**\r\n   * Returns the data from the query processing.\r\n   * @param  {Object} data\r\n   * @param  {DataOptions} ds?\r\n   * @param  {Query} query?\r\n   * @param  {XMLHttpRequest} xhr?\r\n   * @returns Object\r\n   */\n\n\n  Adaptor.prototype.processResponse = function (data, ds, query, xhr) {\n    return data;\n  };\n\n  return Adaptor;\n}();\n\nexport { Adaptor };\n/**\r\n * JsonAdaptor is used to process JSON data. It contains methods to process the given JSON data based on the queries.\r\n * @hidden\r\n */\n\nvar JsonAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(JsonAdaptor, _super);\n\n  function JsonAdaptor() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  /**\r\n   * Process the JSON data based on the provided queries.\r\n   * @param  {DataManager} dataManager\r\n   * @param  {Query} query\r\n   * @returns Object\r\n   */\n\n\n  JsonAdaptor.prototype.processQuery = function (dataManager, query) {\n    var result = dataManager.dataSource.json.slice(0);\n    var count = result.length;\n    var countFlg = true;\n    var ret;\n    var key;\n    var lazyLoad = {};\n    var keyCount = 0;\n    var group = [];\n    var page;\n\n    for (var i = 0; i < query.lazyLoad.length; i++) {\n      keyCount++;\n      lazyLoad[query.lazyLoad[i].key] = query.lazyLoad[i].value;\n    }\n\n    var agg = {};\n\n    for (var i = 0; i < query.queries.length; i++) {\n      key = query.queries[i];\n\n      if ((key.fn === 'onPage' || key.fn === 'onGroup') && query.lazyLoad.length) {\n        if (key.fn === 'onGroup') {\n          group.push(key.e);\n        }\n\n        if (key.fn === 'onPage') {\n          page = key.e;\n        }\n\n        continue;\n      }\n\n      ret = this[key.fn].call(this, result, key.e, query);\n\n      if (key.fn === 'onAggregates') {\n        agg[key.e.field + ' - ' + key.e.type] = ret;\n      } else {\n        result = ret !== undefined ? ret : result;\n      }\n\n      if (key.fn === 'onPage' || key.fn === 'onSkip' || key.fn === 'onTake' || key.fn === 'onRange') {\n        countFlg = false;\n      }\n\n      if (countFlg) {\n        count = result.length;\n      }\n    }\n\n    if (keyCount) {\n      var args = {\n        query: query,\n        lazyLoad: lazyLoad,\n        result: result,\n        group: group,\n        page: page\n      };\n      var lazyLoadData = this.lazyLoadGroup(args);\n      result = lazyLoadData.result;\n      count = lazyLoadData.count;\n    }\n\n    if (query.isCountRequired) {\n      result = {\n        result: result,\n        count: count,\n        aggregates: agg\n      };\n    }\n\n    return result;\n  };\n  /**\r\n   * Perform lazy load grouping in JSON array based on the given query and lazy load details.\r\n   * @param  {LazyLoadGroupArgs} args\r\n   */\n\n\n  JsonAdaptor.prototype.lazyLoadGroup = function (args) {\n    var count = 0;\n    var agg = this.getAggregate(args.query);\n    var result = args.result;\n\n    if (!isNullOrUndefined(args.lazyLoad.onDemandGroupInfo)) {\n      var req = args.lazyLoad.onDemandGroupInfo;\n\n      for (var i = req.where.length - 1; i >= 0; i--) {\n        result = this.onWhere(result, req.where[i]);\n      }\n\n      if (args.group.length !== req.level) {\n        var field = args.group[req.level].fieldName;\n        result = DataUtil.group(result, field, agg, null, null, args.group[0].comparer, true);\n      }\n\n      count = result.length;\n      var data = result;\n      result = result.slice(req.skip);\n      result = result.slice(0, req.take);\n\n      if (args.group.length !== req.level) {\n        this.formGroupResult(result, data);\n      }\n    } else {\n      var field = args.group[0].fieldName;\n      result = DataUtil.group(result, field, agg, null, null, args.group[0].comparer, true);\n      count = result.length;\n      var data = result;\n\n      if (args.page) {\n        result = this.onPage(result, args.page, args.query);\n      }\n\n      this.formGroupResult(result, data);\n    }\n\n    return {\n      result: result,\n      count: count\n    };\n  };\n\n  JsonAdaptor.prototype.formGroupResult = function (result, data) {\n    if (result.length && data.length) {\n      var uid = 'GroupGuid';\n      var childLevel = 'childLevels';\n      var level = 'level';\n      var records = 'records';\n      result[uid] = data[uid];\n      result[childLevel] = data[childLevel];\n      result[level] = data[level];\n      result[records] = data[records];\n    }\n\n    return result;\n  };\n  /**\r\n   * Separate the aggregate query from the given queries\r\n   * @param  {Query} query\r\n   */\n\n\n  JsonAdaptor.prototype.getAggregate = function (query) {\n    var aggQuery = Query.filterQueries(query.queries, 'onAggregates');\n    var agg = [];\n\n    if (aggQuery.length) {\n      var tmp = void 0;\n\n      for (var i = 0; i < aggQuery.length; i++) {\n        tmp = aggQuery[i].e;\n        agg.push({\n          type: tmp.type,\n          field: DataUtil.getValue(tmp.field, query)\n        });\n      }\n    }\n\n    return agg;\n  };\n  /**\r\n   * Performs batch update in the JSON array which add, remove and update records.\r\n   * @param  {DataManager} dm\r\n   * @param  {CrudOptions} changes\r\n   * @param  {RemoteArgs} e\r\n   */\n\n\n  JsonAdaptor.prototype.batchRequest = function (dm, changes, e) {\n    var i;\n    var deletedRecordsLen = changes.deletedRecords.length;\n\n    for (i = 0; i < changes.addedRecords.length; i++) {\n      this.insert(dm, changes.addedRecords[i]);\n    }\n\n    for (i = 0; i < changes.changedRecords.length; i++) {\n      this.update(dm, e.key, changes.changedRecords[i]);\n    }\n\n    for (i = 0; i < deletedRecordsLen; i++) {\n      this.remove(dm, e.key, changes.deletedRecords[i]);\n    }\n\n    return changes;\n  };\n  /**\r\n   * Performs filter operation with the given data and where query.\r\n   * @param  {Object[]} ds\r\n   * @param  {{validate:Function}} e\r\n   */\n\n\n  JsonAdaptor.prototype.onWhere = function (ds, e) {\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    return ds.filter(function (obj) {\n      if (e) {\n        return e.validate(obj);\n      }\n    });\n  };\n  /**\r\n   * Returns aggregate function based on the aggregate type.\r\n   * @param  {Object[]} ds\r\n   * @param  {{field:string} e\r\n   * @param  {string}} type\r\n   */\n\n\n  JsonAdaptor.prototype.onAggregates = function (ds, e) {\n    var fn = DataUtil.aggregates[e.type];\n\n    if (!ds || !fn || ds.length === 0) {\n      return null;\n    }\n\n    return fn(ds, e.field);\n  };\n  /**\r\n   * Performs search operation based on the given query.\r\n   * @param  {Object[]} ds\r\n   * @param  {QueryOptions} e\r\n   */\n\n\n  JsonAdaptor.prototype.onSearch = function (ds, e) {\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    if (e.fieldNames.length === 0) {\n      DataUtil.getFieldList(ds[0], e.fieldNames);\n    }\n\n    return ds.filter(function (obj) {\n      for (var j = 0; j < e.fieldNames.length; j++) {\n        if (e.comparer.call(obj, DataUtil.getObject(e.fieldNames[j], obj), e.searchKey, e.ignoreCase, e.ignoreAccent)) {\n          return true;\n        }\n      }\n\n      return false;\n    });\n  };\n  /**\r\n   * Sort the data with given direction and field.\r\n   * @param  {Object[]} ds\r\n   * @param  {{comparer:(a:Object} e\r\n   * @param  {Object} b\r\n   */\n\n\n  JsonAdaptor.prototype.onSortBy = function (ds, e, query) {\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    var fnCompare;\n    var field = DataUtil.getValue(e.fieldName, query);\n\n    if (!field) {\n      return ds.sort(e.comparer);\n    }\n\n    if (field instanceof Array) {\n      field = field.slice(0);\n\n      for (var i = field.length - 1; i >= 0; i--) {\n        if (!field[i]) {\n          continue;\n        }\n\n        fnCompare = e.comparer;\n\n        if (DataUtil.endsWith(field[i], ' desc')) {\n          fnCompare = DataUtil.fnSort('descending');\n          field[i] = field[i].replace(' desc', '');\n        }\n\n        ds = DataUtil.sort(ds, field[i], fnCompare);\n      }\n\n      return ds;\n    }\n\n    return DataUtil.sort(ds, field, e.comparer);\n  };\n  /**\r\n   * Group the data based on the given query.\r\n   * @param  {Object[]} ds\r\n   * @param  {QueryOptions} e\r\n   * @param  {Query} query\r\n   */\n\n\n  JsonAdaptor.prototype.onGroup = function (ds, e, query) {\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    var agg = this.getAggregate(query);\n    return DataUtil.group(ds, DataUtil.getValue(e.fieldName, query), agg, null, null, e.comparer);\n  };\n  /**\r\n   * Retrieves records based on the given page index and size.\r\n   * @param  {Object[]} ds\r\n   * @param  {{pageSize:number} e\r\n   * @param  {number}} pageIndex\r\n   * @param  {Query} query\r\n   */\n\n\n  JsonAdaptor.prototype.onPage = function (ds, e, query) {\n    var size = DataUtil.getValue(e.pageSize, query);\n    var start = (DataUtil.getValue(e.pageIndex, query) - 1) * size;\n    var end = start + size;\n\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    return ds.slice(start, end);\n  };\n  /**\r\n   * Retrieves records based on the given start and end index from query.\r\n   * @param  {Object[]} ds\r\n   * @param  {{start:number} e\r\n   * @param  {number}} end\r\n   */\n\n\n  JsonAdaptor.prototype.onRange = function (ds, e) {\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    return ds.slice(DataUtil.getValue(e.start), DataUtil.getValue(e.end));\n  };\n  /**\r\n   * Picks the given count of records from the top of the datasource.\r\n   * @param  {Object[]} ds\r\n   * @param  {{nos:number}} e\r\n   */\n\n\n  JsonAdaptor.prototype.onTake = function (ds, e) {\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    return ds.slice(0, DataUtil.getValue(e.nos));\n  };\n  /**\r\n   * Skips the given count of records from the data source.\r\n   * @param  {Object[]} ds\r\n   * @param  {{nos:number}} e\r\n   */\n\n\n  JsonAdaptor.prototype.onSkip = function (ds, e) {\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    return ds.slice(DataUtil.getValue(e.nos));\n  };\n  /**\r\n   * Selects specified columns from the data source.\r\n   * @param  {Object[]} ds\r\n   * @param  {{fieldNames:string}} e\r\n   */\n\n\n  JsonAdaptor.prototype.onSelect = function (ds, e) {\n    if (!ds || !ds.length) {\n      return ds;\n    }\n\n    return DataUtil.select(ds, DataUtil.getValue(e.fieldNames));\n  };\n  /**\r\n   * Inserts new record in the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {Object} data\r\n   * @param  {number} position\r\n   */\n\n\n  JsonAdaptor.prototype.insert = function (dm, data, tableName, query, position) {\n    if (isNullOrUndefined(position)) {\n      return dm.dataSource.json.push(data);\n    } else {\n      return dm.dataSource.json.splice(position, 0, data);\n    }\n  };\n  /**\r\n   * Remove the data from the dataSource based on the key field value.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {Object} value\r\n   * @param  {string} tableName?\r\n   * @returns null\r\n   */\n\n\n  JsonAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n    var ds = dm.dataSource.json;\n    var i;\n\n    if (typeof value === 'object' && !(value instanceof Date)) {\n      value = DataUtil.getObject(keyField, value);\n    }\n\n    for (i = 0; i < ds.length; i++) {\n      if (DataUtil.getObject(keyField, ds[i]) === value) {\n        break;\n      }\n    }\n\n    return i !== ds.length ? ds.splice(i, 1) : null;\n  };\n  /**\r\n   * Updates existing record and saves the changes to the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {Object} value\r\n   * @param  {string} tableName?\r\n   * @returns null\r\n   */\n\n\n  JsonAdaptor.prototype.update = function (dm, keyField, value, tableName) {\n    var ds = dm.dataSource.json;\n    var i;\n    var key;\n\n    if (!isNullOrUndefined(keyField)) {\n      key = getValue(keyField, value);\n    }\n\n    for (i = 0; i < ds.length; i++) {\n      if (!isNullOrUndefined(keyField) && getValue(keyField, ds[i]) === key) {\n        break;\n      }\n    }\n\n    return i < ds.length ? merge(ds[i], value) : null;\n  };\n\n  return JsonAdaptor;\n}(Adaptor);\n\nexport { JsonAdaptor };\n/**\r\n * URL Adaptor of DataManager can be used when you are required to use remote service to retrieve data.\r\n * It interacts with server-side for all DataManager Queries and CRUD operations.\r\n * @hidden\r\n */\n\nvar UrlAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(UrlAdaptor, _super);\n\n  function UrlAdaptor() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  /**\r\n   * Process the query to generate request body.\r\n   * @param  {DataManager} dm\r\n   * @param  {Query} query\r\n   * @param  {Object[]} hierarchyFilters?\r\n   * @returns p\r\n   */\n  // tslint:disable-next-line:max-func-body-length\n\n\n  UrlAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\n    var queries = this.getQueryRequest(query);\n    var singles = Query.filterQueryLists(query.queries, ['onSelect', 'onPage', 'onSkip', 'onTake', 'onRange']);\n    var params = query.params;\n    var url = dm.dataSource.url;\n    var temp;\n    var skip;\n    var take = null;\n    var options = this.options;\n    var request = {\n      sorts: [],\n      groups: [],\n      filters: [],\n      searches: [],\n      aggregates: []\n    }; // calc Paging & Range\n\n    if ('onPage' in singles) {\n      temp = singles.onPage;\n      skip = DataUtil.getValue(temp.pageIndex, query);\n      take = DataUtil.getValue(temp.pageSize, query);\n      skip = (skip - 1) * take;\n    } else if ('onRange' in singles) {\n      temp = singles.onRange;\n      skip = temp.start;\n      take = temp.end - temp.start;\n    } // Sorting\n\n\n    for (var i = 0; i < queries.sorts.length; i++) {\n      temp = DataUtil.getValue(queries.sorts[i].e.fieldName, query);\n      request.sorts.push(DataUtil.callAdaptorFunction(this, 'onEachSort', {\n        name: temp,\n        direction: queries.sorts[i].e.direction\n      }, query));\n    } // hierarchy\n\n\n    if (hierarchyFilters) {\n      temp = this.getFiltersFrom(hierarchyFilters, query);\n\n      if (temp) {\n        request.filters.push(DataUtil.callAdaptorFunction(this, 'onEachWhere', temp.toJson(), query));\n      }\n    } // Filters\n\n\n    for (var i = 0; i < queries.filters.length; i++) {\n      var res = DataUtil.callAdaptorFunction(this, 'onEachWhere', queries.filters[i].e.toJson(), query);\n\n      if (this.getModuleName && this.getModuleName() === 'ODataV4Adaptor' && !isNullOrUndefined(queries.filters[i].e.key) && queries.filters.length > 1) {\n        res = \"(\" + res + \")\";\n      }\n\n      request.filters.push(res);\n      var keys_3 = typeof request.filters[i] === 'object' ? Object.keys(request.filters[i]) : [];\n\n      for (var _i = 0, keys_1 = keys_3; _i < keys_1.length; _i++) {\n        var prop = keys_1[_i];\n\n        if (DataUtil.isNull(request[prop])) {\n          delete request[prop];\n        }\n      }\n    } // Searches\n\n\n    for (var i = 0; i < queries.searches.length; i++) {\n      temp = queries.searches[i].e;\n      request.searches.push(DataUtil.callAdaptorFunction(this, 'onEachSearch', {\n        fields: temp.fieldNames,\n        operator: temp.operator,\n        key: temp.searchKey,\n        ignoreCase: temp.ignoreCase\n      }, query));\n    } // Grouping\n\n\n    for (var i = 0; i < queries.groups.length; i++) {\n      request.groups.push(DataUtil.getValue(queries.groups[i].e.fieldName, query));\n    } // aggregates\n\n\n    for (var i = 0; i < queries.aggregates.length; i++) {\n      temp = queries.aggregates[i].e;\n      request.aggregates.push({\n        type: temp.type,\n        field: DataUtil.getValue(temp.field, query)\n      });\n    }\n\n    var req = {};\n    this.getRequestQuery(options, query, singles, request, req); // Params\n\n    DataUtil.callAdaptorFunction(this, 'addParams', {\n      dm: dm,\n      query: query,\n      params: params,\n      reqParams: req\n    });\n\n    if (query.lazyLoad.length) {\n      for (var i = 0; i < query.lazyLoad.length; i++) {\n        req[query.lazyLoad[i].key] = query.lazyLoad[i].value;\n      }\n    } // cleanup\n\n\n    var keys = Object.keys(req);\n\n    for (var _a = 0, keys_2 = keys; _a < keys_2.length; _a++) {\n      var prop = keys_2[_a];\n\n      if (DataUtil.isNull(req[prop]) || req[prop] === '' || req[prop].length === 0) {\n        delete req[prop];\n      }\n    }\n\n    if (!(options.skip in req && options.take in req) && take !== null) {\n      req[options.skip] = DataUtil.callAdaptorFunction(this, 'onSkip', skip, query);\n      req[options.take] = DataUtil.callAdaptorFunction(this, 'onTake', take, query);\n    }\n\n    var p = this.pvt;\n    this.pvt = {};\n\n    if (this.options.requestType === 'json') {\n      return {\n        data: JSON.stringify(req, DataUtil.parse.jsonDateReplacer),\n        url: url,\n        pvtData: p,\n        type: 'POST',\n        contentType: 'application/json; charset=utf-8'\n      };\n    }\n\n    temp = this.convertToQueryString(req, query, dm);\n    temp = (dm.dataSource.url.indexOf('?') !== -1 ? '&' : '/') + temp;\n    return {\n      type: 'GET',\n      url: temp.length ? url.replace(/\\/*$/, temp) : url,\n      pvtData: p\n    };\n  };\n\n  UrlAdaptor.prototype.getRequestQuery = function (options, query, singles, request, request1) {\n    var param = 'param';\n    var req = request1;\n    req[options.from] = query.fromTable;\n\n    if (options.apply && query.distincts.length) {\n      req[options.apply] = 'onDistinct' in this ? DataUtil.callAdaptorFunction(this, 'onDistinct', query.distincts) : '';\n    }\n\n    if (!query.distincts.length && options.expand) {\n      req[options.expand] = 'onExpand' in this && 'onSelect' in singles ? DataUtil.callAdaptorFunction(this, 'onExpand', {\n        selects: DataUtil.getValue(singles.onSelect.fieldNames, query),\n        expands: query.expands\n      }, query) : query.expands;\n    }\n\n    req[options.select] = 'onSelect' in singles && !query.distincts.length ? DataUtil.callAdaptorFunction(this, 'onSelect', DataUtil.getValue(singles.onSelect.fieldNames, query), query) : '';\n    req[options.count] = query.isCountRequired ? DataUtil.callAdaptorFunction(this, 'onCount', query.isCountRequired, query) : '';\n    req[options.search] = request.searches.length ? DataUtil.callAdaptorFunction(this, 'onSearch', request.searches, query) : '';\n    req[options.skip] = 'onSkip' in singles ? DataUtil.callAdaptorFunction(this, 'onSkip', DataUtil.getValue(singles.onSkip.nos, query), query) : '';\n    req[options.take] = 'onTake' in singles ? DataUtil.callAdaptorFunction(this, 'onTake', DataUtil.getValue(singles.onTake.nos, query), query) : '';\n    req[options.where] = request.filters.length || request.searches.length ? DataUtil.callAdaptorFunction(this, 'onWhere', request.filters, query) : '';\n    req[options.sortBy] = request.sorts.length ? DataUtil.callAdaptorFunction(this, 'onSortBy', request.sorts, query) : '';\n    req[options.group] = request.groups.length ? DataUtil.callAdaptorFunction(this, 'onGroup', request.groups, query) : '';\n    req[options.aggregates] = request.aggregates.length ? DataUtil.callAdaptorFunction(this, 'onAggregates', request.aggregates, query) : '';\n    req[param] = [];\n  };\n  /**\r\n   * Convert the object from processQuery to string which can be added query string.\r\n   * @param  {Object} req\r\n   * @param  {Query} query\r\n   * @param  {DataManager} dm\r\n   */\n\n\n  UrlAdaptor.prototype.convertToQueryString = function (request, query, dm) {\n    return ''; // this needs to be overridden\n  };\n  /**\r\n   * Return the data from the data manager processing.\r\n   * @param  {DataResult} data\r\n   * @param  {DataOptions} ds?\r\n   * @param  {Query} query?\r\n   * @param  {XMLHttpRequest} xhr?\r\n   * @param  {Object} request?\r\n   * @param  {CrudOptions} changes?\r\n   */\n\n\n  UrlAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n    if (xhr && xhr.getResponseHeader('Content-Type') && xhr.getResponseHeader('Content-Type').indexOf('application/json') !== -1) {\n      var handleTimeZone = DataUtil.timeZoneHandling;\n\n      if (ds && !ds.timeZoneHandling) {\n        DataUtil.timeZoneHandling = false;\n      }\n\n      data = DataUtil.parse.parseJson(data);\n      DataUtil.timeZoneHandling = handleTimeZone;\n    }\n\n    var requests = request;\n    var pvt = requests.pvtData || {};\n    var groupDs = data ? data.groupDs : [];\n\n    if (xhr && xhr.getResponseHeader('Content-Type') && xhr.getResponseHeader('Content-Type').indexOf('xml') !== -1) {\n      return query.isCountRequired ? {\n        result: [],\n        count: 0\n      } : [];\n    }\n\n    var d = JSON.parse(requests.data);\n\n    if (d && d.action === 'batch' && data && data.addedRecords) {\n      changes.addedRecords = data.addedRecords;\n      return changes;\n    }\n\n    if (data && data.d) {\n      data = data.d;\n    }\n\n    var args = {};\n\n    if (data && 'count' in data) {\n      args.count = data.count;\n    }\n\n    args.result = data && data.result ? data.result : data;\n    var isExpand = false;\n\n    if (Array.isArray(data.result) && data.result.length) {\n      var key = 'key';\n      var val = 'value';\n      var level = 'level';\n\n      if (!isNullOrUndefined(data.result[0][key])) {\n        args.result = this.formRemoteGroupedData(args.result, 1, pvt.groups.length - 1);\n      }\n\n      if (query && query.lazyLoad.length && pvt.groups.length) {\n        for (var i = 0; i < query.lazyLoad.length; i++) {\n          if (query.lazyLoad[i][key] === 'onDemandGroupInfo') {\n            var value = query.lazyLoad[i][val][level];\n\n            if (pvt.groups.length === value) {\n              isExpand = true;\n            }\n          }\n        }\n      }\n    }\n\n    if (!isExpand) {\n      this.getAggregateResult(pvt, data, args, groupDs, query);\n    }\n\n    return DataUtil.isNull(args.count) ? args.result : {\n      result: args.result,\n      count: args.count,\n      aggregates: args.aggregates\n    };\n  };\n\n  UrlAdaptor.prototype.formRemoteGroupedData = function (data, level, childLevel) {\n    for (var i = 0; i < data.length; i++) {\n      if (data[i].items.length && Object.keys(data[i].items[0]).indexOf('key') > -1) {\n        this.formRemoteGroupedData(data[i].items, level + 1, childLevel - 1);\n      }\n    }\n\n    var uid = 'GroupGuid';\n    var childLvl = 'childLevels';\n    var lvl = 'level';\n    var records = 'records';\n    data[uid] = consts[uid];\n    data[lvl] = level;\n    data[childLvl] = childLevel;\n    data[records] = data[0].items.length ? this.getGroupedRecords(data, !isNullOrUndefined(data[0].items[records])) : [];\n    return data;\n  };\n\n  UrlAdaptor.prototype.getGroupedRecords = function (data, hasRecords) {\n    var childGroupedRecords = [];\n    var records = 'records';\n\n    for (var i = 0; i < data.length; i++) {\n      if (!hasRecords) {\n        for (var j = 0; j < data[i].items.length; j++) {\n          childGroupedRecords.push(data[i].items[j]);\n        }\n      } else {\n        childGroupedRecords = childGroupedRecords.concat(data[i].items[records]);\n      }\n    }\n\n    return childGroupedRecords;\n  };\n  /**\r\n   * Add the group query to the adaptor`s option.\r\n   * @param  {Object[]} e\r\n   * @returns void\r\n   */\n\n\n  UrlAdaptor.prototype.onGroup = function (e) {\n    this.pvt.groups = e;\n    return e;\n  };\n  /**\r\n   * Add the aggregate query to the adaptor`s option.\r\n   * @param  {Aggregates[]} e\r\n   * @returns void\r\n   */\n\n\n  UrlAdaptor.prototype.onAggregates = function (e) {\n    this.pvt.aggregates = e;\n  };\n  /**\r\n   * Prepare the request body based on the newly added, removed and updated records.\r\n   * The result is used by the batch request.\r\n   * @param  {DataManager} dm\r\n   * @param  {CrudOptions} changes\r\n   * @param  {Object} e\r\n   */\n\n\n  UrlAdaptor.prototype.batchRequest = function (dm, changes, e, query, original) {\n    var url;\n    var key;\n    return {\n      type: 'POST',\n      url: dm.dataSource.batchUrl || dm.dataSource.crudUrl || dm.dataSource.removeUrl || dm.dataSource.url,\n      contentType: 'application/json; charset=utf-8',\n      dataType: 'json',\n      data: JSON.stringify(extend({}, {\n        changed: changes.changedRecords,\n        added: changes.addedRecords,\n        deleted: changes.deletedRecords,\n        action: 'batch',\n        table: e[url],\n        key: e[key]\n      }, DataUtil.getAddParams(this, dm, query)))\n    };\n  };\n  /**\r\n   * Method will trigger before send the request to server side.\r\n   * Used to set the custom header or modify the request options.\r\n   * @param  {DataManager} dm\r\n   * @param  {XMLHttpRequest} request\r\n   * @returns void\r\n   */\n\n\n  UrlAdaptor.prototype.beforeSend = function (dm, request) {// need to extend this method\n  };\n  /**\r\n   * Prepare and returns request body which is used to insert a new record in the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {Object} data\r\n   * @param  {string} tableName\r\n   */\n\n\n  UrlAdaptor.prototype.insert = function (dm, data, tableName, query) {\n    return {\n      url: dm.dataSource.insertUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n      data: JSON.stringify(extend({}, {\n        value: data,\n        table: tableName,\n        action: 'insert'\n      }, DataUtil.getAddParams(this, dm, query)))\n    };\n  };\n  /**\r\n   * Prepare and return request body which is used to remove record from the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {number|string} value\r\n   * @param  {string} tableName\r\n   */\n\n\n  UrlAdaptor.prototype.remove = function (dm, keyField, value, tableName, query) {\n    return {\n      type: 'POST',\n      url: dm.dataSource.removeUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n      data: JSON.stringify(extend({}, {\n        key: value,\n        keyColumn: keyField,\n        table: tableName,\n        action: 'remove'\n      }, DataUtil.getAddParams(this, dm, query)))\n    };\n  };\n  /**\r\n   * Prepare and return request body which is used to update record.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {Object} value\r\n   * @param  {string} tableName\r\n   */\n\n\n  UrlAdaptor.prototype.update = function (dm, keyField, value, tableName, query) {\n    return {\n      type: 'POST',\n      url: dm.dataSource.updateUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n      data: JSON.stringify(extend({}, {\n        value: value,\n        action: 'update',\n        keyColumn: keyField,\n        key: DataUtil.getObject(keyField, value),\n        table: tableName\n      }, DataUtil.getAddParams(this, dm, query)))\n    };\n  };\n  /**\r\n   * To generate the predicate based on the filtered query.\r\n   * @param  {Object[]|string[]|number[]} data\r\n   * @param  {Query} query\r\n   * @hidden\r\n   */\n\n\n  UrlAdaptor.prototype.getFiltersFrom = function (data, query) {\n    var key = query.fKey;\n    var value;\n    var prop = key;\n    var pKey = query.key;\n    var predicats = [];\n\n    if (typeof data[0] !== 'object') {\n      prop = null;\n    }\n\n    for (var i = 0; i < data.length; i++) {\n      if (typeof data[0] === 'object') {\n        value = DataUtil.getObject(pKey || prop, data[i]);\n      } else {\n        value = data[i];\n      }\n\n      predicats.push(new Predicate(key, 'equal', value));\n    }\n\n    return Predicate.or(predicats);\n  };\n\n  UrlAdaptor.prototype.getAggregateResult = function (pvt, data, args, groupDs, query) {\n    var pData = data;\n\n    if (data && data.result) {\n      pData = data.result;\n    }\n\n    if (pvt && pvt.aggregates && pvt.aggregates.length) {\n      var agg = pvt.aggregates;\n      var fn = void 0;\n      var aggregateData = pData;\n      var res = {};\n\n      if (data.aggregate) {\n        aggregateData = data.aggregate;\n      }\n\n      for (var i = 0; i < agg.length; i++) {\n        fn = DataUtil.aggregates[agg[i].type];\n\n        if (fn) {\n          res[agg[i].field + ' - ' + agg[i].type] = fn(aggregateData, agg[i].field);\n        }\n      }\n\n      args.aggregates = res;\n    }\n\n    var key = 'key';\n    var isServerGrouping = Array.isArray(data.result) && data.result.length && !isNullOrUndefined(data.result[0][key]);\n\n    if (pvt && pvt.groups && pvt.groups.length && !isServerGrouping) {\n      var groups = pvt.groups;\n\n      for (var i = 0; i < groups.length; i++) {\n        var level = null;\n\n        if (!isNullOrUndefined(groupDs)) {\n          groupDs = DataUtil.group(groupDs, groups[i]);\n        }\n\n        var groupQuery = Query.filterQueries(query.queries, 'onGroup')[i].e;\n        pData = DataUtil.group(pData, groups[i], pvt.aggregates, level, groupDs, groupQuery.comparer);\n      }\n\n      args.result = pData;\n    }\n\n    return args;\n  };\n\n  UrlAdaptor.prototype.getQueryRequest = function (query) {\n    var req = {\n      sorts: [],\n      groups: [],\n      filters: [],\n      searches: [],\n      aggregates: []\n    };\n    req.sorts = Query.filterQueries(query.queries, 'onSortBy');\n    req.groups = Query.filterQueries(query.queries, 'onGroup');\n    req.filters = Query.filterQueries(query.queries, 'onWhere');\n    req.searches = Query.filterQueries(query.queries, 'onSearch');\n    req.aggregates = Query.filterQueries(query.queries, 'onAggregates');\n    return req;\n  };\n\n  UrlAdaptor.prototype.addParams = function (options) {\n    var req = options.reqParams;\n\n    if (options.params.length) {\n      req.params = {};\n    }\n\n    for (var _i = 0, _a = options.params; _i < _a.length; _i++) {\n      var tmp = _a[_i];\n\n      if (req[tmp.key]) {\n        throw new Error('Query() - addParams: Custom Param is conflicting other request arguments');\n      }\n\n      req[tmp.key] = tmp.value;\n\n      if (tmp.fn) {\n        req[tmp.key] = tmp.fn.call(options.query, tmp.key, options.query, options.dm);\n      }\n\n      req.params[tmp.key] = req[tmp.key];\n    }\n  };\n\n  return UrlAdaptor;\n}(Adaptor);\n\nexport { UrlAdaptor };\n/**\r\n * OData Adaptor that is extended from URL Adaptor, is used for consuming data through OData Service.\r\n * @hidden\r\n */\n\nvar ODataAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(ODataAdaptor, _super);\n\n  function ODataAdaptor(props) {\n    var _this = _super.call(this) || this; // options replaced the default adaptor options\n\n\n    _this.options = extend({}, _this.options, {\n      requestType: 'get',\n      accept: 'application/json;odata=light;q=1,application/json;odata=verbose;q=0.5',\n      multipartAccept: 'multipart/mixed',\n      sortBy: '$orderby',\n      select: '$select',\n      skip: '$skip',\n      take: '$top',\n      count: '$inlinecount',\n      where: '$filter',\n      expand: '$expand',\n      batch: '$batch',\n      changeSet: '--changeset_',\n      batchPre: 'batch_',\n      contentId: 'Content-Id: ',\n      batchContent: 'Content-Type: multipart/mixed; boundary=',\n      changeSetContent: 'Content-Type: application/http\\nContent-Transfer-Encoding: binary ',\n      batchChangeSetContentType: 'Content-Type: application/json; charset=utf-8 ',\n      updateType: 'PUT'\n    });\n    extend(_this.options, props || {});\n    return _this;\n  }\n\n  ODataAdaptor.prototype.getModuleName = function () {\n    return 'ODataAdaptor';\n  };\n  /**\r\n   * Generate request string based on the filter criteria from query.\r\n   * @param  {Predicate} pred\r\n   * @param  {boolean} requiresCast?\r\n   */\n\n\n  ODataAdaptor.prototype.onPredicate = function (predicate, query, requiresCast) {\n    var returnValue = '';\n    var operator;\n    var guid;\n    var val = predicate.value;\n    var type = typeof val;\n    var field = predicate.field ? ODataAdaptor.getField(predicate.field) : null;\n\n    if (val instanceof Date) {\n      val = 'datetime\\'' + DataUtil.parse.replacer(val) + '\\'';\n    }\n\n    if (type === 'string') {\n      val = val.replace(\"'\", \"''\");\n      val = encodeURIComponent(val);\n      val = '\\'' + val + '\\'';\n\n      if (requiresCast) {\n        field = 'cast(' + field + ', \\'Edm.String\\')';\n      }\n\n      if (DataUtil.parse.isGuid(val)) {\n        guid = 'guid';\n      }\n\n      if (predicate.ignoreCase) {\n        if (!guid) {\n          field = 'tolower(' + field + ')';\n        }\n\n        val = val.toLowerCase();\n      }\n    }\n\n    operator = DataUtil.odBiOperator[predicate.operator];\n\n    if (operator) {\n      returnValue += field;\n      returnValue += operator;\n\n      if (guid) {\n        returnValue += guid;\n      }\n\n      return returnValue + val;\n    }\n\n    if (!isNullOrUndefined(this.getModuleName) && this.getModuleName() === 'ODataV4Adaptor') {\n      operator = DataUtil.odv4UniOperator[predicate.operator];\n    } else {\n      operator = DataUtil.odUniOperator[predicate.operator];\n    }\n\n    if (operator === 'substringof') {\n      var temp = val;\n      val = field;\n      field = temp;\n    }\n\n    returnValue += operator + '(';\n    returnValue += field + ',';\n\n    if (guid) {\n      returnValue += guid;\n    }\n\n    returnValue += val + ')';\n    return returnValue;\n  };\n\n  ODataAdaptor.prototype.addParams = function (options) {\n    _super.prototype.addParams.call(this, options);\n\n    delete options.reqParams.params;\n  };\n  /**\r\n   * Generate request string based on the multiple filter criteria from query.\r\n   * @param  {Predicate} pred\r\n   * @param  {boolean} requiresCast?\r\n   */\n\n\n  ODataAdaptor.prototype.onComplexPredicate = function (predicate, query, requiresCast) {\n    var res = [];\n\n    for (var i = 0; i < predicate.predicates.length; i++) {\n      res.push('(' + this.onEachWhere(predicate.predicates[i], query, requiresCast) + ')');\n    }\n\n    return res.join(' ' + predicate.condition + ' ');\n  };\n  /**\r\n   * Generate query string based on the multiple filter criteria from query.\r\n   * @param  {Predicate} filter\r\n   * @param  {boolean} requiresCast?\r\n   */\n\n\n  ODataAdaptor.prototype.onEachWhere = function (filter, query, requiresCast) {\n    return filter.isComplex ? this.onComplexPredicate(filter, query, requiresCast) : this.onPredicate(filter, query, requiresCast);\n  };\n  /**\r\n   * Generate query string based on the multiple filter criteria from query.\r\n   * @param  {string[]} filters\r\n   */\n\n\n  ODataAdaptor.prototype.onWhere = function (filters) {\n    if (this.pvt.search) {\n      filters.push(this.onEachWhere(this.pvt.search, null, true));\n    }\n\n    return filters.join(' and ');\n  };\n  /**\r\n   * Generate query string based on the multiple search criteria from query.\r\n   * @param  {{fields:string[]} e\r\n   * @param  {string} operator\r\n   * @param  {string} key\r\n   * @param  {boolean}} ignoreCase\r\n   */\n\n\n  ODataAdaptor.prototype.onEachSearch = function (e) {\n    if (e.fields && e.fields.length === 0) {\n      DataUtil.throwError('Query() - Search : oData search requires list of field names to search');\n    }\n\n    var filter = this.pvt.search || [];\n\n    for (var i = 0; i < e.fields.length; i++) {\n      filter.push(new Predicate(e.fields[i], e.operator, e.key, e.ignoreCase));\n    }\n\n    this.pvt.search = filter;\n  };\n  /**\r\n   * Generate query string based on the search criteria from query.\r\n   * @param  {Object} e\r\n   */\n\n\n  ODataAdaptor.prototype.onSearch = function (e) {\n    this.pvt.search = Predicate.or(this.pvt.search);\n    return '';\n  };\n  /**\r\n   * Generate query string based on multiple sort criteria from query.\r\n   * @param  {QueryOptions} e\r\n   */\n\n\n  ODataAdaptor.prototype.onEachSort = function (e) {\n    var res = [];\n\n    if (e.name instanceof Array) {\n      for (var i = 0; i < e.name.length; i++) {\n        res.push(ODataAdaptor.getField(e.name[i]) + (e.direction === 'descending' ? ' desc' : ''));\n      }\n    } else {\n      res.push(ODataAdaptor.getField(e.name) + (e.direction === 'descending' ? ' desc' : ''));\n    }\n\n    return res.join(',');\n  };\n  /**\r\n   * Returns sort query string.\r\n   * @param  {string[]} e\r\n   */\n\n\n  ODataAdaptor.prototype.onSortBy = function (e) {\n    return e.reverse().join(',');\n  };\n  /**\r\n   * Adds the group query to the adaptor option.\r\n   * @param  {Object[]} e\r\n   * @returns string\r\n   */\n\n\n  ODataAdaptor.prototype.onGroup = function (e) {\n    this.pvt.groups = e;\n    return [];\n  };\n  /**\r\n   * Returns the select query string.\r\n   * @param  {string[]} e\r\n   */\n\n\n  ODataAdaptor.prototype.onSelect = function (e) {\n    for (var i = 0; i < e.length; i++) {\n      e[i] = ODataAdaptor.getField(e[i]);\n    }\n\n    return e.join(',');\n  };\n  /**\r\n   * Add the aggregate query to the adaptor option.\r\n   * @param  {Object[]} e\r\n   * @returns string\r\n   */\n\n\n  ODataAdaptor.prototype.onAggregates = function (e) {\n    this.pvt.aggregates = e;\n    return '';\n  };\n  /**\r\n   * Returns the query string which requests total count from the data source.\r\n   * @param  {boolean} e\r\n   * @returns string\r\n   */\n\n\n  ODataAdaptor.prototype.onCount = function (e) {\n    return e === true ? 'allpages' : '';\n  };\n  /**\r\n   * Method will trigger before send the request to server side.\r\n   * Used to set the custom header or modify the request options.\r\n   * @param  {DataManager} dm\r\n   * @param  {XMLHttpRequest} request\r\n   * @param  {Ajax} settings?\r\n   */\n\n\n  ODataAdaptor.prototype.beforeSend = function (dm, request, settings) {\n    if (DataUtil.endsWith(settings.url, this.options.batch) && settings.type.toLowerCase() === 'post') {\n      request.setRequestHeader('Accept', this.options.multipartAccept);\n      request.setRequestHeader('DataServiceVersion', '2.0');\n      request.overrideMimeType('text/plain; charset=x-user-defined');\n    } else {\n      request.setRequestHeader('Accept', this.options.accept);\n    }\n\n    request.setRequestHeader('DataServiceVersion', '2.0');\n    request.setRequestHeader('MaxDataServiceVersion', '2.0');\n  };\n  /**\r\n   * Returns the data from the query processing.\r\n   * @param  {DataResult} data\r\n   * @param  {DataOptions} ds?\r\n   * @param  {Query} query?\r\n   * @param  {XMLHttpRequest} xhr?\r\n   * @param  {Ajax} request?\r\n   * @param  {CrudOptions} changes?\r\n   * @returns aggregateResult\r\n   */\n\n\n  ODataAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n    var metaCheck = 'odata.metadata';\n\n    if (request && request.type === 'GET' && !this.rootUrl && data[metaCheck]) {\n      var dataUrls = data[metaCheck].split('/$metadata#');\n      this.rootUrl = dataUrls[0];\n      this.resourceTableName = dataUrls[1];\n    }\n\n    var pvtData = 'pvtData';\n\n    if (!isNullOrUndefined(data.d)) {\n      var dataCopy = query && query.isCountRequired ? data.d.results : data.d;\n      var metaData = '__metadata';\n\n      if (!isNullOrUndefined(dataCopy)) {\n        for (var i = 0; i < dataCopy.length; i++) {\n          if (!isNullOrUndefined(dataCopy[i][metaData])) {\n            delete dataCopy[i][metaData];\n          }\n        }\n      }\n    }\n\n    var pvt = request && request[pvtData];\n    var emptyAndBatch = this.processBatchResponse(data, query, xhr, request, changes);\n\n    if (emptyAndBatch) {\n      return emptyAndBatch;\n    }\n\n    var versionCheck = xhr && request.getResponseHeader('DataServiceVersion');\n    var count = null;\n    var version = versionCheck && parseInt(versionCheck, 10) || 2;\n\n    if (query && query.isCountRequired) {\n      var oDataCount = '__count';\n\n      if (data[oDataCount] || data['odata.count']) {\n        count = data[oDataCount] || data['odata.count'];\n      }\n\n      if (data.d) {\n        data = data.d;\n      }\n\n      if (data[oDataCount] || data['odata.count']) {\n        count = data[oDataCount] || data['odata.count'];\n      }\n    }\n\n    if (version === 3 && data.value) {\n      data = data.value;\n    }\n\n    if (data.d) {\n      data = data.d;\n    }\n\n    if (version < 3 && data.results) {\n      data = data.results;\n    }\n\n    var args = {};\n    args.count = count;\n    args.result = data;\n    this.getAggregateResult(pvt, data, args, null, query);\n    return DataUtil.isNull(count) ? args.result : {\n      result: args.result,\n      count: args.count,\n      aggregates: args.aggregates\n    };\n  };\n  /**\r\n   * Converts the request object to query string.\r\n   * @param  {Object} req\r\n   * @param  {Query} query\r\n   * @param  {DataManager} dm\r\n   * @returns tableName\r\n   */\n\n\n  ODataAdaptor.prototype.convertToQueryString = function (request, query, dm) {\n    var res = [];\n    var table = 'table';\n    var tableName = request[table] || '';\n    var format = '$format';\n    delete request[table];\n\n    if (dm.dataSource.requiresFormat) {\n      request[format] = 'json';\n    }\n\n    var keys = Object.keys(request);\n\n    for (var _i = 0, keys_4 = keys; _i < keys_4.length; _i++) {\n      var prop = keys_4[_i];\n      res.push(prop + '=' + request[prop]);\n    }\n\n    res = res.join('&');\n\n    if (dm.dataSource.url && dm.dataSource.url.indexOf('?') !== -1 && !tableName) {\n      return res;\n    }\n\n    return res.length ? tableName + '?' + res : tableName || '';\n  };\n\n  ODataAdaptor.prototype.localTimeReplacer = function (key, convertObj) {\n    for (var _i = 0, _a = !isNullOrUndefined(convertObj) ? Object.keys(convertObj) : []; _i < _a.length; _i++) {\n      var prop = _a[_i];\n\n      if (convertObj[prop] instanceof Date) {\n        convertObj[prop] = DataUtil.dateParse.toLocalTime(convertObj[prop]);\n      }\n    }\n\n    return convertObj;\n  };\n  /**\r\n   * Prepare and returns request body which is used to insert a new record in the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {Object} data\r\n   * @param  {string} tableName?\r\n   */\n\n\n  ODataAdaptor.prototype.insert = function (dm, data, tableName) {\n    return {\n      url: (dm.dataSource.insertUrl || dm.dataSource.url).replace(/\\/*$/, tableName ? '/' + tableName : ''),\n      data: JSON.stringify(data, this.options.localTime ? this.localTimeReplacer : null)\n    };\n  };\n  /**\r\n   * Prepare and return request body which is used to remove record from the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {number} value\r\n   * @param  {string} tableName?\r\n   */\n\n\n  ODataAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n    var url;\n\n    if (typeof value === 'string' && !DataUtil.parse.isGuid(value)) {\n      url = \"('\" + value + \"')\";\n    } else {\n      url = \"(\" + value + \")\";\n    }\n\n    return {\n      type: 'DELETE',\n      url: (dm.dataSource.removeUrl || dm.dataSource.url).replace(/\\/*$/, tableName ? '/' + tableName : '') + url\n    };\n  };\n  /**\r\n   * Updates existing record and saves the changes to the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {Object} value\r\n   * @param  {string} tableName?\r\n   * @returns this\r\n   */\n\n\n  ODataAdaptor.prototype.update = function (dm, keyField, value, tableName, query, original) {\n    if (this.options.updateType === 'PATCH' && !isNullOrUndefined(original)) {\n      value = this.compareAndRemove(value, original, keyField);\n    }\n\n    var url;\n\n    if (typeof value[keyField] === 'string' && !DataUtil.parse.isGuid(value[keyField])) {\n      url = \"('\" + value[keyField] + \"')\";\n    } else {\n      url = \"(\" + value[keyField] + \")\";\n    }\n\n    return {\n      type: this.options.updateType,\n      url: (dm.dataSource.updateUrl || dm.dataSource.url).replace(/\\/*$/, tableName ? '/' + tableName : '') + url,\n      data: JSON.stringify(value, this.options.localTime ? this.localTimeReplacer : null),\n      accept: this.options.accept\n    };\n  };\n  /**\r\n   * Prepare the request body based on the newly added, removed and updated records.\r\n   * The result is used by the batch request.\r\n   * @param  {DataManager} dm\r\n   * @param  {CrudOptions} changes\r\n   * @param  {RemoteArgs} e\r\n   * @returns {Object}\r\n   */\n\n\n  ODataAdaptor.prototype.batchRequest = function (dm, changes, e, query, original) {\n    var initialGuid = e.guid = DataUtil.getGuid(this.options.batchPre);\n    var url = this.rootUrl ? this.rootUrl + '/' + this.options.batch : dm.dataSource.url.replace(/\\/*$/, '/' + this.options.batch);\n    e.url = this.resourceTableName ? this.resourceTableName : e.url;\n    var args = {\n      url: e.url,\n      key: e.key,\n      cid: 1,\n      cSet: DataUtil.getGuid(this.options.changeSet)\n    };\n    var req = '--' + initialGuid + '\\n';\n    req += 'Content-Type: multipart/mixed; boundary=' + args.cSet.replace('--', '') + '\\n';\n    this.pvt.changeSet = 0;\n    req += this.generateInsertRequest(changes.addedRecords, args, dm);\n    req += this.generateUpdateRequest(changes.changedRecords, args, dm, original ? original.changedRecords : []);\n    req += this.generateDeleteRequest(changes.deletedRecords, args, dm);\n    req += args.cSet + '--\\n';\n    req += '--' + initialGuid + '--';\n    return {\n      type: 'POST',\n      url: url,\n      dataType: 'json',\n      contentType: 'multipart/mixed; charset=UTF-8;boundary=' + initialGuid,\n      data: req\n    };\n  };\n  /**\r\n   * Generate the string content from the removed records.\r\n   * The result will be send during batch update.\r\n   * @param  {Object[]} arr\r\n   * @param  {RemoteArgs} e\r\n   * @returns this\r\n   */\n\n\n  ODataAdaptor.prototype.generateDeleteRequest = function (arr, e, dm) {\n    if (!arr) {\n      return '';\n    }\n\n    var req = '';\n    var stat = {\n      'method': 'DELETE ',\n      'url': function (data, i, key) {\n        var url = DataUtil.getObject(key, data[i]);\n\n        if (typeof url === 'number' || DataUtil.parse.isGuid(url)) {\n          return '(' + url + ')';\n        } else if (url instanceof Date) {\n          var dateTime = data[i][key];\n          return '(' + dateTime.toJSON() + ')';\n        } else {\n          return \"('\" + url + \"')\";\n        }\n      },\n      'data': function (data, i) {\n        return '';\n      }\n    };\n    req = this.generateBodyContent(arr, e, stat, dm);\n    return req + '\\n';\n  };\n  /**\r\n   * Generate the string content from the inserted records.\r\n   * The result will be send during batch update.\r\n   * @param  {Object[]} arr\r\n   * @param  {RemoteArgs} e\r\n   */\n\n\n  ODataAdaptor.prototype.generateInsertRequest = function (arr, e, dm) {\n    if (!arr) {\n      return '';\n    }\n\n    var req = '';\n    var stat = {\n      'method': 'POST ',\n      'url': function (data, i, key) {\n        return '';\n      },\n      'data': function (data, i) {\n        return JSON.stringify(data[i]) + '\\n\\n';\n      }\n    };\n    req = this.generateBodyContent(arr, e, stat, dm);\n    return req;\n  };\n  /**\r\n   * Generate the string content from the updated records.\r\n   * The result will be send during batch update.\r\n   * @param  {Object[]} arr\r\n   * @param  {RemoteArgs} e\r\n   */\n\n\n  ODataAdaptor.prototype.generateUpdateRequest = function (arr, e, dm, org) {\n    var _this = this;\n\n    if (!arr) {\n      return '';\n    }\n\n    var req = '';\n    arr.forEach(function (change) {\n      return change = _this.compareAndRemove(change, org.filter(function (o) {\n        return DataUtil.getObject(e.key, o) === DataUtil.getObject(e.key, change);\n      })[0], e.key);\n    });\n    var stat = {\n      'method': this.options.updateType + ' ',\n      'url': function (data, i, key) {\n        if (typeof data[i][key] === 'number' || DataUtil.parse.isGuid(data[i][key])) {\n          return '(' + data[i][key] + ')';\n        } else if (data[i][key] instanceof Date) {\n          var date = data[i][key];\n          return '(' + date.toJSON() + ')';\n        } else {\n          return \"('\" + data[i][key] + \"')\";\n        }\n      },\n      'data': function (data, i) {\n        return JSON.stringify(data[i]) + '\\n\\n';\n      }\n    };\n    req = this.generateBodyContent(arr, e, stat, dm);\n    return req;\n  };\n\n  ODataAdaptor.getField = function (prop) {\n    return prop.replace(/\\./g, '/');\n  };\n\n  ODataAdaptor.prototype.generateBodyContent = function (arr, e, stat, dm) {\n    var req = '';\n\n    for (var i = 0; i < arr.length; i++) {\n      req += '\\n' + e.cSet + '\\n';\n      req += this.options.changeSetContent + '\\n\\n';\n      req += stat.method;\n\n      if (stat.method === 'POST ') {\n        req += (dm.dataSource.insertUrl || dm.dataSource.crudUrl || e.url) + stat.url(arr, i, e.key) + ' HTTP/1.1\\n';\n      } else if (stat.method === 'PUT ' || stat.method === 'PATCH ') {\n        req += (dm.dataSource.updateUrl || dm.dataSource.crudUrl || e.url) + stat.url(arr, i, e.key) + ' HTTP/1.1\\n';\n      } else if (stat.method === 'DELETE ') {\n        req += (dm.dataSource.removeUrl || dm.dataSource.crudUrl || e.url) + stat.url(arr, i, e.key) + ' HTTP/1.1\\n';\n      }\n\n      req += 'Accept: ' + this.options.accept + '\\n';\n      req += 'Content-Id: ' + this.pvt.changeSet++ + '\\n';\n      req += this.options.batchChangeSetContentType + '\\n';\n\n      if (!isNullOrUndefined(arr[i]['@odata.etag'])) {\n        req += 'If-Match: ' + arr[i]['@odata.etag'] + '\\n\\n';\n        delete arr[i]['@odata.etag'];\n      } else {\n        req += '\\n';\n      }\n\n      req += stat.data(arr, i);\n    }\n\n    return req;\n  };\n\n  ODataAdaptor.prototype.processBatchResponse = function (data, query, xhr, request, changes) {\n    if (xhr && xhr.getResponseHeader('Content-Type') && xhr.getResponseHeader('Content-Type').indexOf('xml') !== -1) {\n      return query.isCountRequired ? {\n        result: [],\n        count: 0\n      } : [];\n    }\n\n    if (request && this.options.batch && DataUtil.endsWith(request.url, this.options.batch) && request.type.toLowerCase() === 'post') {\n      var guid = xhr.getResponseHeader('Content-Type');\n      var cIdx = void 0;\n      var jsonObj = void 0;\n      var d = data + '';\n      guid = guid.substring(guid.indexOf('=batchresponse') + 1);\n      d = d.split(guid);\n\n      if (d.length < 2) {\n        return {};\n      }\n\n      d = d[1];\n      var exVal = /(?:\\bContent-Type.+boundary=)(changesetresponse.+)/i.exec(d);\n\n      if (exVal) {\n        d.replace(exVal[0], '');\n      }\n\n      var changeGuid = exVal ? exVal[1] : '';\n      d = d.split(changeGuid);\n\n      for (var i = d.length; i > -1; i--) {\n        if (!/\\bContent-ID:/i.test(d[i]) || !/\\bHTTP.+201/.test(d[i])) {\n          continue;\n        }\n\n        cIdx = parseInt(/\\bContent-ID: (\\d+)/i.exec(d[i])[1], 10);\n\n        if (changes.addedRecords[cIdx]) {\n          jsonObj = DataUtil.parse.parseJson(/^\\{.+\\}/m.exec(d[i])[0]);\n          extend({}, changes.addedRecords[cIdx], this.processResponse(jsonObj));\n        }\n      }\n\n      return changes;\n    }\n\n    return null;\n  };\n\n  ODataAdaptor.prototype.compareAndRemove = function (data, original, key) {\n    var _this = this;\n\n    if (isNullOrUndefined(original)) {\n      return data;\n    }\n\n    Object.keys(data).forEach(function (prop) {\n      if (prop !== key && prop !== '@odata.etag') {\n        if (DataUtil.isPlainObject(data[prop])) {\n          _this.compareAndRemove(data[prop], original[prop]);\n\n          var final = Object.keys(data[prop]).filter(function (data) {\n            return data !== '@odata.etag';\n          });\n\n          if (final.length === 0) {\n            delete data[prop];\n          }\n        } else if (data[prop] === original[prop]) {\n          delete data[prop];\n        } else if (data[prop] && original[prop] && data[prop].valueOf() === original[prop].valueOf()) {\n          delete data[prop];\n        }\n      }\n    });\n    return data;\n  };\n\n  return ODataAdaptor;\n}(UrlAdaptor);\n\nexport { ODataAdaptor };\n/**\r\n * The OData v4 is an improved version of OData protocols.\r\n * The DataManager uses the ODataV4Adaptor to consume OData v4 services.\r\n * @hidden\r\n */\n\nvar ODataV4Adaptor =\n/** @class */\nfunction (_super) {\n  __extends(ODataV4Adaptor, _super);\n\n  function ODataV4Adaptor(props) {\n    var _this = _super.call(this, props) || this; // options replaced the default adaptor options\n\n\n    _this.options = extend({}, _this.options, {\n      requestType: 'get',\n      accept: 'application/json, text/javascript, */*; q=0.01',\n      multipartAccept: 'multipart/mixed',\n      sortBy: '$orderby',\n      select: '$select',\n      skip: '$skip',\n      take: '$top',\n      count: '$count',\n      search: '$search',\n      where: '$filter',\n      expand: '$expand',\n      batch: '$batch',\n      changeSet: '--changeset_',\n      batchPre: 'batch_',\n      contentId: 'Content-Id: ',\n      batchContent: 'Content-Type: multipart/mixed; boundary=',\n      changeSetContent: 'Content-Type: application/http\\nContent-Transfer-Encoding: binary ',\n      batchChangeSetContentType: 'Content-Type: application/json; charset=utf-8 ',\n      updateType: 'PATCH',\n      localTime: false,\n      apply: '$apply'\n    });\n    extend(_this.options, props || {});\n    return _this;\n  }\n  /**\r\n   * @hidden\r\n   */\n\n\n  ODataV4Adaptor.prototype.getModuleName = function () {\n    return 'ODataV4Adaptor';\n  };\n  /**\r\n   * Returns the query string which requests total count from the data source.\r\n   * @param  {boolean} e\r\n   * @returns string\r\n   */\n\n\n  ODataV4Adaptor.prototype.onCount = function (e) {\n    return e === true ? 'true' : '';\n  };\n  /**\r\n   * Generate request string based on the filter criteria from query.\r\n   * @param  {Predicate} pred\r\n   * @param  {boolean} requiresCast?\r\n   */\n\n\n  ODataV4Adaptor.prototype.onPredicate = function (predicate, query, requiresCast) {\n    var returnValue = '';\n    var val = predicate.value;\n    var isDate = val instanceof Date;\n\n    if (query instanceof Query) {\n      var queries = this.getQueryRequest(query);\n\n      for (var i = 0; i < queries.filters.length; i++) {\n        if (queries.filters[i].e.key === predicate.value) {\n          requiresCast = true;\n        }\n      }\n    }\n\n    returnValue = _super.prototype.onPredicate.call(this, predicate, query, requiresCast);\n\n    if (isDate) {\n      returnValue = returnValue.replace(/datetime'(.*)'$/, '$1');\n    }\n\n    if (DataUtil.parse.isGuid(val)) {\n      returnValue = returnValue.replace('guid', '').replace(/'/g, '');\n    }\n\n    return returnValue;\n  };\n  /**\r\n   *  Generate query string based on the multiple search criteria from query.\r\n   * @param  {{fields:string[]} e\r\n   * @param  {string} operator\r\n   * @param  {string} key\r\n   * @param  {boolean}} ignoreCase\r\n   */\n\n\n  ODataV4Adaptor.prototype.onEachSearch = function (e) {\n    var search = this.pvt.searches || [];\n    search.push(e.key);\n    this.pvt.searches = search;\n  };\n  /**\r\n   *  Generate query string based on the search criteria from query.\r\n   * @param  {Object} e\r\n   */\n\n\n  ODataV4Adaptor.prototype.onSearch = function (e) {\n    return this.pvt.searches.join(' OR ');\n  };\n  /**\r\n   * Returns the expand query string.\r\n   * @param  {string} e\r\n   */\n\n\n  ODataV4Adaptor.prototype.onExpand = function (e) {\n    var selected = {};\n    var expanded = {};\n    var expands = e.expands.slice();\n    var exArr = [];\n    var selects = e.selects.filter(function (item) {\n      return item.indexOf('.') > -1;\n    });\n    selects.forEach(function (select) {\n      var splits = select.split('.');\n\n      if (!(splits[0] in selected)) {\n        selected[splits[0]] = [];\n      }\n\n      if (splits.length == 2) {\n        if (selected[splits[0]].length && Object.keys(selected).indexOf(splits[0]) !== -1) {\n          selected[splits[0]][0] = selected[splits[0]][0] + ',' + splits[1];\n        } else {\n          selected[splits[0]].push('$select=' + splits[1]);\n        }\n      } else {\n        var sel = '$select=' + splits[splits.length - 1];\n        var exp = '';\n        var close_1 = '';\n\n        for (var i = 1; i < splits.length - 1; i++) {\n          exp = exp + '$expand=' + splits[i] + '(';\n          close_1 = close_1 + ')';\n        }\n\n        var combineVal = exp + sel + close_1;\n\n        if (selected[splits[0]].length && Object.keys(selected).indexOf(splits[0]) !== -1 && selected[splits[0]][0].indexOf('$expand') !== -1) {\n          selected[splits[0]][0] = selected[splits[0]][0] + combineVal.replace('$expand=', ',');\n        } else {\n          selected[splits[0]].push(combineVal);\n        }\n      }\n    }); //Auto expand from select query\n\n    Object.keys(selected).forEach(function (expand) {\n      if (expands.indexOf(expand) === -1) {\n        expands.push(expand);\n      }\n    });\n    expands.forEach(function (expand) {\n      expanded[expand] = expand in selected ? expand + \"(\" + selected[expand].join(';') + \")\" : expand;\n    });\n    Object.keys(expanded).forEach(function (ex) {\n      return exArr.push(expanded[ex]);\n    });\n    return exArr.join(',');\n  };\n  /**\r\n   * Returns the groupby query string.\r\n   * @param  {string} e\r\n   */\n\n\n  ODataV4Adaptor.prototype.onDistinct = function (distinctFields) {\n    var fields = distinctFields.map(function (field) {\n      return ODataAdaptor.getField(field);\n    }).join(',');\n    return \"groupby((\" + fields + \"))\";\n  };\n  /**\r\n   * Returns the select query string.\r\n   * @param  {string[]} e\r\n   */\n\n\n  ODataV4Adaptor.prototype.onSelect = function (e) {\n    return _super.prototype.onSelect.call(this, e.filter(function (item) {\n      return item.indexOf('.') === -1;\n    }));\n  };\n  /**\r\n   * Method will trigger before send the request to server side.\r\n   * Used to set the custom header or modify the request options.\r\n   * @param  {DataManager} dm\r\n   * @param  {XMLHttpRequest} request\r\n   * @param  {Ajax} settings\r\n   * @returns void\r\n   */\n\n\n  ODataV4Adaptor.prototype.beforeSend = function (dm, request, settings) {\n    if (settings.type === 'POST' || settings.type === 'PUT' || settings.type === 'PATCH') {\n      request.setRequestHeader('Prefer', 'return=representation');\n    }\n\n    request.setRequestHeader('Accept', this.options.accept);\n  };\n  /**\r\n   * Returns the data from the query processing.\r\n   * @param  {DataResult} data\r\n   * @param  {DataOptions} ds?\r\n   * @param  {Query} query?\r\n   * @param  {XMLHttpRequest} xhr?\r\n   * @param  {Ajax} request?\r\n   * @param  {CrudOptions} changes?\r\n   * @returns aggregateResult\r\n   */\n\n\n  ODataV4Adaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n    var metaName = '@odata.context';\n\n    if (request && request.type === 'GET' && !this.rootUrl && data[metaName]) {\n      var dataUrl = data[metaName].split('/$metadata#');\n      this.rootUrl = dataUrl[0];\n      this.resourceTableName = dataUrl[1];\n    }\n\n    var pvtData = 'pvtData';\n    var pvt = request && request[pvtData];\n\n    var emptyAndBatch = _super.prototype.processBatchResponse.call(this, data, query, xhr, request, changes);\n\n    if (emptyAndBatch) {\n      return emptyAndBatch;\n    }\n\n    var count = null;\n    var dataCount = '@odata.count';\n\n    if (query && query.isCountRequired) {\n      if (dataCount in data) {\n        count = data[dataCount];\n      }\n    }\n\n    data = !isNullOrUndefined(data.value) ? data.value : data;\n    var args = {};\n    args.count = count;\n    args.result = data;\n    this.getAggregateResult(pvt, data, args, null, query);\n    return DataUtil.isNull(count) ? args.result : {\n      result: args.result,\n      count: count,\n      aggregates: args.aggregates\n    };\n  };\n\n  return ODataV4Adaptor;\n}(ODataAdaptor);\n\nexport { ODataV4Adaptor };\n/**\r\n * The Web API is a programmatic interface to define the request and response messages system that is mostly exposed in JSON or XML.\r\n * The DataManager uses the WebApiAdaptor to consume Web API.\r\n * Since this adaptor is targeted to interact with Web API created using OData endpoint, it is extended from ODataAdaptor\r\n * @hidden\r\n */\n\nvar WebApiAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(WebApiAdaptor, _super);\n\n  function WebApiAdaptor() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  WebApiAdaptor.prototype.getModuleName = function () {\n    return 'WebApiAdaptor';\n  };\n  /**\r\n   * Prepare and returns request body which is used to insert a new record in the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {Object} data\r\n   * @param  {string} tableName?\r\n   */\n\n\n  WebApiAdaptor.prototype.insert = function (dm, data, tableName) {\n    return {\n      type: 'POST',\n      url: dm.dataSource.url,\n      data: JSON.stringify(data)\n    };\n  };\n  /**\r\n   * Prepare and return request body which is used to remove record from the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {number} value\r\n   * @param  {string} tableName?\r\n   */\n\n\n  WebApiAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n    return {\n      type: 'DELETE',\n      url: dm.dataSource.url + '/' + value,\n      data: JSON.stringify(value)\n    };\n  };\n  /**\r\n   * Prepare and return request body which is used to update record.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {Object} value\r\n   * @param  {string} tableName?\r\n   */\n\n\n  WebApiAdaptor.prototype.update = function (dm, keyField, value, tableName) {\n    return {\n      type: 'PUT',\n      url: dm.dataSource.url,\n      data: JSON.stringify(value)\n    };\n  };\n\n  WebApiAdaptor.prototype.batchRequest = function (dm, changes, e) {\n    var _this = this;\n\n    var initialGuid = e.guid = DataUtil.getGuid(this.options.batchPre);\n    var url = dm.dataSource.url.replace(/\\/*$/, '/' + this.options.batch);\n    e.url = this.resourceTableName ? this.resourceTableName : e.url;\n    var req = [];\n\n    var _loop_1 = function (i, x) {\n      changes.addedRecords.forEach(function (j, d) {\n        var stat = {\n          'method': 'POST ',\n          'url': function (data, i, key) {\n            return '';\n          },\n          'data': function (data, i) {\n            return JSON.stringify(data[i]) + '\\n\\n';\n          }\n        };\n        req.push('--' + initialGuid);\n        req.push('Content-Type: application/http; msgtype=request', '');\n        req.push('POST ' + '/api/' + (dm.dataSource.insertUrl || dm.dataSource.crudUrl || e.url) + stat.url(changes.addedRecords, i, e.key) + ' HTTP/1.1');\n        req.push('Content-Type: ' + 'application/json; charset=utf-8');\n        req.push('Host: ' + location.host);\n        req.push('', j ? JSON.stringify(j) : '');\n      });\n    }; //insertion\n\n\n    for (var i = 0, x = changes.addedRecords.length; i < x; i++) {\n      _loop_1(i, x);\n    }\n\n    var _loop_2 = function (i, x) {\n      changes.changedRecords.forEach(function (j, d) {\n        var stat = {\n          'method': _this.options.updateType + ' ',\n          'url': function (data, i, key) {\n            return '';\n          },\n          'data': function (data, i) {\n            return JSON.stringify(data[i]) + '\\n\\n';\n          }\n        };\n        req.push('--' + initialGuid);\n        req.push('Content-Type: application/http; msgtype=request', '');\n        req.push('PUT ' + '/api/' + (dm.dataSource.updateUrl || dm.dataSource.crudUrl || e.url) + stat.url(changes.changedRecords, i, e.key) + ' HTTP/1.1');\n        req.push('Content-Type: ' + 'application/json; charset=utf-8');\n        req.push('Host: ' + location.host);\n        req.push('', j ? JSON.stringify(j) : '');\n      });\n    }; //updation \n\n\n    for (var i = 0, x = changes.changedRecords.length; i < x; i++) {\n      _loop_2(i, x);\n    }\n\n    var _loop_3 = function (i, x) {\n      changes.deletedRecords.forEach(function (j, d) {\n        var state = {\n          'mtd': 'DELETE ',\n          'url': function (data, i, key) {\n            var url = DataUtil.getObject(key, data[i]);\n\n            if (typeof url === 'number' || DataUtil.parse.isGuid(url)) {\n              return '/' + url;\n            } else if (url instanceof Date) {\n              var datTime = data[i][key];\n              return '/' + datTime.toJSON();\n            } else {\n              return \"/'\" + url + \"'\";\n            }\n          },\n          'data': function (data, i) {\n            return '';\n          }\n        };\n        req.push('--' + initialGuid);\n        req.push('Content-Type: application/http; msgtype=request', '');\n        req.push('DELETE ' + '/api/' + (dm.dataSource.removeUrl || dm.dataSource.crudUrl || e.url) + state.url(changes.deletedRecords, i, e.key) + ' HTTP/1.1');\n        req.push('Content-Type: ' + 'application/json; charset=utf-8');\n        req.push('Host: ' + location.host);\n        req.push('', j ? JSON.stringify(j) : '');\n      });\n    }; //deletion\n\n\n    for (var i = 0, x = changes.deletedRecords.length; i < x; i++) {\n      _loop_3(i, x);\n    }\n\n    req.push('--' + initialGuid + '--', '');\n    return {\n      type: 'POST',\n      url: url,\n      contentType: 'multipart/mixed; boundary=' + initialGuid,\n      data: req.join('\\r\\n')\n    };\n  };\n  /**\r\n   * Method will trigger before send the request to server side.\r\n   * Used to set the custom header or modify the request options.\r\n   * @param  {DataManager} dm\r\n   * @param  {XMLHttpRequest} request\r\n   * @param  {Ajax} settings\r\n   * @returns void\r\n   */\n\n\n  WebApiAdaptor.prototype.beforeSend = function (dm, request, settings) {\n    request.setRequestHeader('Accept', 'application/json, text/javascript, */*; q=0.01');\n  };\n  /**\r\n   * Returns the data from the query processing.\r\n   * @param  {DataResult} data\r\n   * @param  {DataOptions} ds?\r\n   * @param  {Query} query?\r\n   * @param  {XMLHttpRequest} xhr?\r\n   * @param  {Ajax} request?\r\n   * @param  {CrudOptions} changes?\r\n   * @returns aggregateResult\r\n   */\n\n\n  WebApiAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n    var pvtData = 'pvtData';\n    var pvt = request && request[pvtData];\n    var count = null;\n    var args = {};\n\n    if (request && request.type.toLowerCase() !== 'post') {\n      var versionCheck = xhr && request.getResponseHeader('DataServiceVersion');\n      var version = versionCheck && parseInt(versionCheck, 10) || 2;\n\n      if (query && query.isCountRequired) {\n        if (!DataUtil.isNull(data.Count)) {\n          count = data.Count;\n        }\n      }\n\n      if (version < 3 && data.Items) {\n        data = data.Items;\n      }\n\n      args.count = count;\n      args.result = data;\n      this.getAggregateResult(pvt, data, args, null, query);\n    }\n\n    args.result = args.result || data;\n    return DataUtil.isNull(count) ? args.result : {\n      result: args.result,\n      count: args.count,\n      aggregates: args.aggregates\n    };\n  };\n\n  return WebApiAdaptor;\n}(ODataAdaptor);\n\nexport { WebApiAdaptor };\n/**\r\n * WebMethodAdaptor can be used by DataManager to interact with web method.\r\n * @hidden\r\n */\n\nvar WebMethodAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(WebMethodAdaptor, _super);\n\n  function WebMethodAdaptor() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  /**\r\n   * Prepare the request body based on the query.\r\n   * The query information can be accessed at the WebMethod using variable named `value`.\r\n   * @param  {DataManager} dm\r\n   * @param  {Query} query\r\n   * @param  {Object[]} hierarchyFilters?\r\n   * @returns application\r\n   */\n\n\n  WebMethodAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\n    var obj = new UrlAdaptor().processQuery(dm, query, hierarchyFilters);\n    var getData = 'data';\n    var data = DataUtil.parse.parseJson(obj[getData]);\n    var result = {};\n    var value = 'value';\n\n    if (data.param) {\n      for (var i = 0; i < data.param.length; i++) {\n        var param = data.param[i];\n        var key = Object.keys(param)[0];\n        result[key] = param[key];\n      }\n    }\n\n    result[value] = data;\n    var pvtData = 'pvtData';\n    var url = 'url';\n    return {\n      data: JSON.stringify(result),\n      url: obj[url],\n      pvtData: obj[pvtData],\n      type: 'POST',\n      contentType: 'application/json; charset=utf-8'\n    };\n  };\n\n  return WebMethodAdaptor;\n}(UrlAdaptor);\n\nexport { WebMethodAdaptor };\n/**\r\n * RemoteSaveAdaptor, extended from JsonAdaptor and it is used for binding local data and performs all DataManager queries in client-side.\r\n * It interacts with server-side only for CRUD operations.\r\n * @hidden\r\n */\n\nvar RemoteSaveAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(RemoteSaveAdaptor, _super);\n  /**\r\n   * @hidden\r\n   */\n\n\n  function RemoteSaveAdaptor() {\n    var _this = _super.call(this) || this;\n\n    setValue('beforeSend', UrlAdaptor.prototype.beforeSend, _this);\n    return _this;\n  }\n\n  RemoteSaveAdaptor.prototype.insert = function (dm, data, tableName, query, position) {\n    this.pvt.position = position;\n    this.updateType = 'add';\n    return {\n      url: dm.dataSource.insertUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n      data: JSON.stringify(extend({}, {\n        value: data,\n        table: tableName,\n        action: 'insert'\n      }, DataUtil.getAddParams(this, dm, query)))\n    };\n  };\n\n  RemoteSaveAdaptor.prototype.remove = function (dm, keyField, val, tableName, query) {\n    _super.prototype.remove.call(this, dm, keyField, val);\n\n    return {\n      type: 'POST',\n      url: dm.dataSource.removeUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n      data: JSON.stringify(extend({}, {\n        key: val,\n        keyColumn: keyField,\n        table: tableName,\n        action: 'remove'\n      }, DataUtil.getAddParams(this, dm, query)))\n    };\n  };\n\n  RemoteSaveAdaptor.prototype.update = function (dm, keyField, val, tableName, query) {\n    this.updateType = 'update';\n    this.updateKey = keyField;\n    return {\n      type: 'POST',\n      url: dm.dataSource.updateUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n      data: JSON.stringify(extend({}, {\n        value: val,\n        action: 'update',\n        keyColumn: keyField,\n        key: val[keyField],\n        table: tableName\n      }, DataUtil.getAddParams(this, dm, query)))\n    };\n  };\n\n  RemoteSaveAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes, e) {\n    var i;\n    var newData = request ? JSON.parse(request.data) : data;\n    data = newData.action === 'batch' ? DataUtil.parse.parseJson(data) : data;\n\n    if (this.updateType === 'add') {\n      _super.prototype.insert.call(this, ds, data, null, null, this.pvt.position);\n    }\n\n    if (this.updateType === 'update') {\n      _super.prototype.update.call(this, ds, this.updateKey, data);\n    }\n\n    this.updateType = undefined;\n\n    if (data.added) {\n      for (i = 0; i < data.added.length; i++) {\n        _super.prototype.insert.call(this, ds, data.added[i]);\n      }\n    }\n\n    if (data.changed) {\n      for (i = 0; i < data.changed.length; i++) {\n        _super.prototype.update.call(this, ds, e.key, data.changed[i]);\n      }\n    }\n\n    if (data.deleted) {\n      for (i = 0; i < data.deleted.length; i++) {\n        _super.prototype.remove.call(this, ds, e.key, data.deleted[i]);\n      }\n    }\n\n    return data;\n  };\n  /**\r\n   * Prepare the request body based on the newly added, removed and updated records.\r\n   * Also perform the changes in the locally cached data to sync with the remote data.\r\n   * The result is used by the batch request.\r\n   * @param  {DataManager} dm\r\n   * @param  {CrudOptions} changes\r\n   * @param  {RemoteArgs} e\r\n   */\n\n\n  RemoteSaveAdaptor.prototype.batchRequest = function (dm, changes, e, query, original) {\n    return {\n      type: 'POST',\n      url: dm.dataSource.batchUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n      contentType: 'application/json; charset=utf-8',\n      dataType: 'json',\n      data: JSON.stringify(extend({}, {\n        changed: changes.changedRecords,\n        added: changes.addedRecords,\n        deleted: changes.deletedRecords,\n        action: 'batch',\n        table: e.url,\n        key: e.key\n      }, DataUtil.getAddParams(this, dm, query)))\n    };\n  };\n\n  RemoteSaveAdaptor.prototype.addParams = function (options) {\n    var urlParams = new UrlAdaptor();\n    urlParams.addParams(options);\n  };\n\n  return RemoteSaveAdaptor;\n}(JsonAdaptor);\n\nexport { RemoteSaveAdaptor };\n/**\r\n * Ajax Adaptor that is extended from URL Adaptor, is used for handle data operations with user defined functions.\r\n * @hidden\r\n */\n\nvar CustomDataAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(CustomDataAdaptor, _super);\n\n  function CustomDataAdaptor(props) {\n    var _this = _super.call(this) || this; // options replaced the default adaptor options\n\n\n    _this.options = extend({}, _this.options, {\n      getData: new Function(),\n      addRecord: new Function(),\n      updateRecord: new Function(),\n      deleteRecord: new Function(),\n      batchUpdate: new Function()\n    });\n    extend(_this.options, props || {});\n    return _this;\n  }\n\n  CustomDataAdaptor.prototype.getModuleName = function () {\n    return 'CustomDataAdaptor';\n  };\n\n  return CustomDataAdaptor;\n}(UrlAdaptor);\n\nexport { CustomDataAdaptor };\n/**\r\n * The GraphqlAdaptor that is extended from URL Adaptor, is used for retrieving data from the Graphql server.\r\n * It interacts with the Graphql server with all the DataManager Queries and performs CRUD operations.\r\n * @hidden\r\n */\n\nvar GraphQLAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(GraphQLAdaptor, _super);\n\n  function GraphQLAdaptor(options) {\n    var _this = _super.call(this) || this;\n\n    _this.opt = options;\n    _this.schema = _this.opt.response;\n    _this.query = _this.opt.query;\n    _this.getVariables = _this.opt.getVariables ? _this.opt.getVariables : function () {};\n\n    _this.getQuery = function () {\n      return _this.query;\n    };\n\n    return _this;\n  }\n\n  GraphQLAdaptor.prototype.getModuleName = function () {\n    return 'GraphQLAdaptor';\n  };\n  /**\r\n   * Process the JSON data based on the provided queries.\r\n   * @param  {DataManager} dm\r\n   * @param  {Query} query?\r\n   */\n\n\n  GraphQLAdaptor.prototype.processQuery = function (datamanager, query) {\n    var urlQuery = _super.prototype.processQuery.apply(this, arguments);\n\n    var dm = JSON.parse(urlQuery.data); // constructing GraphQL parameters\n\n    var keys = ['skip', 'take', 'sorted', 'table', 'select', 'where', 'search', 'requiresCounts', 'aggregates', 'params'];\n    var temp = {};\n    var str = 'searchwhereparams';\n    keys.filter(function (e) {\n      temp[e] = str.indexOf(e) > -1 ? JSON.stringify(dm[e]) : dm[e];\n    });\n    var vars = this.getVariables() || {};\n    vars['datamanager'] = temp;\n    var data = JSON.stringify({\n      query: this.getQuery(),\n      variables: vars\n    });\n    urlQuery.data = data;\n    return urlQuery;\n  };\n  /**\r\n   * Returns the data from the query processing.\r\n   * It will also cache the data for later usage.\r\n   * @param  {DataResult} data\r\n   * @param  {DataManager} ds?\r\n   * @param  {Query} query?\r\n   * @param  {XMLHttpRequest} xhr?\r\n   * @param  {Object} request?\r\n   * @returns DataResult\r\n   */\n\n\n  GraphQLAdaptor.prototype.processResponse = function (resData, ds, query, xhr, request) {\n    var res = resData;\n    var count;\n    var aggregates;\n    var result = getValue(this.schema.result, res.data);\n\n    if (this.schema.count) {\n      count = getValue(this.schema.count, res.data);\n    }\n\n    if (this.schema.aggregates) {\n      aggregates = getValue(this.schema.aggregates, res.data);\n      aggregates = !isNullOrUndefined(aggregates) ? DataUtil.parse.parseJson(aggregates) : aggregates;\n    }\n\n    var pvt = request.pvtData || {};\n    var args = {\n      result: result,\n      aggregates: aggregates\n    };\n    var data = args;\n\n    if (pvt && pvt.groups && pvt.groups.length) {\n      this.getAggregateResult(pvt, data, args, null, query);\n    }\n\n    return !isNullOrUndefined(count) ? {\n      result: args.result,\n      count: count,\n      aggregates: aggregates\n    } : args.result;\n  };\n  /**\r\n   * Prepare and returns request body which is used to insert a new record in the table.\r\n   */\n\n\n  GraphQLAdaptor.prototype.insert = function () {\n    var inserted = _super.prototype.insert.apply(this, arguments);\n\n    return this.generateCrudData(inserted, 'insert');\n  };\n  /**\r\n   * Prepare and returns request body which is used to update a new record in the table.\r\n   */\n\n\n  GraphQLAdaptor.prototype.update = function () {\n    var inserted = _super.prototype.update.apply(this, arguments);\n\n    return this.generateCrudData(inserted, 'update');\n  };\n  /**\r\n   * Prepare and returns request body which is used to remove a new record in the table.\r\n   */\n\n\n  GraphQLAdaptor.prototype.remove = function () {\n    var inserted = _super.prototype.remove.apply(this, arguments);\n\n    return this.generateCrudData(inserted, 'remove');\n  };\n  /**\r\n   * Prepare the request body based on the newly added, removed and updated records.\r\n   * The result is used by the batch request.\r\n   * @param  {DataManager} dm\r\n   * @param  {CrudOptions} changes\r\n   * @param  {Object} e\r\n   * @param  {Query} query\r\n   * @param  {Object} original\r\n   */\n\n\n  GraphQLAdaptor.prototype.batchRequest = function (dm, changes, e, query, original) {\n    var batch = _super.prototype.batchRequest.apply(this, arguments);\n\n    var bData = JSON.parse(batch.data);\n    bData.key = e.key;\n    batch.data = JSON.stringify(bData);\n    return this.generateCrudData(batch, 'batch');\n  };\n\n  GraphQLAdaptor.prototype.generateCrudData = function (crudData, action) {\n    var parsed = JSON.parse(crudData.data);\n    crudData.data = JSON.stringify({\n      query: this.opt.getMutation(action),\n      variables: parsed\n    });\n    return crudData;\n  };\n\n  return GraphQLAdaptor;\n}(UrlAdaptor);\n\nexport { GraphQLAdaptor };\n/**\r\n * Cache Adaptor is used to cache the data of the visited pages. It prevents new requests for the previously visited pages.\r\n * You can configure cache page size and duration of caching by using cachingPageSize and timeTillExpiration properties of the DataManager\r\n * @hidden\r\n */\n\nvar CacheAdaptor =\n/** @class */\nfunction (_super) {\n  __extends(CacheAdaptor, _super);\n  /**\r\n   * Constructor for CacheAdaptor class.\r\n   * @param  {CacheAdaptor} adaptor?\r\n   * @param  {number} timeStamp?\r\n   * @param  {number} pageSize?\r\n   * @hidden\r\n   */\n\n\n  function CacheAdaptor(adaptor, timeStamp, pageSize) {\n    var _this = _super.call(this) || this;\n\n    _this.isCrudAction = false;\n    _this.isInsertAction = false;\n\n    if (!isNullOrUndefined(adaptor)) {\n      _this.cacheAdaptor = adaptor;\n    }\n\n    _this.pageSize = pageSize;\n    _this.guidId = DataUtil.getGuid('cacheAdaptor');\n    var obj = {\n      keys: [],\n      results: []\n    };\n    window.localStorage.setItem(_this.guidId, JSON.stringify(obj));\n    var guid = _this.guidId;\n\n    if (!isNullOrUndefined(timeStamp)) {\n      setInterval(function () {\n        var data;\n        data = DataUtil.parse.parseJson(window.localStorage.getItem(guid));\n        var forDel = [];\n\n        for (var i = 0; i < data.results.length; i++) {\n          var currentTime = +new Date();\n          var requestTime = +new Date(data.results[i].timeStamp);\n          data.results[i].timeStamp = currentTime - requestTime;\n\n          if (currentTime - requestTime > timeStamp) {\n            forDel.push(i);\n          }\n        }\n\n        for (var i = 0; i < forDel.length; i++) {\n          data.results.splice(forDel[i], 1);\n          data.keys.splice(forDel[i], 1);\n        }\n\n        window.localStorage.removeItem(guid);\n        window.localStorage.setItem(guid, JSON.stringify(data));\n      }, timeStamp);\n    }\n\n    return _this;\n  }\n  /**\r\n   * It will generate the key based on the URL when we send a request to server.\r\n   * @param  {string} url\r\n   * @param  {Query} query?\r\n   * @hidden\r\n   */\n\n\n  CacheAdaptor.prototype.generateKey = function (url, query) {\n    var queries = this.getQueryRequest(query);\n    var singles = Query.filterQueryLists(query.queries, ['onSelect', 'onPage', 'onSkip', 'onTake', 'onRange']);\n    var key = url;\n    var page = 'onPage';\n\n    if (page in singles) {\n      key += singles[page].pageIndex;\n    }\n\n    queries.sorts.forEach(function (obj) {\n      key += obj.e.direction + obj.e.fieldName;\n    });\n    queries.groups.forEach(function (obj) {\n      key += obj.e.fieldName;\n    });\n    queries.searches.forEach(function (obj) {\n      key += obj.e.searchKey;\n    });\n\n    for (var filter = 0; filter < queries.filters.length; filter++) {\n      var currentFilter = queries.filters[filter];\n\n      if (currentFilter.e.isComplex) {\n        var newQuery = query.clone();\n        newQuery.queries = [];\n\n        for (var i = 0; i < currentFilter.e.predicates.length; i++) {\n          newQuery.queries.push({\n            fn: 'onWhere',\n            e: currentFilter.e.predicates[i],\n            filter: query.queries.filter\n          });\n        }\n\n        key += currentFilter.e.condition + this.generateKey(url, newQuery);\n      } else {\n        key += currentFilter.e.field + currentFilter.e.operator + currentFilter.e.value;\n      }\n    }\n\n    return key;\n  };\n  /**\r\n   * Process the query to generate request body.\r\n   * If the data is already cached, it will return the cached data.\r\n   * @param  {DataManager} dm\r\n   * @param  {Query} query?\r\n   * @param  {Object[]} hierarchyFilters?\r\n   */\n\n\n  CacheAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\n    var key = this.generateKey(dm.dataSource.url, query);\n    var cachedItems;\n    cachedItems = DataUtil.parse.parseJson(window.localStorage.getItem(this.guidId));\n    var data = cachedItems ? cachedItems.results[cachedItems.keys.indexOf(key)] : null;\n\n    if (data != null && !this.isCrudAction && !this.isInsertAction) {\n      return data;\n    }\n\n    this.isCrudAction = null;\n    this.isInsertAction = null;\n    return this.cacheAdaptor.processQuery.apply(this.cacheAdaptor, [].slice.call(arguments, 0));\n  };\n  /**\r\n   * Returns the data from the query processing.\r\n   * It will also cache the data for later usage.\r\n   * @param  {DataResult} data\r\n   * @param  {DataManager} ds?\r\n   * @param  {Query} query?\r\n   * @param  {XMLHttpRequest} xhr?\r\n   * @param  {Ajax} request?\r\n   * @param  {CrudOptions} changes?\r\n   */\n\n\n  CacheAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n    if (this.isInsertAction || request && this.cacheAdaptor.options.batch && DataUtil.endsWith(request.url, this.cacheAdaptor.options.batch) && request.type.toLowerCase() === 'post') {\n      return this.cacheAdaptor.processResponse(data, ds, query, xhr, request, changes);\n    }\n\n    data = this.cacheAdaptor.processResponse.apply(this.cacheAdaptor, [].slice.call(arguments, 0));\n    var key = query ? this.generateKey(ds.dataSource.url, query) : ds.dataSource.url;\n    var obj = {};\n    obj = DataUtil.parse.parseJson(window.localStorage.getItem(this.guidId));\n    var index = obj.keys.indexOf(key);\n\n    if (index !== -1) {\n      obj.results.splice(index, 1);\n      obj.keys.splice(index, 1);\n    }\n\n    obj.results[obj.keys.push(key) - 1] = {\n      keys: key,\n      result: data.result,\n      timeStamp: new Date(),\n      count: data.count\n    };\n\n    while (obj.results.length > this.pageSize) {\n      obj.results.splice(0, 1);\n      obj.keys.splice(0, 1);\n    }\n\n    window.localStorage.setItem(this.guidId, JSON.stringify(obj));\n    return data;\n  };\n  /**\r\n   * Method will trigger before send the request to server side. Used to set the custom header or modify the request options.\r\n   * @param  {DataManager} dm\r\n   * @param  {XMLHttpRequest} request\r\n   * @param  {Ajax} settings?\r\n   */\n\n\n  CacheAdaptor.prototype.beforeSend = function (dm, request, settings) {\n    if (!isNullOrUndefined(this.cacheAdaptor.options.batch) && DataUtil.endsWith(settings.url, this.cacheAdaptor.options.batch) && settings.type.toLowerCase() === 'post') {\n      request.setRequestHeader('Accept', this.cacheAdaptor.options.multipartAccept);\n    }\n\n    if (!dm.dataSource.crossDomain) {\n      request.setRequestHeader('Accept', this.cacheAdaptor.options.accept);\n    }\n  };\n  /**\r\n   * Updates existing record and saves the changes to the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {Object} value\r\n   * @param  {string} tableName\r\n   */\n\n\n  CacheAdaptor.prototype.update = function (dm, keyField, value, tableName) {\n    this.isCrudAction = true;\n    return this.cacheAdaptor.update(dm, keyField, value, tableName);\n  };\n  /**\r\n   * Prepare and returns request body which is used to insert a new record in the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {Object} data\r\n   * @param  {string} tableName?\r\n   */\n\n\n  CacheAdaptor.prototype.insert = function (dm, data, tableName) {\n    this.isInsertAction = true;\n    return this.cacheAdaptor.insert(dm, data, tableName);\n  };\n  /**\r\n   * Prepare and return request body which is used to remove record from the table.\r\n   * @param  {DataManager} dm\r\n   * @param  {string} keyField\r\n   * @param  {Object} value\r\n   * @param  {string} tableName?\r\n   */\n\n\n  CacheAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n    this.isCrudAction = true;\n    return this.cacheAdaptor.remove(dm, keyField, value, tableName);\n  };\n  /**\r\n   * Prepare the request body based on the newly added, removed and updated records.\r\n   * The result is used by the batch request.\r\n   * @param  {DataManager} dm\r\n   * @param  {CrudOptions} changes\r\n   * @param  {RemoteArgs} e\r\n   */\n\n\n  CacheAdaptor.prototype.batchRequest = function (dm, changes, e) {\n    return this.cacheAdaptor.batchRequest(dm, changes, e);\n  };\n\n  return CacheAdaptor;\n}(UrlAdaptor);\n\nexport { CacheAdaptor };","map":{"version":3,"sources":["C:/Users/x/Desktop/openDSA/openDSA_dashboard/project/node_modules/@syncfusion/ej2-react-charts/node_modules/@syncfusion/ej2-data/src/adaptors.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","merge","extend","isNullOrUndefined","setValue","getValue","DataUtil","Query","Predicate","consts","GroupGuid","Adaptor","ds","options","from","requestType","sortBy","select","skip","group","take","search","count","where","aggregates","expand","type","dataSource","pvt","processResponse","data","query","xhr","JsonAdaptor","_super","apply","arguments","processQuery","dataManager","result","json","slice","length","countFlg","ret","key","lazyLoad","keyCount","page","i","value","agg","queries","fn","push","e","call","field","undefined","args","lazyLoadData","lazyLoadGroup","isCountRequired","getAggregate","onDemandGroupInfo","req","onWhere","level","fieldName","comparer","formGroupResult","onPage","uid","childLevel","records","aggQuery","filterQueries","tmp","batchRequest","dm","changes","deletedRecordsLen","deletedRecords","addedRecords","insert","changedRecords","update","remove","filter","obj","validate","onAggregates","onSearch","fieldNames","getFieldList","j","getObject","searchKey","ignoreCase","ignoreAccent","onSortBy","fnCompare","sort","endsWith","fnSort","replace","onGroup","size","pageSize","start","pageIndex","end","onRange","onTake","nos","onSkip","onSelect","tableName","position","splice","keyField","Date","UrlAdaptor","hierarchyFilters","getQueryRequest","singles","filterQueryLists","params","url","temp","request","sorts","groups","filters","searches","callAdaptorFunction","name","direction","getFiltersFrom","toJson","res","getModuleName","keys_3","keys","_i","keys_1","prop","isNull","fields","operator","getRequestQuery","reqParams","_a","keys_2","JSON","stringify","parse","jsonDateReplacer","pvtData","contentType","convertToQueryString","indexOf","request1","param","fromTable","distincts","selects","expands","getResponseHeader","handleTimeZone","timeZoneHandling","parseJson","requests","groupDs","action","isExpand","isArray","val","formRemoteGroupedData","getAggregateResult","items","childLvl","lvl","getGroupedRecords","hasRecords","childGroupedRecords","concat","original","batchUrl","crudUrl","removeUrl","dataType","changed","added","deleted","table","getAddParams","beforeSend","insertUrl","keyColumn","updateUrl","fKey","pKey","predicats","or","pData","aggregateData","aggregate","isServerGrouping","groupQuery","addParams","Error","ODataAdaptor","props","_this","accept","multipartAccept","batch","changeSet","batchPre","contentId","batchContent","changeSetContent","batchChangeSetContentType","updateType","onPredicate","predicate","requiresCast","returnValue","guid","getField","replacer","encodeURIComponent","isGuid","toLowerCase","odBiOperator","odv4UniOperator","odUniOperator","onComplexPredicate","predicates","onEachWhere","join","condition","isComplex","onEachSearch","throwError","onEachSort","reverse","onCount","settings","setRequestHeader","overrideMimeType","metaCheck","rootUrl","dataUrls","split","resourceTableName","dataCopy","results","metaData","emptyAndBatch","processBatchResponse","versionCheck","version","parseInt","oDataCount","format","requiresFormat","keys_4","localTimeReplacer","convertObj","dateParse","toLocalTime","localTime","compareAndRemove","initialGuid","getGuid","cid","cSet","generateInsertRequest","generateUpdateRequest","generateDeleteRequest","arr","stat","dateTime","toJSON","generateBodyContent","org","forEach","change","o","date","method","cIdx","jsonObj","substring","exVal","exec","changeGuid","test","isPlainObject","final","valueOf","ODataV4Adaptor","isDate","onExpand","selected","expanded","exArr","item","splits","sel","exp","close_1","combineVal","ex","onDistinct","distinctFields","map","metaName","dataUrl","dataCount","WebApiAdaptor","_loop_1","x","location","host","_loop_2","_loop_3","state","datTime","Count","Items","WebMethodAdaptor","getData","RemoteSaveAdaptor","updateKey","newData","urlParams","CustomDataAdaptor","Function","addRecord","updateRecord","deleteRecord","batchUpdate","GraphQLAdaptor","opt","schema","response","getVariables","getQuery","datamanager","urlQuery","str","vars","variables","resData","inserted","generateCrudData","bData","crudData","parsed","getMutation","CacheAdaptor","adaptor","timeStamp","isCrudAction","isInsertAction","cacheAdaptor","guidId","window","localStorage","setItem","setInterval","getItem","forDel","currentTime","requestTime","removeItem","generateKey","currentFilter","newQuery","clone","cachedItems","index","crossDomain"],"mappings":"AAAA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIA,CAAC,CAACM,cAAF,CAAiBD,CAAjB,CAAJ,EAAyBN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAF9E;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASO,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBT,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACU,SAAF,GAAcT,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACS,MAAP,CAAcV,CAAd,CAAb,IAAiCO,EAAE,CAACE,SAAH,GAAeT,CAAC,CAACS,SAAjB,EAA4B,IAAIF,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaA,SAASI,KAAT,EAAgBC,MAAhB,EAAwBC,iBAAxB,EAA2CC,QAA3C,EAAqDC,QAArD,QAAqE,sBAArE;AACA,SAASC,QAAT,QAAyB,QAAzB;AACA,SAASC,KAAT,EAAgBC,SAAhB,QAAiC,SAAjC;AACA,IAAIC,MAAM,GAAG;AAAEC,EAAAA,SAAS,EAAE;AAAb,CAAb;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIC,OAAO;AAAG;AAAe,YAAY;AACrC;AACJ;AACA;AACA;AACA;AACA;AACI,WAASA,OAAT,CAAiBC,EAAjB,EAAqB;AACjB;AACA,SAAKC,OAAL,GAAe;AACXC,MAAAA,IAAI,EAAE,OADK;AAEXC,MAAAA,WAAW,EAAE,MAFF;AAGXC,MAAAA,MAAM,EAAE,QAHG;AAIXC,MAAAA,MAAM,EAAE,QAJG;AAKXC,MAAAA,IAAI,EAAE,MALK;AAMXC,MAAAA,KAAK,EAAE,OANI;AAOXC,MAAAA,IAAI,EAAE,MAPK;AAQXC,MAAAA,MAAM,EAAE,QARG;AASXC,MAAAA,KAAK,EAAE,gBATI;AAUXC,MAAAA,KAAK,EAAE,OAVI;AAWXC,MAAAA,UAAU,EAAE,YAXD;AAYXC,MAAAA,MAAM,EAAE;AAZG,KAAf;AAcA;AACR;AACA;AACA;;AACQ,SAAKC,IAAL,GAAYf,OAAZ;AACA,SAAKgB,UAAL,GAAkBf,EAAlB;AACA,SAAKgB,GAAL,GAAW,EAAX;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIjB,EAAAA,OAAO,CAACZ,SAAR,CAAkB8B,eAAlB,GAAoC,UAAUC,IAAV,EAAgBlB,EAAhB,EAAoBmB,KAApB,EAA2BC,GAA3B,EAAgC;AAChE,WAAOF,IAAP;AACH,GAFD;;AAGA,SAAOnB,OAAP;AACH,CA3C4B,EAA7B;;AA4CA,SAASA,OAAT;AACA;AACA;AACA;AACA;;AACA,IAAIsB,WAAW;AAAG;AAAe,UAAUC,MAAV,EAAkB;AAC/C/C,EAAAA,SAAS,CAAC8C,WAAD,EAAcC,MAAd,CAAT;;AACA,WAASD,WAAT,GAAuB;AACnB,WAAOC,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACC,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAA3D;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;;;AACIH,EAAAA,WAAW,CAAClC,SAAZ,CAAsBsC,YAAtB,GAAqC,UAAUC,WAAV,EAAuBP,KAAvB,EAA8B;AAC/D,QAAIQ,MAAM,GAAGD,WAAW,CAACX,UAAZ,CAAuBa,IAAvB,CAA4BC,KAA5B,CAAkC,CAAlC,CAAb;AACA,QAAInB,KAAK,GAAGiB,MAAM,CAACG,MAAnB;AACA,QAAIC,QAAQ,GAAG,IAAf;AACA,QAAIC,GAAJ;AACA,QAAIC,GAAJ;AACA,QAAIC,QAAQ,GAAG,EAAf;AACA,QAAIC,QAAQ,GAAG,CAAf;AACA,QAAI5B,KAAK,GAAG,EAAZ;AACA,QAAI6B,IAAJ;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlB,KAAK,CAACe,QAAN,CAAeJ,MAAnC,EAA2CO,CAAC,EAA5C,EAAgD;AAC5CF,MAAAA,QAAQ;AACRD,MAAAA,QAAQ,CAACf,KAAK,CAACe,QAAN,CAAeG,CAAf,EAAkBJ,GAAnB,CAAR,GAAkCd,KAAK,CAACe,QAAN,CAAeG,CAAf,EAAkBC,KAApD;AACH;;AACD,QAAIC,GAAG,GAAG,EAAV;;AACA,SAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlB,KAAK,CAACqB,OAAN,CAAcV,MAAlC,EAA0CO,CAAC,EAA3C,EAA+C;AAC3CJ,MAAAA,GAAG,GAAGd,KAAK,CAACqB,OAAN,CAAcH,CAAd,CAAN;;AACA,UAAI,CAACJ,GAAG,CAACQ,EAAJ,KAAW,QAAX,IAAuBR,GAAG,CAACQ,EAAJ,KAAW,SAAnC,KAAiDtB,KAAK,CAACe,QAAN,CAAeJ,MAApE,EAA4E;AACxE,YAAIG,GAAG,CAACQ,EAAJ,KAAW,SAAf,EAA0B;AACtBlC,UAAAA,KAAK,CAACmC,IAAN,CAAWT,GAAG,CAACU,CAAf;AACH;;AACD,YAAIV,GAAG,CAACQ,EAAJ,KAAW,QAAf,EAAyB;AACrBL,UAAAA,IAAI,GAAGH,GAAG,CAACU,CAAX;AACH;;AACD;AACH;;AACDX,MAAAA,GAAG,GAAG,KAAKC,GAAG,CAACQ,EAAT,EAAaG,IAAb,CAAkB,IAAlB,EAAwBjB,MAAxB,EAAgCM,GAAG,CAACU,CAApC,EAAuCxB,KAAvC,CAAN;;AACA,UAAIc,GAAG,CAACQ,EAAJ,KAAW,cAAf,EAA+B;AAC3BF,QAAAA,GAAG,CAACN,GAAG,CAACU,CAAJ,CAAME,KAAN,GAAc,KAAd,GAAsBZ,GAAG,CAACU,CAAJ,CAAM7B,IAA7B,CAAH,GAAwCkB,GAAxC;AACH,OAFD,MAGK;AACDL,QAAAA,MAAM,GAAGK,GAAG,KAAKc,SAAR,GAAoBd,GAApB,GAA0BL,MAAnC;AACH;;AACD,UAAIM,GAAG,CAACQ,EAAJ,KAAW,QAAX,IAAuBR,GAAG,CAACQ,EAAJ,KAAW,QAAlC,IAA8CR,GAAG,CAACQ,EAAJ,KAAW,QAAzD,IAAqER,GAAG,CAACQ,EAAJ,KAAW,SAApF,EAA+F;AAC3FV,QAAAA,QAAQ,GAAG,KAAX;AACH;;AACD,UAAIA,QAAJ,EAAc;AACVrB,QAAAA,KAAK,GAAGiB,MAAM,CAACG,MAAf;AACH;AACJ;;AACD,QAAIK,QAAJ,EAAc;AACV,UAAIY,IAAI,GAAG;AACP5B,QAAAA,KAAK,EAAEA,KADA;AACOe,QAAAA,QAAQ,EAAEA,QADjB;AAC2BP,QAAAA,MAAM,EAAEA,MADnC;AAC2CpB,QAAAA,KAAK,EAAEA,KADlD;AACyD6B,QAAAA,IAAI,EAAEA;AAD/D,OAAX;AAGA,UAAIY,YAAY,GAAG,KAAKC,aAAL,CAAmBF,IAAnB,CAAnB;AACApB,MAAAA,MAAM,GAAGqB,YAAY,CAACrB,MAAtB;AACAjB,MAAAA,KAAK,GAAGsC,YAAY,CAACtC,KAArB;AACH;;AACD,QAAIS,KAAK,CAAC+B,eAAV,EAA2B;AACvBvB,MAAAA,MAAM,GAAG;AACLA,QAAAA,MAAM,EAAEA,MADH;AAELjB,QAAAA,KAAK,EAAEA,KAFF;AAGLE,QAAAA,UAAU,EAAE2B;AAHP,OAAT;AAKH;;AACD,WAAOZ,MAAP;AACH,GAxDD;AAyDA;AACJ;AACA;AACA;;;AACIN,EAAAA,WAAW,CAAClC,SAAZ,CAAsB8D,aAAtB,GAAsC,UAAUF,IAAV,EAAgB;AAClD,QAAIrC,KAAK,GAAG,CAAZ;AACA,QAAI6B,GAAG,GAAG,KAAKY,YAAL,CAAkBJ,IAAI,CAAC5B,KAAvB,CAAV;AACA,QAAIQ,MAAM,GAAGoB,IAAI,CAACpB,MAAlB;;AACA,QAAI,CAACpC,iBAAiB,CAACwD,IAAI,CAACb,QAAL,CAAckB,iBAAf,CAAtB,EAAyD;AACrD,UAAIC,GAAG,GAAGN,IAAI,CAACb,QAAL,CAAckB,iBAAxB;;AACA,WAAK,IAAIf,CAAC,GAAGgB,GAAG,CAAC1C,KAAJ,CAAUmB,MAAV,GAAmB,CAAhC,EAAmCO,CAAC,IAAI,CAAxC,EAA2CA,CAAC,EAA5C,EAAgD;AAC5CV,QAAAA,MAAM,GAAG,KAAK2B,OAAL,CAAa3B,MAAb,EAAqB0B,GAAG,CAAC1C,KAAJ,CAAU0B,CAAV,CAArB,CAAT;AACH;;AACD,UAAIU,IAAI,CAACxC,KAAL,CAAWuB,MAAX,KAAsBuB,GAAG,CAACE,KAA9B,EAAqC;AACjC,YAAIV,KAAK,GAAGE,IAAI,CAACxC,KAAL,CAAW8C,GAAG,CAACE,KAAf,EAAsBC,SAAlC;AACA7B,QAAAA,MAAM,GAAGjC,QAAQ,CAACa,KAAT,CAAeoB,MAAf,EAAuBkB,KAAvB,EAA8BN,GAA9B,EAAmC,IAAnC,EAAyC,IAAzC,EAA+CQ,IAAI,CAACxC,KAAL,CAAW,CAAX,EAAckD,QAA7D,EAAuE,IAAvE,CAAT;AACH;;AACD/C,MAAAA,KAAK,GAAGiB,MAAM,CAACG,MAAf;AACA,UAAIZ,IAAI,GAAGS,MAAX;AACAA,MAAAA,MAAM,GAAGA,MAAM,CAACE,KAAP,CAAawB,GAAG,CAAC/C,IAAjB,CAAT;AACAqB,MAAAA,MAAM,GAAGA,MAAM,CAACE,KAAP,CAAa,CAAb,EAAgBwB,GAAG,CAAC7C,IAApB,CAAT;;AACA,UAAIuC,IAAI,CAACxC,KAAL,CAAWuB,MAAX,KAAsBuB,GAAG,CAACE,KAA9B,EAAqC;AACjC,aAAKG,eAAL,CAAqB/B,MAArB,EAA6BT,IAA7B;AACH;AACJ,KAhBD,MAiBK;AACD,UAAI2B,KAAK,GAAGE,IAAI,CAACxC,KAAL,CAAW,CAAX,EAAciD,SAA1B;AACA7B,MAAAA,MAAM,GAAGjC,QAAQ,CAACa,KAAT,CAAeoB,MAAf,EAAuBkB,KAAvB,EAA8BN,GAA9B,EAAmC,IAAnC,EAAyC,IAAzC,EAA+CQ,IAAI,CAACxC,KAAL,CAAW,CAAX,EAAckD,QAA7D,EAAuE,IAAvE,CAAT;AACA/C,MAAAA,KAAK,GAAGiB,MAAM,CAACG,MAAf;AACA,UAAIZ,IAAI,GAAGS,MAAX;;AACA,UAAIoB,IAAI,CAACX,IAAT,EAAe;AACXT,QAAAA,MAAM,GAAG,KAAKgC,MAAL,CAAYhC,MAAZ,EAAoBoB,IAAI,CAACX,IAAzB,EAA+BW,IAAI,CAAC5B,KAApC,CAAT;AACH;;AACD,WAAKuC,eAAL,CAAqB/B,MAArB,EAA6BT,IAA7B;AACH;;AACD,WAAO;AAAES,MAAAA,MAAM,EAAEA,MAAV;AAAkBjB,MAAAA,KAAK,EAAEA;AAAzB,KAAP;AACH,GAhCD;;AAiCAW,EAAAA,WAAW,CAAClC,SAAZ,CAAsBuE,eAAtB,GAAwC,UAAU/B,MAAV,EAAkBT,IAAlB,EAAwB;AAC5D,QAAIS,MAAM,CAACG,MAAP,IAAiBZ,IAAI,CAACY,MAA1B,EAAkC;AAC9B,UAAI8B,GAAG,GAAG,WAAV;AACA,UAAIC,UAAU,GAAG,aAAjB;AACA,UAAIN,KAAK,GAAG,OAAZ;AACA,UAAIO,OAAO,GAAG,SAAd;AACAnC,MAAAA,MAAM,CAACiC,GAAD,CAAN,GAAc1C,IAAI,CAAC0C,GAAD,CAAlB;AACAjC,MAAAA,MAAM,CAACkC,UAAD,CAAN,GAAqB3C,IAAI,CAAC2C,UAAD,CAAzB;AACAlC,MAAAA,MAAM,CAAC4B,KAAD,CAAN,GAAgBrC,IAAI,CAACqC,KAAD,CAApB;AACA5B,MAAAA,MAAM,CAACmC,OAAD,CAAN,GAAkB5C,IAAI,CAAC4C,OAAD,CAAtB;AACH;;AACD,WAAOnC,MAAP;AACH,GAZD;AAaA;AACJ;AACA;AACA;;;AACIN,EAAAA,WAAW,CAAClC,SAAZ,CAAsBgE,YAAtB,GAAqC,UAAUhC,KAAV,EAAiB;AAClD,QAAI4C,QAAQ,GAAGpE,KAAK,CAACqE,aAAN,CAAoB7C,KAAK,CAACqB,OAA1B,EAAmC,cAAnC,CAAf;AACA,QAAID,GAAG,GAAG,EAAV;;AACA,QAAIwB,QAAQ,CAACjC,MAAb,EAAqB;AACjB,UAAImC,GAAG,GAAG,KAAK,CAAf;;AACA,WAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG0B,QAAQ,CAACjC,MAA7B,EAAqCO,CAAC,EAAtC,EAA0C;AACtC4B,QAAAA,GAAG,GAAGF,QAAQ,CAAC1B,CAAD,CAAR,CAAYM,CAAlB;AACAJ,QAAAA,GAAG,CAACG,IAAJ,CAAS;AAAE5B,UAAAA,IAAI,EAAEmD,GAAG,CAACnD,IAAZ;AAAkB+B,UAAAA,KAAK,EAAEnD,QAAQ,CAACD,QAAT,CAAkBwE,GAAG,CAACpB,KAAtB,EAA6B1B,KAA7B;AAAzB,SAAT;AACH;AACJ;;AACD,WAAOoB,GAAP;AACH,GAXD;AAYA;AACJ;AACA;AACA;AACA;AACA;;;AACIlB,EAAAA,WAAW,CAAClC,SAAZ,CAAsB+E,YAAtB,GAAqC,UAAUC,EAAV,EAAcC,OAAd,EAAuBzB,CAAvB,EAA0B;AAC3D,QAAIN,CAAJ;AACA,QAAIgC,iBAAiB,GAAGD,OAAO,CAACE,cAAR,CAAuBxC,MAA/C;;AACA,SAAKO,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG+B,OAAO,CAACG,YAAR,CAAqBzC,MAArC,EAA6CO,CAAC,EAA9C,EAAkD;AAC9C,WAAKmC,MAAL,CAAYL,EAAZ,EAAgBC,OAAO,CAACG,YAAR,CAAqBlC,CAArB,CAAhB;AACH;;AACD,SAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG+B,OAAO,CAACK,cAAR,CAAuB3C,MAAvC,EAA+CO,CAAC,EAAhD,EAAoD;AAChD,WAAKqC,MAAL,CAAYP,EAAZ,EAAgBxB,CAAC,CAACV,GAAlB,EAAuBmC,OAAO,CAACK,cAAR,CAAuBpC,CAAvB,CAAvB;AACH;;AACD,SAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGgC,iBAAhB,EAAmChC,CAAC,EAApC,EAAwC;AACpC,WAAKsC,MAAL,CAAYR,EAAZ,EAAgBxB,CAAC,CAACV,GAAlB,EAAuBmC,OAAO,CAACE,cAAR,CAAuBjC,CAAvB,CAAvB;AACH;;AACD,WAAO+B,OAAP;AACH,GAbD;AAcA;AACJ;AACA;AACA;AACA;;;AACI/C,EAAAA,WAAW,CAAClC,SAAZ,CAAsBmE,OAAtB,GAAgC,UAAUtD,EAAV,EAAc2C,CAAd,EAAiB;AAC7C,QAAI,CAAC3C,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,WAAOA,EAAE,CAAC4E,MAAH,CAAU,UAAUC,GAAV,EAAe;AAC5B,UAAIlC,CAAJ,EAAO;AACH,eAAOA,CAAC,CAACmC,QAAF,CAAWD,GAAX,CAAP;AACH;AACJ,KAJM,CAAP;AAKH,GATD;AAUA;AACJ;AACA;AACA;AACA;AACA;;;AACIxD,EAAAA,WAAW,CAAClC,SAAZ,CAAsB4F,YAAtB,GAAqC,UAAU/E,EAAV,EAAc2C,CAAd,EAAiB;AAClD,QAAIF,EAAE,GAAG/C,QAAQ,CAACkB,UAAT,CAAoB+B,CAAC,CAAC7B,IAAtB,CAAT;;AACA,QAAI,CAACd,EAAD,IAAO,CAACyC,EAAR,IAAczC,EAAE,CAAC8B,MAAH,KAAc,CAAhC,EAAmC;AAC/B,aAAO,IAAP;AACH;;AACD,WAAOW,EAAE,CAACzC,EAAD,EAAK2C,CAAC,CAACE,KAAP,CAAT;AACH,GAND;AAOA;AACJ;AACA;AACA;AACA;;;AACIxB,EAAAA,WAAW,CAAClC,SAAZ,CAAsB6F,QAAtB,GAAiC,UAAUhF,EAAV,EAAc2C,CAAd,EAAiB;AAC9C,QAAI,CAAC3C,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,QAAI2C,CAAC,CAACsC,UAAF,CAAanD,MAAb,KAAwB,CAA5B,EAA+B;AAC3BpC,MAAAA,QAAQ,CAACwF,YAAT,CAAsBlF,EAAE,CAAC,CAAD,CAAxB,EAA6B2C,CAAC,CAACsC,UAA/B;AACH;;AACD,WAAOjF,EAAE,CAAC4E,MAAH,CAAU,UAAUC,GAAV,EAAe;AAC5B,WAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGxC,CAAC,CAACsC,UAAF,CAAanD,MAAjC,EAAyCqD,CAAC,EAA1C,EAA8C;AAC1C,YAAIxC,CAAC,CAACc,QAAF,CAAWb,IAAX,CAAgBiC,GAAhB,EAAqBnF,QAAQ,CAAC0F,SAAT,CAAmBzC,CAAC,CAACsC,UAAF,CAAaE,CAAb,CAAnB,EAAoCN,GAApC,CAArB,EAA+DlC,CAAC,CAAC0C,SAAjE,EAA4E1C,CAAC,CAAC2C,UAA9E,EAA0F3C,CAAC,CAAC4C,YAA5F,CAAJ,EAA+G;AAC3G,iBAAO,IAAP;AACH;AACJ;;AACD,aAAO,KAAP;AACH,KAPM,CAAP;AAQH,GAfD;AAgBA;AACJ;AACA;AACA;AACA;AACA;;;AACIlE,EAAAA,WAAW,CAAClC,SAAZ,CAAsBqG,QAAtB,GAAiC,UAAUxF,EAAV,EAAc2C,CAAd,EAAiBxB,KAAjB,EAAwB;AACrD,QAAI,CAACnB,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,QAAIyF,SAAJ;AACA,QAAI5C,KAAK,GAAGnD,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAACa,SAApB,EAA+BrC,KAA/B,CAAZ;;AACA,QAAI,CAAC0B,KAAL,EAAY;AACR,aAAO7C,EAAE,CAAC0F,IAAH,CAAQ/C,CAAC,CAACc,QAAV,CAAP;AACH;;AACD,QAAIZ,KAAK,YAAY/D,KAArB,EAA4B;AACxB+D,MAAAA,KAAK,GAAGA,KAAK,CAAChB,KAAN,CAAY,CAAZ,CAAR;;AACA,WAAK,IAAIQ,CAAC,GAAGQ,KAAK,CAACf,MAAN,GAAe,CAA5B,EAA+BO,CAAC,IAAI,CAApC,EAAuCA,CAAC,EAAxC,EAA4C;AACxC,YAAI,CAACQ,KAAK,CAACR,CAAD,CAAV,EAAe;AACX;AACH;;AACDoD,QAAAA,SAAS,GAAG9C,CAAC,CAACc,QAAd;;AACA,YAAI/D,QAAQ,CAACiG,QAAT,CAAkB9C,KAAK,CAACR,CAAD,CAAvB,EAA4B,OAA5B,CAAJ,EAA0C;AACtCoD,UAAAA,SAAS,GAAG/F,QAAQ,CAACkG,MAAT,CAAgB,YAAhB,CAAZ;AACA/C,UAAAA,KAAK,CAACR,CAAD,CAAL,GAAWQ,KAAK,CAACR,CAAD,CAAL,CAASwD,OAAT,CAAiB,OAAjB,EAA0B,EAA1B,CAAX;AACH;;AACD7F,QAAAA,EAAE,GAAGN,QAAQ,CAACgG,IAAT,CAAc1F,EAAd,EAAkB6C,KAAK,CAACR,CAAD,CAAvB,EAA4BoD,SAA5B,CAAL;AACH;;AACD,aAAOzF,EAAP;AACH;;AACD,WAAON,QAAQ,CAACgG,IAAT,CAAc1F,EAAd,EAAkB6C,KAAlB,EAAyBF,CAAC,CAACc,QAA3B,CAAP;AACH,GAzBD;AA0BA;AACJ;AACA;AACA;AACA;AACA;;;AACIpC,EAAAA,WAAW,CAAClC,SAAZ,CAAsB2G,OAAtB,GAAgC,UAAU9F,EAAV,EAAc2C,CAAd,EAAiBxB,KAAjB,EAAwB;AACpD,QAAI,CAACnB,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,QAAIuC,GAAG,GAAG,KAAKY,YAAL,CAAkBhC,KAAlB,CAAV;AACA,WAAOzB,QAAQ,CAACa,KAAT,CAAeP,EAAf,EAAmBN,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAACa,SAApB,EAA+BrC,KAA/B,CAAnB,EAA0DoB,GAA1D,EAA+D,IAA/D,EAAqE,IAArE,EAA2EI,CAAC,CAACc,QAA7E,CAAP;AACH,GAND;AAOA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIpC,EAAAA,WAAW,CAAClC,SAAZ,CAAsBwE,MAAtB,GAA+B,UAAU3D,EAAV,EAAc2C,CAAd,EAAiBxB,KAAjB,EAAwB;AACnD,QAAI4E,IAAI,GAAGrG,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAACqD,QAApB,EAA8B7E,KAA9B,CAAX;AACA,QAAI8E,KAAK,GAAG,CAACvG,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAACuD,SAApB,EAA+B/E,KAA/B,IAAwC,CAAzC,IAA8C4E,IAA1D;AACA,QAAII,GAAG,GAAGF,KAAK,GAAGF,IAAlB;;AACA,QAAI,CAAC/F,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,WAAOA,EAAE,CAAC6B,KAAH,CAASoE,KAAT,EAAgBE,GAAhB,CAAP;AACH,GARD;AASA;AACJ;AACA;AACA;AACA;AACA;;;AACI9E,EAAAA,WAAW,CAAClC,SAAZ,CAAsBiH,OAAtB,GAAgC,UAAUpG,EAAV,EAAc2C,CAAd,EAAiB;AAC7C,QAAI,CAAC3C,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,WAAOA,EAAE,CAAC6B,KAAH,CAASnC,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAACsD,KAApB,CAAT,EAAqCvG,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAACwD,GAApB,CAArC,CAAP;AACH,GALD;AAMA;AACJ;AACA;AACA;AACA;;;AACI9E,EAAAA,WAAW,CAAClC,SAAZ,CAAsBkH,MAAtB,GAA+B,UAAUrG,EAAV,EAAc2C,CAAd,EAAiB;AAC5C,QAAI,CAAC3C,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,WAAOA,EAAE,CAAC6B,KAAH,CAAS,CAAT,EAAYnC,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAAC2D,GAApB,CAAZ,CAAP;AACH,GALD;AAMA;AACJ;AACA;AACA;AACA;;;AACIjF,EAAAA,WAAW,CAAClC,SAAZ,CAAsBoH,MAAtB,GAA+B,UAAUvG,EAAV,EAAc2C,CAAd,EAAiB;AAC5C,QAAI,CAAC3C,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,WAAOA,EAAE,CAAC6B,KAAH,CAASnC,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAAC2D,GAApB,CAAT,CAAP;AACH,GALD;AAMA;AACJ;AACA;AACA;AACA;;;AACIjF,EAAAA,WAAW,CAAClC,SAAZ,CAAsBqH,QAAtB,GAAiC,UAAUxG,EAAV,EAAc2C,CAAd,EAAiB;AAC9C,QAAI,CAAC3C,EAAD,IAAO,CAACA,EAAE,CAAC8B,MAAf,EAAuB;AACnB,aAAO9B,EAAP;AACH;;AACD,WAAON,QAAQ,CAACW,MAAT,CAAgBL,EAAhB,EAAoBN,QAAQ,CAACD,QAAT,CAAkBkD,CAAC,CAACsC,UAApB,CAApB,CAAP;AACH,GALD;AAMA;AACJ;AACA;AACA;AACA;AACA;;;AACI5D,EAAAA,WAAW,CAAClC,SAAZ,CAAsBqF,MAAtB,GAA+B,UAAUL,EAAV,EAAcjD,IAAd,EAAoBuF,SAApB,EAA+BtF,KAA/B,EAAsCuF,QAAtC,EAAgD;AAC3E,QAAInH,iBAAiB,CAACmH,QAAD,CAArB,EAAiC;AAC7B,aAAOvC,EAAE,CAACpD,UAAH,CAAca,IAAd,CAAmBc,IAAnB,CAAwBxB,IAAxB,CAAP;AACH,KAFD,MAGK;AACD,aAAOiD,EAAE,CAACpD,UAAH,CAAca,IAAd,CAAmB+E,MAAnB,CAA0BD,QAA1B,EAAoC,CAApC,EAAuCxF,IAAvC,CAAP;AACH;AACJ,GAPD;AAQA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIG,EAAAA,WAAW,CAAClC,SAAZ,CAAsBwF,MAAtB,GAA+B,UAAUR,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0C;AACrE,QAAIzG,EAAE,GAAGmE,EAAE,CAACpD,UAAH,CAAca,IAAvB;AACA,QAAIS,CAAJ;;AACA,QAAI,OAAOC,KAAP,KAAiB,QAAjB,IAA6B,EAAEA,KAAK,YAAYuE,IAAnB,CAAjC,EAA2D;AACvDvE,MAAAA,KAAK,GAAG5C,QAAQ,CAAC0F,SAAT,CAAmBwB,QAAnB,EAA6BtE,KAA7B,CAAR;AACH;;AACD,SAAKD,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGrC,EAAE,CAAC8B,MAAnB,EAA2BO,CAAC,EAA5B,EAAgC;AAC5B,UAAI3C,QAAQ,CAAC0F,SAAT,CAAmBwB,QAAnB,EAA6B5G,EAAE,CAACqC,CAAD,CAA/B,MAAwCC,KAA5C,EAAmD;AAC/C;AACH;AACJ;;AACD,WAAOD,CAAC,KAAKrC,EAAE,CAAC8B,MAAT,GAAkB9B,EAAE,CAAC2G,MAAH,CAAUtE,CAAV,EAAa,CAAb,CAAlB,GAAoC,IAA3C;AACH,GAZD;AAaA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIhB,EAAAA,WAAW,CAAClC,SAAZ,CAAsBuF,MAAtB,GAA+B,UAAUP,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0C;AACrE,QAAIzG,EAAE,GAAGmE,EAAE,CAACpD,UAAH,CAAca,IAAvB;AACA,QAAIS,CAAJ;AACA,QAAIJ,GAAJ;;AACA,QAAI,CAAC1C,iBAAiB,CAACqH,QAAD,CAAtB,EAAkC;AAC9B3E,MAAAA,GAAG,GAAGxC,QAAQ,CAACmH,QAAD,EAAWtE,KAAX,CAAd;AACH;;AACD,SAAKD,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGrC,EAAE,CAAC8B,MAAnB,EAA2BO,CAAC,EAA5B,EAAgC;AAC5B,UAAI,CAAC9C,iBAAiB,CAACqH,QAAD,CAAlB,IAAiCnH,QAAQ,CAACmH,QAAD,EAAW5G,EAAE,CAACqC,CAAD,CAAb,CAAT,KAAgCJ,GAApE,EAAyE;AACrE;AACH;AACJ;;AACD,WAAOI,CAAC,GAAGrC,EAAE,CAAC8B,MAAP,GAAgBzC,KAAK,CAACW,EAAE,CAACqC,CAAD,CAAH,EAAQC,KAAR,CAArB,GAAsC,IAA7C;AACH,GAbD;;AAcA,SAAOjB,WAAP;AACH,CA/WgC,CA+W/BtB,OA/W+B,CAAjC;;AAgXA,SAASsB,WAAT;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIyF,UAAU;AAAG;AAAe,UAAUxF,MAAV,EAAkB;AAC9C/C,EAAAA,SAAS,CAACuI,UAAD,EAAaxF,MAAb,CAAT;;AACA,WAASwF,UAAT,GAAsB;AAClB,WAAOxF,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACC,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAA3D;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACI;;;AACAsF,EAAAA,UAAU,CAAC3H,SAAX,CAAqBsC,YAArB,GAAoC,UAAU0C,EAAV,EAAchD,KAAd,EAAqB4F,gBAArB,EAAuC;AACvE,QAAIvE,OAAO,GAAG,KAAKwE,eAAL,CAAqB7F,KAArB,CAAd;AACA,QAAI8F,OAAO,GAAGtH,KAAK,CAACuH,gBAAN,CAAuB/F,KAAK,CAACqB,OAA7B,EAAsC,CAAC,UAAD,EAAa,QAAb,EAAuB,QAAvB,EAAiC,QAAjC,EAA2C,SAA3C,CAAtC,CAAd;AACA,QAAI2E,MAAM,GAAGhG,KAAK,CAACgG,MAAnB;AACA,QAAIC,GAAG,GAAGjD,EAAE,CAACpD,UAAH,CAAcqG,GAAxB;AACA,QAAIC,IAAJ;AACA,QAAI/G,IAAJ;AACA,QAAIE,IAAI,GAAG,IAAX;AACA,QAAIP,OAAO,GAAG,KAAKA,OAAnB;AACA,QAAIqH,OAAO,GAAG;AAAEC,MAAAA,KAAK,EAAE,EAAT;AAAaC,MAAAA,MAAM,EAAE,EAArB;AAAyBC,MAAAA,OAAO,EAAE,EAAlC;AAAsCC,MAAAA,QAAQ,EAAE,EAAhD;AAAoD9G,MAAAA,UAAU,EAAE;AAAhE,KAAd,CATuE,CAUvE;;AACA,QAAI,YAAYqG,OAAhB,EAAyB;AACrBI,MAAAA,IAAI,GAAGJ,OAAO,CAACtD,MAAf;AACArD,MAAAA,IAAI,GAAGZ,QAAQ,CAACD,QAAT,CAAkB4H,IAAI,CAACnB,SAAvB,EAAkC/E,KAAlC,CAAP;AACAX,MAAAA,IAAI,GAAGd,QAAQ,CAACD,QAAT,CAAkB4H,IAAI,CAACrB,QAAvB,EAAiC7E,KAAjC,CAAP;AACAb,MAAAA,IAAI,GAAG,CAACA,IAAI,GAAG,CAAR,IAAaE,IAApB;AACH,KALD,MAMK,IAAI,aAAayG,OAAjB,EAA0B;AAC3BI,MAAAA,IAAI,GAAGJ,OAAO,CAACb,OAAf;AACA9F,MAAAA,IAAI,GAAG+G,IAAI,CAACpB,KAAZ;AACAzF,MAAAA,IAAI,GAAG6G,IAAI,CAAClB,GAAL,GAAWkB,IAAI,CAACpB,KAAvB;AACH,KArBsE,CAsBvE;;;AACA,SAAK,IAAI5D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,OAAO,CAAC+E,KAAR,CAAczF,MAAlC,EAA0CO,CAAC,EAA3C,EAA+C;AAC3CgF,MAAAA,IAAI,GAAG3H,QAAQ,CAACD,QAAT,CAAkB+C,OAAO,CAAC+E,KAAR,CAAclF,CAAd,EAAiBM,CAAjB,CAAmBa,SAArC,EAAgDrC,KAAhD,CAAP;AACAmG,MAAAA,OAAO,CAACC,KAAR,CAAc7E,IAAd,CAAmBhD,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,YAAnC,EAAiD;AAAEC,QAAAA,IAAI,EAAEP,IAAR;AAAcQ,QAAAA,SAAS,EAAErF,OAAO,CAAC+E,KAAR,CAAclF,CAAd,EAAiBM,CAAjB,CAAmBkF;AAA5C,OAAjD,EAA0G1G,KAA1G,CAAnB;AACH,KA1BsE,CA2BvE;;;AACA,QAAI4F,gBAAJ,EAAsB;AAClBM,MAAAA,IAAI,GAAG,KAAKS,cAAL,CAAoBf,gBAApB,EAAsC5F,KAAtC,CAAP;;AACA,UAAIkG,IAAJ,EAAU;AACNC,QAAAA,OAAO,CAACG,OAAR,CAAgB/E,IAAhB,CAAqBhD,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,aAAnC,EAAkDN,IAAI,CAACU,MAAL,EAAlD,EAAiE5G,KAAjE,CAArB;AACH;AACJ,KAjCsE,CAkCvE;;;AACA,SAAK,IAAIkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,OAAO,CAACiF,OAAR,CAAgB3F,MAApC,EAA4CO,CAAC,EAA7C,EAAiD;AAC7C,UAAI2F,GAAG,GAAGtI,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,aAAnC,EAAkDnF,OAAO,CAACiF,OAAR,CAAgBpF,CAAhB,EAAmBM,CAAnB,CAAqBoF,MAArB,EAAlD,EAAiF5G,KAAjF,CAAV;;AACA,UAAK,KAAK8G,aAAL,IACD,KAAKA,aAAL,OAAyB,gBADzB,IAEA,CAAC1I,iBAAiB,CAACiD,OAAO,CAACiF,OAAR,CAAgBpF,CAAhB,EAAmBM,CAAnB,CAAqBV,GAAtB,CAFlB,IAEgDO,OAAO,CAACiF,OAAR,CAAgB3F,MAAhB,GAAyB,CAF7E,EAEgF;AAC5EkG,QAAAA,GAAG,GAAG,MAAMA,GAAN,GAAY,GAAlB;AACH;;AACDV,MAAAA,OAAO,CAACG,OAAR,CAAgB/E,IAAhB,CAAqBsF,GAArB;AACA,UAAIE,MAAM,GAAG,OAAOZ,OAAO,CAACG,OAAR,CAAgBpF,CAAhB,CAAP,KAA8B,QAA9B,GAAyC1D,MAAM,CAACwJ,IAAP,CAAYb,OAAO,CAACG,OAAR,CAAgBpF,CAAhB,CAAZ,CAAzC,GAA2E,EAAxF;;AACA,WAAK,IAAI+F,EAAE,GAAG,CAAT,EAAYC,MAAM,GAAGH,MAA1B,EAAkCE,EAAE,GAAGC,MAAM,CAACvG,MAA9C,EAAsDsG,EAAE,EAAxD,EAA4D;AACxD,YAAIE,IAAI,GAAGD,MAAM,CAACD,EAAD,CAAjB;;AACA,YAAI1I,QAAQ,CAAC6I,MAAT,CAAiBjB,OAAD,CAAUgB,IAAV,CAAhB,CAAJ,EAAsC;AAClC,iBAAOhB,OAAO,CAACgB,IAAD,CAAd;AACH;AACJ;AACJ,KAlDsE,CAmDvE;;;AACA,SAAK,IAAIjG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,OAAO,CAACkF,QAAR,CAAiB5F,MAArC,EAA6CO,CAAC,EAA9C,EAAkD;AAC9CgF,MAAAA,IAAI,GAAG7E,OAAO,CAACkF,QAAR,CAAiBrF,CAAjB,EAAoBM,CAA3B;AACA2E,MAAAA,OAAO,CAACI,QAAR,CAAiBhF,IAAjB,CAAsBhD,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,cAAnC,EAAmD;AACrEa,QAAAA,MAAM,EAAEnB,IAAI,CAACpC,UADwD;AAErEwD,QAAAA,QAAQ,EAAEpB,IAAI,CAACoB,QAFsD;AAGrExG,QAAAA,GAAG,EAAEoF,IAAI,CAAChC,SAH2D;AAIrEC,QAAAA,UAAU,EAAE+B,IAAI,CAAC/B;AAJoD,OAAnD,EAKnBnE,KALmB,CAAtB;AAMH,KA5DsE,CA6DvE;;;AACA,SAAK,IAAIkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,OAAO,CAACgF,MAAR,CAAe1F,MAAnC,EAA2CO,CAAC,EAA5C,EAAgD;AAC5CiF,MAAAA,OAAO,CAACE,MAAR,CAAe9E,IAAf,CAAoBhD,QAAQ,CAACD,QAAT,CAAkB+C,OAAO,CAACgF,MAAR,CAAenF,CAAf,EAAkBM,CAAlB,CAAoBa,SAAtC,EAAiDrC,KAAjD,CAApB;AACH,KAhEsE,CAiEvE;;;AACA,SAAK,IAAIkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,OAAO,CAAC5B,UAAR,CAAmBkB,MAAvC,EAA+CO,CAAC,EAAhD,EAAoD;AAChDgF,MAAAA,IAAI,GAAG7E,OAAO,CAAC5B,UAAR,CAAmByB,CAAnB,EAAsBM,CAA7B;AACA2E,MAAAA,OAAO,CAAC1G,UAAR,CAAmB8B,IAAnB,CAAwB;AAAE5B,QAAAA,IAAI,EAAEuG,IAAI,CAACvG,IAAb;AAAmB+B,QAAAA,KAAK,EAAEnD,QAAQ,CAACD,QAAT,CAAkB4H,IAAI,CAACxE,KAAvB,EAA8B1B,KAA9B;AAA1B,OAAxB;AACH;;AACD,QAAIkC,GAAG,GAAG,EAAV;AACA,SAAKqF,eAAL,CAAqBzI,OAArB,EAA8BkB,KAA9B,EAAqC8F,OAArC,EAA8CK,OAA9C,EAAuDjE,GAAvD,EAvEuE,CAwEvE;;AACA3D,IAAAA,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,WAAnC,EAAgD;AAAExD,MAAAA,EAAE,EAAEA,EAAN;AAAUhD,MAAAA,KAAK,EAAEA,KAAjB;AAAwBgG,MAAAA,MAAM,EAAEA,MAAhC;AAAwCwB,MAAAA,SAAS,EAAEtF;AAAnD,KAAhD;;AACA,QAAIlC,KAAK,CAACe,QAAN,CAAeJ,MAAnB,EAA2B;AACvB,WAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlB,KAAK,CAACe,QAAN,CAAeJ,MAAnC,EAA2CO,CAAC,EAA5C,EAAgD;AAC5CgB,QAAAA,GAAG,CAAClC,KAAK,CAACe,QAAN,CAAeG,CAAf,EAAkBJ,GAAnB,CAAH,GAA6Bd,KAAK,CAACe,QAAN,CAAeG,CAAf,EAAkBC,KAA/C;AACH;AACJ,KA9EsE,CA+EvE;;;AACA,QAAI6F,IAAI,GAAGxJ,MAAM,CAACwJ,IAAP,CAAY9E,GAAZ,CAAX;;AACA,SAAK,IAAIuF,EAAE,GAAG,CAAT,EAAYC,MAAM,GAAGV,IAA1B,EAAgCS,EAAE,GAAGC,MAAM,CAAC/G,MAA5C,EAAoD8G,EAAE,EAAtD,EAA0D;AACtD,UAAIN,IAAI,GAAGO,MAAM,CAACD,EAAD,CAAjB;;AACA,UAAIlJ,QAAQ,CAAC6I,MAAT,CAAgBlF,GAAG,CAACiF,IAAD,CAAnB,KAA8BjF,GAAG,CAACiF,IAAD,CAAH,KAAc,EAA5C,IAAkDjF,GAAG,CAACiF,IAAD,CAAH,CAAUxG,MAAV,KAAqB,CAA3E,EAA8E;AAC1E,eAAOuB,GAAG,CAACiF,IAAD,CAAV;AACH;AACJ;;AACD,QAAI,EAAErI,OAAO,CAACK,IAAR,IAAgB+C,GAAhB,IAAuBpD,OAAO,CAACO,IAAR,IAAgB6C,GAAzC,KAAiD7C,IAAI,KAAK,IAA9D,EAAoE;AAChE6C,MAAAA,GAAG,CAACpD,OAAO,CAACK,IAAT,CAAH,GAAoBZ,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,QAAnC,EAA6CrH,IAA7C,EAAmDa,KAAnD,CAApB;AACAkC,MAAAA,GAAG,CAACpD,OAAO,CAACO,IAAT,CAAH,GAAoBd,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,QAAnC,EAA6CnH,IAA7C,EAAmDW,KAAnD,CAApB;AACH;;AACD,QAAIpC,CAAC,GAAG,KAAKiC,GAAb;AACA,SAAKA,GAAL,GAAW,EAAX;;AACA,QAAI,KAAKf,OAAL,CAAaE,WAAb,KAA6B,MAAjC,EAAyC;AACrC,aAAO;AACHe,QAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAe1F,GAAf,EAAoB3D,QAAQ,CAACsJ,KAAT,CAAeC,gBAAnC,CADH;AAEH7B,QAAAA,GAAG,EAAEA,GAFF;AAGH8B,QAAAA,OAAO,EAAEnK,CAHN;AAIH+B,QAAAA,IAAI,EAAE,MAJH;AAKHqI,QAAAA,WAAW,EAAE;AALV,OAAP;AAOH;;AACD9B,IAAAA,IAAI,GAAG,KAAK+B,oBAAL,CAA0B/F,GAA1B,EAA+BlC,KAA/B,EAAsCgD,EAAtC,CAAP;AACAkD,IAAAA,IAAI,GAAG,CAAClD,EAAE,CAACpD,UAAH,CAAcqG,GAAd,CAAkBiC,OAAlB,CAA0B,GAA1B,MAAmC,CAAC,CAApC,GAAwC,GAAxC,GAA8C,GAA/C,IAAsDhC,IAA7D;AACA,WAAO;AACHvG,MAAAA,IAAI,EAAE,KADH;AACUsG,MAAAA,GAAG,EAAEC,IAAI,CAACvF,MAAL,GAAcsF,GAAG,CAACvB,OAAJ,CAAY,MAAZ,EAAoBwB,IAApB,CAAd,GAA0CD,GADzD;AAC8D8B,MAAAA,OAAO,EAAEnK;AADvE,KAAP;AAGH,GA3GD;;AA4GA+H,EAAAA,UAAU,CAAC3H,SAAX,CAAqBuJ,eAArB,GAAuC,UAAUzI,OAAV,EAAmBkB,KAAnB,EAA0B8F,OAA1B,EAAmCK,OAAnC,EAA4CgC,QAA5C,EAAsD;AACzF,QAAIC,KAAK,GAAG,OAAZ;AACA,QAAIlG,GAAG,GAAGiG,QAAV;AACAjG,IAAAA,GAAG,CAACpD,OAAO,CAACC,IAAT,CAAH,GAAoBiB,KAAK,CAACqI,SAA1B;;AACA,QAAIvJ,OAAO,CAACsB,KAAR,IAAiBJ,KAAK,CAACsI,SAAN,CAAgB3H,MAArC,EAA6C;AACzCuB,MAAAA,GAAG,CAACpD,OAAO,CAACsB,KAAT,CAAH,GAAqB,gBAAgB,IAAhB,GAAuB7B,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,YAAnC,EAAiDxG,KAAK,CAACsI,SAAvD,CAAvB,GAA2F,EAAhH;AACH;;AACD,QAAI,CAACtI,KAAK,CAACsI,SAAN,CAAgB3H,MAAjB,IAA2B7B,OAAO,CAACY,MAAvC,EAA+C;AAC3CwC,MAAAA,GAAG,CAACpD,OAAO,CAACY,MAAT,CAAH,GAAsB,cAAc,IAAd,IAAsB,cAAcoG,OAApC,GAClBvH,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,UAAnC,EAA+C;AAAE+B,QAAAA,OAAO,EAAEhK,QAAQ,CAACD,QAAT,CAAkBwH,OAAO,CAACT,QAAR,CAAiBvB,UAAnC,EAA+C9D,KAA/C,CAAX;AAAkEwI,QAAAA,OAAO,EAAExI,KAAK,CAACwI;AAAjF,OAA/C,EAA2IxI,KAA3I,CADkB,GACkIA,KAAK,CAACwI,OAD9J;AAEH;;AACDtG,IAAAA,GAAG,CAACpD,OAAO,CAACI,MAAT,CAAH,GAAsB,cAAc4G,OAAd,IAAyB,CAAC9F,KAAK,CAACsI,SAAN,CAAgB3H,MAA1C,GAClBpC,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,UAAnC,EAA+CjI,QAAQ,CAACD,QAAT,CAAkBwH,OAAO,CAACT,QAAR,CAAiBvB,UAAnC,EAA+C9D,KAA/C,CAA/C,EAAsGA,KAAtG,CADkB,GAC6F,EADnH;AAEAkC,IAAAA,GAAG,CAACpD,OAAO,CAACS,KAAT,CAAH,GAAqBS,KAAK,CAAC+B,eAAN,GAAwBxD,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,SAAnC,EAA8CxG,KAAK,CAAC+B,eAApD,EAAqE/B,KAArE,CAAxB,GAAsG,EAA3H;AACAkC,IAAAA,GAAG,CAACpD,OAAO,CAACQ,MAAT,CAAH,GAAsB6G,OAAO,CAACI,QAAR,CAAiB5F,MAAjB,GAA0BpC,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,UAAnC,EAA+CL,OAAO,CAACI,QAAvD,EAAiEvG,KAAjE,CAA1B,GAAoG,EAA1H;AACAkC,IAAAA,GAAG,CAACpD,OAAO,CAACK,IAAT,CAAH,GAAoB,YAAY2G,OAAZ,GAChBvH,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,QAAnC,EAA6CjI,QAAQ,CAACD,QAAT,CAAkBwH,OAAO,CAACV,MAAR,CAAeD,GAAjC,EAAsCnF,KAAtC,CAA7C,EAA2FA,KAA3F,CADgB,GACoF,EADxG;AAEAkC,IAAAA,GAAG,CAACpD,OAAO,CAACO,IAAT,CAAH,GAAoB,YAAYyG,OAAZ,GAChBvH,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,QAAnC,EAA6CjI,QAAQ,CAACD,QAAT,CAAkBwH,OAAO,CAACZ,MAAR,CAAeC,GAAjC,EAAsCnF,KAAtC,CAA7C,EAA2FA,KAA3F,CADgB,GACoF,EADxG;AAEAkC,IAAAA,GAAG,CAACpD,OAAO,CAACU,KAAT,CAAH,GAAqB2G,OAAO,CAACG,OAAR,CAAgB3F,MAAhB,IAA0BwF,OAAO,CAACI,QAAR,CAAiB5F,MAA3C,GACjBpC,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,SAAnC,EAA8CL,OAAO,CAACG,OAAtD,EAA+DtG,KAA/D,CADiB,GACuD,EAD5E;AAEAkC,IAAAA,GAAG,CAACpD,OAAO,CAACG,MAAT,CAAH,GAAsBkH,OAAO,CAACC,KAAR,CAAczF,MAAd,GAAuBpC,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,UAAnC,EAA+CL,OAAO,CAACC,KAAvD,EAA8DpG,KAA9D,CAAvB,GAA8F,EAApH;AACAkC,IAAAA,GAAG,CAACpD,OAAO,CAACM,KAAT,CAAH,GAAqB+G,OAAO,CAACE,MAAR,CAAe1F,MAAf,GAAwBpC,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,SAAnC,EAA8CL,OAAO,CAACE,MAAtD,EAA8DrG,KAA9D,CAAxB,GAA+F,EAApH;AACAkC,IAAAA,GAAG,CAACpD,OAAO,CAACW,UAAT,CAAH,GAA0B0G,OAAO,CAAC1G,UAAR,CAAmBkB,MAAnB,GACtBpC,QAAQ,CAACiI,mBAAT,CAA6B,IAA7B,EAAmC,cAAnC,EAAmDL,OAAO,CAAC1G,UAA3D,EAAuEO,KAAvE,CADsB,GAC0D,EADpF;AAEAkC,IAAAA,GAAG,CAACkG,KAAD,CAAH,GAAa,EAAb;AACH,GA1BD;AA2BA;AACJ;AACA;AACA;AACA;AACA;;;AACIzC,EAAAA,UAAU,CAAC3H,SAAX,CAAqBiK,oBAArB,GAA4C,UAAU9B,OAAV,EAAmBnG,KAAnB,EAA0BgD,EAA1B,EAA8B;AACtE,WAAO,EAAP,CADsE,CAEtE;AACH,GAHD;AAIA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACI2C,EAAAA,UAAU,CAAC3H,SAAX,CAAqB8B,eAArB,GAAuC,UAAUC,IAAV,EAAgBlB,EAAhB,EAAoBmB,KAApB,EAA2BC,GAA3B,EAAgCkG,OAAhC,EAAyClD,OAAzC,EAAkD;AACrF,QAAIhD,GAAG,IAAIA,GAAG,CAACwI,iBAAJ,CAAsB,cAAtB,CAAP,IACAxI,GAAG,CAACwI,iBAAJ,CAAsB,cAAtB,EAAsCP,OAAtC,CAA8C,kBAA9C,MAAsE,CAAC,CAD3E,EAC8E;AAC1E,UAAIQ,cAAc,GAAGnK,QAAQ,CAACoK,gBAA9B;;AACA,UAAI9J,EAAE,IAAI,CAACA,EAAE,CAAC8J,gBAAd,EAAgC;AAC5BpK,QAAAA,QAAQ,CAACoK,gBAAT,GAA4B,KAA5B;AACH;;AACD5I,MAAAA,IAAI,GAAGxB,QAAQ,CAACsJ,KAAT,CAAee,SAAf,CAAyB7I,IAAzB,CAAP;AACAxB,MAAAA,QAAQ,CAACoK,gBAAT,GAA4BD,cAA5B;AACH;;AACD,QAAIG,QAAQ,GAAG1C,OAAf;AACA,QAAItG,GAAG,GAAGgJ,QAAQ,CAACd,OAAT,IAAoB,EAA9B;AACA,QAAIe,OAAO,GAAG/I,IAAI,GAAGA,IAAI,CAAC+I,OAAR,GAAkB,EAApC;;AACA,QAAI7I,GAAG,IAAIA,GAAG,CAACwI,iBAAJ,CAAsB,cAAtB,CAAP,IACAxI,GAAG,CAACwI,iBAAJ,CAAsB,cAAtB,EAAsCP,OAAtC,CAA8C,KAA9C,MAAyD,CAAC,CAD9D,EACiE;AAC7D,aAAQlI,KAAK,CAAC+B,eAAN,GAAwB;AAAEvB,QAAAA,MAAM,EAAE,EAAV;AAAcjB,QAAAA,KAAK,EAAE;AAArB,OAAxB,GAAmD,EAA3D;AACH;;AACD,QAAIjC,CAAC,GAAGqK,IAAI,CAACE,KAAL,CAAWgB,QAAQ,CAAC9I,IAApB,CAAR;;AACA,QAAIzC,CAAC,IAAIA,CAAC,CAACyL,MAAF,KAAa,OAAlB,IAA6BhJ,IAA7B,IAAqCA,IAAI,CAACqD,YAA9C,EAA4D;AACxDH,MAAAA,OAAO,CAACG,YAAR,GAAuBrD,IAAI,CAACqD,YAA5B;AACA,aAAOH,OAAP;AACH;;AACD,QAAIlD,IAAI,IAAIA,IAAI,CAACzC,CAAjB,EAAoB;AAChByC,MAAAA,IAAI,GAAGA,IAAI,CAACzC,CAAZ;AACH;;AACD,QAAIsE,IAAI,GAAG,EAAX;;AACA,QAAI7B,IAAI,IAAI,WAAWA,IAAvB,EAA6B;AACzB6B,MAAAA,IAAI,CAACrC,KAAL,GAAaQ,IAAI,CAACR,KAAlB;AACH;;AACDqC,IAAAA,IAAI,CAACpB,MAAL,GAAcT,IAAI,IAAIA,IAAI,CAACS,MAAb,GAAsBT,IAAI,CAACS,MAA3B,GAAoCT,IAAlD;AACA,QAAIiJ,QAAQ,GAAG,KAAf;;AACA,QAAIrL,KAAK,CAACsL,OAAN,CAAclJ,IAAI,CAACS,MAAnB,KAA8BT,IAAI,CAACS,MAAL,CAAYG,MAA9C,EAAsD;AAClD,UAAIG,GAAG,GAAG,KAAV;AACA,UAAIoI,GAAG,GAAG,OAAV;AACA,UAAI9G,KAAK,GAAG,OAAZ;;AACA,UAAI,CAAChE,iBAAiB,CAAC2B,IAAI,CAACS,MAAL,CAAY,CAAZ,EAAeM,GAAf,CAAD,CAAtB,EAA6C;AACzCc,QAAAA,IAAI,CAACpB,MAAL,GAAc,KAAK2I,qBAAL,CAA2BvH,IAAI,CAACpB,MAAhC,EAAwC,CAAxC,EAA2CX,GAAG,CAACwG,MAAJ,CAAW1F,MAAX,GAAoB,CAA/D,CAAd;AACH;;AACD,UAAIX,KAAK,IAAIA,KAAK,CAACe,QAAN,CAAeJ,MAAxB,IAAkCd,GAAG,CAACwG,MAAJ,CAAW1F,MAAjD,EAAyD;AACrD,aAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlB,KAAK,CAACe,QAAN,CAAeJ,MAAnC,EAA2CO,CAAC,EAA5C,EAAgD;AAC5C,cAAIlB,KAAK,CAACe,QAAN,CAAeG,CAAf,EAAkBJ,GAAlB,MAA2B,mBAA/B,EAAoD;AAChD,gBAAIK,KAAK,GAAGnB,KAAK,CAACe,QAAN,CAAeG,CAAf,EAAkBgI,GAAlB,EAAuB9G,KAAvB,CAAZ;;AACA,gBAAIvC,GAAG,CAACwG,MAAJ,CAAW1F,MAAX,KAAsBQ,KAA1B,EAAiC;AAC7B6H,cAAAA,QAAQ,GAAG,IAAX;AACH;AACJ;AACJ;AACJ;AACJ;;AACD,QAAI,CAACA,QAAL,EAAe;AACX,WAAKI,kBAAL,CAAwBvJ,GAAxB,EAA6BE,IAA7B,EAAmC6B,IAAnC,EAAyCkH,OAAzC,EAAkD9I,KAAlD;AACH;;AACD,WAAOzB,QAAQ,CAAC6I,MAAT,CAAgBxF,IAAI,CAACrC,KAArB,IAA8BqC,IAAI,CAACpB,MAAnC,GAA4C;AAAEA,MAAAA,MAAM,EAAEoB,IAAI,CAACpB,MAAf;AAAuBjB,MAAAA,KAAK,EAAEqC,IAAI,CAACrC,KAAnC;AAA0CE,MAAAA,UAAU,EAAEmC,IAAI,CAACnC;AAA3D,KAAnD;AACH,GArDD;;AAsDAkG,EAAAA,UAAU,CAAC3H,SAAX,CAAqBmL,qBAArB,GAA6C,UAAUpJ,IAAV,EAAgBqC,KAAhB,EAAuBM,UAAvB,EAAmC;AAC5E,SAAK,IAAIxB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnB,IAAI,CAACY,MAAzB,EAAiCO,CAAC,EAAlC,EAAsC;AAClC,UAAInB,IAAI,CAACmB,CAAD,CAAJ,CAAQmI,KAAR,CAAc1I,MAAd,IAAwBnD,MAAM,CAACwJ,IAAP,CAAYjH,IAAI,CAACmB,CAAD,CAAJ,CAAQmI,KAAR,CAAc,CAAd,CAAZ,EAA8BnB,OAA9B,CAAsC,KAAtC,IAA+C,CAAC,CAA5E,EAA+E;AAC3E,aAAKiB,qBAAL,CAA2BpJ,IAAI,CAACmB,CAAD,CAAJ,CAAQmI,KAAnC,EAA0CjH,KAAK,GAAG,CAAlD,EAAqDM,UAAU,GAAG,CAAlE;AACH;AACJ;;AACD,QAAID,GAAG,GAAG,WAAV;AACA,QAAI6G,QAAQ,GAAG,aAAf;AACA,QAAIC,GAAG,GAAG,OAAV;AACA,QAAI5G,OAAO,GAAG,SAAd;AACA5C,IAAAA,IAAI,CAAC0C,GAAD,CAAJ,GAAY/D,MAAM,CAAC+D,GAAD,CAAlB;AACA1C,IAAAA,IAAI,CAACwJ,GAAD,CAAJ,GAAYnH,KAAZ;AACArC,IAAAA,IAAI,CAACuJ,QAAD,CAAJ,GAAiB5G,UAAjB;AACA3C,IAAAA,IAAI,CAAC4C,OAAD,CAAJ,GAAgB5C,IAAI,CAAC,CAAD,CAAJ,CAAQsJ,KAAR,CAAc1I,MAAd,GAAuB,KAAK6I,iBAAL,CAAuBzJ,IAAvB,EAA6B,CAAC3B,iBAAiB,CAAC2B,IAAI,CAAC,CAAD,CAAJ,CAAQsJ,KAAR,CAAc1G,OAAd,CAAD,CAA/C,CAAvB,GAAkG,EAAlH;AACA,WAAO5C,IAAP;AACH,GAfD;;AAgBA4F,EAAAA,UAAU,CAAC3H,SAAX,CAAqBwL,iBAArB,GAAyC,UAAUzJ,IAAV,EAAgB0J,UAAhB,EAA4B;AACjE,QAAIC,mBAAmB,GAAG,EAA1B;AACA,QAAI/G,OAAO,GAAG,SAAd;;AACA,SAAK,IAAIzB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnB,IAAI,CAACY,MAAzB,EAAiCO,CAAC,EAAlC,EAAsC;AAClC,UAAI,CAACuI,UAAL,EAAiB;AACb,aAAK,IAAIzF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGjE,IAAI,CAACmB,CAAD,CAAJ,CAAQmI,KAAR,CAAc1I,MAAlC,EAA0CqD,CAAC,EAA3C,EAA+C;AAC3C0F,UAAAA,mBAAmB,CAACnI,IAApB,CAAyBxB,IAAI,CAACmB,CAAD,CAAJ,CAAQmI,KAAR,CAAcrF,CAAd,CAAzB;AACH;AACJ,OAJD,MAKK;AACD0F,QAAAA,mBAAmB,GAAGA,mBAAmB,CAACC,MAApB,CAA2B5J,IAAI,CAACmB,CAAD,CAAJ,CAAQmI,KAAR,CAAc1G,OAAd,CAA3B,CAAtB;AACH;AACJ;;AACD,WAAO+G,mBAAP;AACH,GAdD;AAeA;AACJ;AACA;AACA;AACA;;;AACI/D,EAAAA,UAAU,CAAC3H,SAAX,CAAqB2G,OAArB,GAA+B,UAAUnD,CAAV,EAAa;AACxC,SAAK3B,GAAL,CAASwG,MAAT,GAAkB7E,CAAlB;AACA,WAAOA,CAAP;AACH,GAHD;AAIA;AACJ;AACA;AACA;AACA;;;AACImE,EAAAA,UAAU,CAAC3H,SAAX,CAAqB4F,YAArB,GAAoC,UAAUpC,CAAV,EAAa;AAC7C,SAAK3B,GAAL,CAASJ,UAAT,GAAsB+B,CAAtB;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACImE,EAAAA,UAAU,CAAC3H,SAAX,CAAqB+E,YAArB,GAAoC,UAAUC,EAAV,EAAcC,OAAd,EAAuBzB,CAAvB,EAA0BxB,KAA1B,EAAiC4J,QAAjC,EAA2C;AAC3E,QAAI3D,GAAJ;AACA,QAAInF,GAAJ;AACA,WAAO;AACHnB,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAciK,QAAd,IAA0B7G,EAAE,CAACpD,UAAH,CAAckK,OAAxC,IAAmD9G,EAAE,CAACpD,UAAH,CAAcmK,SAAjE,IAA8E/G,EAAE,CAACpD,UAAH,CAAcqG,GAF9F;AAGH+B,MAAAA,WAAW,EAAE,iCAHV;AAIHgC,MAAAA,QAAQ,EAAE,MAJP;AAKHjK,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezJ,MAAM,CAAC,EAAD,EAAK;AAC5B8L,QAAAA,OAAO,EAAEhH,OAAO,CAACK,cADW;AAE5B4G,QAAAA,KAAK,EAAEjH,OAAO,CAACG,YAFa;AAG5B+G,QAAAA,OAAO,EAAElH,OAAO,CAACE,cAHW;AAI5B4F,QAAAA,MAAM,EAAE,OAJoB;AAK5BqB,QAAAA,KAAK,EAAE5I,CAAC,CAACyE,GAAD,CALoB;AAM5BnF,QAAAA,GAAG,EAAEU,CAAC,CAACV,GAAD;AANsB,OAAL,EAOxBvC,QAAQ,CAAC8L,YAAT,CAAsB,IAAtB,EAA4BrH,EAA5B,EAAgChD,KAAhC,CAPwB,CAArB;AALH,KAAP;AAcH,GAjBD;AAkBA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI2F,EAAAA,UAAU,CAAC3H,SAAX,CAAqBsM,UAArB,GAAkC,UAAUtH,EAAV,EAAcmD,OAAd,EAAuB,CACrD;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;AACA;;;AACIR,EAAAA,UAAU,CAAC3H,SAAX,CAAqBqF,MAArB,GAA8B,UAAUL,EAAV,EAAcjD,IAAd,EAAoBuF,SAApB,EAA+BtF,KAA/B,EAAsC;AAChE,WAAO;AACHiG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAc2K,SAAd,IAA2BvH,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoD9G,EAAE,CAACpD,UAAH,CAAcqG,GADpE;AAEHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezJ,MAAM,CAAC,EAAD,EAAK;AAC5BgD,QAAAA,KAAK,EAAEpB,IADqB;AAE5BqK,QAAAA,KAAK,EAAE9E,SAFqB;AAG5ByD,QAAAA,MAAM,EAAE;AAHoB,OAAL,EAIxBxK,QAAQ,CAAC8L,YAAT,CAAsB,IAAtB,EAA4BrH,EAA5B,EAAgChD,KAAhC,CAJwB,CAArB;AAFH,KAAP;AAQH,GATD;AAUA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI2F,EAAAA,UAAU,CAAC3H,SAAX,CAAqBwF,MAArB,GAA8B,UAAUR,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0CtF,KAA1C,EAAiD;AAC3E,WAAO;AACHL,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAcmK,SAAd,IAA2B/G,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoD9G,EAAE,CAACpD,UAAH,CAAcqG,GAFpE;AAGHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezJ,MAAM,CAAC,EAAD,EAAK;AAC5B2C,QAAAA,GAAG,EAAEK,KADuB;AAE5BqJ,QAAAA,SAAS,EAAE/E,QAFiB;AAG5B2E,QAAAA,KAAK,EAAE9E,SAHqB;AAI5ByD,QAAAA,MAAM,EAAE;AAJoB,OAAL,EAKxBxK,QAAQ,CAAC8L,YAAT,CAAsB,IAAtB,EAA4BrH,EAA5B,EAAgChD,KAAhC,CALwB,CAArB;AAHH,KAAP;AAUH,GAXD;AAYA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI2F,EAAAA,UAAU,CAAC3H,SAAX,CAAqBuF,MAArB,GAA8B,UAAUP,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0CtF,KAA1C,EAAiD;AAC3E,WAAO;AACHL,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAc6K,SAAd,IAA2BzH,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoD9G,EAAE,CAACpD,UAAH,CAAcqG,GAFpE;AAGHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezJ,MAAM,CAAC,EAAD,EAAK;AAC5BgD,QAAAA,KAAK,EAAEA,KADqB;AAE5B4H,QAAAA,MAAM,EAAE,QAFoB;AAG5ByB,QAAAA,SAAS,EAAE/E,QAHiB;AAI5B3E,QAAAA,GAAG,EAAEvC,QAAQ,CAAC0F,SAAT,CAAmBwB,QAAnB,EAA6BtE,KAA7B,CAJuB;AAK5BiJ,QAAAA,KAAK,EAAE9E;AALqB,OAAL,EAMxB/G,QAAQ,CAAC8L,YAAT,CAAsB,IAAtB,EAA4BrH,EAA5B,EAAgChD,KAAhC,CANwB,CAArB;AAHH,KAAP;AAWH,GAZD;AAaA;AACJ;AACA;AACA;AACA;AACA;;;AACI2F,EAAAA,UAAU,CAAC3H,SAAX,CAAqB2I,cAArB,GAAsC,UAAU5G,IAAV,EAAgBC,KAAhB,EAAuB;AACzD,QAAIc,GAAG,GAAGd,KAAK,CAAC0K,IAAhB;AACA,QAAIvJ,KAAJ;AACA,QAAIgG,IAAI,GAAGrG,GAAX;AACA,QAAI6J,IAAI,GAAG3K,KAAK,CAACc,GAAjB;AACA,QAAI8J,SAAS,GAAG,EAAhB;;AACA,QAAI,OAAO7K,IAAI,CAAC,CAAD,CAAX,KAAmB,QAAvB,EAAiC;AAC7BoH,MAAAA,IAAI,GAAG,IAAP;AACH;;AACD,SAAK,IAAIjG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnB,IAAI,CAACY,MAAzB,EAAiCO,CAAC,EAAlC,EAAsC;AAClC,UAAI,OAAOnB,IAAI,CAAC,CAAD,CAAX,KAAmB,QAAvB,EAAiC;AAC7BoB,QAAAA,KAAK,GAAG5C,QAAQ,CAAC0F,SAAT,CAAmB0G,IAAI,IAAIxD,IAA3B,EAAiCpH,IAAI,CAACmB,CAAD,CAArC,CAAR;AACH,OAFD,MAGK;AACDC,QAAAA,KAAK,GAAGpB,IAAI,CAACmB,CAAD,CAAZ;AACH;;AACD0J,MAAAA,SAAS,CAACrJ,IAAV,CAAe,IAAI9C,SAAJ,CAAcqC,GAAd,EAAmB,OAAnB,EAA4BK,KAA5B,CAAf;AACH;;AACD,WAAO1C,SAAS,CAACoM,EAAV,CAAaD,SAAb,CAAP;AACH,GAnBD;;AAoBAjF,EAAAA,UAAU,CAAC3H,SAAX,CAAqBoL,kBAArB,GAA0C,UAAUvJ,GAAV,EAAeE,IAAf,EAAqB6B,IAArB,EAA2BkH,OAA3B,EAAoC9I,KAApC,EAA2C;AACjF,QAAI8K,KAAK,GAAG/K,IAAZ;;AACA,QAAIA,IAAI,IAAIA,IAAI,CAACS,MAAjB,EAAyB;AACrBsK,MAAAA,KAAK,GAAG/K,IAAI,CAACS,MAAb;AACH;;AACD,QAAIX,GAAG,IAAIA,GAAG,CAACJ,UAAX,IAAyBI,GAAG,CAACJ,UAAJ,CAAekB,MAA5C,EAAoD;AAChD,UAAIS,GAAG,GAAGvB,GAAG,CAACJ,UAAd;AACA,UAAI6B,EAAE,GAAG,KAAK,CAAd;AACA,UAAIyJ,aAAa,GAAGD,KAApB;AACA,UAAIjE,GAAG,GAAG,EAAV;;AACA,UAAI9G,IAAI,CAACiL,SAAT,EAAoB;AAChBD,QAAAA,aAAa,GAAGhL,IAAI,CAACiL,SAArB;AACH;;AACD,WAAK,IAAI9J,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGE,GAAG,CAACT,MAAxB,EAAgCO,CAAC,EAAjC,EAAqC;AACjCI,QAAAA,EAAE,GAAG/C,QAAQ,CAACkB,UAAT,CAAoB2B,GAAG,CAACF,CAAD,CAAH,CAAOvB,IAA3B,CAAL;;AACA,YAAI2B,EAAJ,EAAQ;AACJuF,UAAAA,GAAG,CAACzF,GAAG,CAACF,CAAD,CAAH,CAAOQ,KAAP,GAAe,KAAf,GAAuBN,GAAG,CAACF,CAAD,CAAH,CAAOvB,IAA/B,CAAH,GAA0C2B,EAAE,CAACyJ,aAAD,EAAgB3J,GAAG,CAACF,CAAD,CAAH,CAAOQ,KAAvB,CAA5C;AACH;AACJ;;AACDE,MAAAA,IAAI,CAACnC,UAAL,GAAkBoH,GAAlB;AACH;;AACD,QAAI/F,GAAG,GAAG,KAAV;AACA,QAAImK,gBAAgB,GAAGtN,KAAK,CAACsL,OAAN,CAAclJ,IAAI,CAACS,MAAnB,KAA8BT,IAAI,CAACS,MAAL,CAAYG,MAA1C,IAAoD,CAACvC,iBAAiB,CAAC2B,IAAI,CAACS,MAAL,CAAY,CAAZ,EAAeM,GAAf,CAAD,CAA7F;;AACA,QAAIjB,GAAG,IAAIA,GAAG,CAACwG,MAAX,IAAqBxG,GAAG,CAACwG,MAAJ,CAAW1F,MAAhC,IAA0C,CAACsK,gBAA/C,EAAiE;AAC7D,UAAI5E,MAAM,GAAGxG,GAAG,CAACwG,MAAjB;;AACA,WAAK,IAAInF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmF,MAAM,CAAC1F,MAA3B,EAAmCO,CAAC,EAApC,EAAwC;AACpC,YAAIkB,KAAK,GAAG,IAAZ;;AACA,YAAI,CAAChE,iBAAiB,CAAC0K,OAAD,CAAtB,EAAiC;AAC7BA,UAAAA,OAAO,GAAGvK,QAAQ,CAACa,KAAT,CAAe0J,OAAf,EAAwBzC,MAAM,CAACnF,CAAD,CAA9B,CAAV;AACH;;AACD,YAAIgK,UAAU,GAAG1M,KAAK,CAACqE,aAAN,CAAoB7C,KAAK,CAACqB,OAA1B,EAAmC,SAAnC,EAA8CH,CAA9C,EAAiDM,CAAlE;AACAsJ,QAAAA,KAAK,GAAGvM,QAAQ,CAACa,KAAT,CAAe0L,KAAf,EAAsBzE,MAAM,CAACnF,CAAD,CAA5B,EAAiCrB,GAAG,CAACJ,UAArC,EAAiD2C,KAAjD,EAAwD0G,OAAxD,EAAiEoC,UAAU,CAAC5I,QAA5E,CAAR;AACH;;AACDV,MAAAA,IAAI,CAACpB,MAAL,GAAcsK,KAAd;AACH;;AACD,WAAOlJ,IAAP;AACH,GApCD;;AAqCA+D,EAAAA,UAAU,CAAC3H,SAAX,CAAqB6H,eAArB,GAAuC,UAAU7F,KAAV,EAAiB;AACpD,QAAIkC,GAAG,GAAG;AAAEkE,MAAAA,KAAK,EAAE,EAAT;AAAaC,MAAAA,MAAM,EAAE,EAArB;AAAyBC,MAAAA,OAAO,EAAE,EAAlC;AAAsCC,MAAAA,QAAQ,EAAE,EAAhD;AAAoD9G,MAAAA,UAAU,EAAE;AAAhE,KAAV;AACAyC,IAAAA,GAAG,CAACkE,KAAJ,GAAY5H,KAAK,CAACqE,aAAN,CAAoB7C,KAAK,CAACqB,OAA1B,EAAmC,UAAnC,CAAZ;AACAa,IAAAA,GAAG,CAACmE,MAAJ,GAAa7H,KAAK,CAACqE,aAAN,CAAoB7C,KAAK,CAACqB,OAA1B,EAAmC,SAAnC,CAAb;AACAa,IAAAA,GAAG,CAACoE,OAAJ,GAAc9H,KAAK,CAACqE,aAAN,CAAoB7C,KAAK,CAACqB,OAA1B,EAAmC,SAAnC,CAAd;AACAa,IAAAA,GAAG,CAACqE,QAAJ,GAAe/H,KAAK,CAACqE,aAAN,CAAoB7C,KAAK,CAACqB,OAA1B,EAAmC,UAAnC,CAAf;AACAa,IAAAA,GAAG,CAACzC,UAAJ,GAAiBjB,KAAK,CAACqE,aAAN,CAAoB7C,KAAK,CAACqB,OAA1B,EAAmC,cAAnC,CAAjB;AACA,WAAOa,GAAP;AACH,GARD;;AASAyD,EAAAA,UAAU,CAAC3H,SAAX,CAAqBmN,SAArB,GAAiC,UAAUrM,OAAV,EAAmB;AAChD,QAAIoD,GAAG,GAAGpD,OAAO,CAAC0I,SAAlB;;AACA,QAAI1I,OAAO,CAACkH,MAAR,CAAerF,MAAnB,EAA2B;AACvBuB,MAAAA,GAAG,CAAC8D,MAAJ,GAAa,EAAb;AACH;;AACD,SAAK,IAAIiB,EAAE,GAAG,CAAT,EAAYQ,EAAE,GAAG3I,OAAO,CAACkH,MAA9B,EAAsCiB,EAAE,GAAGQ,EAAE,CAAC9G,MAA9C,EAAsDsG,EAAE,EAAxD,EAA4D;AACxD,UAAInE,GAAG,GAAG2E,EAAE,CAACR,EAAD,CAAZ;;AACA,UAAI/E,GAAG,CAACY,GAAG,CAAChC,GAAL,CAAP,EAAkB;AACd,cAAM,IAAIsK,KAAJ,CAAU,0EAAV,CAAN;AACH;;AACDlJ,MAAAA,GAAG,CAACY,GAAG,CAAChC,GAAL,CAAH,GAAegC,GAAG,CAAC3B,KAAnB;;AACA,UAAI2B,GAAG,CAACxB,EAAR,EAAY;AACRY,QAAAA,GAAG,CAACY,GAAG,CAAChC,GAAL,CAAH,GAAegC,GAAG,CAACxB,EAAJ,CAAOG,IAAP,CAAY3C,OAAO,CAACkB,KAApB,EAA2B8C,GAAG,CAAChC,GAA/B,EAAoChC,OAAO,CAACkB,KAA5C,EAAmDlB,OAAO,CAACkE,EAA3D,CAAf;AACH;;AACDd,MAAAA,GAAG,CAAC8D,MAAJ,CAAWlD,GAAG,CAAChC,GAAf,IAAsBoB,GAAG,CAACY,GAAG,CAAChC,GAAL,CAAzB;AACH;AACJ,GAhBD;;AAiBA,SAAO6E,UAAP;AACH,CAjc+B,CAic9B/G,OAjc8B,CAAhC;;AAkcA,SAAS+G,UAAT;AACA;AACA;AACA;AACA;;AACA,IAAI0F,YAAY;AAAG;AAAe,UAAUlL,MAAV,EAAkB;AAChD/C,EAAAA,SAAS,CAACiO,YAAD,EAAelL,MAAf,CAAT;;AACA,WAASkL,YAAT,CAAsBC,KAAtB,EAA6B;AACzB,QAAIC,KAAK,GAAGpL,MAAM,CAACsB,IAAP,CAAY,IAAZ,KAAqB,IAAjC,CADyB,CAEzB;;;AACA8J,IAAAA,KAAK,CAACzM,OAAN,GAAgBX,MAAM,CAAC,EAAD,EAAKoN,KAAK,CAACzM,OAAX,EAAoB;AACtCE,MAAAA,WAAW,EAAE,KADyB;AAEtCwM,MAAAA,MAAM,EAAE,uEAF8B;AAGtCC,MAAAA,eAAe,EAAE,iBAHqB;AAItCxM,MAAAA,MAAM,EAAE,UAJ8B;AAKtCC,MAAAA,MAAM,EAAE,SAL8B;AAMtCC,MAAAA,IAAI,EAAE,OANgC;AAOtCE,MAAAA,IAAI,EAAE,MAPgC;AAQtCE,MAAAA,KAAK,EAAE,cAR+B;AAStCC,MAAAA,KAAK,EAAE,SAT+B;AAUtCE,MAAAA,MAAM,EAAE,SAV8B;AAWtCgM,MAAAA,KAAK,EAAE,QAX+B;AAYtCC,MAAAA,SAAS,EAAE,cAZ2B;AAatCC,MAAAA,QAAQ,EAAE,QAb4B;AActCC,MAAAA,SAAS,EAAE,cAd2B;AAetCC,MAAAA,YAAY,EAAE,0CAfwB;AAgBtCC,MAAAA,gBAAgB,EAAE,oEAhBoB;AAiBtCC,MAAAA,yBAAyB,EAAE,gDAjBW;AAkBtCC,MAAAA,UAAU,EAAE;AAlB0B,KAApB,CAAtB;AAoBA9N,IAAAA,MAAM,CAACoN,KAAK,CAACzM,OAAP,EAAgBwM,KAAK,IAAI,EAAzB,CAAN;AACA,WAAOC,KAAP;AACH;;AACDF,EAAAA,YAAY,CAACrN,SAAb,CAAuB8I,aAAvB,GAAuC,YAAY;AAC/C,WAAO,cAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;;;AACIuE,EAAAA,YAAY,CAACrN,SAAb,CAAuBkO,WAAvB,GAAqC,UAAUC,SAAV,EAAqBnM,KAArB,EAA4BoM,YAA5B,EAA0C;AAC3E,QAAIC,WAAW,GAAG,EAAlB;AACA,QAAI/E,QAAJ;AACA,QAAIgF,IAAJ;AACA,QAAIpD,GAAG,GAAGiD,SAAS,CAAChL,KAApB;AACA,QAAIxB,IAAI,GAAG,OAAOuJ,GAAlB;AACA,QAAIxH,KAAK,GAAGyK,SAAS,CAACzK,KAAV,GAAkB2J,YAAY,CAACkB,QAAb,CAAsBJ,SAAS,CAACzK,KAAhC,CAAlB,GAA2D,IAAvE;;AACA,QAAIwH,GAAG,YAAYxD,IAAnB,EAAyB;AACrBwD,MAAAA,GAAG,GAAG,eAAe3K,QAAQ,CAACsJ,KAAT,CAAe2E,QAAf,CAAwBtD,GAAxB,CAAf,GAA8C,IAApD;AACH;;AACD,QAAIvJ,IAAI,KAAK,QAAb,EAAuB;AACnBuJ,MAAAA,GAAG,GAAGA,GAAG,CAACxE,OAAJ,CAAY,GAAZ,EAAiB,IAAjB,CAAN;AACAwE,MAAAA,GAAG,GAAGuD,kBAAkB,CAACvD,GAAD,CAAxB;AACAA,MAAAA,GAAG,GAAG,OAAOA,GAAP,GAAa,IAAnB;;AACA,UAAIkD,YAAJ,EAAkB;AACd1K,QAAAA,KAAK,GAAG,UAAUA,KAAV,GAAkB,mBAA1B;AACH;;AACD,UAAInD,QAAQ,CAACsJ,KAAT,CAAe6E,MAAf,CAAsBxD,GAAtB,CAAJ,EAAgC;AAC5BoD,QAAAA,IAAI,GAAG,MAAP;AACH;;AACD,UAAIH,SAAS,CAAChI,UAAd,EAA0B;AACtB,YAAI,CAACmI,IAAL,EAAW;AACP5K,UAAAA,KAAK,GAAG,aAAaA,KAAb,GAAqB,GAA7B;AACH;;AACDwH,QAAAA,GAAG,GAAGA,GAAG,CAACyD,WAAJ,EAAN;AACH;AACJ;;AACDrF,IAAAA,QAAQ,GAAG/I,QAAQ,CAACqO,YAAT,CAAsBT,SAAS,CAAC7E,QAAhC,CAAX;;AACA,QAAIA,QAAJ,EAAc;AACV+E,MAAAA,WAAW,IAAI3K,KAAf;AACA2K,MAAAA,WAAW,IAAI/E,QAAf;;AACA,UAAIgF,IAAJ,EAAU;AACND,QAAAA,WAAW,IAAIC,IAAf;AACH;;AACD,aAAOD,WAAW,GAAGnD,GAArB;AACH;;AACD,QAAI,CAAC9K,iBAAiB,CAAC,KAAK0I,aAAN,CAAlB,IAA0C,KAAKA,aAAL,OAAyB,gBAAvE,EAAyF;AACrFQ,MAAAA,QAAQ,GAAG/I,QAAQ,CAACsO,eAAT,CAAyBV,SAAS,CAAC7E,QAAnC,CAAX;AACH,KAFD,MAGK;AACDA,MAAAA,QAAQ,GAAG/I,QAAQ,CAACuO,aAAT,CAAuBX,SAAS,CAAC7E,QAAjC,CAAX;AACH;;AACD,QAAIA,QAAQ,KAAK,aAAjB,EAAgC;AAC5B,UAAIpB,IAAI,GAAGgD,GAAX;AACAA,MAAAA,GAAG,GAAGxH,KAAN;AACAA,MAAAA,KAAK,GAAGwE,IAAR;AACH;;AACDmG,IAAAA,WAAW,IAAI/E,QAAQ,GAAG,GAA1B;AACA+E,IAAAA,WAAW,IAAI3K,KAAK,GAAG,GAAvB;;AACA,QAAI4K,IAAJ,EAAU;AACND,MAAAA,WAAW,IAAIC,IAAf;AACH;;AACDD,IAAAA,WAAW,IAAInD,GAAG,GAAG,GAArB;AACA,WAAOmD,WAAP;AACH,GAtDD;;AAuDAhB,EAAAA,YAAY,CAACrN,SAAb,CAAuBmN,SAAvB,GAAmC,UAAUrM,OAAV,EAAmB;AAClDqB,IAAAA,MAAM,CAACnC,SAAP,CAAiBmN,SAAjB,CAA2B1J,IAA3B,CAAgC,IAAhC,EAAsC3C,OAAtC;;AACA,WAAOA,OAAO,CAAC0I,SAAR,CAAkBxB,MAAzB;AACH,GAHD;AAIA;AACJ;AACA;AACA;AACA;;;AACIqF,EAAAA,YAAY,CAACrN,SAAb,CAAuB+O,kBAAvB,GAA4C,UAAUZ,SAAV,EAAqBnM,KAArB,EAA4BoM,YAA5B,EAA0C;AAClF,QAAIvF,GAAG,GAAG,EAAV;;AACA,SAAK,IAAI3F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiL,SAAS,CAACa,UAAV,CAAqBrM,MAAzC,EAAiDO,CAAC,EAAlD,EAAsD;AAClD2F,MAAAA,GAAG,CAACtF,IAAJ,CAAS,MAAM,KAAK0L,WAAL,CAAiBd,SAAS,CAACa,UAAV,CAAqB9L,CAArB,CAAjB,EAA0ClB,KAA1C,EAAiDoM,YAAjD,CAAN,GAAuE,GAAhF;AACH;;AACD,WAAOvF,GAAG,CAACqG,IAAJ,CAAS,MAAMf,SAAS,CAACgB,SAAhB,GAA4B,GAArC,CAAP;AACH,GAND;AAOA;AACJ;AACA;AACA;AACA;;;AACI9B,EAAAA,YAAY,CAACrN,SAAb,CAAuBiP,WAAvB,GAAqC,UAAUxJ,MAAV,EAAkBzD,KAAlB,EAAyBoM,YAAzB,EAAuC;AACxE,WAAO3I,MAAM,CAAC2J,SAAP,GAAmB,KAAKL,kBAAL,CAAwBtJ,MAAxB,EAAgCzD,KAAhC,EAAuCoM,YAAvC,CAAnB,GAA0E,KAAKF,WAAL,CAAiBzI,MAAjB,EAAyBzD,KAAzB,EAAgCoM,YAAhC,CAAjF;AACH,GAFD;AAGA;AACJ;AACA;AACA;;;AACIf,EAAAA,YAAY,CAACrN,SAAb,CAAuBmE,OAAvB,GAAiC,UAAUmE,OAAV,EAAmB;AAChD,QAAI,KAAKzG,GAAL,CAASP,MAAb,EAAqB;AACjBgH,MAAAA,OAAO,CAAC/E,IAAR,CAAa,KAAK0L,WAAL,CAAiB,KAAKpN,GAAL,CAASP,MAA1B,EAAkC,IAAlC,EAAwC,IAAxC,CAAb;AACH;;AACD,WAAOgH,OAAO,CAAC4G,IAAR,CAAa,OAAb,CAAP;AACH,GALD;AAMA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI7B,EAAAA,YAAY,CAACrN,SAAb,CAAuBqP,YAAvB,GAAsC,UAAU7L,CAAV,EAAa;AAC/C,QAAIA,CAAC,CAAC6F,MAAF,IAAY7F,CAAC,CAAC6F,MAAF,CAAS1G,MAAT,KAAoB,CAApC,EAAuC;AACnCpC,MAAAA,QAAQ,CAAC+O,UAAT,CAAoB,wEAApB;AACH;;AACD,QAAI7J,MAAM,GAAG,KAAK5D,GAAL,CAASP,MAAT,IAAmB,EAAhC;;AACA,SAAK,IAAI4B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGM,CAAC,CAAC6F,MAAF,CAAS1G,MAA7B,EAAqCO,CAAC,EAAtC,EAA0C;AACtCuC,MAAAA,MAAM,CAAClC,IAAP,CAAY,IAAI9C,SAAJ,CAAc+C,CAAC,CAAC6F,MAAF,CAASnG,CAAT,CAAd,EAA2BM,CAAC,CAAC8F,QAA7B,EAAuC9F,CAAC,CAACV,GAAzC,EAA8CU,CAAC,CAAC2C,UAAhD,CAAZ;AACH;;AACD,SAAKtE,GAAL,CAASP,MAAT,GAAkBmE,MAAlB;AACH,GATD;AAUA;AACJ;AACA;AACA;;;AACI4H,EAAAA,YAAY,CAACrN,SAAb,CAAuB6F,QAAvB,GAAkC,UAAUrC,CAAV,EAAa;AAC3C,SAAK3B,GAAL,CAASP,MAAT,GAAkBb,SAAS,CAACoM,EAAV,CAAa,KAAKhL,GAAL,CAASP,MAAtB,CAAlB;AACA,WAAO,EAAP;AACH,GAHD;AAIA;AACJ;AACA;AACA;;;AACI+L,EAAAA,YAAY,CAACrN,SAAb,CAAuBuP,UAAvB,GAAoC,UAAU/L,CAAV,EAAa;AAC7C,QAAIqF,GAAG,GAAG,EAAV;;AACA,QAAIrF,CAAC,CAACiF,IAAF,YAAkB9I,KAAtB,EAA6B;AACzB,WAAK,IAAIuD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGM,CAAC,CAACiF,IAAF,CAAO9F,MAA3B,EAAmCO,CAAC,EAApC,EAAwC;AACpC2F,QAAAA,GAAG,CAACtF,IAAJ,CAAS8J,YAAY,CAACkB,QAAb,CAAsB/K,CAAC,CAACiF,IAAF,CAAOvF,CAAP,CAAtB,KAAoCM,CAAC,CAACkF,SAAF,KAAgB,YAAhB,GAA+B,OAA/B,GAAyC,EAA7E,CAAT;AACH;AACJ,KAJD,MAKK;AACDG,MAAAA,GAAG,CAACtF,IAAJ,CAAS8J,YAAY,CAACkB,QAAb,CAAsB/K,CAAC,CAACiF,IAAxB,KAAiCjF,CAAC,CAACkF,SAAF,KAAgB,YAAhB,GAA+B,OAA/B,GAAyC,EAA1E,CAAT;AACH;;AACD,WAAOG,GAAG,CAACqG,IAAJ,CAAS,GAAT,CAAP;AACH,GAXD;AAYA;AACJ;AACA;AACA;;;AACI7B,EAAAA,YAAY,CAACrN,SAAb,CAAuBqG,QAAvB,GAAkC,UAAU7C,CAAV,EAAa;AAC3C,WAAOA,CAAC,CAACgM,OAAF,GAAYN,IAAZ,CAAiB,GAAjB,CAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;;;AACI7B,EAAAA,YAAY,CAACrN,SAAb,CAAuB2G,OAAvB,GAAiC,UAAUnD,CAAV,EAAa;AAC1C,SAAK3B,GAAL,CAASwG,MAAT,GAAkB7E,CAAlB;AACA,WAAO,EAAP;AACH,GAHD;AAIA;AACJ;AACA;AACA;;;AACI6J,EAAAA,YAAY,CAACrN,SAAb,CAAuBqH,QAAvB,GAAkC,UAAU7D,CAAV,EAAa;AAC3C,SAAK,IAAIN,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGM,CAAC,CAACb,MAAtB,EAA8BO,CAAC,EAA/B,EAAmC;AAC/BM,MAAAA,CAAC,CAACN,CAAD,CAAD,GAAOmK,YAAY,CAACkB,QAAb,CAAsB/K,CAAC,CAACN,CAAD,CAAvB,CAAP;AACH;;AACD,WAAOM,CAAC,CAAC0L,IAAF,CAAO,GAAP,CAAP;AACH,GALD;AAMA;AACJ;AACA;AACA;AACA;;;AACI7B,EAAAA,YAAY,CAACrN,SAAb,CAAuB4F,YAAvB,GAAsC,UAAUpC,CAAV,EAAa;AAC/C,SAAK3B,GAAL,CAASJ,UAAT,GAAsB+B,CAAtB;AACA,WAAO,EAAP;AACH,GAHD;AAIA;AACJ;AACA;AACA;AACA;;;AACI6J,EAAAA,YAAY,CAACrN,SAAb,CAAuByP,OAAvB,GAAiC,UAAUjM,CAAV,EAAa;AAC1C,WAAOA,CAAC,KAAK,IAAN,GAAa,UAAb,GAA0B,EAAjC;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI6J,EAAAA,YAAY,CAACrN,SAAb,CAAuBsM,UAAvB,GAAoC,UAAUtH,EAAV,EAAcmD,OAAd,EAAuBuH,QAAvB,EAAiC;AACjE,QAAInP,QAAQ,CAACiG,QAAT,CAAkBkJ,QAAQ,CAACzH,GAA3B,EAAgC,KAAKnH,OAAL,CAAa4M,KAA7C,KAAuDgC,QAAQ,CAAC/N,IAAT,CAAcgN,WAAd,OAAgC,MAA3F,EAAmG;AAC/FxG,MAAAA,OAAO,CAACwH,gBAAR,CAAyB,QAAzB,EAAmC,KAAK7O,OAAL,CAAa2M,eAAhD;AACAtF,MAAAA,OAAO,CAACwH,gBAAR,CAAyB,oBAAzB,EAA+C,KAA/C;AACAxH,MAAAA,OAAO,CAACyH,gBAAR,CAAyB,oCAAzB;AACH,KAJD,MAKK;AACDzH,MAAAA,OAAO,CAACwH,gBAAR,CAAyB,QAAzB,EAAmC,KAAK7O,OAAL,CAAa0M,MAAhD;AACH;;AACDrF,IAAAA,OAAO,CAACwH,gBAAR,CAAyB,oBAAzB,EAA+C,KAA/C;AACAxH,IAAAA,OAAO,CAACwH,gBAAR,CAAyB,uBAAzB,EAAkD,KAAlD;AACH,GAXD;AAYA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACItC,EAAAA,YAAY,CAACrN,SAAb,CAAuB8B,eAAvB,GAAyC,UAAUC,IAAV,EAAgBlB,EAAhB,EAAoBmB,KAApB,EAA2BC,GAA3B,EAAgCkG,OAAhC,EAAyClD,OAAzC,EAAkD;AACvF,QAAI4K,SAAS,GAAG,gBAAhB;;AACA,QAAK1H,OAAO,IAAIA,OAAO,CAACxG,IAAR,KAAiB,KAA7B,IAAuC,CAAC,KAAKmO,OAA7C,IAAwD/N,IAAI,CAAC8N,SAAD,CAAhE,EAA6E;AACzE,UAAIE,QAAQ,GAAGhO,IAAI,CAAC8N,SAAD,CAAJ,CAAgBG,KAAhB,CAAsB,aAAtB,CAAf;AACA,WAAKF,OAAL,GAAeC,QAAQ,CAAC,CAAD,CAAvB;AACA,WAAKE,iBAAL,GAAyBF,QAAQ,CAAC,CAAD,CAAjC;AACH;;AACD,QAAIhG,OAAO,GAAG,SAAd;;AACA,QAAI,CAAC3J,iBAAiB,CAAC2B,IAAI,CAACzC,CAAN,CAAtB,EAAgC;AAC5B,UAAI4Q,QAAQ,GAAKlO,KAAK,IAAIA,KAAK,CAAC+B,eAAhB,GAAmChC,IAAI,CAACzC,CAAL,CAAO6Q,OAA1C,GAAoDpO,IAAI,CAACzC,CAAzE;AACA,UAAI8Q,QAAQ,GAAG,YAAf;;AACA,UAAI,CAAChQ,iBAAiB,CAAC8P,QAAD,CAAtB,EAAkC;AAC9B,aAAK,IAAIhN,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgN,QAAQ,CAACvN,MAA7B,EAAqCO,CAAC,EAAtC,EAA0C;AACtC,cAAI,CAAC9C,iBAAiB,CAAC8P,QAAQ,CAAChN,CAAD,CAAR,CAAYkN,QAAZ,CAAD,CAAtB,EAA+C;AAC3C,mBAAOF,QAAQ,CAAChN,CAAD,CAAR,CAAYkN,QAAZ,CAAP;AACH;AACJ;AACJ;AACJ;;AACD,QAAIvO,GAAG,GAAGsG,OAAO,IAAIA,OAAO,CAAC4B,OAAD,CAA5B;AACA,QAAIsG,aAAa,GAAG,KAAKC,oBAAL,CAA0BvO,IAA1B,EAAgCC,KAAhC,EAAuCC,GAAvC,EAA4CkG,OAA5C,EAAqDlD,OAArD,CAApB;;AACA,QAAIoL,aAAJ,EAAmB;AACf,aAAOA,aAAP;AACH;;AACD,QAAIE,YAAY,GAAGtO,GAAG,IAAIkG,OAAO,CAACsC,iBAAR,CAA0B,oBAA1B,CAA1B;AACA,QAAIlJ,KAAK,GAAG,IAAZ;AACA,QAAIiP,OAAO,GAAID,YAAY,IAAIE,QAAQ,CAACF,YAAD,EAAe,EAAf,CAAzB,IAAgD,CAA9D;;AACA,QAAIvO,KAAK,IAAIA,KAAK,CAAC+B,eAAnB,EAAoC;AAChC,UAAI2M,UAAU,GAAG,SAAjB;;AACA,UAAI3O,IAAI,CAAC2O,UAAD,CAAJ,IAAoB3O,IAAI,CAAC,aAAD,CAA5B,EAA6C;AACzCR,QAAAA,KAAK,GAAGQ,IAAI,CAAC2O,UAAD,CAAJ,IAAoB3O,IAAI,CAAC,aAAD,CAAhC;AACH;;AACD,UAAIA,IAAI,CAACzC,CAAT,EAAY;AACRyC,QAAAA,IAAI,GAAGA,IAAI,CAACzC,CAAZ;AACH;;AACD,UAAIyC,IAAI,CAAC2O,UAAD,CAAJ,IAAoB3O,IAAI,CAAC,aAAD,CAA5B,EAA6C;AACzCR,QAAAA,KAAK,GAAGQ,IAAI,CAAC2O,UAAD,CAAJ,IAAoB3O,IAAI,CAAC,aAAD,CAAhC;AACH;AACJ;;AACD,QAAIyO,OAAO,KAAK,CAAZ,IAAiBzO,IAAI,CAACoB,KAA1B,EAAiC;AAC7BpB,MAAAA,IAAI,GAAGA,IAAI,CAACoB,KAAZ;AACH;;AACD,QAAIpB,IAAI,CAACzC,CAAT,EAAY;AACRyC,MAAAA,IAAI,GAAGA,IAAI,CAACzC,CAAZ;AACH;;AACD,QAAIkR,OAAO,GAAG,CAAV,IAAezO,IAAI,CAACoO,OAAxB,EAAiC;AAC7BpO,MAAAA,IAAI,GAAGA,IAAI,CAACoO,OAAZ;AACH;;AACD,QAAIvM,IAAI,GAAG,EAAX;AACAA,IAAAA,IAAI,CAACrC,KAAL,GAAaA,KAAb;AACAqC,IAAAA,IAAI,CAACpB,MAAL,GAAcT,IAAd;AACA,SAAKqJ,kBAAL,CAAwBvJ,GAAxB,EAA6BE,IAA7B,EAAmC6B,IAAnC,EAAyC,IAAzC,EAA+C5B,KAA/C;AACA,WAAOzB,QAAQ,CAAC6I,MAAT,CAAgB7H,KAAhB,IAAyBqC,IAAI,CAACpB,MAA9B,GAAuC;AAAEA,MAAAA,MAAM,EAAEoB,IAAI,CAACpB,MAAf;AAAuBjB,MAAAA,KAAK,EAAEqC,IAAI,CAACrC,KAAnC;AAA0CE,MAAAA,UAAU,EAAEmC,IAAI,CAACnC;AAA3D,KAA9C;AACH,GArDD;AAsDA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI4L,EAAAA,YAAY,CAACrN,SAAb,CAAuBiK,oBAAvB,GAA8C,UAAU9B,OAAV,EAAmBnG,KAAnB,EAA0BgD,EAA1B,EAA8B;AACxE,QAAI6D,GAAG,GAAG,EAAV;AACA,QAAIuD,KAAK,GAAG,OAAZ;AACA,QAAI9E,SAAS,GAAGa,OAAO,CAACiE,KAAD,CAAP,IAAkB,EAAlC;AACA,QAAIuE,MAAM,GAAG,SAAb;AACA,WAAOxI,OAAO,CAACiE,KAAD,CAAd;;AACA,QAAIpH,EAAE,CAACpD,UAAH,CAAcgP,cAAlB,EAAkC;AAC9BzI,MAAAA,OAAO,CAACwI,MAAD,CAAP,GAAkB,MAAlB;AACH;;AACD,QAAI3H,IAAI,GAAGxJ,MAAM,CAACwJ,IAAP,CAAYb,OAAZ,CAAX;;AACA,SAAK,IAAIc,EAAE,GAAG,CAAT,EAAY4H,MAAM,GAAG7H,IAA1B,EAAgCC,EAAE,GAAG4H,MAAM,CAAClO,MAA5C,EAAoDsG,EAAE,EAAtD,EAA0D;AACtD,UAAIE,IAAI,GAAG0H,MAAM,CAAC5H,EAAD,CAAjB;AACAJ,MAAAA,GAAG,CAACtF,IAAJ,CAAS4F,IAAI,GAAG,GAAP,GAAahB,OAAO,CAACgB,IAAD,CAA7B;AACH;;AACDN,IAAAA,GAAG,GAAGA,GAAG,CAACqG,IAAJ,CAAS,GAAT,CAAN;;AACA,QAAIlK,EAAE,CAACpD,UAAH,CAAcqG,GAAd,IAAqBjD,EAAE,CAACpD,UAAH,CAAcqG,GAAd,CAAkBiC,OAAlB,CAA0B,GAA1B,MAAmC,CAAC,CAAzD,IAA8D,CAAC5C,SAAnE,EAA8E;AAC1E,aAAOuB,GAAP;AACH;;AACD,WAAOA,GAAG,CAAClG,MAAJ,GAAa2E,SAAS,GAAG,GAAZ,GAAkBuB,GAA/B,GAAqCvB,SAAS,IAAI,EAAzD;AACH,GAnBD;;AAoBA+F,EAAAA,YAAY,CAACrN,SAAb,CAAuB8Q,iBAAvB,GAA2C,UAAUhO,GAAV,EAAeiO,UAAf,EAA2B;AAClE,SAAK,IAAI9H,EAAE,GAAG,CAAT,EAAYQ,EAAE,GAAG,CAACrJ,iBAAiB,CAAC2Q,UAAD,CAAlB,GAAiCvR,MAAM,CAACwJ,IAAP,CAAY+H,UAAZ,CAAjC,GAA2D,EAAjF,EAAqF9H,EAAE,GAAGQ,EAAE,CAAC9G,MAA7F,EAAqGsG,EAAE,EAAvG,EAA2G;AACvG,UAAIE,IAAI,GAAGM,EAAE,CAACR,EAAD,CAAb;;AACA,UAAK8H,UAAU,CAAC5H,IAAD,CAAV,YAA4BzB,IAAjC,EAAwC;AACpCqJ,QAAAA,UAAU,CAAC5H,IAAD,CAAV,GAAmB5I,QAAQ,CAACyQ,SAAT,CAAmBC,WAAnB,CAA+BF,UAAU,CAAC5H,IAAD,CAAzC,CAAnB;AACH;AACJ;;AACD,WAAO4H,UAAP;AACH,GARD;AASA;AACJ;AACA;AACA;AACA;AACA;;;AACI1D,EAAAA,YAAY,CAACrN,SAAb,CAAuBqF,MAAvB,GAAgC,UAAUL,EAAV,EAAcjD,IAAd,EAAoBuF,SAApB,EAA+B;AAC3D,WAAO;AACHW,MAAAA,GAAG,EAAE,CAACjD,EAAE,CAACpD,UAAH,CAAc2K,SAAd,IAA2BvH,EAAE,CAACpD,UAAH,CAAcqG,GAA1C,EAA+CvB,OAA/C,CAAuD,MAAvD,EAA+DY,SAAS,GAAG,MAAMA,SAAT,GAAqB,EAA7F,CADF;AAEHvF,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAe7H,IAAf,EAAqB,KAAKjB,OAAL,CAAaoQ,SAAb,GAAyB,KAAKJ,iBAA9B,GAAkD,IAAvE;AAFH,KAAP;AAIH,GALD;AAMA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIzD,EAAAA,YAAY,CAACrN,SAAb,CAAuBwF,MAAvB,GAAgC,UAAUR,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0C;AACtE,QAAIW,GAAJ;;AACA,QAAI,OAAO9E,KAAP,KAAiB,QAAjB,IAA6B,CAAC5C,QAAQ,CAACsJ,KAAT,CAAe6E,MAAf,CAAsBvL,KAAtB,CAAlC,EAAgE;AAC5D8E,MAAAA,GAAG,GAAG,OAAO9E,KAAP,GAAe,IAArB;AACH,KAFD,MAGK;AACD8E,MAAAA,GAAG,GAAG,MAAM9E,KAAN,GAAc,GAApB;AACH;;AACD,WAAO;AACHxB,MAAAA,IAAI,EAAE,QADH;AAEHsG,MAAAA,GAAG,EAAE,CAACjD,EAAE,CAACpD,UAAH,CAAcmK,SAAd,IAA2B/G,EAAE,CAACpD,UAAH,CAAcqG,GAA1C,EAA+CvB,OAA/C,CAAuD,MAAvD,EAA+DY,SAAS,GAAG,MAAMA,SAAT,GAAqB,EAA7F,IAAmGW;AAFrG,KAAP;AAIH,GAZD;AAaA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIoF,EAAAA,YAAY,CAACrN,SAAb,CAAuBuF,MAAvB,GAAgC,UAAUP,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0CtF,KAA1C,EAAiD4J,QAAjD,EAA2D;AACvF,QAAI,KAAK9K,OAAL,CAAamN,UAAb,KAA4B,OAA5B,IAAuC,CAAC7N,iBAAiB,CAACwL,QAAD,CAA7D,EAAyE;AACrEzI,MAAAA,KAAK,GAAG,KAAKgO,gBAAL,CAAsBhO,KAAtB,EAA6ByI,QAA7B,EAAuCnE,QAAvC,CAAR;AACH;;AACD,QAAIQ,GAAJ;;AACA,QAAI,OAAO9E,KAAK,CAACsE,QAAD,CAAZ,KAA2B,QAA3B,IAAuC,CAAClH,QAAQ,CAACsJ,KAAT,CAAe6E,MAAf,CAAsBvL,KAAK,CAACsE,QAAD,CAA3B,CAA5C,EAAoF;AAChFQ,MAAAA,GAAG,GAAG,OAAO9E,KAAK,CAACsE,QAAD,CAAZ,GAAyB,IAA/B;AACH,KAFD,MAGK;AACDQ,MAAAA,GAAG,GAAG,MAAM9E,KAAK,CAACsE,QAAD,CAAX,GAAwB,GAA9B;AACH;;AACD,WAAO;AACH9F,MAAAA,IAAI,EAAE,KAAKb,OAAL,CAAamN,UADhB;AAEHhG,MAAAA,GAAG,EAAE,CAACjD,EAAE,CAACpD,UAAH,CAAc6K,SAAd,IAA2BzH,EAAE,CAACpD,UAAH,CAAcqG,GAA1C,EAA+CvB,OAA/C,CAAuD,MAAvD,EAA+DY,SAAS,GAAG,MAAMA,SAAT,GAAqB,EAA7F,IAAmGW,GAFrG;AAGHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezG,KAAf,EAAsB,KAAKrC,OAAL,CAAaoQ,SAAb,GAAyB,KAAKJ,iBAA9B,GAAkD,IAAxE,CAHH;AAIHtD,MAAAA,MAAM,EAAE,KAAK1M,OAAL,CAAa0M;AAJlB,KAAP;AAMH,GAjBD;AAkBA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIH,EAAAA,YAAY,CAACrN,SAAb,CAAuB+E,YAAvB,GAAsC,UAAUC,EAAV,EAAcC,OAAd,EAAuBzB,CAAvB,EAA0BxB,KAA1B,EAAiC4J,QAAjC,EAA2C;AAC7E,QAAIwF,WAAW,GAAG5N,CAAC,CAAC8K,IAAF,GAAS/N,QAAQ,CAAC8Q,OAAT,CAAiB,KAAKvQ,OAAL,CAAa8M,QAA9B,CAA3B;AACA,QAAI3F,GAAG,GAAG,KAAK6H,OAAL,GAAe,KAAKA,OAAL,GAAe,GAAf,GAAqB,KAAKhP,OAAL,CAAa4M,KAAjD,GACN1I,EAAE,CAACpD,UAAH,CAAcqG,GAAd,CAAkBvB,OAAlB,CAA0B,MAA1B,EAAkC,MAAM,KAAK5F,OAAL,CAAa4M,KAArD,CADJ;AAEAlK,IAAAA,CAAC,CAACyE,GAAF,GAAQ,KAAKgI,iBAAL,GAAyB,KAAKA,iBAA9B,GAAkDzM,CAAC,CAACyE,GAA5D;AACA,QAAIrE,IAAI,GAAG;AACPqE,MAAAA,GAAG,EAAEzE,CAAC,CAACyE,GADA;AAEPnF,MAAAA,GAAG,EAAEU,CAAC,CAACV,GAFA;AAGPwO,MAAAA,GAAG,EAAE,CAHE;AAIPC,MAAAA,IAAI,EAAEhR,QAAQ,CAAC8Q,OAAT,CAAiB,KAAKvQ,OAAL,CAAa6M,SAA9B;AAJC,KAAX;AAMA,QAAIzJ,GAAG,GAAG,OAAOkN,WAAP,GAAqB,IAA/B;AACAlN,IAAAA,GAAG,IAAI,6CAA6CN,IAAI,CAAC2N,IAAL,CAAU7K,OAAV,CAAkB,IAAlB,EAAwB,EAAxB,CAA7C,GAA2E,IAAlF;AACA,SAAK7E,GAAL,CAAS8L,SAAT,GAAqB,CAArB;AACAzJ,IAAAA,GAAG,IAAI,KAAKsN,qBAAL,CAA2BvM,OAAO,CAACG,YAAnC,EAAiDxB,IAAjD,EAAuDoB,EAAvD,CAAP;AACAd,IAAAA,GAAG,IAAI,KAAKuN,qBAAL,CAA2BxM,OAAO,CAACK,cAAnC,EAAmD1B,IAAnD,EAAyDoB,EAAzD,EAA6D4G,QAAQ,GAAGA,QAAQ,CAACtG,cAAZ,GAA6B,EAAlG,CAAP;AACApB,IAAAA,GAAG,IAAI,KAAKwN,qBAAL,CAA2BzM,OAAO,CAACE,cAAnC,EAAmDvB,IAAnD,EAAyDoB,EAAzD,CAAP;AACAd,IAAAA,GAAG,IAAIN,IAAI,CAAC2N,IAAL,GAAY,MAAnB;AACArN,IAAAA,GAAG,IAAI,OAAOkN,WAAP,GAAqB,IAA5B;AACA,WAAO;AACHzP,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEA,GAFF;AAGH+D,MAAAA,QAAQ,EAAE,MAHP;AAIHhC,MAAAA,WAAW,EAAE,6CAA6CoH,WAJvD;AAKHrP,MAAAA,IAAI,EAAEmC;AALH,KAAP;AAOH,GA1BD;AA2BA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACImJ,EAAAA,YAAY,CAACrN,SAAb,CAAuB0R,qBAAvB,GAA+C,UAAUC,GAAV,EAAenO,CAAf,EAAkBwB,EAAlB,EAAsB;AACjE,QAAI,CAAC2M,GAAL,EAAU;AACN,aAAO,EAAP;AACH;;AACD,QAAIzN,GAAG,GAAG,EAAV;AACA,QAAI0N,IAAI,GAAG;AACP,gBAAU,SADH;AAEP,aAAO,UAAU7P,IAAV,EAAgBmB,CAAhB,EAAmBJ,GAAnB,EAAwB;AAC3B,YAAImF,GAAG,GAAG1H,QAAQ,CAAC0F,SAAT,CAAmBnD,GAAnB,EAAwBf,IAAI,CAACmB,CAAD,CAA5B,CAAV;;AACA,YAAI,OAAO+E,GAAP,KAAe,QAAf,IAA2B1H,QAAQ,CAACsJ,KAAT,CAAe6E,MAAf,CAAsBzG,GAAtB,CAA/B,EAA2D;AACvD,iBAAO,MAAMA,GAAN,GAAY,GAAnB;AACH,SAFD,MAGK,IAAIA,GAAG,YAAYP,IAAnB,EAAyB;AAC1B,cAAImK,QAAQ,GAAG9P,IAAI,CAACmB,CAAD,CAAJ,CAAQJ,GAAR,CAAf;AACA,iBAAO,MAAM+O,QAAQ,CAACC,MAAT,EAAN,GAA0B,GAAjC;AACH,SAHI,MAIA;AACD,iBAAO,OAAO7J,GAAP,GAAa,IAApB;AACH;AACJ,OAdM;AAeP,cAAQ,UAAUlG,IAAV,EAAgBmB,CAAhB,EAAmB;AAAE,eAAO,EAAP;AAAY;AAflC,KAAX;AAiBAgB,IAAAA,GAAG,GAAG,KAAK6N,mBAAL,CAAyBJ,GAAzB,EAA8BnO,CAA9B,EAAiCoO,IAAjC,EAAuC5M,EAAvC,CAAN;AACA,WAAOd,GAAG,GAAG,IAAb;AACH,GAxBD;AAyBA;AACJ;AACA;AACA;AACA;AACA;;;AACImJ,EAAAA,YAAY,CAACrN,SAAb,CAAuBwR,qBAAvB,GAA+C,UAAUG,GAAV,EAAenO,CAAf,EAAkBwB,EAAlB,EAAsB;AACjE,QAAI,CAAC2M,GAAL,EAAU;AACN,aAAO,EAAP;AACH;;AACD,QAAIzN,GAAG,GAAG,EAAV;AACA,QAAI0N,IAAI,GAAG;AACP,gBAAU,OADH;AAEP,aAAO,UAAU7P,IAAV,EAAgBmB,CAAhB,EAAmBJ,GAAnB,EAAwB;AAAE,eAAO,EAAP;AAAY,OAFtC;AAGP,cAAQ,UAAUf,IAAV,EAAgBmB,CAAhB,EAAmB;AAAE,eAAOyG,IAAI,CAACC,SAAL,CAAe7H,IAAI,CAACmB,CAAD,CAAnB,IAA0B,MAAjC;AAA0C;AAHhE,KAAX;AAKAgB,IAAAA,GAAG,GAAG,KAAK6N,mBAAL,CAAyBJ,GAAzB,EAA8BnO,CAA9B,EAAiCoO,IAAjC,EAAuC5M,EAAvC,CAAN;AACA,WAAOd,GAAP;AACH,GAZD;AAaA;AACJ;AACA;AACA;AACA;AACA;;;AACImJ,EAAAA,YAAY,CAACrN,SAAb,CAAuByR,qBAAvB,GAA+C,UAAUE,GAAV,EAAenO,CAAf,EAAkBwB,EAAlB,EAAsBgN,GAAtB,EAA2B;AACtE,QAAIzE,KAAK,GAAG,IAAZ;;AACA,QAAI,CAACoE,GAAL,EAAU;AACN,aAAO,EAAP;AACH;;AACD,QAAIzN,GAAG,GAAG,EAAV;AACAyN,IAAAA,GAAG,CAACM,OAAJ,CAAY,UAAUC,MAAV,EAAkB;AAAE,aAAOA,MAAM,GAAG3E,KAAK,CAAC4D,gBAAN,CAAuBe,MAAvB,EAA+BF,GAAG,CAACvM,MAAJ,CAAW,UAAU0M,CAAV,EAAa;AAAE,eAAO5R,QAAQ,CAAC0F,SAAT,CAAmBzC,CAAC,CAACV,GAArB,EAA0BqP,CAA1B,MAAiC5R,QAAQ,CAAC0F,SAAT,CAAmBzC,CAAC,CAACV,GAArB,EAA0BoP,MAA1B,CAAxC;AAA4E,OAAtG,EAAwG,CAAxG,CAA/B,EAA2I1O,CAAC,CAACV,GAA7I,CAAhB;AAAoK,KAApM;AACA,QAAI8O,IAAI,GAAG;AACP,gBAAU,KAAK9Q,OAAL,CAAamN,UAAb,GAA0B,GAD7B;AAEP,aAAO,UAAUlM,IAAV,EAAgBmB,CAAhB,EAAmBJ,GAAnB,EAAwB;AAC3B,YAAI,OAAOf,IAAI,CAACmB,CAAD,CAAJ,CAAQJ,GAAR,CAAP,KAAwB,QAAxB,IAAoCvC,QAAQ,CAACsJ,KAAT,CAAe6E,MAAf,CAAsB3M,IAAI,CAACmB,CAAD,CAAJ,CAAQJ,GAAR,CAAtB,CAAxC,EAA6E;AACzE,iBAAO,MAAMf,IAAI,CAACmB,CAAD,CAAJ,CAAQJ,GAAR,CAAN,GAAqB,GAA5B;AACH,SAFD,MAGK,IAAIf,IAAI,CAACmB,CAAD,CAAJ,CAAQJ,GAAR,aAAwB4E,IAA5B,EAAkC;AACnC,cAAI0K,IAAI,GAAGrQ,IAAI,CAACmB,CAAD,CAAJ,CAAQJ,GAAR,CAAX;AACA,iBAAO,MAAMsP,IAAI,CAACN,MAAL,EAAN,GAAsB,GAA7B;AACH,SAHI,MAIA;AACD,iBAAO,OAAO/P,IAAI,CAACmB,CAAD,CAAJ,CAAQJ,GAAR,CAAP,GAAsB,IAA7B;AACH;AACJ,OAbM;AAcP,cAAQ,UAAUf,IAAV,EAAgBmB,CAAhB,EAAmB;AAAE,eAAOyG,IAAI,CAACC,SAAL,CAAe7H,IAAI,CAACmB,CAAD,CAAnB,IAA0B,MAAjC;AAA0C;AAdhE,KAAX;AAgBAgB,IAAAA,GAAG,GAAG,KAAK6N,mBAAL,CAAyBJ,GAAzB,EAA8BnO,CAA9B,EAAiCoO,IAAjC,EAAuC5M,EAAvC,CAAN;AACA,WAAOd,GAAP;AACH,GAzBD;;AA0BAmJ,EAAAA,YAAY,CAACkB,QAAb,GAAwB,UAAUpF,IAAV,EAAgB;AACpC,WAAOA,IAAI,CAACzC,OAAL,CAAa,KAAb,EAAoB,GAApB,CAAP;AACH,GAFD;;AAGA2G,EAAAA,YAAY,CAACrN,SAAb,CAAuB+R,mBAAvB,GAA6C,UAAUJ,GAAV,EAAenO,CAAf,EAAkBoO,IAAlB,EAAwB5M,EAAxB,EAA4B;AACrE,QAAId,GAAG,GAAG,EAAV;;AACA,SAAK,IAAIhB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyO,GAAG,CAAChP,MAAxB,EAAgCO,CAAC,EAAjC,EAAqC;AACjCgB,MAAAA,GAAG,IAAI,OAAOV,CAAC,CAAC+N,IAAT,GAAgB,IAAvB;AACArN,MAAAA,GAAG,IAAI,KAAKpD,OAAL,CAAaiN,gBAAb,GAAgC,MAAvC;AACA7J,MAAAA,GAAG,IAAI0N,IAAI,CAACS,MAAZ;;AACA,UAAIT,IAAI,CAACS,MAAL,KAAgB,OAApB,EAA6B;AACzBnO,QAAAA,GAAG,IAAI,CAACc,EAAE,CAACpD,UAAH,CAAc2K,SAAd,IAA2BvH,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoDtI,CAAC,CAACyE,GAAvD,IAA8D2J,IAAI,CAAC3J,GAAL,CAAS0J,GAAT,EAAczO,CAAd,EAAiBM,CAAC,CAACV,GAAnB,CAA9D,GAAwF,aAA/F;AACH,OAFD,MAGK,IAAI8O,IAAI,CAACS,MAAL,KAAgB,MAAhB,IAA0BT,IAAI,CAACS,MAAL,KAAgB,QAA9C,EAAwD;AACzDnO,QAAAA,GAAG,IAAI,CAACc,EAAE,CAACpD,UAAH,CAAc6K,SAAd,IAA2BzH,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoDtI,CAAC,CAACyE,GAAvD,IAA8D2J,IAAI,CAAC3J,GAAL,CAAS0J,GAAT,EAAczO,CAAd,EAAiBM,CAAC,CAACV,GAAnB,CAA9D,GAAwF,aAA/F;AACH,OAFI,MAGA,IAAI8O,IAAI,CAACS,MAAL,KAAgB,SAApB,EAA+B;AAChCnO,QAAAA,GAAG,IAAI,CAACc,EAAE,CAACpD,UAAH,CAAcmK,SAAd,IAA2B/G,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoDtI,CAAC,CAACyE,GAAvD,IAA8D2J,IAAI,CAAC3J,GAAL,CAAS0J,GAAT,EAAczO,CAAd,EAAiBM,CAAC,CAACV,GAAnB,CAA9D,GAAwF,aAA/F;AACH;;AACDoB,MAAAA,GAAG,IAAI,aAAa,KAAKpD,OAAL,CAAa0M,MAA1B,GAAmC,IAA1C;AACAtJ,MAAAA,GAAG,IAAI,iBAAiB,KAAKrC,GAAL,CAAS8L,SAAT,EAAjB,GAAwC,IAA/C;AACAzJ,MAAAA,GAAG,IAAI,KAAKpD,OAAL,CAAakN,yBAAb,GAAyC,IAAhD;;AACA,UAAI,CAAC5N,iBAAiB,CAACuR,GAAG,CAACzO,CAAD,CAAH,CAAO,aAAP,CAAD,CAAtB,EAA+C;AAC3CgB,QAAAA,GAAG,IAAI,eAAeyN,GAAG,CAACzO,CAAD,CAAH,CAAO,aAAP,CAAf,GAAuC,MAA9C;AACA,eAAOyO,GAAG,CAACzO,CAAD,CAAH,CAAO,aAAP,CAAP;AACH,OAHD,MAIK;AACDgB,QAAAA,GAAG,IAAI,IAAP;AACH;;AACDA,MAAAA,GAAG,IAAI0N,IAAI,CAAC7P,IAAL,CAAU4P,GAAV,EAAezO,CAAf,CAAP;AACH;;AACD,WAAOgB,GAAP;AACH,GA5BD;;AA6BAmJ,EAAAA,YAAY,CAACrN,SAAb,CAAuBsQ,oBAAvB,GAA8C,UAAUvO,IAAV,EAAgBC,KAAhB,EAAuBC,GAAvB,EAA4BkG,OAA5B,EAAqClD,OAArC,EAA8C;AACxF,QAAIhD,GAAG,IAAIA,GAAG,CAACwI,iBAAJ,CAAsB,cAAtB,CAAP,IAAgDxI,GAAG,CAACwI,iBAAJ,CAAsB,cAAtB,EAAsCP,OAAtC,CAA8C,KAA9C,MAAyD,CAAC,CAA9G,EAAiH;AAC7G,aAAQlI,KAAK,CAAC+B,eAAN,GAAwB;AAAEvB,QAAAA,MAAM,EAAE,EAAV;AAAcjB,QAAAA,KAAK,EAAE;AAArB,OAAxB,GAAmD,EAA3D;AACH;;AACD,QAAI4G,OAAO,IAAI,KAAKrH,OAAL,CAAa4M,KAAxB,IAAiCnN,QAAQ,CAACiG,QAAT,CAAkB2B,OAAO,CAACF,GAA1B,EAA+B,KAAKnH,OAAL,CAAa4M,KAA5C,CAAjC,IAAuFvF,OAAO,CAACxG,IAAR,CAAagN,WAAb,OAA+B,MAA1H,EAAkI;AAC9H,UAAIL,IAAI,GAAGrM,GAAG,CAACwI,iBAAJ,CAAsB,cAAtB,CAAX;AACA,UAAI6H,IAAI,GAAG,KAAK,CAAhB;AACA,UAAIC,OAAO,GAAG,KAAK,CAAnB;AACA,UAAIjT,CAAC,GAAGyC,IAAI,GAAG,EAAf;AACAuM,MAAAA,IAAI,GAAGA,IAAI,CAACkE,SAAL,CAAelE,IAAI,CAACpE,OAAL,CAAa,gBAAb,IAAiC,CAAhD,CAAP;AACA5K,MAAAA,CAAC,GAAGA,CAAC,CAAC0Q,KAAF,CAAQ1B,IAAR,CAAJ;;AACA,UAAIhP,CAAC,CAACqD,MAAF,GAAW,CAAf,EAAkB;AACd,eAAO,EAAP;AACH;;AACDrD,MAAAA,CAAC,GAAGA,CAAC,CAAC,CAAD,CAAL;AACA,UAAImT,KAAK,GAAG,sDAAsDC,IAAtD,CAA2DpT,CAA3D,CAAZ;;AACA,UAAImT,KAAJ,EAAW;AACPnT,QAAAA,CAAC,CAACoH,OAAF,CAAU+L,KAAK,CAAC,CAAD,CAAf,EAAoB,EAApB;AACH;;AACD,UAAIE,UAAU,GAAGF,KAAK,GAAGA,KAAK,CAAC,CAAD,CAAR,GAAc,EAApC;AACAnT,MAAAA,CAAC,GAAGA,CAAC,CAAC0Q,KAAF,CAAQ2C,UAAR,CAAJ;;AACA,WAAK,IAAIzP,CAAC,GAAG5D,CAAC,CAACqD,MAAf,EAAuBO,CAAC,GAAG,CAAC,CAA5B,EAA+BA,CAAC,EAAhC,EAAoC;AAChC,YAAI,CAAC,iBAAiB0P,IAAjB,CAAsBtT,CAAC,CAAC4D,CAAD,CAAvB,CAAD,IAAgC,CAAC,cAAc0P,IAAd,CAAmBtT,CAAC,CAAC4D,CAAD,CAApB,CAArC,EAA+D;AAC3D;AACH;;AACDoP,QAAAA,IAAI,GAAG7B,QAAQ,CAAC,uBAAuBiC,IAAvB,CAA4BpT,CAAC,CAAC4D,CAAD,CAA7B,EAAkC,CAAlC,CAAD,EAAuC,EAAvC,CAAf;;AACA,YAAI+B,OAAO,CAACG,YAAR,CAAqBkN,IAArB,CAAJ,EAAgC;AAC5BC,UAAAA,OAAO,GAAGhS,QAAQ,CAACsJ,KAAT,CAAee,SAAf,CAAyB,WAAW8H,IAAX,CAAgBpT,CAAC,CAAC4D,CAAD,CAAjB,EAAsB,CAAtB,CAAzB,CAAV;AACA/C,UAAAA,MAAM,CAAC,EAAD,EAAK8E,OAAO,CAACG,YAAR,CAAqBkN,IAArB,CAAL,EAAiC,KAAKxQ,eAAL,CAAqByQ,OAArB,CAAjC,CAAN;AACH;AACJ;;AACD,aAAOtN,OAAP;AACH;;AACD,WAAO,IAAP;AACH,GAlCD;;AAmCAoI,EAAAA,YAAY,CAACrN,SAAb,CAAuBmR,gBAAvB,GAA0C,UAAUpP,IAAV,EAAgB6J,QAAhB,EAA0B9I,GAA1B,EAA+B;AACrE,QAAIyK,KAAK,GAAG,IAAZ;;AACA,QAAInN,iBAAiB,CAACwL,QAAD,CAArB,EAAiC;AAC7B,aAAO7J,IAAP;AACH;;AACDvC,IAAAA,MAAM,CAACwJ,IAAP,CAAYjH,IAAZ,EAAkBkQ,OAAlB,CAA0B,UAAU9I,IAAV,EAAgB;AACtC,UAAIA,IAAI,KAAKrG,GAAT,IAAgBqG,IAAI,KAAK,aAA7B,EAA4C;AACxC,YAAI5I,QAAQ,CAACsS,aAAT,CAAuB9Q,IAAI,CAACoH,IAAD,CAA3B,CAAJ,EAAwC;AACpCoE,UAAAA,KAAK,CAAC4D,gBAAN,CAAuBpP,IAAI,CAACoH,IAAD,CAA3B,EAAmCyC,QAAQ,CAACzC,IAAD,CAA3C;;AACA,cAAI2J,KAAK,GAAGtT,MAAM,CAACwJ,IAAP,CAAYjH,IAAI,CAACoH,IAAD,CAAhB,EAAwB1D,MAAxB,CAA+B,UAAU1D,IAAV,EAAgB;AAAE,mBAAOA,IAAI,KAAK,aAAhB;AAAgC,WAAjF,CAAZ;;AACA,cAAI+Q,KAAK,CAACnQ,MAAN,KAAiB,CAArB,EAAwB;AACpB,mBAAOZ,IAAI,CAACoH,IAAD,CAAX;AACH;AACJ,SAND,MAOK,IAAIpH,IAAI,CAACoH,IAAD,CAAJ,KAAeyC,QAAQ,CAACzC,IAAD,CAA3B,EAAmC;AACpC,iBAAOpH,IAAI,CAACoH,IAAD,CAAX;AACH,SAFI,MAGA,IAAIpH,IAAI,CAACoH,IAAD,CAAJ,IAAcyC,QAAQ,CAACzC,IAAD,CAAtB,IAAgCpH,IAAI,CAACoH,IAAD,CAAJ,CAAW4J,OAAX,OAAyBnH,QAAQ,CAACzC,IAAD,CAAR,CAAe4J,OAAf,EAA7D,EAAuF;AACxF,iBAAOhR,IAAI,CAACoH,IAAD,CAAX;AACH;AACJ;AACJ,KAhBD;AAiBA,WAAOpH,IAAP;AACH,GAvBD;;AAwBA,SAAOsL,YAAP;AACH,CAplBiC,CAolBhC1F,UAplBgC,CAAlC;;AAqlBA,SAAS0F,YAAT;AACA;AACA;AACA;AACA;AACA;;AACA,IAAI2F,cAAc;AAAG;AAAe,UAAU7Q,MAAV,EAAkB;AAClD/C,EAAAA,SAAS,CAAC4T,cAAD,EAAiB7Q,MAAjB,CAAT;;AACA,WAAS6Q,cAAT,CAAwB1F,KAAxB,EAA+B;AAC3B,QAAIC,KAAK,GAAGpL,MAAM,CAACsB,IAAP,CAAY,IAAZ,EAAkB6J,KAAlB,KAA4B,IAAxC,CAD2B,CAE3B;;;AACAC,IAAAA,KAAK,CAACzM,OAAN,GAAgBX,MAAM,CAAC,EAAD,EAAKoN,KAAK,CAACzM,OAAX,EAAoB;AACtCE,MAAAA,WAAW,EAAE,KADyB;AAEtCwM,MAAAA,MAAM,EAAE,gDAF8B;AAGtCC,MAAAA,eAAe,EAAE,iBAHqB;AAItCxM,MAAAA,MAAM,EAAE,UAJ8B;AAKtCC,MAAAA,MAAM,EAAE,SAL8B;AAMtCC,MAAAA,IAAI,EAAE,OANgC;AAOtCE,MAAAA,IAAI,EAAE,MAPgC;AAQtCE,MAAAA,KAAK,EAAE,QAR+B;AAStCD,MAAAA,MAAM,EAAE,SAT8B;AAUtCE,MAAAA,KAAK,EAAE,SAV+B;AAWtCE,MAAAA,MAAM,EAAE,SAX8B;AAYtCgM,MAAAA,KAAK,EAAE,QAZ+B;AAatCC,MAAAA,SAAS,EAAE,cAb2B;AActCC,MAAAA,QAAQ,EAAE,QAd4B;AAetCC,MAAAA,SAAS,EAAE,cAf2B;AAgBtCC,MAAAA,YAAY,EAAE,0CAhBwB;AAiBtCC,MAAAA,gBAAgB,EAAE,oEAjBoB;AAkBtCC,MAAAA,yBAAyB,EAAE,gDAlBW;AAmBtCC,MAAAA,UAAU,EAAE,OAnB0B;AAoBtCiD,MAAAA,SAAS,EAAE,KApB2B;AAqBtC9O,MAAAA,KAAK,EAAE;AArB+B,KAApB,CAAtB;AAuBAjC,IAAAA,MAAM,CAACoN,KAAK,CAACzM,OAAP,EAAgBwM,KAAK,IAAI,EAAzB,CAAN;AACA,WAAOC,KAAP;AACH;AACD;AACJ;AACA;;;AACIyF,EAAAA,cAAc,CAAChT,SAAf,CAAyB8I,aAAzB,GAAyC,YAAY;AACjD,WAAO,gBAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;;;AACIkK,EAAAA,cAAc,CAAChT,SAAf,CAAyByP,OAAzB,GAAmC,UAAUjM,CAAV,EAAa;AAC5C,WAAOA,CAAC,KAAK,IAAN,GAAa,MAAb,GAAsB,EAA7B;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;;;AACIwP,EAAAA,cAAc,CAAChT,SAAf,CAAyBkO,WAAzB,GAAuC,UAAUC,SAAV,EAAqBnM,KAArB,EAA4BoM,YAA5B,EAA0C;AAC7E,QAAIC,WAAW,GAAG,EAAlB;AACA,QAAInD,GAAG,GAAGiD,SAAS,CAAChL,KAApB;AACA,QAAI8P,MAAM,GAAG/H,GAAG,YAAYxD,IAA5B;;AACA,QAAI1F,KAAK,YAAYxB,KAArB,EAA4B;AACxB,UAAI6C,OAAO,GAAG,KAAKwE,eAAL,CAAqB7F,KAArB,CAAd;;AACA,WAAK,IAAIkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,OAAO,CAACiF,OAAR,CAAgB3F,MAApC,EAA4CO,CAAC,EAA7C,EAAiD;AAC7C,YAAIG,OAAO,CAACiF,OAAR,CAAgBpF,CAAhB,EAAmBM,CAAnB,CAAqBV,GAArB,KAA6BqL,SAAS,CAAChL,KAA3C,EAAkD;AAC9CiL,UAAAA,YAAY,GAAG,IAAf;AACH;AACJ;AACJ;;AACDC,IAAAA,WAAW,GAAGlM,MAAM,CAACnC,SAAP,CAAiBkO,WAAjB,CAA6BzK,IAA7B,CAAkC,IAAlC,EAAwC0K,SAAxC,EAAmDnM,KAAnD,EAA0DoM,YAA1D,CAAd;;AACA,QAAI6E,MAAJ,EAAY;AACR5E,MAAAA,WAAW,GAAGA,WAAW,CAAC3H,OAAZ,CAAoB,iBAApB,EAAuC,IAAvC,CAAd;AACH;;AACD,QAAInG,QAAQ,CAACsJ,KAAT,CAAe6E,MAAf,CAAsBxD,GAAtB,CAAJ,EAAgC;AAC5BmD,MAAAA,WAAW,GAAGA,WAAW,CAAC3H,OAAZ,CAAoB,MAApB,EAA4B,EAA5B,EAAgCA,OAAhC,CAAwC,IAAxC,EAA8C,EAA9C,CAAd;AACH;;AACD,WAAO2H,WAAP;AACH,GApBD;AAqBA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI2E,EAAAA,cAAc,CAAChT,SAAf,CAAyBqP,YAAzB,GAAwC,UAAU7L,CAAV,EAAa;AACjD,QAAIlC,MAAM,GAAG,KAAKO,GAAL,CAAS0G,QAAT,IAAqB,EAAlC;AACAjH,IAAAA,MAAM,CAACiC,IAAP,CAAYC,CAAC,CAACV,GAAd;AACA,SAAKjB,GAAL,CAAS0G,QAAT,GAAoBjH,MAApB;AACH,GAJD;AAKA;AACJ;AACA;AACA;;;AACI0R,EAAAA,cAAc,CAAChT,SAAf,CAAyB6F,QAAzB,GAAoC,UAAUrC,CAAV,EAAa;AAC7C,WAAO,KAAK3B,GAAL,CAAS0G,QAAT,CAAkB2G,IAAlB,CAAuB,MAAvB,CAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;;;AACI8D,EAAAA,cAAc,CAAChT,SAAf,CAAyBkT,QAAzB,GAAoC,UAAU1P,CAAV,EAAa;AAC7C,QAAI2P,QAAQ,GAAG,EAAf;AACA,QAAIC,QAAQ,GAAG,EAAf;AACA,QAAI5I,OAAO,GAAGhH,CAAC,CAACgH,OAAF,CAAU9H,KAAV,EAAd;AACA,QAAI2Q,KAAK,GAAG,EAAZ;AACA,QAAI9I,OAAO,GAAG/G,CAAC,CAAC+G,OAAF,CAAU9E,MAAV,CAAiB,UAAU6N,IAAV,EAAgB;AAAE,aAAOA,IAAI,CAACpJ,OAAL,CAAa,GAAb,IAAoB,CAAC,CAA5B;AAAgC,KAAnE,CAAd;AACAK,IAAAA,OAAO,CAAC0H,OAAR,CAAgB,UAAU/Q,MAAV,EAAkB;AAC9B,UAAIqS,MAAM,GAAGrS,MAAM,CAAC8O,KAAP,CAAa,GAAb,CAAb;;AACA,UAAI,EAAEuD,MAAM,CAAC,CAAD,CAAN,IAAaJ,QAAf,CAAJ,EAA8B;AAC1BA,QAAAA,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,GAAsB,EAAtB;AACH;;AACD,UAAIA,MAAM,CAAC5Q,MAAP,IAAiB,CAArB,EAAwB;AACpB,YAAIwQ,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoB5Q,MAApB,IAA8BnD,MAAM,CAACwJ,IAAP,CAAYmK,QAAZ,EAAsBjJ,OAAtB,CAA8BqJ,MAAM,CAAC,CAAD,CAApC,MAA6C,CAAC,CAAhF,EAAmF;AAC/EJ,UAAAA,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoB,CAApB,IAAyBJ,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoB,CAApB,IAAyB,GAAzB,GAA+BA,MAAM,CAAC,CAAD,CAA9D;AACH,SAFD,MAGK;AACDJ,UAAAA,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoBhQ,IAApB,CAAyB,aAAagQ,MAAM,CAAC,CAAD,CAA5C;AACH;AACJ,OAPD,MAQK;AACD,YAAIC,GAAG,GAAG,aAAaD,MAAM,CAACA,MAAM,CAAC5Q,MAAP,GAAgB,CAAjB,CAA7B;AACA,YAAI8Q,GAAG,GAAG,EAAV;AACA,YAAIC,OAAO,GAAG,EAAd;;AACA,aAAK,IAAIxQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqQ,MAAM,CAAC5Q,MAAP,GAAgB,CAApC,EAAuCO,CAAC,EAAxC,EAA4C;AACxCuQ,UAAAA,GAAG,GAAGA,GAAG,GAAG,UAAN,GAAmBF,MAAM,CAACrQ,CAAD,CAAzB,GAA+B,GAArC;AACAwQ,UAAAA,OAAO,GAAGA,OAAO,GAAG,GAApB;AACH;;AACD,YAAIC,UAAU,GAAGF,GAAG,GAAGD,GAAN,GAAYE,OAA7B;;AACA,YAAIP,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoB5Q,MAApB,IAA8BnD,MAAM,CAACwJ,IAAP,CAAYmK,QAAZ,EAAsBjJ,OAAtB,CAA8BqJ,MAAM,CAAC,CAAD,CAApC,MAA6C,CAAC,CAA5E,IACAJ,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoB,CAApB,EAAuBrJ,OAAvB,CAA+B,SAA/B,MAA8C,CAAC,CADnD,EACsD;AAClDiJ,UAAAA,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoB,CAApB,IAAyBJ,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoB,CAApB,IAAyBI,UAAU,CAACjN,OAAX,CAAmB,UAAnB,EAA+B,GAA/B,CAAlD;AACH,SAHD,MAIK;AACDyM,UAAAA,QAAQ,CAACI,MAAM,CAAC,CAAD,CAAP,CAAR,CAAoBhQ,IAApB,CAAyBoQ,UAAzB;AACH;AACJ;AACJ,KA9BD,EAN6C,CAqC7C;;AACAnU,IAAAA,MAAM,CAACwJ,IAAP,CAAYmK,QAAZ,EAAsBlB,OAAtB,CAA8B,UAAUvQ,MAAV,EAAkB;AAC5C,UAAK8I,OAAO,CAACN,OAAR,CAAgBxI,MAAhB,MAA4B,CAAC,CAAlC,EAAsC;AAClC8I,QAAAA,OAAO,CAACjH,IAAR,CAAa7B,MAAb;AACH;AACJ,KAJD;AAKA8I,IAAAA,OAAO,CAACyH,OAAR,CAAgB,UAAUvQ,MAAV,EAAkB;AAC9B0R,MAAAA,QAAQ,CAAC1R,MAAD,CAAR,GAAmBA,MAAM,IAAIyR,QAAV,GAAqBzR,MAAM,GAAG,GAAT,GAAeyR,QAAQ,CAACzR,MAAD,CAAR,CAAiBwN,IAAjB,CAAsB,GAAtB,CAAf,GAA4C,GAAjE,GAAuExN,MAA1F;AACH,KAFD;AAGAlC,IAAAA,MAAM,CAACwJ,IAAP,CAAYoK,QAAZ,EAAsBnB,OAAtB,CAA8B,UAAU2B,EAAV,EAAc;AAAE,aAAOP,KAAK,CAAC9P,IAAN,CAAW6P,QAAQ,CAACQ,EAAD,CAAnB,CAAP;AAAkC,KAAhF;AACA,WAAOP,KAAK,CAACnE,IAAN,CAAW,GAAX,CAAP;AACH,GAhDD;AAiDA;AACJ;AACA;AACA;;;AACI8D,EAAAA,cAAc,CAAChT,SAAf,CAAyB6T,UAAzB,GAAsC,UAAUC,cAAV,EAA0B;AAC5D,QAAIzK,MAAM,GAAGyK,cAAc,CAACC,GAAf,CAAmB,UAAUrQ,KAAV,EAAiB;AAAE,aAAO2J,YAAY,CAACkB,QAAb,CAAsB7K,KAAtB,CAAP;AAAsC,KAA5E,EAA8EwL,IAA9E,CAAmF,GAAnF,CAAb;AACA,WAAO,cAAc7F,MAAd,GAAuB,IAA9B;AACH,GAHD;AAIA;AACJ;AACA;AACA;;;AACI2J,EAAAA,cAAc,CAAChT,SAAf,CAAyBqH,QAAzB,GAAoC,UAAU7D,CAAV,EAAa;AAC7C,WAAOrB,MAAM,CAACnC,SAAP,CAAiBqH,QAAjB,CAA0B5D,IAA1B,CAA+B,IAA/B,EAAqCD,CAAC,CAACiC,MAAF,CAAS,UAAU6N,IAAV,EAAgB;AAAE,aAAOA,IAAI,CAACpJ,OAAL,CAAa,GAAb,MAAsB,CAAC,CAA9B;AAAkC,KAA7D,CAArC,CAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACI8I,EAAAA,cAAc,CAAChT,SAAf,CAAyBsM,UAAzB,GAAsC,UAAUtH,EAAV,EAAcmD,OAAd,EAAuBuH,QAAvB,EAAiC;AACnE,QAAIA,QAAQ,CAAC/N,IAAT,KAAkB,MAAlB,IAA4B+N,QAAQ,CAAC/N,IAAT,KAAkB,KAA9C,IAAuD+N,QAAQ,CAAC/N,IAAT,KAAkB,OAA7E,EAAsF;AAClFwG,MAAAA,OAAO,CAACwH,gBAAR,CAAyB,QAAzB,EAAmC,uBAAnC;AACH;;AACDxH,IAAAA,OAAO,CAACwH,gBAAR,CAAyB,QAAzB,EAAmC,KAAK7O,OAAL,CAAa0M,MAAhD;AACH,GALD;AAMA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIwF,EAAAA,cAAc,CAAChT,SAAf,CAAyB8B,eAAzB,GAA2C,UAAUC,IAAV,EAAgBlB,EAAhB,EAAoBmB,KAApB,EAA2BC,GAA3B,EAAgCkG,OAAhC,EAAyClD,OAAzC,EAAkD;AACzF,QAAI+O,QAAQ,GAAG,gBAAf;;AACA,QAAK7L,OAAO,IAAIA,OAAO,CAACxG,IAAR,KAAiB,KAA7B,IAAuC,CAAC,KAAKmO,OAA7C,IAAwD/N,IAAI,CAACiS,QAAD,CAAhE,EAA4E;AACxE,UAAIC,OAAO,GAAGlS,IAAI,CAACiS,QAAD,CAAJ,CAAehE,KAAf,CAAqB,aAArB,CAAd;AACA,WAAKF,OAAL,GAAemE,OAAO,CAAC,CAAD,CAAtB;AACA,WAAKhE,iBAAL,GAAyBgE,OAAO,CAAC,CAAD,CAAhC;AACH;;AACD,QAAIlK,OAAO,GAAG,SAAd;AACA,QAAIlI,GAAG,GAAGsG,OAAO,IAAIA,OAAO,CAAC4B,OAAD,CAA5B;;AACA,QAAIsG,aAAa,GAAGlO,MAAM,CAACnC,SAAP,CAAiBsQ,oBAAjB,CAAsC7M,IAAtC,CAA2C,IAA3C,EAAiD1B,IAAjD,EAAuDC,KAAvD,EAA8DC,GAA9D,EAAmEkG,OAAnE,EAA4ElD,OAA5E,CAApB;;AACA,QAAIoL,aAAJ,EAAmB;AACf,aAAOA,aAAP;AACH;;AACD,QAAI9O,KAAK,GAAG,IAAZ;AACA,QAAI2S,SAAS,GAAG,cAAhB;;AACA,QAAIlS,KAAK,IAAIA,KAAK,CAAC+B,eAAnB,EAAoC;AAChC,UAAImQ,SAAS,IAAInS,IAAjB,EAAuB;AACnBR,QAAAA,KAAK,GAAGQ,IAAI,CAACmS,SAAD,CAAZ;AACH;AACJ;;AACDnS,IAAAA,IAAI,GAAG,CAAC3B,iBAAiB,CAAC2B,IAAI,CAACoB,KAAN,CAAlB,GAAiCpB,IAAI,CAACoB,KAAtC,GAA8CpB,IAArD;AACA,QAAI6B,IAAI,GAAG,EAAX;AACAA,IAAAA,IAAI,CAACrC,KAAL,GAAaA,KAAb;AACAqC,IAAAA,IAAI,CAACpB,MAAL,GAAcT,IAAd;AACA,SAAKqJ,kBAAL,CAAwBvJ,GAAxB,EAA6BE,IAA7B,EAAmC6B,IAAnC,EAAyC,IAAzC,EAA+C5B,KAA/C;AACA,WAAOzB,QAAQ,CAAC6I,MAAT,CAAgB7H,KAAhB,IAAyBqC,IAAI,CAACpB,MAA9B,GAAuC;AAAEA,MAAAA,MAAM,EAAEoB,IAAI,CAACpB,MAAf;AAAuBjB,MAAAA,KAAK,EAAEA,KAA9B;AAAqCE,MAAAA,UAAU,EAAEmC,IAAI,CAACnC;AAAtD,KAA9C;AACH,GA1BD;;AA2BA,SAAOuR,cAAP;AACH,CAlNmC,CAkNlC3F,YAlNkC,CAApC;;AAmNA,SAAS2F,cAAT;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAImB,aAAa;AAAG;AAAe,UAAUhS,MAAV,EAAkB;AACjD/C,EAAAA,SAAS,CAAC+U,aAAD,EAAgBhS,MAAhB,CAAT;;AACA,WAASgS,aAAT,GAAyB;AACrB,WAAOhS,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACC,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAA3D;AACH;;AACD8R,EAAAA,aAAa,CAACnU,SAAd,CAAwB8I,aAAxB,GAAwC,YAAY;AAChD,WAAO,eAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;AACA;;;AACIqL,EAAAA,aAAa,CAACnU,SAAd,CAAwBqF,MAAxB,GAAiC,UAAUL,EAAV,EAAcjD,IAAd,EAAoBuF,SAApB,EAA+B;AAC5D,WAAO;AACH3F,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAcqG,GAFhB;AAGHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAe7H,IAAf;AAHH,KAAP;AAKH,GAND;AAOA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIoS,EAAAA,aAAa,CAACnU,SAAd,CAAwBwF,MAAxB,GAAiC,UAAUR,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0C;AACvE,WAAO;AACH3F,MAAAA,IAAI,EAAE,QADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAcqG,GAAd,GAAoB,GAApB,GAA0B9E,KAF5B;AAGHpB,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezG,KAAf;AAHH,KAAP;AAKH,GAND;AAOA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIgR,EAAAA,aAAa,CAACnU,SAAd,CAAwBuF,MAAxB,GAAiC,UAAUP,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0C;AACvE,WAAO;AACH3F,MAAAA,IAAI,EAAE,KADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAcqG,GAFhB;AAGHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezG,KAAf;AAHH,KAAP;AAKH,GAND;;AAOAgR,EAAAA,aAAa,CAACnU,SAAd,CAAwB+E,YAAxB,GAAuC,UAAUC,EAAV,EAAcC,OAAd,EAAuBzB,CAAvB,EAA0B;AAC7D,QAAI+J,KAAK,GAAG,IAAZ;;AACA,QAAI6D,WAAW,GAAG5N,CAAC,CAAC8K,IAAF,GAAS/N,QAAQ,CAAC8Q,OAAT,CAAiB,KAAKvQ,OAAL,CAAa8M,QAA9B,CAA3B;AACA,QAAI3F,GAAG,GAAGjD,EAAE,CAACpD,UAAH,CAAcqG,GAAd,CAAkBvB,OAAlB,CAA0B,MAA1B,EAAkC,MAAM,KAAK5F,OAAL,CAAa4M,KAArD,CAAV;AACAlK,IAAAA,CAAC,CAACyE,GAAF,GAAQ,KAAKgI,iBAAL,GAAyB,KAAKA,iBAA9B,GAAkDzM,CAAC,CAACyE,GAA5D;AACA,QAAI/D,GAAG,GAAG,EAAV;;AACA,QAAIkQ,OAAO,GAAG,UAAUlR,CAAV,EAAamR,CAAb,EAAgB;AAC1BpP,MAAAA,OAAO,CAACG,YAAR,CAAqB6M,OAArB,CAA6B,UAAUjM,CAAV,EAAa1G,CAAb,EAAgB;AACzC,YAAIsS,IAAI,GAAG;AACP,oBAAU,OADH;AAEP,iBAAO,UAAU7P,IAAV,EAAgBmB,CAAhB,EAAmBJ,GAAnB,EAAwB;AAAE,mBAAO,EAAP;AAAY,WAFtC;AAGP,kBAAQ,UAAUf,IAAV,EAAgBmB,CAAhB,EAAmB;AAAE,mBAAOyG,IAAI,CAACC,SAAL,CAAe7H,IAAI,CAACmB,CAAD,CAAnB,IAA0B,MAAjC;AAA0C;AAHhE,SAAX;AAKAgB,QAAAA,GAAG,CAACX,IAAJ,CAAS,OAAO6N,WAAhB;AACAlN,QAAAA,GAAG,CAACX,IAAJ,CAAS,iDAAT,EAA4D,EAA5D;AACAW,QAAAA,GAAG,CAACX,IAAJ,CAAS,UAAU,OAAV,IAAqByB,EAAE,CAACpD,UAAH,CAAc2K,SAAd,IAA2BvH,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoDtI,CAAC,CAACyE,GAA3E,IACH2J,IAAI,CAAC3J,GAAL,CAAShD,OAAO,CAACG,YAAjB,EAA+BlC,CAA/B,EAAkCM,CAAC,CAACV,GAApC,CADG,GACwC,WADjD;AAEAoB,QAAAA,GAAG,CAACX,IAAJ,CAAS,mBAAmB,iCAA5B;AACAW,QAAAA,GAAG,CAACX,IAAJ,CAAS,WAAW+Q,QAAQ,CAACC,IAA7B;AACArQ,QAAAA,GAAG,CAACX,IAAJ,CAAS,EAAT,EAAayC,CAAC,GAAG2D,IAAI,CAACC,SAAL,CAAe5D,CAAf,CAAH,GAAuB,EAArC;AACH,OAbD;AAcH,KAfD,CAN6D,CAsB7D;;;AACA,SAAK,IAAI9C,CAAC,GAAG,CAAR,EAAWmR,CAAC,GAAGpP,OAAO,CAACG,YAAR,CAAqBzC,MAAzC,EAAiDO,CAAC,GAAGmR,CAArD,EAAwDnR,CAAC,EAAzD,EAA6D;AACzDkR,MAAAA,OAAO,CAAClR,CAAD,EAAImR,CAAJ,CAAP;AACH;;AACD,QAAIG,OAAO,GAAG,UAAUtR,CAAV,EAAamR,CAAb,EAAgB;AAC1BpP,MAAAA,OAAO,CAACK,cAAR,CAAuB2M,OAAvB,CAA+B,UAAUjM,CAAV,EAAa1G,CAAb,EAAgB;AAC3C,YAAIsS,IAAI,GAAG;AACP,oBAAUrE,KAAK,CAACzM,OAAN,CAAcmN,UAAd,GAA2B,GAD9B;AAEP,iBAAO,UAAUlM,IAAV,EAAgBmB,CAAhB,EAAmBJ,GAAnB,EAAwB;AAAE,mBAAO,EAAP;AAAY,WAFtC;AAGP,kBAAQ,UAAUf,IAAV,EAAgBmB,CAAhB,EAAmB;AAAE,mBAAOyG,IAAI,CAACC,SAAL,CAAe7H,IAAI,CAACmB,CAAD,CAAnB,IAA0B,MAAjC;AAA0C;AAHhE,SAAX;AAKAgB,QAAAA,GAAG,CAACX,IAAJ,CAAS,OAAO6N,WAAhB;AACAlN,QAAAA,GAAG,CAACX,IAAJ,CAAS,iDAAT,EAA4D,EAA5D;AACAW,QAAAA,GAAG,CAACX,IAAJ,CAAS,SAAS,OAAT,IAAoByB,EAAE,CAACpD,UAAH,CAAc6K,SAAd,IAA2BzH,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoDtI,CAAC,CAACyE,GAA1E,IACH2J,IAAI,CAAC3J,GAAL,CAAShD,OAAO,CAACK,cAAjB,EAAiCpC,CAAjC,EAAoCM,CAAC,CAACV,GAAtC,CADG,GAC0C,WADnD;AAEAoB,QAAAA,GAAG,CAACX,IAAJ,CAAS,mBAAmB,iCAA5B;AACAW,QAAAA,GAAG,CAACX,IAAJ,CAAS,WAAW+Q,QAAQ,CAACC,IAA7B;AACArQ,QAAAA,GAAG,CAACX,IAAJ,CAAS,EAAT,EAAayC,CAAC,GAAG2D,IAAI,CAACC,SAAL,CAAe5D,CAAf,CAAH,GAAuB,EAArC;AACH,OAbD;AAcH,KAfD,CA1B6D,CA0C7D;;;AACA,SAAK,IAAI9C,CAAC,GAAG,CAAR,EAAWmR,CAAC,GAAGpP,OAAO,CAACK,cAAR,CAAuB3C,MAA3C,EAAmDO,CAAC,GAAGmR,CAAvD,EAA0DnR,CAAC,EAA3D,EAA+D;AAC3DsR,MAAAA,OAAO,CAACtR,CAAD,EAAImR,CAAJ,CAAP;AACH;;AACD,QAAII,OAAO,GAAG,UAAUvR,CAAV,EAAamR,CAAb,EAAgB;AAC1BpP,MAAAA,OAAO,CAACE,cAAR,CAAuB8M,OAAvB,CAA+B,UAAUjM,CAAV,EAAa1G,CAAb,EAAgB;AAC3C,YAAIoV,KAAK,GAAG;AACR,iBAAO,SADC;AAER,iBAAO,UAAU3S,IAAV,EAAgBmB,CAAhB,EAAmBJ,GAAnB,EAAwB;AAC3B,gBAAImF,GAAG,GAAG1H,QAAQ,CAAC0F,SAAT,CAAmBnD,GAAnB,EAAwBf,IAAI,CAACmB,CAAD,CAA5B,CAAV;;AACA,gBAAI,OAAO+E,GAAP,KAAe,QAAf,IAA2B1H,QAAQ,CAACsJ,KAAT,CAAe6E,MAAf,CAAsBzG,GAAtB,CAA/B,EAA2D;AACvD,qBAAO,MAAMA,GAAb;AACH,aAFD,MAGK,IAAIA,GAAG,YAAYP,IAAnB,EAAyB;AAC1B,kBAAIiN,OAAO,GAAG5S,IAAI,CAACmB,CAAD,CAAJ,CAAQJ,GAAR,CAAd;AACA,qBAAO,MAAM6R,OAAO,CAAC7C,MAAR,EAAb;AACH,aAHI,MAIA;AACD,qBAAO,OAAO7J,GAAP,GAAa,GAApB;AACH;AACJ,WAdO;AAeR,kBAAQ,UAAUlG,IAAV,EAAgBmB,CAAhB,EAAmB;AAAE,mBAAO,EAAP;AAAY;AAfjC,SAAZ;AAiBAgB,QAAAA,GAAG,CAACX,IAAJ,CAAS,OAAO6N,WAAhB;AACAlN,QAAAA,GAAG,CAACX,IAAJ,CAAS,iDAAT,EAA4D,EAA5D;AACAW,QAAAA,GAAG,CAACX,IAAJ,CAAS,YAAY,OAAZ,IAAuByB,EAAE,CAACpD,UAAH,CAAcmK,SAAd,IAA2B/G,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoDtI,CAAC,CAACyE,GAA7E,IACHyM,KAAK,CAACzM,GAAN,CAAUhD,OAAO,CAACE,cAAlB,EAAkCjC,CAAlC,EAAqCM,CAAC,CAACV,GAAvC,CADG,GAC2C,WADpD;AAEAoB,QAAAA,GAAG,CAACX,IAAJ,CAAS,mBAAmB,iCAA5B;AACAW,QAAAA,GAAG,CAACX,IAAJ,CAAS,WAAW+Q,QAAQ,CAACC,IAA7B;AACArQ,QAAAA,GAAG,CAACX,IAAJ,CAAS,EAAT,EAAayC,CAAC,GAAG2D,IAAI,CAACC,SAAL,CAAe5D,CAAf,CAAH,GAAuB,EAArC;AACH,OAzBD;AA0BH,KA3BD,CA9C6D,CA0E7D;;;AACA,SAAK,IAAI9C,CAAC,GAAG,CAAR,EAAWmR,CAAC,GAAGpP,OAAO,CAACE,cAAR,CAAuBxC,MAA3C,EAAmDO,CAAC,GAAGmR,CAAvD,EAA0DnR,CAAC,EAA3D,EAA+D;AAC3DuR,MAAAA,OAAO,CAACvR,CAAD,EAAImR,CAAJ,CAAP;AACH;;AACDnQ,IAAAA,GAAG,CAACX,IAAJ,CAAS,OAAO6N,WAAP,GAAqB,IAA9B,EAAoC,EAApC;AACA,WAAO;AACHzP,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEA,GAFF;AAGH+B,MAAAA,WAAW,EAAE,+BAA+BoH,WAHzC;AAIHrP,MAAAA,IAAI,EAAEmC,GAAG,CAACgL,IAAJ,CAAS,MAAT;AAJH,KAAP;AAMH,GArFD;AAsFA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIiF,EAAAA,aAAa,CAACnU,SAAd,CAAwBsM,UAAxB,GAAqC,UAAUtH,EAAV,EAAcmD,OAAd,EAAuBuH,QAAvB,EAAiC;AAClEvH,IAAAA,OAAO,CAACwH,gBAAR,CAAyB,QAAzB,EAAmC,gDAAnC;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIwE,EAAAA,aAAa,CAACnU,SAAd,CAAwB8B,eAAxB,GAA0C,UAAUC,IAAV,EAAgBlB,EAAhB,EAAoBmB,KAApB,EAA2BC,GAA3B,EAAgCkG,OAAhC,EAAyClD,OAAzC,EAAkD;AACxF,QAAI8E,OAAO,GAAG,SAAd;AACA,QAAIlI,GAAG,GAAGsG,OAAO,IAAIA,OAAO,CAAC4B,OAAD,CAA5B;AACA,QAAIxI,KAAK,GAAG,IAAZ;AACA,QAAIqC,IAAI,GAAG,EAAX;;AACA,QAAIuE,OAAO,IAAIA,OAAO,CAACxG,IAAR,CAAagN,WAAb,OAA+B,MAA9C,EAAsD;AAClD,UAAI4B,YAAY,GAAGtO,GAAG,IAAIkG,OAAO,CAACsC,iBAAR,CAA0B,oBAA1B,CAA1B;AACA,UAAI+F,OAAO,GAAID,YAAY,IAAIE,QAAQ,CAACF,YAAD,EAAe,EAAf,CAAzB,IAAgD,CAA9D;;AACA,UAAIvO,KAAK,IAAIA,KAAK,CAAC+B,eAAnB,EAAoC;AAChC,YAAI,CAACxD,QAAQ,CAAC6I,MAAT,CAAgBrH,IAAI,CAAC6S,KAArB,CAAL,EAAkC;AAC9BrT,UAAAA,KAAK,GAAGQ,IAAI,CAAC6S,KAAb;AACH;AACJ;;AACD,UAAIpE,OAAO,GAAG,CAAV,IAAezO,IAAI,CAAC8S,KAAxB,EAA+B;AAC3B9S,QAAAA,IAAI,GAAGA,IAAI,CAAC8S,KAAZ;AACH;;AACDjR,MAAAA,IAAI,CAACrC,KAAL,GAAaA,KAAb;AACAqC,MAAAA,IAAI,CAACpB,MAAL,GAAcT,IAAd;AACA,WAAKqJ,kBAAL,CAAwBvJ,GAAxB,EAA6BE,IAA7B,EAAmC6B,IAAnC,EAAyC,IAAzC,EAA+C5B,KAA/C;AACH;;AACD4B,IAAAA,IAAI,CAACpB,MAAL,GAAcoB,IAAI,CAACpB,MAAL,IAAeT,IAA7B;AACA,WAAOxB,QAAQ,CAAC6I,MAAT,CAAgB7H,KAAhB,IAAyBqC,IAAI,CAACpB,MAA9B,GAAuC;AAAEA,MAAAA,MAAM,EAAEoB,IAAI,CAACpB,MAAf;AAAuBjB,MAAAA,KAAK,EAAEqC,IAAI,CAACrC,KAAnC;AAA0CE,MAAAA,UAAU,EAAEmC,IAAI,CAACnC;AAA3D,KAA9C;AACH,GAtBD;;AAuBA,SAAO0S,aAAP;AACH,CApLkC,CAoLjC9G,YApLiC,CAAnC;;AAqLA,SAAS8G,aAAT;AACA;AACA;AACA;AACA;;AACA,IAAIW,gBAAgB;AAAG;AAAe,UAAU3S,MAAV,EAAkB;AACpD/C,EAAAA,SAAS,CAAC0V,gBAAD,EAAmB3S,MAAnB,CAAT;;AACA,WAAS2S,gBAAT,GAA4B;AACxB,WAAO3S,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACC,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAA3D;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIyS,EAAAA,gBAAgB,CAAC9U,SAAjB,CAA2BsC,YAA3B,GAA0C,UAAU0C,EAAV,EAAchD,KAAd,EAAqB4F,gBAArB,EAAuC;AAC7E,QAAIlC,GAAG,GAAG,IAAIiC,UAAJ,GAAiBrF,YAAjB,CAA8B0C,EAA9B,EAAkChD,KAAlC,EAAyC4F,gBAAzC,CAAV;AACA,QAAImN,OAAO,GAAG,MAAd;AACA,QAAIhT,IAAI,GAAGxB,QAAQ,CAACsJ,KAAT,CAAee,SAAf,CAAyBlF,GAAG,CAACqP,OAAD,CAA5B,CAAX;AACA,QAAIvS,MAAM,GAAG,EAAb;AACA,QAAIW,KAAK,GAAG,OAAZ;;AACA,QAAIpB,IAAI,CAACqI,KAAT,EAAgB;AACZ,WAAK,IAAIlH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnB,IAAI,CAACqI,KAAL,CAAWzH,MAA/B,EAAuCO,CAAC,EAAxC,EAA4C;AACxC,YAAIkH,KAAK,GAAGrI,IAAI,CAACqI,KAAL,CAAWlH,CAAX,CAAZ;AACA,YAAIJ,GAAG,GAAGtD,MAAM,CAACwJ,IAAP,CAAYoB,KAAZ,EAAmB,CAAnB,CAAV;AACA5H,QAAAA,MAAM,CAACM,GAAD,CAAN,GAAcsH,KAAK,CAACtH,GAAD,CAAnB;AACH;AACJ;;AACDN,IAAAA,MAAM,CAACW,KAAD,CAAN,GAAgBpB,IAAhB;AACA,QAAIgI,OAAO,GAAG,SAAd;AACA,QAAI9B,GAAG,GAAG,KAAV;AACA,WAAO;AACHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAepH,MAAf,CADH;AAEHyF,MAAAA,GAAG,EAAEvC,GAAG,CAACuC,GAAD,CAFL;AAGH8B,MAAAA,OAAO,EAAErE,GAAG,CAACqE,OAAD,CAHT;AAIHpI,MAAAA,IAAI,EAAE,MAJH;AAKHqI,MAAAA,WAAW,EAAE;AALV,KAAP;AAOH,GAvBD;;AAwBA,SAAO8K,gBAAP;AACH,CAtCqC,CAsCpCnN,UAtCoC,CAAtC;;AAuCA,SAASmN,gBAAT;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIE,iBAAiB;AAAG;AAAe,UAAU7S,MAAV,EAAkB;AACrD/C,EAAAA,SAAS,CAAC4V,iBAAD,EAAoB7S,MAApB,CAAT;AACA;AACJ;AACA;;;AACI,WAAS6S,iBAAT,GAA6B;AACzB,QAAIzH,KAAK,GAAGpL,MAAM,CAACsB,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACApD,IAAAA,QAAQ,CAAC,YAAD,EAAesH,UAAU,CAAC3H,SAAX,CAAqBsM,UAApC,EAAgDiB,KAAhD,CAAR;AACA,WAAOA,KAAP;AACH;;AACDyH,EAAAA,iBAAiB,CAAChV,SAAlB,CAA4BqF,MAA5B,GAAqC,UAAUL,EAAV,EAAcjD,IAAd,EAAoBuF,SAApB,EAA+BtF,KAA/B,EAAsCuF,QAAtC,EAAgD;AACjF,SAAK1F,GAAL,CAAS0F,QAAT,GAAoBA,QAApB;AACA,SAAK0G,UAAL,GAAkB,KAAlB;AACA,WAAO;AACHhG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAc2K,SAAd,IAA2BvH,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoD9G,EAAE,CAACpD,UAAH,CAAcqG,GADpE;AAEHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezJ,MAAM,CAAC,EAAD,EAAK;AAC5BgD,QAAAA,KAAK,EAAEpB,IADqB;AAE5BqK,QAAAA,KAAK,EAAE9E,SAFqB;AAG5ByD,QAAAA,MAAM,EAAE;AAHoB,OAAL,EAIxBxK,QAAQ,CAAC8L,YAAT,CAAsB,IAAtB,EAA4BrH,EAA5B,EAAgChD,KAAhC,CAJwB,CAArB;AAFH,KAAP;AAQH,GAXD;;AAYAgT,EAAAA,iBAAiB,CAAChV,SAAlB,CAA4BwF,MAA5B,GAAqC,UAAUR,EAAV,EAAcyC,QAAd,EAAwByD,GAAxB,EAA6B5D,SAA7B,EAAwCtF,KAAxC,EAA+C;AAChFG,IAAAA,MAAM,CAACnC,SAAP,CAAiBwF,MAAjB,CAAwB/B,IAAxB,CAA6B,IAA7B,EAAmCuB,EAAnC,EAAuCyC,QAAvC,EAAiDyD,GAAjD;;AACA,WAAO;AACHvJ,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAcmK,SAAd,IAA2B/G,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoD9G,EAAE,CAACpD,UAAH,CAAcqG,GAFpE;AAGHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezJ,MAAM,CAAC,EAAD,EAAK;AAC5B2C,QAAAA,GAAG,EAAEoI,GADuB;AAE5BsB,QAAAA,SAAS,EAAE/E,QAFiB;AAG5B2E,QAAAA,KAAK,EAAE9E,SAHqB;AAI5ByD,QAAAA,MAAM,EAAE;AAJoB,OAAL,EAKxBxK,QAAQ,CAAC8L,YAAT,CAAsB,IAAtB,EAA4BrH,EAA5B,EAAgChD,KAAhC,CALwB,CAArB;AAHH,KAAP;AAUH,GAZD;;AAaAgT,EAAAA,iBAAiB,CAAChV,SAAlB,CAA4BuF,MAA5B,GAAqC,UAAUP,EAAV,EAAcyC,QAAd,EAAwByD,GAAxB,EAA6B5D,SAA7B,EAAwCtF,KAAxC,EAA+C;AAChF,SAAKiM,UAAL,GAAkB,QAAlB;AACA,SAAKgH,SAAL,GAAiBxN,QAAjB;AACA,WAAO;AACH9F,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAc6K,SAAd,IAA2BzH,EAAE,CAACpD,UAAH,CAAckK,OAAzC,IAAoD9G,EAAE,CAACpD,UAAH,CAAcqG,GAFpE;AAGHlG,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezJ,MAAM,CAAC,EAAD,EAAK;AAC5BgD,QAAAA,KAAK,EAAE+H,GADqB;AAE5BH,QAAAA,MAAM,EAAE,QAFoB;AAG5ByB,QAAAA,SAAS,EAAE/E,QAHiB;AAI5B3E,QAAAA,GAAG,EAAEoI,GAAG,CAACzD,QAAD,CAJoB;AAK5B2E,QAAAA,KAAK,EAAE9E;AALqB,OAAL,EAMxB/G,QAAQ,CAAC8L,YAAT,CAAsB,IAAtB,EAA4BrH,EAA5B,EAAgChD,KAAhC,CANwB,CAArB;AAHH,KAAP;AAWH,GAdD;;AAeAgT,EAAAA,iBAAiB,CAAChV,SAAlB,CAA4B8B,eAA5B,GAA8C,UAAUC,IAAV,EAAgBlB,EAAhB,EAAoBmB,KAApB,EAA2BC,GAA3B,EAAgCkG,OAAhC,EAAyClD,OAAzC,EAAkDzB,CAAlD,EAAqD;AAC/F,QAAIN,CAAJ;AACA,QAAIgS,OAAO,GAAG/M,OAAO,GAAGwB,IAAI,CAACE,KAAL,CAAW1B,OAAO,CAACpG,IAAnB,CAAH,GAA8BA,IAAnD;AACAA,IAAAA,IAAI,GAAGmT,OAAO,CAACnK,MAAR,KAAmB,OAAnB,GAA6BxK,QAAQ,CAACsJ,KAAT,CAAee,SAAf,CAAyB7I,IAAzB,CAA7B,GAA8DA,IAArE;;AACA,QAAI,KAAKkM,UAAL,KAAoB,KAAxB,EAA+B;AAC3B9L,MAAAA,MAAM,CAACnC,SAAP,CAAiBqF,MAAjB,CAAwB5B,IAAxB,CAA6B,IAA7B,EAAmC5C,EAAnC,EAAuCkB,IAAvC,EAA6C,IAA7C,EAAmD,IAAnD,EAAyD,KAAKF,GAAL,CAAS0F,QAAlE;AACH;;AACD,QAAI,KAAK0G,UAAL,KAAoB,QAAxB,EAAkC;AAC9B9L,MAAAA,MAAM,CAACnC,SAAP,CAAiBuF,MAAjB,CAAwB9B,IAAxB,CAA6B,IAA7B,EAAmC5C,EAAnC,EAAuC,KAAKoU,SAA5C,EAAuDlT,IAAvD;AACH;;AACD,SAAKkM,UAAL,GAAkBtK,SAAlB;;AACA,QAAI5B,IAAI,CAACmK,KAAT,EAAgB;AACZ,WAAKhJ,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGnB,IAAI,CAACmK,KAAL,CAAWvJ,MAA3B,EAAmCO,CAAC,EAApC,EAAwC;AACpCf,QAAAA,MAAM,CAACnC,SAAP,CAAiBqF,MAAjB,CAAwB5B,IAAxB,CAA6B,IAA7B,EAAmC5C,EAAnC,EAAuCkB,IAAI,CAACmK,KAAL,CAAWhJ,CAAX,CAAvC;AACH;AACJ;;AACD,QAAInB,IAAI,CAACkK,OAAT,EAAkB;AACd,WAAK/I,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGnB,IAAI,CAACkK,OAAL,CAAatJ,MAA7B,EAAqCO,CAAC,EAAtC,EAA0C;AACtCf,QAAAA,MAAM,CAACnC,SAAP,CAAiBuF,MAAjB,CAAwB9B,IAAxB,CAA6B,IAA7B,EAAmC5C,EAAnC,EAAuC2C,CAAC,CAACV,GAAzC,EAA8Cf,IAAI,CAACkK,OAAL,CAAa/I,CAAb,CAA9C;AACH;AACJ;;AACD,QAAInB,IAAI,CAACoK,OAAT,EAAkB;AACd,WAAKjJ,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGnB,IAAI,CAACoK,OAAL,CAAaxJ,MAA7B,EAAqCO,CAAC,EAAtC,EAA0C;AACtCf,QAAAA,MAAM,CAACnC,SAAP,CAAiBwF,MAAjB,CAAwB/B,IAAxB,CAA6B,IAA7B,EAAmC5C,EAAnC,EAAuC2C,CAAC,CAACV,GAAzC,EAA8Cf,IAAI,CAACoK,OAAL,CAAajJ,CAAb,CAA9C;AACH;AACJ;;AACD,WAAOnB,IAAP;AACH,GA3BD;AA4BA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIiT,EAAAA,iBAAiB,CAAChV,SAAlB,CAA4B+E,YAA5B,GAA2C,UAAUC,EAAV,EAAcC,OAAd,EAAuBzB,CAAvB,EAA0BxB,KAA1B,EAAiC4J,QAAjC,EAA2C;AAClF,WAAO;AACHjK,MAAAA,IAAI,EAAE,MADH;AAEHsG,MAAAA,GAAG,EAAEjD,EAAE,CAACpD,UAAH,CAAciK,QAAd,IAA0B7G,EAAE,CAACpD,UAAH,CAAckK,OAAxC,IAAmD9G,EAAE,CAACpD,UAAH,CAAcqG,GAFnE;AAGH+B,MAAAA,WAAW,EAAE,iCAHV;AAIHgC,MAAAA,QAAQ,EAAE,MAJP;AAKHjK,MAAAA,IAAI,EAAE4H,IAAI,CAACC,SAAL,CAAezJ,MAAM,CAAC,EAAD,EAAK;AAC5B8L,QAAAA,OAAO,EAAEhH,OAAO,CAACK,cADW;AAE5B4G,QAAAA,KAAK,EAAEjH,OAAO,CAACG,YAFa;AAG5B+G,QAAAA,OAAO,EAAElH,OAAO,CAACE,cAHW;AAI5B4F,QAAAA,MAAM,EAAE,OAJoB;AAK5BqB,QAAAA,KAAK,EAAE5I,CAAC,CAACyE,GALmB;AAM5BnF,QAAAA,GAAG,EAAEU,CAAC,CAACV;AANqB,OAAL,EAOxBvC,QAAQ,CAAC8L,YAAT,CAAsB,IAAtB,EAA4BrH,EAA5B,EAAgChD,KAAhC,CAPwB,CAArB;AALH,KAAP;AAcH,GAfD;;AAgBAgT,EAAAA,iBAAiB,CAAChV,SAAlB,CAA4BmN,SAA5B,GAAwC,UAAUrM,OAAV,EAAmB;AACvD,QAAIqU,SAAS,GAAG,IAAIxN,UAAJ,EAAhB;AACAwN,IAAAA,SAAS,CAAChI,SAAV,CAAoBrM,OAApB;AACH,GAHD;;AAIA,SAAOkU,iBAAP;AACH,CA3GsC,CA2GrC9S,WA3GqC,CAAvC;;AA4GA,SAAS8S,iBAAT;AACA;AACA;AACA;AACA;;AACA,IAAII,iBAAiB;AAAG;AAAe,UAAUjT,MAAV,EAAkB;AACrD/C,EAAAA,SAAS,CAACgW,iBAAD,EAAoBjT,MAApB,CAAT;;AACA,WAASiT,iBAAT,CAA2B9H,KAA3B,EAAkC;AAC9B,QAAIC,KAAK,GAAGpL,MAAM,CAACsB,IAAP,CAAY,IAAZ,KAAqB,IAAjC,CAD8B,CAE9B;;;AACA8J,IAAAA,KAAK,CAACzM,OAAN,GAAgBX,MAAM,CAAC,EAAD,EAAKoN,KAAK,CAACzM,OAAX,EAAoB;AACtCiU,MAAAA,OAAO,EAAE,IAAIM,QAAJ,EAD6B;AAEtCC,MAAAA,SAAS,EAAE,IAAID,QAAJ,EAF2B;AAGtCE,MAAAA,YAAY,EAAE,IAAIF,QAAJ,EAHwB;AAItCG,MAAAA,YAAY,EAAE,IAAIH,QAAJ,EAJwB;AAKtCI,MAAAA,WAAW,EAAE,IAAIJ,QAAJ;AALyB,KAApB,CAAtB;AAOAlV,IAAAA,MAAM,CAACoN,KAAK,CAACzM,OAAP,EAAgBwM,KAAK,IAAI,EAAzB,CAAN;AACA,WAAOC,KAAP;AACH;;AACD6H,EAAAA,iBAAiB,CAACpV,SAAlB,CAA4B8I,aAA5B,GAA4C,YAAY;AACpD,WAAO,mBAAP;AACH,GAFD;;AAGA,SAAOsM,iBAAP;AACH,CAnBsC,CAmBrCzN,UAnBqC,CAAvC;;AAoBA,SAASyN,iBAAT;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIM,cAAc;AAAG;AAAe,UAAUvT,MAAV,EAAkB;AAClD/C,EAAAA,SAAS,CAACsW,cAAD,EAAiBvT,MAAjB,CAAT;;AACA,WAASuT,cAAT,CAAwB5U,OAAxB,EAAiC;AAC7B,QAAIyM,KAAK,GAAGpL,MAAM,CAACsB,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACA8J,IAAAA,KAAK,CAACoI,GAAN,GAAY7U,OAAZ;AACAyM,IAAAA,KAAK,CAACqI,MAAN,GAAerI,KAAK,CAACoI,GAAN,CAAUE,QAAzB;AACAtI,IAAAA,KAAK,CAACvL,KAAN,GAAcuL,KAAK,CAACoI,GAAN,CAAU3T,KAAxB;AACAuL,IAAAA,KAAK,CAACuI,YAAN,GAAqBvI,KAAK,CAACoI,GAAN,CAAUG,YAAV,GAAyBvI,KAAK,CAACoI,GAAN,CAAUG,YAAnC,GAAkD,YAAY,CAAG,CAAtF;;AACAvI,IAAAA,KAAK,CAACwI,QAAN,GAAiB,YAAY;AAAE,aAAOxI,KAAK,CAACvL,KAAb;AAAqB,KAApD;;AACA,WAAOuL,KAAP;AACH;;AACDmI,EAAAA,cAAc,CAAC1V,SAAf,CAAyB8I,aAAzB,GAAyC,YAAY;AACjD,WAAO,gBAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;;;AACI4M,EAAAA,cAAc,CAAC1V,SAAf,CAAyBsC,YAAzB,GAAwC,UAAU0T,WAAV,EAAuBhU,KAAvB,EAA8B;AAClE,QAAIiU,QAAQ,GAAG9T,MAAM,CAACnC,SAAP,CAAiBsC,YAAjB,CAA8BF,KAA9B,CAAoC,IAApC,EAA0CC,SAA1C,CAAf;;AACA,QAAI2C,EAAE,GAAG2E,IAAI,CAACE,KAAL,CAAWoM,QAAQ,CAAClU,IAApB,CAAT,CAFkE,CAGlE;;AACA,QAAIiH,IAAI,GAAG,CAAC,MAAD,EAAS,MAAT,EAAiB,QAAjB,EAA2B,OAA3B,EAAoC,QAApC,EAA8C,OAA9C,EACP,QADO,EACG,gBADH,EACqB,YADrB,EACmC,QADnC,CAAX;AAEA,QAAId,IAAI,GAAG,EAAX;AACA,QAAIgO,GAAG,GAAG,mBAAV;AACAlN,IAAAA,IAAI,CAACvD,MAAL,CAAY,UAAUjC,CAAV,EAAa;AACrB0E,MAAAA,IAAI,CAAC1E,CAAD,CAAJ,GAAU0S,GAAG,CAAChM,OAAJ,CAAY1G,CAAZ,IAAiB,CAAC,CAAlB,GAAsBmG,IAAI,CAACC,SAAL,CAAe5E,EAAE,CAACxB,CAAD,CAAjB,CAAtB,GAA8CwB,EAAE,CAACxB,CAAD,CAA1D;AACH,KAFD;AAGA,QAAI2S,IAAI,GAAG,KAAKL,YAAL,MAAuB,EAAlC;AACAK,IAAAA,IAAI,CAAC,aAAD,CAAJ,GAAsBjO,IAAtB;AACA,QAAInG,IAAI,GAAG4H,IAAI,CAACC,SAAL,CAAe;AACtB5H,MAAAA,KAAK,EAAE,KAAK+T,QAAL,EADe;AAEtBK,MAAAA,SAAS,EAAED;AAFW,KAAf,CAAX;AAIAF,IAAAA,QAAQ,CAAClU,IAAT,GAAgBA,IAAhB;AACA,WAAOkU,QAAP;AACH,GAnBD;AAoBA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIP,EAAAA,cAAc,CAAC1V,SAAf,CAAyB8B,eAAzB,GAA2C,UAAUuU,OAAV,EAAmBxV,EAAnB,EAAuBmB,KAAvB,EAA8BC,GAA9B,EAAmCkG,OAAnC,EAA4C;AACnF,QAAIU,GAAG,GAAGwN,OAAV;AACA,QAAI9U,KAAJ;AACA,QAAIE,UAAJ;AACA,QAAIe,MAAM,GAAGlC,QAAQ,CAAC,KAAKsV,MAAL,CAAYpT,MAAb,EAAqBqG,GAAG,CAAC9G,IAAzB,CAArB;;AACA,QAAI,KAAK6T,MAAL,CAAYrU,KAAhB,EAAuB;AACnBA,MAAAA,KAAK,GAAGjB,QAAQ,CAAC,KAAKsV,MAAL,CAAYrU,KAAb,EAAoBsH,GAAG,CAAC9G,IAAxB,CAAhB;AACH;;AACD,QAAI,KAAK6T,MAAL,CAAYnU,UAAhB,EAA4B;AACxBA,MAAAA,UAAU,GAAGnB,QAAQ,CAAC,KAAKsV,MAAL,CAAYnU,UAAb,EAAyBoH,GAAG,CAAC9G,IAA7B,CAArB;AACAN,MAAAA,UAAU,GAAG,CAACrB,iBAAiB,CAACqB,UAAD,CAAlB,GAAiClB,QAAQ,CAACsJ,KAAT,CAAee,SAAf,CAAyBnJ,UAAzB,CAAjC,GAAwEA,UAArF;AACH;;AACD,QAAII,GAAG,GAAGsG,OAAO,CAAC4B,OAAR,IAAmB,EAA7B;AACA,QAAInG,IAAI,GAAG;AAAEpB,MAAAA,MAAM,EAAEA,MAAV;AAAkBf,MAAAA,UAAU,EAAEA;AAA9B,KAAX;AACA,QAAIM,IAAI,GAAG6B,IAAX;;AACA,QAAI/B,GAAG,IAAIA,GAAG,CAACwG,MAAX,IAAqBxG,GAAG,CAACwG,MAAJ,CAAW1F,MAApC,EAA4C;AACxC,WAAKyI,kBAAL,CAAwBvJ,GAAxB,EAA6BE,IAA7B,EAAmC6B,IAAnC,EAAyC,IAAzC,EAA+C5B,KAA/C;AACH;;AACD,WAAO,CAAC5B,iBAAiB,CAACmB,KAAD,CAAlB,GAA4B;AAAEiB,MAAAA,MAAM,EAAEoB,IAAI,CAACpB,MAAf;AAAuBjB,MAAAA,KAAK,EAAEA,KAA9B;AAAqCE,MAAAA,UAAU,EAAEA;AAAjD,KAA5B,GAA4FmC,IAAI,CAACpB,MAAxG;AACH,GAnBD;AAoBA;AACJ;AACA;;;AACIkT,EAAAA,cAAc,CAAC1V,SAAf,CAAyBqF,MAAzB,GAAkC,YAAY;AAC1C,QAAIiR,QAAQ,GAAGnU,MAAM,CAACnC,SAAP,CAAiBqF,MAAjB,CAAwBjD,KAAxB,CAA8B,IAA9B,EAAoCC,SAApC,CAAf;;AACA,WAAO,KAAKkU,gBAAL,CAAsBD,QAAtB,EAAgC,QAAhC,CAAP;AACH,GAHD;AAIA;AACJ;AACA;;;AACIZ,EAAAA,cAAc,CAAC1V,SAAf,CAAyBuF,MAAzB,GAAkC,YAAY;AAC1C,QAAI+Q,QAAQ,GAAGnU,MAAM,CAACnC,SAAP,CAAiBuF,MAAjB,CAAwBnD,KAAxB,CAA8B,IAA9B,EAAoCC,SAApC,CAAf;;AACA,WAAO,KAAKkU,gBAAL,CAAsBD,QAAtB,EAAgC,QAAhC,CAAP;AACH,GAHD;AAIA;AACJ;AACA;;;AACIZ,EAAAA,cAAc,CAAC1V,SAAf,CAAyBwF,MAAzB,GAAkC,YAAY;AAC1C,QAAI8Q,QAAQ,GAAGnU,MAAM,CAACnC,SAAP,CAAiBwF,MAAjB,CAAwBpD,KAAxB,CAA8B,IAA9B,EAAoCC,SAApC,CAAf;;AACA,WAAO,KAAKkU,gBAAL,CAAsBD,QAAtB,EAAgC,QAAhC,CAAP;AACH,GAHD;AAIA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIZ,EAAAA,cAAc,CAAC1V,SAAf,CAAyB+E,YAAzB,GAAwC,UAAUC,EAAV,EAAcC,OAAd,EAAuBzB,CAAvB,EAA0BxB,KAA1B,EAAiC4J,QAAjC,EAA2C;AAC/E,QAAI8B,KAAK,GAAGvL,MAAM,CAACnC,SAAP,CAAiB+E,YAAjB,CAA8B3C,KAA9B,CAAoC,IAApC,EAA0CC,SAA1C,CAAZ;;AACA,QAAImU,KAAK,GAAG7M,IAAI,CAACE,KAAL,CAAW6D,KAAK,CAAC3L,IAAjB,CAAZ;AACAyU,IAAAA,KAAK,CAAC1T,GAAN,GAAYU,CAAC,CAACV,GAAd;AACA4K,IAAAA,KAAK,CAAC3L,IAAN,GAAa4H,IAAI,CAACC,SAAL,CAAe4M,KAAf,CAAb;AACA,WAAO,KAAKD,gBAAL,CAAsB7I,KAAtB,EAA6B,OAA7B,CAAP;AACH,GAND;;AAOAgI,EAAAA,cAAc,CAAC1V,SAAf,CAAyBuW,gBAAzB,GAA4C,UAAUE,QAAV,EAAoB1L,MAApB,EAA4B;AACpE,QAAI2L,MAAM,GAAG/M,IAAI,CAACE,KAAL,CAAW4M,QAAQ,CAAC1U,IAApB,CAAb;AACA0U,IAAAA,QAAQ,CAAC1U,IAAT,GAAgB4H,IAAI,CAACC,SAAL,CAAe;AAC3B5H,MAAAA,KAAK,EAAE,KAAK2T,GAAL,CAASgB,WAAT,CAAqB5L,MAArB,CADoB;AAE3BqL,MAAAA,SAAS,EAAEM;AAFgB,KAAf,CAAhB;AAIA,WAAOD,QAAP;AACH,GAPD;;AAQA,SAAOf,cAAP;AACH,CAnHmC,CAmHlC/N,UAnHkC,CAApC;;AAoHA,SAAS+N,cAAT;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIkB,YAAY;AAAG;AAAe,UAAUzU,MAAV,EAAkB;AAChD/C,EAAAA,SAAS,CAACwX,YAAD,EAAezU,MAAf,CAAT;AACA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI,WAASyU,YAAT,CAAsBC,OAAtB,EAA+BC,SAA/B,EAA0CjQ,QAA1C,EAAoD;AAChD,QAAI0G,KAAK,GAAGpL,MAAM,CAACsB,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACA8J,IAAAA,KAAK,CAACwJ,YAAN,GAAqB,KAArB;AACAxJ,IAAAA,KAAK,CAACyJ,cAAN,GAAuB,KAAvB;;AACA,QAAI,CAAC5W,iBAAiB,CAACyW,OAAD,CAAtB,EAAiC;AAC7BtJ,MAAAA,KAAK,CAAC0J,YAAN,GAAqBJ,OAArB;AACH;;AACDtJ,IAAAA,KAAK,CAAC1G,QAAN,GAAiBA,QAAjB;AACA0G,IAAAA,KAAK,CAAC2J,MAAN,GAAe3W,QAAQ,CAAC8Q,OAAT,CAAiB,cAAjB,CAAf;AACA,QAAI3L,GAAG,GAAG;AAAEsD,MAAAA,IAAI,EAAE,EAAR;AAAYmH,MAAAA,OAAO,EAAE;AAArB,KAAV;AACAgH,IAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B9J,KAAK,CAAC2J,MAAlC,EAA0CvN,IAAI,CAACC,SAAL,CAAelE,GAAf,CAA1C;AACA,QAAI4I,IAAI,GAAGf,KAAK,CAAC2J,MAAjB;;AACA,QAAI,CAAC9W,iBAAiB,CAAC0W,SAAD,CAAtB,EAAmC;AAC/BQ,MAAAA,WAAW,CAAC,YAAY;AACpB,YAAIvV,IAAJ;AACAA,QAAAA,IAAI,GAAGxB,QAAQ,CAACsJ,KAAT,CAAee,SAAf,CAAyBuM,MAAM,CAACC,YAAP,CAAoBG,OAApB,CAA4BjJ,IAA5B,CAAzB,CAAP;AACA,YAAIkJ,MAAM,GAAG,EAAb;;AACA,aAAK,IAAItU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnB,IAAI,CAACoO,OAAL,CAAaxN,MAAjC,EAAyCO,CAAC,EAA1C,EAA8C;AAC1C,cAAIuU,WAAW,GAAG,CAAC,IAAI/P,IAAJ,EAAnB;AACA,cAAIgQ,WAAW,GAAG,CAAC,IAAIhQ,IAAJ,CAAS3F,IAAI,CAACoO,OAAL,CAAajN,CAAb,EAAgB4T,SAAzB,CAAnB;AACA/U,UAAAA,IAAI,CAACoO,OAAL,CAAajN,CAAb,EAAgB4T,SAAhB,GAA4BW,WAAW,GAAGC,WAA1C;;AACA,cAAID,WAAW,GAAGC,WAAd,GAA4BZ,SAAhC,EAA2C;AACvCU,YAAAA,MAAM,CAACjU,IAAP,CAAYL,CAAZ;AACH;AACJ;;AACD,aAAK,IAAIA,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsU,MAAM,CAAC7U,MAA3B,EAAmCO,CAAC,EAApC,EAAwC;AACpCnB,UAAAA,IAAI,CAACoO,OAAL,CAAa3I,MAAb,CAAoBgQ,MAAM,CAACtU,CAAD,CAA1B,EAA+B,CAA/B;AACAnB,UAAAA,IAAI,CAACiH,IAAL,CAAUxB,MAAV,CAAiBgQ,MAAM,CAACtU,CAAD,CAAvB,EAA4B,CAA5B;AACH;;AACDiU,QAAAA,MAAM,CAACC,YAAP,CAAoBO,UAApB,CAA+BrJ,IAA/B;AACA6I,QAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B/I,IAA5B,EAAkC3E,IAAI,CAACC,SAAL,CAAe7H,IAAf,CAAlC;AACH,OAlBU,EAkBR+U,SAlBQ,CAAX;AAmBH;;AACD,WAAOvJ,KAAP;AACH;AACD;AACJ;AACA;AACA;AACA;AACA;;;AACIqJ,EAAAA,YAAY,CAAC5W,SAAb,CAAuB4X,WAAvB,GAAqC,UAAU3P,GAAV,EAAejG,KAAf,EAAsB;AACvD,QAAIqB,OAAO,GAAG,KAAKwE,eAAL,CAAqB7F,KAArB,CAAd;AACA,QAAI8F,OAAO,GAAGtH,KAAK,CAACuH,gBAAN,CAAuB/F,KAAK,CAACqB,OAA7B,EAAsC,CAAC,UAAD,EAAa,QAAb,EAAuB,QAAvB,EAAiC,QAAjC,EAA2C,SAA3C,CAAtC,CAAd;AACA,QAAIP,GAAG,GAAGmF,GAAV;AACA,QAAIhF,IAAI,GAAG,QAAX;;AACA,QAAIA,IAAI,IAAI6E,OAAZ,EAAqB;AACjBhF,MAAAA,GAAG,IAAIgF,OAAO,CAAC7E,IAAD,CAAP,CAAc8D,SAArB;AACH;;AACD1D,IAAAA,OAAO,CAAC+E,KAAR,CAAc6J,OAAd,CAAsB,UAAUvM,GAAV,EAAe;AACjC5C,MAAAA,GAAG,IAAI4C,GAAG,CAAClC,CAAJ,CAAMkF,SAAN,GAAkBhD,GAAG,CAAClC,CAAJ,CAAMa,SAA/B;AACH,KAFD;AAGAhB,IAAAA,OAAO,CAACgF,MAAR,CAAe4J,OAAf,CAAuB,UAAUvM,GAAV,EAAe;AAClC5C,MAAAA,GAAG,IAAI4C,GAAG,CAAClC,CAAJ,CAAMa,SAAb;AACH,KAFD;AAGAhB,IAAAA,OAAO,CAACkF,QAAR,CAAiB0J,OAAjB,CAAyB,UAAUvM,GAAV,EAAe;AACpC5C,MAAAA,GAAG,IAAI4C,GAAG,CAAClC,CAAJ,CAAM0C,SAAb;AACH,KAFD;;AAGA,SAAK,IAAIT,MAAM,GAAG,CAAlB,EAAqBA,MAAM,GAAGpC,OAAO,CAACiF,OAAR,CAAgB3F,MAA9C,EAAsD8C,MAAM,EAA5D,EAAgE;AAC5D,UAAIoS,aAAa,GAAGxU,OAAO,CAACiF,OAAR,CAAgB7C,MAAhB,CAApB;;AACA,UAAIoS,aAAa,CAACrU,CAAd,CAAgB4L,SAApB,EAA+B;AAC3B,YAAI0I,QAAQ,GAAG9V,KAAK,CAAC+V,KAAN,EAAf;AACAD,QAAAA,QAAQ,CAACzU,OAAT,GAAmB,EAAnB;;AACA,aAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2U,aAAa,CAACrU,CAAd,CAAgBwL,UAAhB,CAA2BrM,MAA/C,EAAuDO,CAAC,EAAxD,EAA4D;AACxD4U,UAAAA,QAAQ,CAACzU,OAAT,CAAiBE,IAAjB,CAAsB;AAAED,YAAAA,EAAE,EAAE,SAAN;AAAiBE,YAAAA,CAAC,EAAEqU,aAAa,CAACrU,CAAd,CAAgBwL,UAAhB,CAA2B9L,CAA3B,CAApB;AAAmDuC,YAAAA,MAAM,EAAEzD,KAAK,CAACqB,OAAN,CAAcoC;AAAzE,WAAtB;AACH;;AACD3C,QAAAA,GAAG,IAAI+U,aAAa,CAACrU,CAAd,CAAgB2L,SAAhB,GAA4B,KAAKyI,WAAL,CAAiB3P,GAAjB,EAAsB6P,QAAtB,CAAnC;AACH,OAPD,MAQK;AACDhV,QAAAA,GAAG,IAAI+U,aAAa,CAACrU,CAAd,CAAgBE,KAAhB,GAAwBmU,aAAa,CAACrU,CAAd,CAAgB8F,QAAxC,GAAmDuO,aAAa,CAACrU,CAAd,CAAgBL,KAA1E;AACH;AACJ;;AACD,WAAOL,GAAP;AACH,GAhCD;AAiCA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI8T,EAAAA,YAAY,CAAC5W,SAAb,CAAuBsC,YAAvB,GAAsC,UAAU0C,EAAV,EAAchD,KAAd,EAAqB4F,gBAArB,EAAuC;AACzE,QAAI9E,GAAG,GAAG,KAAK8U,WAAL,CAAiB5S,EAAE,CAACpD,UAAH,CAAcqG,GAA/B,EAAoCjG,KAApC,CAAV;AACA,QAAIgW,WAAJ;AACAA,IAAAA,WAAW,GAAGzX,QAAQ,CAACsJ,KAAT,CAAee,SAAf,CAAyBuM,MAAM,CAACC,YAAP,CAAoBG,OAApB,CAA4B,KAAKL,MAAjC,CAAzB,CAAd;AACA,QAAInV,IAAI,GAAGiW,WAAW,GAAGA,WAAW,CAAC7H,OAAZ,CAAoB6H,WAAW,CAAChP,IAAZ,CAAiBkB,OAAjB,CAAyBpH,GAAzB,CAApB,CAAH,GAAwD,IAA9E;;AACA,QAAIf,IAAI,IAAI,IAAR,IAAgB,CAAC,KAAKgV,YAAtB,IAAsC,CAAC,KAAKC,cAAhD,EAAgE;AAC5D,aAAOjV,IAAP;AACH;;AACD,SAAKgV,YAAL,GAAoB,IAApB;AACA,SAAKC,cAAL,GAAsB,IAAtB;AACA,WAAO,KAAKC,YAAL,CAAkB3U,YAAlB,CAA+BF,KAA/B,CAAqC,KAAK6U,YAA1C,EAAwD,GAAGvU,KAAH,CAASe,IAAT,CAAcpB,SAAd,EAAyB,CAAzB,CAAxD,CAAP;AACH,GAXD;AAYA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIuU,EAAAA,YAAY,CAAC5W,SAAb,CAAuB8B,eAAvB,GAAyC,UAAUC,IAAV,EAAgBlB,EAAhB,EAAoBmB,KAApB,EAA2BC,GAA3B,EAAgCkG,OAAhC,EAAyClD,OAAzC,EAAkD;AACvF,QAAI,KAAK+R,cAAL,IAAwB7O,OAAO,IAAI,KAAK8O,YAAL,CAAkBnW,OAAlB,CAA0B4M,KAArC,IACxBnN,QAAQ,CAACiG,QAAT,CAAkB2B,OAAO,CAACF,GAA1B,EAA+B,KAAKgP,YAAL,CAAkBnW,OAAlB,CAA0B4M,KAAzD,CADwB,IAC2CvF,OAAO,CAACxG,IAAR,CAAagN,WAAb,OAA+B,MADtG,EAC+G;AAC3G,aAAO,KAAKsI,YAAL,CAAkBnV,eAAlB,CAAkCC,IAAlC,EAAwClB,EAAxC,EAA4CmB,KAA5C,EAAmDC,GAAnD,EAAwDkG,OAAxD,EAAiElD,OAAjE,CAAP;AACH;;AACDlD,IAAAA,IAAI,GAAG,KAAKkV,YAAL,CAAkBnV,eAAlB,CAAkCM,KAAlC,CAAwC,KAAK6U,YAA7C,EAA2D,GAAGvU,KAAH,CAASe,IAAT,CAAcpB,SAAd,EAAyB,CAAzB,CAA3D,CAAP;AACA,QAAIS,GAAG,GAAGd,KAAK,GAAG,KAAK4V,WAAL,CAAiB/W,EAAE,CAACe,UAAH,CAAcqG,GAA/B,EAAoCjG,KAApC,CAAH,GAAgDnB,EAAE,CAACe,UAAH,CAAcqG,GAA7E;AACA,QAAIvC,GAAG,GAAG,EAAV;AACAA,IAAAA,GAAG,GAAGnF,QAAQ,CAACsJ,KAAT,CAAee,SAAf,CAAyBuM,MAAM,CAACC,YAAP,CAAoBG,OAApB,CAA4B,KAAKL,MAAjC,CAAzB,CAAN;AACA,QAAIe,KAAK,GAAGvS,GAAG,CAACsD,IAAJ,CAASkB,OAAT,CAAiBpH,GAAjB,CAAZ;;AACA,QAAImV,KAAK,KAAK,CAAC,CAAf,EAAkB;AACdvS,MAAAA,GAAG,CAACyK,OAAJ,CAAY3I,MAAZ,CAAmByQ,KAAnB,EAA0B,CAA1B;AACAvS,MAAAA,GAAG,CAACsD,IAAJ,CAASxB,MAAT,CAAgByQ,KAAhB,EAAuB,CAAvB;AACH;;AACDvS,IAAAA,GAAG,CAACyK,OAAJ,CAAYzK,GAAG,CAACsD,IAAJ,CAASzF,IAAT,CAAcT,GAAd,IAAqB,CAAjC,IAAsC;AAAEkG,MAAAA,IAAI,EAAElG,GAAR;AAAaN,MAAAA,MAAM,EAAET,IAAI,CAACS,MAA1B;AAAkCsU,MAAAA,SAAS,EAAE,IAAIpP,IAAJ,EAA7C;AAAyDnG,MAAAA,KAAK,EAAEQ,IAAI,CAACR;AAArE,KAAtC;;AACA,WAAOmE,GAAG,CAACyK,OAAJ,CAAYxN,MAAZ,GAAqB,KAAKkE,QAAjC,EAA2C;AACvCnB,MAAAA,GAAG,CAACyK,OAAJ,CAAY3I,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB;AACA9B,MAAAA,GAAG,CAACsD,IAAJ,CAASxB,MAAT,CAAgB,CAAhB,EAAmB,CAAnB;AACH;;AACD2P,IAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,KAAKH,MAAjC,EAAyCvN,IAAI,CAACC,SAAL,CAAelE,GAAf,CAAzC;AACA,WAAO3D,IAAP;AACH,GArBD;AAsBA;AACJ;AACA;AACA;AACA;AACA;;;AACI6U,EAAAA,YAAY,CAAC5W,SAAb,CAAuBsM,UAAvB,GAAoC,UAAUtH,EAAV,EAAcmD,OAAd,EAAuBuH,QAAvB,EAAiC;AACjE,QAAI,CAACtP,iBAAiB,CAAC,KAAK6W,YAAL,CAAkBnW,OAAlB,CAA0B4M,KAA3B,CAAlB,IAAuDnN,QAAQ,CAACiG,QAAT,CAAkBkJ,QAAQ,CAACzH,GAA3B,EAAgC,KAAKgP,YAAL,CAAkBnW,OAAlB,CAA0B4M,KAA1D,CAAvD,IACGgC,QAAQ,CAAC/N,IAAT,CAAcgN,WAAd,OAAgC,MADvC,EAC+C;AAC3CxG,MAAAA,OAAO,CAACwH,gBAAR,CAAyB,QAAzB,EAAmC,KAAKsH,YAAL,CAAkBnW,OAAlB,CAA0B2M,eAA7D;AACH;;AACD,QAAI,CAACzI,EAAE,CAACpD,UAAH,CAAcsW,WAAnB,EAAgC;AAC5B/P,MAAAA,OAAO,CAACwH,gBAAR,CAAyB,QAAzB,EAAmC,KAAKsH,YAAL,CAAkBnW,OAAlB,CAA0B0M,MAA7D;AACH;AACJ,GARD;AASA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIoJ,EAAAA,YAAY,CAAC5W,SAAb,CAAuBuF,MAAvB,GAAgC,UAAUP,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0C;AACtE,SAAKyP,YAAL,GAAoB,IAApB;AACA,WAAO,KAAKE,YAAL,CAAkB1R,MAAlB,CAAyBP,EAAzB,EAA6ByC,QAA7B,EAAuCtE,KAAvC,EAA8CmE,SAA9C,CAAP;AACH,GAHD;AAIA;AACJ;AACA;AACA;AACA;AACA;;;AACIsP,EAAAA,YAAY,CAAC5W,SAAb,CAAuBqF,MAAvB,GAAgC,UAAUL,EAAV,EAAcjD,IAAd,EAAoBuF,SAApB,EAA+B;AAC3D,SAAK0P,cAAL,GAAsB,IAAtB;AACA,WAAO,KAAKC,YAAL,CAAkB5R,MAAlB,CAAyBL,EAAzB,EAA6BjD,IAA7B,EAAmCuF,SAAnC,CAAP;AACH,GAHD;AAIA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIsP,EAAAA,YAAY,CAAC5W,SAAb,CAAuBwF,MAAvB,GAAgC,UAAUR,EAAV,EAAcyC,QAAd,EAAwBtE,KAAxB,EAA+BmE,SAA/B,EAA0C;AACtE,SAAKyP,YAAL,GAAoB,IAApB;AACA,WAAO,KAAKE,YAAL,CAAkBzR,MAAlB,CAAyBR,EAAzB,EAA6ByC,QAA7B,EAAuCtE,KAAvC,EAA8CmE,SAA9C,CAAP;AACH,GAHD;AAIA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIsP,EAAAA,YAAY,CAAC5W,SAAb,CAAuB+E,YAAvB,GAAsC,UAAUC,EAAV,EAAcC,OAAd,EAAuBzB,CAAvB,EAA0B;AAC5D,WAAO,KAAKyT,YAAL,CAAkBlS,YAAlB,CAA+BC,EAA/B,EAAmCC,OAAnC,EAA4CzB,CAA5C,CAAP;AACH,GAFD;;AAGA,SAAOoT,YAAP;AACH,CAhMiC,CAgMhCjP,UAhMgC,CAAlC;;AAiMA,SAASiP,YAAT","sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { merge, extend, isNullOrUndefined, setValue, getValue } from '@syncfusion/ej2-base';\r\nimport { DataUtil } from './util';\r\nimport { Query, Predicate } from './query';\r\nvar consts = { GroupGuid: '{271bbba0-1ee7}' };\r\n/**\r\n * Adaptors are specific data source type aware interfaces that are used by DataManager to communicate with DataSource.\r\n * This is the base adaptor class that other adaptors can extend.\r\n * @hidden\r\n */\r\nvar Adaptor = /** @class */ (function () {\r\n    /**\r\n     * Constructor for Adaptor class\r\n     * @param  {DataOptions} ds?\r\n     * @hidden\r\n     * @returns aggregates\r\n     */\r\n    function Adaptor(ds) {\r\n        // common options for all the adaptors \r\n        this.options = {\r\n            from: 'table',\r\n            requestType: 'json',\r\n            sortBy: 'sorted',\r\n            select: 'select',\r\n            skip: 'skip',\r\n            group: 'group',\r\n            take: 'take',\r\n            search: 'search',\r\n            count: 'requiresCounts',\r\n            where: 'where',\r\n            aggregates: 'aggregates',\r\n            expand: 'expand'\r\n        };\r\n        /**\r\n         * Specifies the type of adaptor.\r\n         * @default Adaptor\r\n         */\r\n        this.type = Adaptor;\r\n        this.dataSource = ds;\r\n        this.pvt = {};\r\n    }\r\n    /**\r\n     * Returns the data from the query processing.\r\n     * @param  {Object} data\r\n     * @param  {DataOptions} ds?\r\n     * @param  {Query} query?\r\n     * @param  {XMLHttpRequest} xhr?\r\n     * @returns Object\r\n     */\r\n    Adaptor.prototype.processResponse = function (data, ds, query, xhr) {\r\n        return data;\r\n    };\r\n    return Adaptor;\r\n}());\r\nexport { Adaptor };\r\n/**\r\n * JsonAdaptor is used to process JSON data. It contains methods to process the given JSON data based on the queries.\r\n * @hidden\r\n */\r\nvar JsonAdaptor = /** @class */ (function (_super) {\r\n    __extends(JsonAdaptor, _super);\r\n    function JsonAdaptor() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    /**\r\n     * Process the JSON data based on the provided queries.\r\n     * @param  {DataManager} dataManager\r\n     * @param  {Query} query\r\n     * @returns Object\r\n     */\r\n    JsonAdaptor.prototype.processQuery = function (dataManager, query) {\r\n        var result = dataManager.dataSource.json.slice(0);\r\n        var count = result.length;\r\n        var countFlg = true;\r\n        var ret;\r\n        var key;\r\n        var lazyLoad = {};\r\n        var keyCount = 0;\r\n        var group = [];\r\n        var page;\r\n        for (var i = 0; i < query.lazyLoad.length; i++) {\r\n            keyCount++;\r\n            lazyLoad[query.lazyLoad[i].key] = query.lazyLoad[i].value;\r\n        }\r\n        var agg = {};\r\n        for (var i = 0; i < query.queries.length; i++) {\r\n            key = query.queries[i];\r\n            if ((key.fn === 'onPage' || key.fn === 'onGroup') && query.lazyLoad.length) {\r\n                if (key.fn === 'onGroup') {\r\n                    group.push(key.e);\r\n                }\r\n                if (key.fn === 'onPage') {\r\n                    page = key.e;\r\n                }\r\n                continue;\r\n            }\r\n            ret = this[key.fn].call(this, result, key.e, query);\r\n            if (key.fn === 'onAggregates') {\r\n                agg[key.e.field + ' - ' + key.e.type] = ret;\r\n            }\r\n            else {\r\n                result = ret !== undefined ? ret : result;\r\n            }\r\n            if (key.fn === 'onPage' || key.fn === 'onSkip' || key.fn === 'onTake' || key.fn === 'onRange') {\r\n                countFlg = false;\r\n            }\r\n            if (countFlg) {\r\n                count = result.length;\r\n            }\r\n        }\r\n        if (keyCount) {\r\n            var args = {\r\n                query: query, lazyLoad: lazyLoad, result: result, group: group, page: page\r\n            };\r\n            var lazyLoadData = this.lazyLoadGroup(args);\r\n            result = lazyLoadData.result;\r\n            count = lazyLoadData.count;\r\n        }\r\n        if (query.isCountRequired) {\r\n            result = {\r\n                result: result,\r\n                count: count,\r\n                aggregates: agg\r\n            };\r\n        }\r\n        return result;\r\n    };\r\n    /**\r\n     * Perform lazy load grouping in JSON array based on the given query and lazy load details.\r\n     * @param  {LazyLoadGroupArgs} args\r\n     */\r\n    JsonAdaptor.prototype.lazyLoadGroup = function (args) {\r\n        var count = 0;\r\n        var agg = this.getAggregate(args.query);\r\n        var result = args.result;\r\n        if (!isNullOrUndefined(args.lazyLoad.onDemandGroupInfo)) {\r\n            var req = args.lazyLoad.onDemandGroupInfo;\r\n            for (var i = req.where.length - 1; i >= 0; i--) {\r\n                result = this.onWhere(result, req.where[i]);\r\n            }\r\n            if (args.group.length !== req.level) {\r\n                var field = args.group[req.level].fieldName;\r\n                result = DataUtil.group(result, field, agg, null, null, args.group[0].comparer, true);\r\n            }\r\n            count = result.length;\r\n            var data = result;\r\n            result = result.slice(req.skip);\r\n            result = result.slice(0, req.take);\r\n            if (args.group.length !== req.level) {\r\n                this.formGroupResult(result, data);\r\n            }\r\n        }\r\n        else {\r\n            var field = args.group[0].fieldName;\r\n            result = DataUtil.group(result, field, agg, null, null, args.group[0].comparer, true);\r\n            count = result.length;\r\n            var data = result;\r\n            if (args.page) {\r\n                result = this.onPage(result, args.page, args.query);\r\n            }\r\n            this.formGroupResult(result, data);\r\n        }\r\n        return { result: result, count: count };\r\n    };\r\n    JsonAdaptor.prototype.formGroupResult = function (result, data) {\r\n        if (result.length && data.length) {\r\n            var uid = 'GroupGuid';\r\n            var childLevel = 'childLevels';\r\n            var level = 'level';\r\n            var records = 'records';\r\n            result[uid] = data[uid];\r\n            result[childLevel] = data[childLevel];\r\n            result[level] = data[level];\r\n            result[records] = data[records];\r\n        }\r\n        return result;\r\n    };\r\n    /**\r\n     * Separate the aggregate query from the given queries\r\n     * @param  {Query} query\r\n     */\r\n    JsonAdaptor.prototype.getAggregate = function (query) {\r\n        var aggQuery = Query.filterQueries(query.queries, 'onAggregates');\r\n        var agg = [];\r\n        if (aggQuery.length) {\r\n            var tmp = void 0;\r\n            for (var i = 0; i < aggQuery.length; i++) {\r\n                tmp = aggQuery[i].e;\r\n                agg.push({ type: tmp.type, field: DataUtil.getValue(tmp.field, query) });\r\n            }\r\n        }\r\n        return agg;\r\n    };\r\n    /**\r\n     * Performs batch update in the JSON array which add, remove and update records.\r\n     * @param  {DataManager} dm\r\n     * @param  {CrudOptions} changes\r\n     * @param  {RemoteArgs} e\r\n     */\r\n    JsonAdaptor.prototype.batchRequest = function (dm, changes, e) {\r\n        var i;\r\n        var deletedRecordsLen = changes.deletedRecords.length;\r\n        for (i = 0; i < changes.addedRecords.length; i++) {\r\n            this.insert(dm, changes.addedRecords[i]);\r\n        }\r\n        for (i = 0; i < changes.changedRecords.length; i++) {\r\n            this.update(dm, e.key, changes.changedRecords[i]);\r\n        }\r\n        for (i = 0; i < deletedRecordsLen; i++) {\r\n            this.remove(dm, e.key, changes.deletedRecords[i]);\r\n        }\r\n        return changes;\r\n    };\r\n    /**\r\n     * Performs filter operation with the given data and where query.\r\n     * @param  {Object[]} ds\r\n     * @param  {{validate:Function}} e\r\n     */\r\n    JsonAdaptor.prototype.onWhere = function (ds, e) {\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        return ds.filter(function (obj) {\r\n            if (e) {\r\n                return e.validate(obj);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Returns aggregate function based on the aggregate type.\r\n     * @param  {Object[]} ds\r\n     * @param  {{field:string} e\r\n     * @param  {string}} type\r\n     */\r\n    JsonAdaptor.prototype.onAggregates = function (ds, e) {\r\n        var fn = DataUtil.aggregates[e.type];\r\n        if (!ds || !fn || ds.length === 0) {\r\n            return null;\r\n        }\r\n        return fn(ds, e.field);\r\n    };\r\n    /**\r\n     * Performs search operation based on the given query.\r\n     * @param  {Object[]} ds\r\n     * @param  {QueryOptions} e\r\n     */\r\n    JsonAdaptor.prototype.onSearch = function (ds, e) {\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        if (e.fieldNames.length === 0) {\r\n            DataUtil.getFieldList(ds[0], e.fieldNames);\r\n        }\r\n        return ds.filter(function (obj) {\r\n            for (var j = 0; j < e.fieldNames.length; j++) {\r\n                if (e.comparer.call(obj, DataUtil.getObject(e.fieldNames[j], obj), e.searchKey, e.ignoreCase, e.ignoreAccent)) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        });\r\n    };\r\n    /**\r\n     * Sort the data with given direction and field.\r\n     * @param  {Object[]} ds\r\n     * @param  {{comparer:(a:Object} e\r\n     * @param  {Object} b\r\n     */\r\n    JsonAdaptor.prototype.onSortBy = function (ds, e, query) {\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        var fnCompare;\r\n        var field = DataUtil.getValue(e.fieldName, query);\r\n        if (!field) {\r\n            return ds.sort(e.comparer);\r\n        }\r\n        if (field instanceof Array) {\r\n            field = field.slice(0);\r\n            for (var i = field.length - 1; i >= 0; i--) {\r\n                if (!field[i]) {\r\n                    continue;\r\n                }\r\n                fnCompare = e.comparer;\r\n                if (DataUtil.endsWith(field[i], ' desc')) {\r\n                    fnCompare = DataUtil.fnSort('descending');\r\n                    field[i] = field[i].replace(' desc', '');\r\n                }\r\n                ds = DataUtil.sort(ds, field[i], fnCompare);\r\n            }\r\n            return ds;\r\n        }\r\n        return DataUtil.sort(ds, field, e.comparer);\r\n    };\r\n    /**\r\n     * Group the data based on the given query.\r\n     * @param  {Object[]} ds\r\n     * @param  {QueryOptions} e\r\n     * @param  {Query} query\r\n     */\r\n    JsonAdaptor.prototype.onGroup = function (ds, e, query) {\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        var agg = this.getAggregate(query);\r\n        return DataUtil.group(ds, DataUtil.getValue(e.fieldName, query), agg, null, null, e.comparer);\r\n    };\r\n    /**\r\n     * Retrieves records based on the given page index and size.\r\n     * @param  {Object[]} ds\r\n     * @param  {{pageSize:number} e\r\n     * @param  {number}} pageIndex\r\n     * @param  {Query} query\r\n     */\r\n    JsonAdaptor.prototype.onPage = function (ds, e, query) {\r\n        var size = DataUtil.getValue(e.pageSize, query);\r\n        var start = (DataUtil.getValue(e.pageIndex, query) - 1) * size;\r\n        var end = start + size;\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        return ds.slice(start, end);\r\n    };\r\n    /**\r\n     * Retrieves records based on the given start and end index from query.\r\n     * @param  {Object[]} ds\r\n     * @param  {{start:number} e\r\n     * @param  {number}} end\r\n     */\r\n    JsonAdaptor.prototype.onRange = function (ds, e) {\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        return ds.slice(DataUtil.getValue(e.start), DataUtil.getValue(e.end));\r\n    };\r\n    /**\r\n     * Picks the given count of records from the top of the datasource.\r\n     * @param  {Object[]} ds\r\n     * @param  {{nos:number}} e\r\n     */\r\n    JsonAdaptor.prototype.onTake = function (ds, e) {\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        return ds.slice(0, DataUtil.getValue(e.nos));\r\n    };\r\n    /**\r\n     * Skips the given count of records from the data source.\r\n     * @param  {Object[]} ds\r\n     * @param  {{nos:number}} e\r\n     */\r\n    JsonAdaptor.prototype.onSkip = function (ds, e) {\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        return ds.slice(DataUtil.getValue(e.nos));\r\n    };\r\n    /**\r\n     * Selects specified columns from the data source.\r\n     * @param  {Object[]} ds\r\n     * @param  {{fieldNames:string}} e\r\n     */\r\n    JsonAdaptor.prototype.onSelect = function (ds, e) {\r\n        if (!ds || !ds.length) {\r\n            return ds;\r\n        }\r\n        return DataUtil.select(ds, DataUtil.getValue(e.fieldNames));\r\n    };\r\n    /**\r\n     * Inserts new record in the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {Object} data\r\n     * @param  {number} position\r\n     */\r\n    JsonAdaptor.prototype.insert = function (dm, data, tableName, query, position) {\r\n        if (isNullOrUndefined(position)) {\r\n            return dm.dataSource.json.push(data);\r\n        }\r\n        else {\r\n            return dm.dataSource.json.splice(position, 0, data);\r\n        }\r\n    };\r\n    /**\r\n     * Remove the data from the dataSource based on the key field value.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {Object} value\r\n     * @param  {string} tableName?\r\n     * @returns null\r\n     */\r\n    JsonAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\r\n        var ds = dm.dataSource.json;\r\n        var i;\r\n        if (typeof value === 'object' && !(value instanceof Date)) {\r\n            value = DataUtil.getObject(keyField, value);\r\n        }\r\n        for (i = 0; i < ds.length; i++) {\r\n            if (DataUtil.getObject(keyField, ds[i]) === value) {\r\n                break;\r\n            }\r\n        }\r\n        return i !== ds.length ? ds.splice(i, 1) : null;\r\n    };\r\n    /**\r\n     * Updates existing record and saves the changes to the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {Object} value\r\n     * @param  {string} tableName?\r\n     * @returns null\r\n     */\r\n    JsonAdaptor.prototype.update = function (dm, keyField, value, tableName) {\r\n        var ds = dm.dataSource.json;\r\n        var i;\r\n        var key;\r\n        if (!isNullOrUndefined(keyField)) {\r\n            key = getValue(keyField, value);\r\n        }\r\n        for (i = 0; i < ds.length; i++) {\r\n            if (!isNullOrUndefined(keyField) && (getValue(keyField, ds[i])) === key) {\r\n                break;\r\n            }\r\n        }\r\n        return i < ds.length ? merge(ds[i], value) : null;\r\n    };\r\n    return JsonAdaptor;\r\n}(Adaptor));\r\nexport { JsonAdaptor };\r\n/**\r\n * URL Adaptor of DataManager can be used when you are required to use remote service to retrieve data.\r\n * It interacts with server-side for all DataManager Queries and CRUD operations.\r\n * @hidden\r\n */\r\nvar UrlAdaptor = /** @class */ (function (_super) {\r\n    __extends(UrlAdaptor, _super);\r\n    function UrlAdaptor() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    /**\r\n     * Process the query to generate request body.\r\n     * @param  {DataManager} dm\r\n     * @param  {Query} query\r\n     * @param  {Object[]} hierarchyFilters?\r\n     * @returns p\r\n     */\r\n    // tslint:disable-next-line:max-func-body-length\r\n    UrlAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\r\n        var queries = this.getQueryRequest(query);\r\n        var singles = Query.filterQueryLists(query.queries, ['onSelect', 'onPage', 'onSkip', 'onTake', 'onRange']);\r\n        var params = query.params;\r\n        var url = dm.dataSource.url;\r\n        var temp;\r\n        var skip;\r\n        var take = null;\r\n        var options = this.options;\r\n        var request = { sorts: [], groups: [], filters: [], searches: [], aggregates: [] };\r\n        // calc Paging & Range\r\n        if ('onPage' in singles) {\r\n            temp = singles.onPage;\r\n            skip = DataUtil.getValue(temp.pageIndex, query);\r\n            take = DataUtil.getValue(temp.pageSize, query);\r\n            skip = (skip - 1) * take;\r\n        }\r\n        else if ('onRange' in singles) {\r\n            temp = singles.onRange;\r\n            skip = temp.start;\r\n            take = temp.end - temp.start;\r\n        }\r\n        // Sorting\r\n        for (var i = 0; i < queries.sorts.length; i++) {\r\n            temp = DataUtil.getValue(queries.sorts[i].e.fieldName, query);\r\n            request.sorts.push(DataUtil.callAdaptorFunction(this, 'onEachSort', { name: temp, direction: queries.sorts[i].e.direction }, query));\r\n        }\r\n        // hierarchy\r\n        if (hierarchyFilters) {\r\n            temp = this.getFiltersFrom(hierarchyFilters, query);\r\n            if (temp) {\r\n                request.filters.push(DataUtil.callAdaptorFunction(this, 'onEachWhere', temp.toJson(), query));\r\n            }\r\n        }\r\n        // Filters\r\n        for (var i = 0; i < queries.filters.length; i++) {\r\n            var res = DataUtil.callAdaptorFunction(this, 'onEachWhere', queries.filters[i].e.toJson(), query);\r\n            if ((this.getModuleName &&\r\n                this.getModuleName() === 'ODataV4Adaptor') &&\r\n                !isNullOrUndefined(queries.filters[i].e.key) && queries.filters.length > 1) {\r\n                res = \"(\" + res + \")\";\r\n            }\r\n            request.filters.push(res);\r\n            var keys_3 = typeof request.filters[i] === 'object' ? Object.keys(request.filters[i]) : [];\r\n            for (var _i = 0, keys_1 = keys_3; _i < keys_1.length; _i++) {\r\n                var prop = keys_1[_i];\r\n                if (DataUtil.isNull((request)[prop])) {\r\n                    delete request[prop];\r\n                }\r\n            }\r\n        }\r\n        // Searches\r\n        for (var i = 0; i < queries.searches.length; i++) {\r\n            temp = queries.searches[i].e;\r\n            request.searches.push(DataUtil.callAdaptorFunction(this, 'onEachSearch', {\r\n                fields: temp.fieldNames,\r\n                operator: temp.operator,\r\n                key: temp.searchKey,\r\n                ignoreCase: temp.ignoreCase\r\n            }, query));\r\n        }\r\n        // Grouping\r\n        for (var i = 0; i < queries.groups.length; i++) {\r\n            request.groups.push(DataUtil.getValue(queries.groups[i].e.fieldName, query));\r\n        }\r\n        // aggregates\r\n        for (var i = 0; i < queries.aggregates.length; i++) {\r\n            temp = queries.aggregates[i].e;\r\n            request.aggregates.push({ type: temp.type, field: DataUtil.getValue(temp.field, query) });\r\n        }\r\n        var req = {};\r\n        this.getRequestQuery(options, query, singles, request, req);\r\n        // Params\r\n        DataUtil.callAdaptorFunction(this, 'addParams', { dm: dm, query: query, params: params, reqParams: req });\r\n        if (query.lazyLoad.length) {\r\n            for (var i = 0; i < query.lazyLoad.length; i++) {\r\n                req[query.lazyLoad[i].key] = query.lazyLoad[i].value;\r\n            }\r\n        }\r\n        // cleanup\r\n        var keys = Object.keys(req);\r\n        for (var _a = 0, keys_2 = keys; _a < keys_2.length; _a++) {\r\n            var prop = keys_2[_a];\r\n            if (DataUtil.isNull(req[prop]) || req[prop] === '' || req[prop].length === 0) {\r\n                delete req[prop];\r\n            }\r\n        }\r\n        if (!(options.skip in req && options.take in req) && take !== null) {\r\n            req[options.skip] = DataUtil.callAdaptorFunction(this, 'onSkip', skip, query);\r\n            req[options.take] = DataUtil.callAdaptorFunction(this, 'onTake', take, query);\r\n        }\r\n        var p = this.pvt;\r\n        this.pvt = {};\r\n        if (this.options.requestType === 'json') {\r\n            return {\r\n                data: JSON.stringify(req, DataUtil.parse.jsonDateReplacer),\r\n                url: url,\r\n                pvtData: p,\r\n                type: 'POST',\r\n                contentType: 'application/json; charset=utf-8'\r\n            };\r\n        }\r\n        temp = this.convertToQueryString(req, query, dm);\r\n        temp = (dm.dataSource.url.indexOf('?') !== -1 ? '&' : '/') + temp;\r\n        return {\r\n            type: 'GET', url: temp.length ? url.replace(/\\/*$/, temp) : url, pvtData: p\r\n        };\r\n    };\r\n    UrlAdaptor.prototype.getRequestQuery = function (options, query, singles, request, request1) {\r\n        var param = 'param';\r\n        var req = request1;\r\n        req[options.from] = query.fromTable;\r\n        if (options.apply && query.distincts.length) {\r\n            req[options.apply] = 'onDistinct' in this ? DataUtil.callAdaptorFunction(this, 'onDistinct', query.distincts) : '';\r\n        }\r\n        if (!query.distincts.length && options.expand) {\r\n            req[options.expand] = 'onExpand' in this && 'onSelect' in singles ?\r\n                DataUtil.callAdaptorFunction(this, 'onExpand', { selects: DataUtil.getValue(singles.onSelect.fieldNames, query), expands: query.expands }, query) : query.expands;\r\n        }\r\n        req[options.select] = 'onSelect' in singles && !query.distincts.length ?\r\n            DataUtil.callAdaptorFunction(this, 'onSelect', DataUtil.getValue(singles.onSelect.fieldNames, query), query) : '';\r\n        req[options.count] = query.isCountRequired ? DataUtil.callAdaptorFunction(this, 'onCount', query.isCountRequired, query) : '';\r\n        req[options.search] = request.searches.length ? DataUtil.callAdaptorFunction(this, 'onSearch', request.searches, query) : '';\r\n        req[options.skip] = 'onSkip' in singles ?\r\n            DataUtil.callAdaptorFunction(this, 'onSkip', DataUtil.getValue(singles.onSkip.nos, query), query) : '';\r\n        req[options.take] = 'onTake' in singles ?\r\n            DataUtil.callAdaptorFunction(this, 'onTake', DataUtil.getValue(singles.onTake.nos, query), query) : '';\r\n        req[options.where] = request.filters.length || request.searches.length ?\r\n            DataUtil.callAdaptorFunction(this, 'onWhere', request.filters, query) : '';\r\n        req[options.sortBy] = request.sorts.length ? DataUtil.callAdaptorFunction(this, 'onSortBy', request.sorts, query) : '';\r\n        req[options.group] = request.groups.length ? DataUtil.callAdaptorFunction(this, 'onGroup', request.groups, query) : '';\r\n        req[options.aggregates] = request.aggregates.length ?\r\n            DataUtil.callAdaptorFunction(this, 'onAggregates', request.aggregates, query) : '';\r\n        req[param] = [];\r\n    };\r\n    /**\r\n     * Convert the object from processQuery to string which can be added query string.\r\n     * @param  {Object} req\r\n     * @param  {Query} query\r\n     * @param  {DataManager} dm\r\n     */\r\n    UrlAdaptor.prototype.convertToQueryString = function (request, query, dm) {\r\n        return '';\r\n        // this needs to be overridden\r\n    };\r\n    /**\r\n     * Return the data from the data manager processing.\r\n     * @param  {DataResult} data\r\n     * @param  {DataOptions} ds?\r\n     * @param  {Query} query?\r\n     * @param  {XMLHttpRequest} xhr?\r\n     * @param  {Object} request?\r\n     * @param  {CrudOptions} changes?\r\n     */\r\n    UrlAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\r\n        if (xhr && xhr.getResponseHeader('Content-Type') &&\r\n            xhr.getResponseHeader('Content-Type').indexOf('application/json') !== -1) {\r\n            var handleTimeZone = DataUtil.timeZoneHandling;\r\n            if (ds && !ds.timeZoneHandling) {\r\n                DataUtil.timeZoneHandling = false;\r\n            }\r\n            data = DataUtil.parse.parseJson(data);\r\n            DataUtil.timeZoneHandling = handleTimeZone;\r\n        }\r\n        var requests = request;\r\n        var pvt = requests.pvtData || {};\r\n        var groupDs = data ? data.groupDs : [];\r\n        if (xhr && xhr.getResponseHeader('Content-Type') &&\r\n            xhr.getResponseHeader('Content-Type').indexOf('xml') !== -1) {\r\n            return (query.isCountRequired ? { result: [], count: 0 } : []);\r\n        }\r\n        var d = JSON.parse(requests.data);\r\n        if (d && d.action === 'batch' && data && data.addedRecords) {\r\n            changes.addedRecords = data.addedRecords;\r\n            return changes;\r\n        }\r\n        if (data && data.d) {\r\n            data = data.d;\r\n        }\r\n        var args = {};\r\n        if (data && 'count' in data) {\r\n            args.count = data.count;\r\n        }\r\n        args.result = data && data.result ? data.result : data;\r\n        var isExpand = false;\r\n        if (Array.isArray(data.result) && data.result.length) {\r\n            var key = 'key';\r\n            var val = 'value';\r\n            var level = 'level';\r\n            if (!isNullOrUndefined(data.result[0][key])) {\r\n                args.result = this.formRemoteGroupedData(args.result, 1, pvt.groups.length - 1);\r\n            }\r\n            if (query && query.lazyLoad.length && pvt.groups.length) {\r\n                for (var i = 0; i < query.lazyLoad.length; i++) {\r\n                    if (query.lazyLoad[i][key] === 'onDemandGroupInfo') {\r\n                        var value = query.lazyLoad[i][val][level];\r\n                        if (pvt.groups.length === value) {\r\n                            isExpand = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (!isExpand) {\r\n            this.getAggregateResult(pvt, data, args, groupDs, query);\r\n        }\r\n        return DataUtil.isNull(args.count) ? args.result : { result: args.result, count: args.count, aggregates: args.aggregates };\r\n    };\r\n    UrlAdaptor.prototype.formRemoteGroupedData = function (data, level, childLevel) {\r\n        for (var i = 0; i < data.length; i++) {\r\n            if (data[i].items.length && Object.keys(data[i].items[0]).indexOf('key') > -1) {\r\n                this.formRemoteGroupedData(data[i].items, level + 1, childLevel - 1);\r\n            }\r\n        }\r\n        var uid = 'GroupGuid';\r\n        var childLvl = 'childLevels';\r\n        var lvl = 'level';\r\n        var records = 'records';\r\n        data[uid] = consts[uid];\r\n        data[lvl] = level;\r\n        data[childLvl] = childLevel;\r\n        data[records] = data[0].items.length ? this.getGroupedRecords(data, !isNullOrUndefined(data[0].items[records])) : [];\r\n        return data;\r\n    };\r\n    UrlAdaptor.prototype.getGroupedRecords = function (data, hasRecords) {\r\n        var childGroupedRecords = [];\r\n        var records = 'records';\r\n        for (var i = 0; i < data.length; i++) {\r\n            if (!hasRecords) {\r\n                for (var j = 0; j < data[i].items.length; j++) {\r\n                    childGroupedRecords.push(data[i].items[j]);\r\n                }\r\n            }\r\n            else {\r\n                childGroupedRecords = childGroupedRecords.concat(data[i].items[records]);\r\n            }\r\n        }\r\n        return childGroupedRecords;\r\n    };\r\n    /**\r\n     * Add the group query to the adaptor`s option.\r\n     * @param  {Object[]} e\r\n     * @returns void\r\n     */\r\n    UrlAdaptor.prototype.onGroup = function (e) {\r\n        this.pvt.groups = e;\r\n        return e;\r\n    };\r\n    /**\r\n     * Add the aggregate query to the adaptor`s option.\r\n     * @param  {Aggregates[]} e\r\n     * @returns void\r\n     */\r\n    UrlAdaptor.prototype.onAggregates = function (e) {\r\n        this.pvt.aggregates = e;\r\n    };\r\n    /**\r\n     * Prepare the request body based on the newly added, removed and updated records.\r\n     * The result is used by the batch request.\r\n     * @param  {DataManager} dm\r\n     * @param  {CrudOptions} changes\r\n     * @param  {Object} e\r\n     */\r\n    UrlAdaptor.prototype.batchRequest = function (dm, changes, e, query, original) {\r\n        var url;\r\n        var key;\r\n        return {\r\n            type: 'POST',\r\n            url: dm.dataSource.batchUrl || dm.dataSource.crudUrl || dm.dataSource.removeUrl || dm.dataSource.url,\r\n            contentType: 'application/json; charset=utf-8',\r\n            dataType: 'json',\r\n            data: JSON.stringify(extend({}, {\r\n                changed: changes.changedRecords,\r\n                added: changes.addedRecords,\r\n                deleted: changes.deletedRecords,\r\n                action: 'batch',\r\n                table: e[url],\r\n                key: e[key]\r\n            }, DataUtil.getAddParams(this, dm, query)))\r\n        };\r\n    };\r\n    /**\r\n     * Method will trigger before send the request to server side.\r\n     * Used to set the custom header or modify the request options.\r\n     * @param  {DataManager} dm\r\n     * @param  {XMLHttpRequest} request\r\n     * @returns void\r\n     */\r\n    UrlAdaptor.prototype.beforeSend = function (dm, request) {\r\n        // need to extend this method\r\n    };\r\n    /**\r\n     * Prepare and returns request body which is used to insert a new record in the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {Object} data\r\n     * @param  {string} tableName\r\n     */\r\n    UrlAdaptor.prototype.insert = function (dm, data, tableName, query) {\r\n        return {\r\n            url: dm.dataSource.insertUrl || dm.dataSource.crudUrl || dm.dataSource.url,\r\n            data: JSON.stringify(extend({}, {\r\n                value: data,\r\n                table: tableName,\r\n                action: 'insert'\r\n            }, DataUtil.getAddParams(this, dm, query)))\r\n        };\r\n    };\r\n    /**\r\n     * Prepare and return request body which is used to remove record from the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {number|string} value\r\n     * @param  {string} tableName\r\n     */\r\n    UrlAdaptor.prototype.remove = function (dm, keyField, value, tableName, query) {\r\n        return {\r\n            type: 'POST',\r\n            url: dm.dataSource.removeUrl || dm.dataSource.crudUrl || dm.dataSource.url,\r\n            data: JSON.stringify(extend({}, {\r\n                key: value,\r\n                keyColumn: keyField,\r\n                table: tableName,\r\n                action: 'remove'\r\n            }, DataUtil.getAddParams(this, dm, query)))\r\n        };\r\n    };\r\n    /**\r\n     * Prepare and return request body which is used to update record.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {Object} value\r\n     * @param  {string} tableName\r\n     */\r\n    UrlAdaptor.prototype.update = function (dm, keyField, value, tableName, query) {\r\n        return {\r\n            type: 'POST',\r\n            url: dm.dataSource.updateUrl || dm.dataSource.crudUrl || dm.dataSource.url,\r\n            data: JSON.stringify(extend({}, {\r\n                value: value,\r\n                action: 'update',\r\n                keyColumn: keyField,\r\n                key: DataUtil.getObject(keyField, value),\r\n                table: tableName\r\n            }, DataUtil.getAddParams(this, dm, query)))\r\n        };\r\n    };\r\n    /**\r\n     * To generate the predicate based on the filtered query.\r\n     * @param  {Object[]|string[]|number[]} data\r\n     * @param  {Query} query\r\n     * @hidden\r\n     */\r\n    UrlAdaptor.prototype.getFiltersFrom = function (data, query) {\r\n        var key = query.fKey;\r\n        var value;\r\n        var prop = key;\r\n        var pKey = query.key;\r\n        var predicats = [];\r\n        if (typeof data[0] !== 'object') {\r\n            prop = null;\r\n        }\r\n        for (var i = 0; i < data.length; i++) {\r\n            if (typeof data[0] === 'object') {\r\n                value = DataUtil.getObject(pKey || prop, data[i]);\r\n            }\r\n            else {\r\n                value = data[i];\r\n            }\r\n            predicats.push(new Predicate(key, 'equal', value));\r\n        }\r\n        return Predicate.or(predicats);\r\n    };\r\n    UrlAdaptor.prototype.getAggregateResult = function (pvt, data, args, groupDs, query) {\r\n        var pData = data;\r\n        if (data && data.result) {\r\n            pData = data.result;\r\n        }\r\n        if (pvt && pvt.aggregates && pvt.aggregates.length) {\r\n            var agg = pvt.aggregates;\r\n            var fn = void 0;\r\n            var aggregateData = pData;\r\n            var res = {};\r\n            if (data.aggregate) {\r\n                aggregateData = data.aggregate;\r\n            }\r\n            for (var i = 0; i < agg.length; i++) {\r\n                fn = DataUtil.aggregates[agg[i].type];\r\n                if (fn) {\r\n                    res[agg[i].field + ' - ' + agg[i].type] = fn(aggregateData, agg[i].field);\r\n                }\r\n            }\r\n            args.aggregates = res;\r\n        }\r\n        var key = 'key';\r\n        var isServerGrouping = Array.isArray(data.result) && data.result.length && !isNullOrUndefined(data.result[0][key]);\r\n        if (pvt && pvt.groups && pvt.groups.length && !isServerGrouping) {\r\n            var groups = pvt.groups;\r\n            for (var i = 0; i < groups.length; i++) {\r\n                var level = null;\r\n                if (!isNullOrUndefined(groupDs)) {\r\n                    groupDs = DataUtil.group(groupDs, groups[i]);\r\n                }\r\n                var groupQuery = Query.filterQueries(query.queries, 'onGroup')[i].e;\r\n                pData = DataUtil.group(pData, groups[i], pvt.aggregates, level, groupDs, groupQuery.comparer);\r\n            }\r\n            args.result = pData;\r\n        }\r\n        return args;\r\n    };\r\n    UrlAdaptor.prototype.getQueryRequest = function (query) {\r\n        var req = { sorts: [], groups: [], filters: [], searches: [], aggregates: [] };\r\n        req.sorts = Query.filterQueries(query.queries, 'onSortBy');\r\n        req.groups = Query.filterQueries(query.queries, 'onGroup');\r\n        req.filters = Query.filterQueries(query.queries, 'onWhere');\r\n        req.searches = Query.filterQueries(query.queries, 'onSearch');\r\n        req.aggregates = Query.filterQueries(query.queries, 'onAggregates');\r\n        return req;\r\n    };\r\n    UrlAdaptor.prototype.addParams = function (options) {\r\n        var req = options.reqParams;\r\n        if (options.params.length) {\r\n            req.params = {};\r\n        }\r\n        for (var _i = 0, _a = options.params; _i < _a.length; _i++) {\r\n            var tmp = _a[_i];\r\n            if (req[tmp.key]) {\r\n                throw new Error('Query() - addParams: Custom Param is conflicting other request arguments');\r\n            }\r\n            req[tmp.key] = tmp.value;\r\n            if (tmp.fn) {\r\n                req[tmp.key] = tmp.fn.call(options.query, tmp.key, options.query, options.dm);\r\n            }\r\n            req.params[tmp.key] = req[tmp.key];\r\n        }\r\n    };\r\n    return UrlAdaptor;\r\n}(Adaptor));\r\nexport { UrlAdaptor };\r\n/**\r\n * OData Adaptor that is extended from URL Adaptor, is used for consuming data through OData Service.\r\n * @hidden\r\n */\r\nvar ODataAdaptor = /** @class */ (function (_super) {\r\n    __extends(ODataAdaptor, _super);\r\n    function ODataAdaptor(props) {\r\n        var _this = _super.call(this) || this;\r\n        // options replaced the default adaptor options\r\n        _this.options = extend({}, _this.options, {\r\n            requestType: 'get',\r\n            accept: 'application/json;odata=light;q=1,application/json;odata=verbose;q=0.5',\r\n            multipartAccept: 'multipart/mixed',\r\n            sortBy: '$orderby',\r\n            select: '$select',\r\n            skip: '$skip',\r\n            take: '$top',\r\n            count: '$inlinecount',\r\n            where: '$filter',\r\n            expand: '$expand',\r\n            batch: '$batch',\r\n            changeSet: '--changeset_',\r\n            batchPre: 'batch_',\r\n            contentId: 'Content-Id: ',\r\n            batchContent: 'Content-Type: multipart/mixed; boundary=',\r\n            changeSetContent: 'Content-Type: application/http\\nContent-Transfer-Encoding: binary ',\r\n            batchChangeSetContentType: 'Content-Type: application/json; charset=utf-8 ',\r\n            updateType: 'PUT'\r\n        });\r\n        extend(_this.options, props || {});\r\n        return _this;\r\n    }\r\n    ODataAdaptor.prototype.getModuleName = function () {\r\n        return 'ODataAdaptor';\r\n    };\r\n    /**\r\n     * Generate request string based on the filter criteria from query.\r\n     * @param  {Predicate} pred\r\n     * @param  {boolean} requiresCast?\r\n     */\r\n    ODataAdaptor.prototype.onPredicate = function (predicate, query, requiresCast) {\r\n        var returnValue = '';\r\n        var operator;\r\n        var guid;\r\n        var val = predicate.value;\r\n        var type = typeof val;\r\n        var field = predicate.field ? ODataAdaptor.getField(predicate.field) : null;\r\n        if (val instanceof Date) {\r\n            val = 'datetime\\'' + DataUtil.parse.replacer(val) + '\\'';\r\n        }\r\n        if (type === 'string') {\r\n            val = val.replace(\"'\", \"''\");\r\n            val = encodeURIComponent(val);\r\n            val = '\\'' + val + '\\'';\r\n            if (requiresCast) {\r\n                field = 'cast(' + field + ', \\'Edm.String\\')';\r\n            }\r\n            if (DataUtil.parse.isGuid(val)) {\r\n                guid = 'guid';\r\n            }\r\n            if (predicate.ignoreCase) {\r\n                if (!guid) {\r\n                    field = 'tolower(' + field + ')';\r\n                }\r\n                val = val.toLowerCase();\r\n            }\r\n        }\r\n        operator = DataUtil.odBiOperator[predicate.operator];\r\n        if (operator) {\r\n            returnValue += field;\r\n            returnValue += operator;\r\n            if (guid) {\r\n                returnValue += guid;\r\n            }\r\n            return returnValue + val;\r\n        }\r\n        if (!isNullOrUndefined(this.getModuleName) && this.getModuleName() === 'ODataV4Adaptor') {\r\n            operator = DataUtil.odv4UniOperator[predicate.operator];\r\n        }\r\n        else {\r\n            operator = DataUtil.odUniOperator[predicate.operator];\r\n        }\r\n        if (operator === 'substringof') {\r\n            var temp = val;\r\n            val = field;\r\n            field = temp;\r\n        }\r\n        returnValue += operator + '(';\r\n        returnValue += field + ',';\r\n        if (guid) {\r\n            returnValue += guid;\r\n        }\r\n        returnValue += val + ')';\r\n        return returnValue;\r\n    };\r\n    ODataAdaptor.prototype.addParams = function (options) {\r\n        _super.prototype.addParams.call(this, options);\r\n        delete options.reqParams.params;\r\n    };\r\n    /**\r\n     * Generate request string based on the multiple filter criteria from query.\r\n     * @param  {Predicate} pred\r\n     * @param  {boolean} requiresCast?\r\n     */\r\n    ODataAdaptor.prototype.onComplexPredicate = function (predicate, query, requiresCast) {\r\n        var res = [];\r\n        for (var i = 0; i < predicate.predicates.length; i++) {\r\n            res.push('(' + this.onEachWhere(predicate.predicates[i], query, requiresCast) + ')');\r\n        }\r\n        return res.join(' ' + predicate.condition + ' ');\r\n    };\r\n    /**\r\n     * Generate query string based on the multiple filter criteria from query.\r\n     * @param  {Predicate} filter\r\n     * @param  {boolean} requiresCast?\r\n     */\r\n    ODataAdaptor.prototype.onEachWhere = function (filter, query, requiresCast) {\r\n        return filter.isComplex ? this.onComplexPredicate(filter, query, requiresCast) : this.onPredicate(filter, query, requiresCast);\r\n    };\r\n    /**\r\n     * Generate query string based on the multiple filter criteria from query.\r\n     * @param  {string[]} filters\r\n     */\r\n    ODataAdaptor.prototype.onWhere = function (filters) {\r\n        if (this.pvt.search) {\r\n            filters.push(this.onEachWhere(this.pvt.search, null, true));\r\n        }\r\n        return filters.join(' and ');\r\n    };\r\n    /**\r\n     * Generate query string based on the multiple search criteria from query.\r\n     * @param  {{fields:string[]} e\r\n     * @param  {string} operator\r\n     * @param  {string} key\r\n     * @param  {boolean}} ignoreCase\r\n     */\r\n    ODataAdaptor.prototype.onEachSearch = function (e) {\r\n        if (e.fields && e.fields.length === 0) {\r\n            DataUtil.throwError('Query() - Search : oData search requires list of field names to search');\r\n        }\r\n        var filter = this.pvt.search || [];\r\n        for (var i = 0; i < e.fields.length; i++) {\r\n            filter.push(new Predicate(e.fields[i], e.operator, e.key, e.ignoreCase));\r\n        }\r\n        this.pvt.search = filter;\r\n    };\r\n    /**\r\n     * Generate query string based on the search criteria from query.\r\n     * @param  {Object} e\r\n     */\r\n    ODataAdaptor.prototype.onSearch = function (e) {\r\n        this.pvt.search = Predicate.or(this.pvt.search);\r\n        return '';\r\n    };\r\n    /**\r\n     * Generate query string based on multiple sort criteria from query.\r\n     * @param  {QueryOptions} e\r\n     */\r\n    ODataAdaptor.prototype.onEachSort = function (e) {\r\n        var res = [];\r\n        if (e.name instanceof Array) {\r\n            for (var i = 0; i < e.name.length; i++) {\r\n                res.push(ODataAdaptor.getField(e.name[i]) + (e.direction === 'descending' ? ' desc' : ''));\r\n            }\r\n        }\r\n        else {\r\n            res.push(ODataAdaptor.getField(e.name) + (e.direction === 'descending' ? ' desc' : ''));\r\n        }\r\n        return res.join(',');\r\n    };\r\n    /**\r\n     * Returns sort query string.\r\n     * @param  {string[]} e\r\n     */\r\n    ODataAdaptor.prototype.onSortBy = function (e) {\r\n        return e.reverse().join(',');\r\n    };\r\n    /**\r\n     * Adds the group query to the adaptor option.\r\n     * @param  {Object[]} e\r\n     * @returns string\r\n     */\r\n    ODataAdaptor.prototype.onGroup = function (e) {\r\n        this.pvt.groups = e;\r\n        return [];\r\n    };\r\n    /**\r\n     * Returns the select query string.\r\n     * @param  {string[]} e\r\n     */\r\n    ODataAdaptor.prototype.onSelect = function (e) {\r\n        for (var i = 0; i < e.length; i++) {\r\n            e[i] = ODataAdaptor.getField(e[i]);\r\n        }\r\n        return e.join(',');\r\n    };\r\n    /**\r\n     * Add the aggregate query to the adaptor option.\r\n     * @param  {Object[]} e\r\n     * @returns string\r\n     */\r\n    ODataAdaptor.prototype.onAggregates = function (e) {\r\n        this.pvt.aggregates = e;\r\n        return '';\r\n    };\r\n    /**\r\n     * Returns the query string which requests total count from the data source.\r\n     * @param  {boolean} e\r\n     * @returns string\r\n     */\r\n    ODataAdaptor.prototype.onCount = function (e) {\r\n        return e === true ? 'allpages' : '';\r\n    };\r\n    /**\r\n     * Method will trigger before send the request to server side.\r\n     * Used to set the custom header or modify the request options.\r\n     * @param  {DataManager} dm\r\n     * @param  {XMLHttpRequest} request\r\n     * @param  {Ajax} settings?\r\n     */\r\n    ODataAdaptor.prototype.beforeSend = function (dm, request, settings) {\r\n        if (DataUtil.endsWith(settings.url, this.options.batch) && settings.type.toLowerCase() === 'post') {\r\n            request.setRequestHeader('Accept', this.options.multipartAccept);\r\n            request.setRequestHeader('DataServiceVersion', '2.0');\r\n            request.overrideMimeType('text/plain; charset=x-user-defined');\r\n        }\r\n        else {\r\n            request.setRequestHeader('Accept', this.options.accept);\r\n        }\r\n        request.setRequestHeader('DataServiceVersion', '2.0');\r\n        request.setRequestHeader('MaxDataServiceVersion', '2.0');\r\n    };\r\n    /**\r\n     * Returns the data from the query processing.\r\n     * @param  {DataResult} data\r\n     * @param  {DataOptions} ds?\r\n     * @param  {Query} query?\r\n     * @param  {XMLHttpRequest} xhr?\r\n     * @param  {Ajax} request?\r\n     * @param  {CrudOptions} changes?\r\n     * @returns aggregateResult\r\n     */\r\n    ODataAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\r\n        var metaCheck = 'odata.metadata';\r\n        if ((request && request.type === 'GET') && !this.rootUrl && data[metaCheck]) {\r\n            var dataUrls = data[metaCheck].split('/$metadata#');\r\n            this.rootUrl = dataUrls[0];\r\n            this.resourceTableName = dataUrls[1];\r\n        }\r\n        var pvtData = 'pvtData';\r\n        if (!isNullOrUndefined(data.d)) {\r\n            var dataCopy = ((query && query.isCountRequired) ? data.d.results : data.d);\r\n            var metaData = '__metadata';\r\n            if (!isNullOrUndefined(dataCopy)) {\r\n                for (var i = 0; i < dataCopy.length; i++) {\r\n                    if (!isNullOrUndefined(dataCopy[i][metaData])) {\r\n                        delete dataCopy[i][metaData];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        var pvt = request && request[pvtData];\r\n        var emptyAndBatch = this.processBatchResponse(data, query, xhr, request, changes);\r\n        if (emptyAndBatch) {\r\n            return emptyAndBatch;\r\n        }\r\n        var versionCheck = xhr && request.getResponseHeader('DataServiceVersion');\r\n        var count = null;\r\n        var version = (versionCheck && parseInt(versionCheck, 10)) || 2;\r\n        if (query && query.isCountRequired) {\r\n            var oDataCount = '__count';\r\n            if (data[oDataCount] || data['odata.count']) {\r\n                count = data[oDataCount] || data['odata.count'];\r\n            }\r\n            if (data.d) {\r\n                data = data.d;\r\n            }\r\n            if (data[oDataCount] || data['odata.count']) {\r\n                count = data[oDataCount] || data['odata.count'];\r\n            }\r\n        }\r\n        if (version === 3 && data.value) {\r\n            data = data.value;\r\n        }\r\n        if (data.d) {\r\n            data = data.d;\r\n        }\r\n        if (version < 3 && data.results) {\r\n            data = data.results;\r\n        }\r\n        var args = {};\r\n        args.count = count;\r\n        args.result = data;\r\n        this.getAggregateResult(pvt, data, args, null, query);\r\n        return DataUtil.isNull(count) ? args.result : { result: args.result, count: args.count, aggregates: args.aggregates };\r\n    };\r\n    /**\r\n     * Converts the request object to query string.\r\n     * @param  {Object} req\r\n     * @param  {Query} query\r\n     * @param  {DataManager} dm\r\n     * @returns tableName\r\n     */\r\n    ODataAdaptor.prototype.convertToQueryString = function (request, query, dm) {\r\n        var res = [];\r\n        var table = 'table';\r\n        var tableName = request[table] || '';\r\n        var format = '$format';\r\n        delete request[table];\r\n        if (dm.dataSource.requiresFormat) {\r\n            request[format] = 'json';\r\n        }\r\n        var keys = Object.keys(request);\r\n        for (var _i = 0, keys_4 = keys; _i < keys_4.length; _i++) {\r\n            var prop = keys_4[_i];\r\n            res.push(prop + '=' + request[prop]);\r\n        }\r\n        res = res.join('&');\r\n        if (dm.dataSource.url && dm.dataSource.url.indexOf('?') !== -1 && !tableName) {\r\n            return res;\r\n        }\r\n        return res.length ? tableName + '?' + res : tableName || '';\r\n    };\r\n    ODataAdaptor.prototype.localTimeReplacer = function (key, convertObj) {\r\n        for (var _i = 0, _a = !isNullOrUndefined(convertObj) ? Object.keys(convertObj) : []; _i < _a.length; _i++) {\r\n            var prop = _a[_i];\r\n            if ((convertObj[prop] instanceof Date)) {\r\n                convertObj[prop] = DataUtil.dateParse.toLocalTime(convertObj[prop]);\r\n            }\r\n        }\r\n        return convertObj;\r\n    };\r\n    /**\r\n     * Prepare and returns request body which is used to insert a new record in the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {Object} data\r\n     * @param  {string} tableName?\r\n     */\r\n    ODataAdaptor.prototype.insert = function (dm, data, tableName) {\r\n        return {\r\n            url: (dm.dataSource.insertUrl || dm.dataSource.url).replace(/\\/*$/, tableName ? '/' + tableName : ''),\r\n            data: JSON.stringify(data, this.options.localTime ? this.localTimeReplacer : null)\r\n        };\r\n    };\r\n    /**\r\n     * Prepare and return request body which is used to remove record from the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {number} value\r\n     * @param  {string} tableName?\r\n     */\r\n    ODataAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\r\n        var url;\r\n        if (typeof value === 'string' && !DataUtil.parse.isGuid(value)) {\r\n            url = \"('\" + value + \"')\";\r\n        }\r\n        else {\r\n            url = \"(\" + value + \")\";\r\n        }\r\n        return {\r\n            type: 'DELETE',\r\n            url: (dm.dataSource.removeUrl || dm.dataSource.url).replace(/\\/*$/, tableName ? '/' + tableName : '') + url\r\n        };\r\n    };\r\n    /**\r\n     * Updates existing record and saves the changes to the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {Object} value\r\n     * @param  {string} tableName?\r\n     * @returns this\r\n     */\r\n    ODataAdaptor.prototype.update = function (dm, keyField, value, tableName, query, original) {\r\n        if (this.options.updateType === 'PATCH' && !isNullOrUndefined(original)) {\r\n            value = this.compareAndRemove(value, original, keyField);\r\n        }\r\n        var url;\r\n        if (typeof value[keyField] === 'string' && !DataUtil.parse.isGuid(value[keyField])) {\r\n            url = \"('\" + value[keyField] + \"')\";\r\n        }\r\n        else {\r\n            url = \"(\" + value[keyField] + \")\";\r\n        }\r\n        return {\r\n            type: this.options.updateType,\r\n            url: (dm.dataSource.updateUrl || dm.dataSource.url).replace(/\\/*$/, tableName ? '/' + tableName : '') + url,\r\n            data: JSON.stringify(value, this.options.localTime ? this.localTimeReplacer : null),\r\n            accept: this.options.accept\r\n        };\r\n    };\r\n    /**\r\n     * Prepare the request body based on the newly added, removed and updated records.\r\n     * The result is used by the batch request.\r\n     * @param  {DataManager} dm\r\n     * @param  {CrudOptions} changes\r\n     * @param  {RemoteArgs} e\r\n     * @returns {Object}\r\n     */\r\n    ODataAdaptor.prototype.batchRequest = function (dm, changes, e, query, original) {\r\n        var initialGuid = e.guid = DataUtil.getGuid(this.options.batchPre);\r\n        var url = this.rootUrl ? this.rootUrl + '/' + this.options.batch :\r\n            dm.dataSource.url.replace(/\\/*$/, '/' + this.options.batch);\r\n        e.url = this.resourceTableName ? this.resourceTableName : e.url;\r\n        var args = {\r\n            url: e.url,\r\n            key: e.key,\r\n            cid: 1,\r\n            cSet: DataUtil.getGuid(this.options.changeSet)\r\n        };\r\n        var req = '--' + initialGuid + '\\n';\r\n        req += 'Content-Type: multipart/mixed; boundary=' + args.cSet.replace('--', '') + '\\n';\r\n        this.pvt.changeSet = 0;\r\n        req += this.generateInsertRequest(changes.addedRecords, args, dm);\r\n        req += this.generateUpdateRequest(changes.changedRecords, args, dm, original ? original.changedRecords : []);\r\n        req += this.generateDeleteRequest(changes.deletedRecords, args, dm);\r\n        req += args.cSet + '--\\n';\r\n        req += '--' + initialGuid + '--';\r\n        return {\r\n            type: 'POST',\r\n            url: url,\r\n            dataType: 'json',\r\n            contentType: 'multipart/mixed; charset=UTF-8;boundary=' + initialGuid,\r\n            data: req\r\n        };\r\n    };\r\n    /**\r\n     * Generate the string content from the removed records.\r\n     * The result will be send during batch update.\r\n     * @param  {Object[]} arr\r\n     * @param  {RemoteArgs} e\r\n     * @returns this\r\n     */\r\n    ODataAdaptor.prototype.generateDeleteRequest = function (arr, e, dm) {\r\n        if (!arr) {\r\n            return '';\r\n        }\r\n        var req = '';\r\n        var stat = {\r\n            'method': 'DELETE ',\r\n            'url': function (data, i, key) {\r\n                var url = DataUtil.getObject(key, data[i]);\r\n                if (typeof url === 'number' || DataUtil.parse.isGuid(url)) {\r\n                    return '(' + url + ')';\r\n                }\r\n                else if (url instanceof Date) {\r\n                    var dateTime = data[i][key];\r\n                    return '(' + dateTime.toJSON() + ')';\r\n                }\r\n                else {\r\n                    return \"('\" + url + \"')\";\r\n                }\r\n            },\r\n            'data': function (data, i) { return ''; }\r\n        };\r\n        req = this.generateBodyContent(arr, e, stat, dm);\r\n        return req + '\\n';\r\n    };\r\n    /**\r\n     * Generate the string content from the inserted records.\r\n     * The result will be send during batch update.\r\n     * @param  {Object[]} arr\r\n     * @param  {RemoteArgs} e\r\n     */\r\n    ODataAdaptor.prototype.generateInsertRequest = function (arr, e, dm) {\r\n        if (!arr) {\r\n            return '';\r\n        }\r\n        var req = '';\r\n        var stat = {\r\n            'method': 'POST ',\r\n            'url': function (data, i, key) { return ''; },\r\n            'data': function (data, i) { return JSON.stringify(data[i]) + '\\n\\n'; }\r\n        };\r\n        req = this.generateBodyContent(arr, e, stat, dm);\r\n        return req;\r\n    };\r\n    /**\r\n     * Generate the string content from the updated records.\r\n     * The result will be send during batch update.\r\n     * @param  {Object[]} arr\r\n     * @param  {RemoteArgs} e\r\n     */\r\n    ODataAdaptor.prototype.generateUpdateRequest = function (arr, e, dm, org) {\r\n        var _this = this;\r\n        if (!arr) {\r\n            return '';\r\n        }\r\n        var req = '';\r\n        arr.forEach(function (change) { return change = _this.compareAndRemove(change, org.filter(function (o) { return DataUtil.getObject(e.key, o) === DataUtil.getObject(e.key, change); })[0], e.key); });\r\n        var stat = {\r\n            'method': this.options.updateType + ' ',\r\n            'url': function (data, i, key) {\r\n                if (typeof data[i][key] === 'number' || DataUtil.parse.isGuid(data[i][key])) {\r\n                    return '(' + data[i][key] + ')';\r\n                }\r\n                else if (data[i][key] instanceof Date) {\r\n                    var date = data[i][key];\r\n                    return '(' + date.toJSON() + ')';\r\n                }\r\n                else {\r\n                    return \"('\" + data[i][key] + \"')\";\r\n                }\r\n            },\r\n            'data': function (data, i) { return JSON.stringify(data[i]) + '\\n\\n'; }\r\n        };\r\n        req = this.generateBodyContent(arr, e, stat, dm);\r\n        return req;\r\n    };\r\n    ODataAdaptor.getField = function (prop) {\r\n        return prop.replace(/\\./g, '/');\r\n    };\r\n    ODataAdaptor.prototype.generateBodyContent = function (arr, e, stat, dm) {\r\n        var req = '';\r\n        for (var i = 0; i < arr.length; i++) {\r\n            req += '\\n' + e.cSet + '\\n';\r\n            req += this.options.changeSetContent + '\\n\\n';\r\n            req += stat.method;\r\n            if (stat.method === 'POST ') {\r\n                req += (dm.dataSource.insertUrl || dm.dataSource.crudUrl || e.url) + stat.url(arr, i, e.key) + ' HTTP/1.1\\n';\r\n            }\r\n            else if (stat.method === 'PUT ' || stat.method === 'PATCH ') {\r\n                req += (dm.dataSource.updateUrl || dm.dataSource.crudUrl || e.url) + stat.url(arr, i, e.key) + ' HTTP/1.1\\n';\r\n            }\r\n            else if (stat.method === 'DELETE ') {\r\n                req += (dm.dataSource.removeUrl || dm.dataSource.crudUrl || e.url) + stat.url(arr, i, e.key) + ' HTTP/1.1\\n';\r\n            }\r\n            req += 'Accept: ' + this.options.accept + '\\n';\r\n            req += 'Content-Id: ' + this.pvt.changeSet++ + '\\n';\r\n            req += this.options.batchChangeSetContentType + '\\n';\r\n            if (!isNullOrUndefined(arr[i]['@odata.etag'])) {\r\n                req += 'If-Match: ' + arr[i]['@odata.etag'] + '\\n\\n';\r\n                delete arr[i]['@odata.etag'];\r\n            }\r\n            else {\r\n                req += '\\n';\r\n            }\r\n            req += stat.data(arr, i);\r\n        }\r\n        return req;\r\n    };\r\n    ODataAdaptor.prototype.processBatchResponse = function (data, query, xhr, request, changes) {\r\n        if (xhr && xhr.getResponseHeader('Content-Type') && xhr.getResponseHeader('Content-Type').indexOf('xml') !== -1) {\r\n            return (query.isCountRequired ? { result: [], count: 0 } : []);\r\n        }\r\n        if (request && this.options.batch && DataUtil.endsWith(request.url, this.options.batch) && request.type.toLowerCase() === 'post') {\r\n            var guid = xhr.getResponseHeader('Content-Type');\r\n            var cIdx = void 0;\r\n            var jsonObj = void 0;\r\n            var d = data + '';\r\n            guid = guid.substring(guid.indexOf('=batchresponse') + 1);\r\n            d = d.split(guid);\r\n            if (d.length < 2) {\r\n                return {};\r\n            }\r\n            d = d[1];\r\n            var exVal = /(?:\\bContent-Type.+boundary=)(changesetresponse.+)/i.exec(d);\r\n            if (exVal) {\r\n                d.replace(exVal[0], '');\r\n            }\r\n            var changeGuid = exVal ? exVal[1] : '';\r\n            d = d.split(changeGuid);\r\n            for (var i = d.length; i > -1; i--) {\r\n                if (!/\\bContent-ID:/i.test(d[i]) || !/\\bHTTP.+201/.test(d[i])) {\r\n                    continue;\r\n                }\r\n                cIdx = parseInt(/\\bContent-ID: (\\d+)/i.exec(d[i])[1], 10);\r\n                if (changes.addedRecords[cIdx]) {\r\n                    jsonObj = DataUtil.parse.parseJson(/^\\{.+\\}/m.exec(d[i])[0]);\r\n                    extend({}, changes.addedRecords[cIdx], this.processResponse(jsonObj));\r\n                }\r\n            }\r\n            return changes;\r\n        }\r\n        return null;\r\n    };\r\n    ODataAdaptor.prototype.compareAndRemove = function (data, original, key) {\r\n        var _this = this;\r\n        if (isNullOrUndefined(original)) {\r\n            return data;\r\n        }\r\n        Object.keys(data).forEach(function (prop) {\r\n            if (prop !== key && prop !== '@odata.etag') {\r\n                if (DataUtil.isPlainObject(data[prop])) {\r\n                    _this.compareAndRemove(data[prop], original[prop]);\r\n                    var final = Object.keys(data[prop]).filter(function (data) { return data !== '@odata.etag'; });\r\n                    if (final.length === 0) {\r\n                        delete data[prop];\r\n                    }\r\n                }\r\n                else if (data[prop] === original[prop]) {\r\n                    delete data[prop];\r\n                }\r\n                else if (data[prop] && original[prop] && data[prop].valueOf() === original[prop].valueOf()) {\r\n                    delete data[prop];\r\n                }\r\n            }\r\n        });\r\n        return data;\r\n    };\r\n    return ODataAdaptor;\r\n}(UrlAdaptor));\r\nexport { ODataAdaptor };\r\n/**\r\n * The OData v4 is an improved version of OData protocols.\r\n * The DataManager uses the ODataV4Adaptor to consume OData v4 services.\r\n * @hidden\r\n */\r\nvar ODataV4Adaptor = /** @class */ (function (_super) {\r\n    __extends(ODataV4Adaptor, _super);\r\n    function ODataV4Adaptor(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        // options replaced the default adaptor options\r\n        _this.options = extend({}, _this.options, {\r\n            requestType: 'get',\r\n            accept: 'application/json, text/javascript, */*; q=0.01',\r\n            multipartAccept: 'multipart/mixed',\r\n            sortBy: '$orderby',\r\n            select: '$select',\r\n            skip: '$skip',\r\n            take: '$top',\r\n            count: '$count',\r\n            search: '$search',\r\n            where: '$filter',\r\n            expand: '$expand',\r\n            batch: '$batch',\r\n            changeSet: '--changeset_',\r\n            batchPre: 'batch_',\r\n            contentId: 'Content-Id: ',\r\n            batchContent: 'Content-Type: multipart/mixed; boundary=',\r\n            changeSetContent: 'Content-Type: application/http\\nContent-Transfer-Encoding: binary ',\r\n            batchChangeSetContentType: 'Content-Type: application/json; charset=utf-8 ',\r\n            updateType: 'PATCH',\r\n            localTime: false,\r\n            apply: '$apply'\r\n        });\r\n        extend(_this.options, props || {});\r\n        return _this;\r\n    }\r\n    /**\r\n     * @hidden\r\n     */\r\n    ODataV4Adaptor.prototype.getModuleName = function () {\r\n        return 'ODataV4Adaptor';\r\n    };\r\n    /**\r\n     * Returns the query string which requests total count from the data source.\r\n     * @param  {boolean} e\r\n     * @returns string\r\n     */\r\n    ODataV4Adaptor.prototype.onCount = function (e) {\r\n        return e === true ? 'true' : '';\r\n    };\r\n    /**\r\n     * Generate request string based on the filter criteria from query.\r\n     * @param  {Predicate} pred\r\n     * @param  {boolean} requiresCast?\r\n     */\r\n    ODataV4Adaptor.prototype.onPredicate = function (predicate, query, requiresCast) {\r\n        var returnValue = '';\r\n        var val = predicate.value;\r\n        var isDate = val instanceof Date;\r\n        if (query instanceof Query) {\r\n            var queries = this.getQueryRequest(query);\r\n            for (var i = 0; i < queries.filters.length; i++) {\r\n                if (queries.filters[i].e.key === predicate.value) {\r\n                    requiresCast = true;\r\n                }\r\n            }\r\n        }\r\n        returnValue = _super.prototype.onPredicate.call(this, predicate, query, requiresCast);\r\n        if (isDate) {\r\n            returnValue = returnValue.replace(/datetime'(.*)'$/, '$1');\r\n        }\r\n        if (DataUtil.parse.isGuid(val)) {\r\n            returnValue = returnValue.replace('guid', '').replace(/'/g, '');\r\n        }\r\n        return returnValue;\r\n    };\r\n    /**\r\n     *  Generate query string based on the multiple search criteria from query.\r\n     * @param  {{fields:string[]} e\r\n     * @param  {string} operator\r\n     * @param  {string} key\r\n     * @param  {boolean}} ignoreCase\r\n     */\r\n    ODataV4Adaptor.prototype.onEachSearch = function (e) {\r\n        var search = this.pvt.searches || [];\r\n        search.push(e.key);\r\n        this.pvt.searches = search;\r\n    };\r\n    /**\r\n     *  Generate query string based on the search criteria from query.\r\n     * @param  {Object} e\r\n     */\r\n    ODataV4Adaptor.prototype.onSearch = function (e) {\r\n        return this.pvt.searches.join(' OR ');\r\n    };\r\n    /**\r\n     * Returns the expand query string.\r\n     * @param  {string} e\r\n     */\r\n    ODataV4Adaptor.prototype.onExpand = function (e) {\r\n        var selected = {};\r\n        var expanded = {};\r\n        var expands = e.expands.slice();\r\n        var exArr = [];\r\n        var selects = e.selects.filter(function (item) { return item.indexOf('.') > -1; });\r\n        selects.forEach(function (select) {\r\n            var splits = select.split('.');\r\n            if (!(splits[0] in selected)) {\r\n                selected[splits[0]] = [];\r\n            }\r\n            if (splits.length == 2) {\r\n                if (selected[splits[0]].length && Object.keys(selected).indexOf(splits[0]) !== -1) {\r\n                    selected[splits[0]][0] = selected[splits[0]][0] + ',' + splits[1];\r\n                }\r\n                else {\r\n                    selected[splits[0]].push('$select=' + splits[1]);\r\n                }\r\n            }\r\n            else {\r\n                var sel = '$select=' + splits[splits.length - 1];\r\n                var exp = '';\r\n                var close_1 = '';\r\n                for (var i = 1; i < splits.length - 1; i++) {\r\n                    exp = exp + '$expand=' + splits[i] + '(';\r\n                    close_1 = close_1 + ')';\r\n                }\r\n                var combineVal = exp + sel + close_1;\r\n                if (selected[splits[0]].length && Object.keys(selected).indexOf(splits[0]) !== -1 &&\r\n                    selected[splits[0]][0].indexOf('$expand') !== -1) {\r\n                    selected[splits[0]][0] = selected[splits[0]][0] + combineVal.replace('$expand=', ',');\r\n                }\r\n                else {\r\n                    selected[splits[0]].push(combineVal);\r\n                }\r\n            }\r\n        });\r\n        //Auto expand from select query\r\n        Object.keys(selected).forEach(function (expand) {\r\n            if ((expands.indexOf(expand) === -1)) {\r\n                expands.push(expand);\r\n            }\r\n        });\r\n        expands.forEach(function (expand) {\r\n            expanded[expand] = expand in selected ? expand + \"(\" + selected[expand].join(';') + \")\" : expand;\r\n        });\r\n        Object.keys(expanded).forEach(function (ex) { return exArr.push(expanded[ex]); });\r\n        return exArr.join(',');\r\n    };\r\n    /**\r\n     * Returns the groupby query string.\r\n     * @param  {string} e\r\n     */\r\n    ODataV4Adaptor.prototype.onDistinct = function (distinctFields) {\r\n        var fields = distinctFields.map(function (field) { return ODataAdaptor.getField(field); }).join(',');\r\n        return \"groupby((\" + fields + \"))\";\r\n    };\r\n    /**\r\n     * Returns the select query string.\r\n     * @param  {string[]} e\r\n     */\r\n    ODataV4Adaptor.prototype.onSelect = function (e) {\r\n        return _super.prototype.onSelect.call(this, e.filter(function (item) { return item.indexOf('.') === -1; }));\r\n    };\r\n    /**\r\n     * Method will trigger before send the request to server side.\r\n     * Used to set the custom header or modify the request options.\r\n     * @param  {DataManager} dm\r\n     * @param  {XMLHttpRequest} request\r\n     * @param  {Ajax} settings\r\n     * @returns void\r\n     */\r\n    ODataV4Adaptor.prototype.beforeSend = function (dm, request, settings) {\r\n        if (settings.type === 'POST' || settings.type === 'PUT' || settings.type === 'PATCH') {\r\n            request.setRequestHeader('Prefer', 'return=representation');\r\n        }\r\n        request.setRequestHeader('Accept', this.options.accept);\r\n    };\r\n    /**\r\n     * Returns the data from the query processing.\r\n     * @param  {DataResult} data\r\n     * @param  {DataOptions} ds?\r\n     * @param  {Query} query?\r\n     * @param  {XMLHttpRequest} xhr?\r\n     * @param  {Ajax} request?\r\n     * @param  {CrudOptions} changes?\r\n     * @returns aggregateResult\r\n     */\r\n    ODataV4Adaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\r\n        var metaName = '@odata.context';\r\n        if ((request && request.type === 'GET') && !this.rootUrl && data[metaName]) {\r\n            var dataUrl = data[metaName].split('/$metadata#');\r\n            this.rootUrl = dataUrl[0];\r\n            this.resourceTableName = dataUrl[1];\r\n        }\r\n        var pvtData = 'pvtData';\r\n        var pvt = request && request[pvtData];\r\n        var emptyAndBatch = _super.prototype.processBatchResponse.call(this, data, query, xhr, request, changes);\r\n        if (emptyAndBatch) {\r\n            return emptyAndBatch;\r\n        }\r\n        var count = null;\r\n        var dataCount = '@odata.count';\r\n        if (query && query.isCountRequired) {\r\n            if (dataCount in data) {\r\n                count = data[dataCount];\r\n            }\r\n        }\r\n        data = !isNullOrUndefined(data.value) ? data.value : data;\r\n        var args = {};\r\n        args.count = count;\r\n        args.result = data;\r\n        this.getAggregateResult(pvt, data, args, null, query);\r\n        return DataUtil.isNull(count) ? args.result : { result: args.result, count: count, aggregates: args.aggregates };\r\n    };\r\n    return ODataV4Adaptor;\r\n}(ODataAdaptor));\r\nexport { ODataV4Adaptor };\r\n/**\r\n * The Web API is a programmatic interface to define the request and response messages system that is mostly exposed in JSON or XML.\r\n * The DataManager uses the WebApiAdaptor to consume Web API.\r\n * Since this adaptor is targeted to interact with Web API created using OData endpoint, it is extended from ODataAdaptor\r\n * @hidden\r\n */\r\nvar WebApiAdaptor = /** @class */ (function (_super) {\r\n    __extends(WebApiAdaptor, _super);\r\n    function WebApiAdaptor() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    WebApiAdaptor.prototype.getModuleName = function () {\r\n        return 'WebApiAdaptor';\r\n    };\r\n    /**\r\n     * Prepare and returns request body which is used to insert a new record in the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {Object} data\r\n     * @param  {string} tableName?\r\n     */\r\n    WebApiAdaptor.prototype.insert = function (dm, data, tableName) {\r\n        return {\r\n            type: 'POST',\r\n            url: dm.dataSource.url,\r\n            data: JSON.stringify(data)\r\n        };\r\n    };\r\n    /**\r\n     * Prepare and return request body which is used to remove record from the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {number} value\r\n     * @param  {string} tableName?\r\n     */\r\n    WebApiAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\r\n        return {\r\n            type: 'DELETE',\r\n            url: dm.dataSource.url + '/' + value,\r\n            data: JSON.stringify(value)\r\n        };\r\n    };\r\n    /**\r\n     * Prepare and return request body which is used to update record.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {Object} value\r\n     * @param  {string} tableName?\r\n     */\r\n    WebApiAdaptor.prototype.update = function (dm, keyField, value, tableName) {\r\n        return {\r\n            type: 'PUT',\r\n            url: dm.dataSource.url,\r\n            data: JSON.stringify(value)\r\n        };\r\n    };\r\n    WebApiAdaptor.prototype.batchRequest = function (dm, changes, e) {\r\n        var _this = this;\r\n        var initialGuid = e.guid = DataUtil.getGuid(this.options.batchPre);\r\n        var url = dm.dataSource.url.replace(/\\/*$/, '/' + this.options.batch);\r\n        e.url = this.resourceTableName ? this.resourceTableName : e.url;\r\n        var req = [];\r\n        var _loop_1 = function (i, x) {\r\n            changes.addedRecords.forEach(function (j, d) {\r\n                var stat = {\r\n                    'method': 'POST ',\r\n                    'url': function (data, i, key) { return ''; },\r\n                    'data': function (data, i) { return JSON.stringify(data[i]) + '\\n\\n'; }\r\n                };\r\n                req.push('--' + initialGuid);\r\n                req.push('Content-Type: application/http; msgtype=request', '');\r\n                req.push('POST ' + '/api/' + (dm.dataSource.insertUrl || dm.dataSource.crudUrl || e.url)\r\n                    + stat.url(changes.addedRecords, i, e.key) + ' HTTP/1.1');\r\n                req.push('Content-Type: ' + 'application/json; charset=utf-8');\r\n                req.push('Host: ' + location.host);\r\n                req.push('', j ? JSON.stringify(j) : '');\r\n            });\r\n        };\r\n        //insertion\r\n        for (var i = 0, x = changes.addedRecords.length; i < x; i++) {\r\n            _loop_1(i, x);\r\n        }\r\n        var _loop_2 = function (i, x) {\r\n            changes.changedRecords.forEach(function (j, d) {\r\n                var stat = {\r\n                    'method': _this.options.updateType + ' ',\r\n                    'url': function (data, i, key) { return ''; },\r\n                    'data': function (data, i) { return JSON.stringify(data[i]) + '\\n\\n'; }\r\n                };\r\n                req.push('--' + initialGuid);\r\n                req.push('Content-Type: application/http; msgtype=request', '');\r\n                req.push('PUT ' + '/api/' + (dm.dataSource.updateUrl || dm.dataSource.crudUrl || e.url)\r\n                    + stat.url(changes.changedRecords, i, e.key) + ' HTTP/1.1');\r\n                req.push('Content-Type: ' + 'application/json; charset=utf-8');\r\n                req.push('Host: ' + location.host);\r\n                req.push('', j ? JSON.stringify(j) : '');\r\n            });\r\n        };\r\n        //updation \r\n        for (var i = 0, x = changes.changedRecords.length; i < x; i++) {\r\n            _loop_2(i, x);\r\n        }\r\n        var _loop_3 = function (i, x) {\r\n            changes.deletedRecords.forEach(function (j, d) {\r\n                var state = {\r\n                    'mtd': 'DELETE ',\r\n                    'url': function (data, i, key) {\r\n                        var url = DataUtil.getObject(key, data[i]);\r\n                        if (typeof url === 'number' || DataUtil.parse.isGuid(url)) {\r\n                            return '/' + url;\r\n                        }\r\n                        else if (url instanceof Date) {\r\n                            var datTime = data[i][key];\r\n                            return '/' + datTime.toJSON();\r\n                        }\r\n                        else {\r\n                            return \"/'\" + url + \"'\";\r\n                        }\r\n                    },\r\n                    'data': function (data, i) { return ''; }\r\n                };\r\n                req.push('--' + initialGuid);\r\n                req.push('Content-Type: application/http; msgtype=request', '');\r\n                req.push('DELETE ' + '/api/' + (dm.dataSource.removeUrl || dm.dataSource.crudUrl || e.url)\r\n                    + state.url(changes.deletedRecords, i, e.key) + ' HTTP/1.1');\r\n                req.push('Content-Type: ' + 'application/json; charset=utf-8');\r\n                req.push('Host: ' + location.host);\r\n                req.push('', j ? JSON.stringify(j) : '');\r\n            });\r\n        };\r\n        //deletion\r\n        for (var i = 0, x = changes.deletedRecords.length; i < x; i++) {\r\n            _loop_3(i, x);\r\n        }\r\n        req.push('--' + initialGuid + '--', '');\r\n        return {\r\n            type: 'POST',\r\n            url: url,\r\n            contentType: 'multipart/mixed; boundary=' + initialGuid,\r\n            data: req.join('\\r\\n')\r\n        };\r\n    };\r\n    /**\r\n     * Method will trigger before send the request to server side.\r\n     * Used to set the custom header or modify the request options.\r\n     * @param  {DataManager} dm\r\n     * @param  {XMLHttpRequest} request\r\n     * @param  {Ajax} settings\r\n     * @returns void\r\n     */\r\n    WebApiAdaptor.prototype.beforeSend = function (dm, request, settings) {\r\n        request.setRequestHeader('Accept', 'application/json, text/javascript, */*; q=0.01');\r\n    };\r\n    /**\r\n     * Returns the data from the query processing.\r\n     * @param  {DataResult} data\r\n     * @param  {DataOptions} ds?\r\n     * @param  {Query} query?\r\n     * @param  {XMLHttpRequest} xhr?\r\n     * @param  {Ajax} request?\r\n     * @param  {CrudOptions} changes?\r\n     * @returns aggregateResult\r\n     */\r\n    WebApiAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\r\n        var pvtData = 'pvtData';\r\n        var pvt = request && request[pvtData];\r\n        var count = null;\r\n        var args = {};\r\n        if (request && request.type.toLowerCase() !== 'post') {\r\n            var versionCheck = xhr && request.getResponseHeader('DataServiceVersion');\r\n            var version = (versionCheck && parseInt(versionCheck, 10)) || 2;\r\n            if (query && query.isCountRequired) {\r\n                if (!DataUtil.isNull(data.Count)) {\r\n                    count = data.Count;\r\n                }\r\n            }\r\n            if (version < 3 && data.Items) {\r\n                data = data.Items;\r\n            }\r\n            args.count = count;\r\n            args.result = data;\r\n            this.getAggregateResult(pvt, data, args, null, query);\r\n        }\r\n        args.result = args.result || data;\r\n        return DataUtil.isNull(count) ? args.result : { result: args.result, count: args.count, aggregates: args.aggregates };\r\n    };\r\n    return WebApiAdaptor;\r\n}(ODataAdaptor));\r\nexport { WebApiAdaptor };\r\n/**\r\n * WebMethodAdaptor can be used by DataManager to interact with web method.\r\n * @hidden\r\n */\r\nvar WebMethodAdaptor = /** @class */ (function (_super) {\r\n    __extends(WebMethodAdaptor, _super);\r\n    function WebMethodAdaptor() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    /**\r\n     * Prepare the request body based on the query.\r\n     * The query information can be accessed at the WebMethod using variable named `value`.\r\n     * @param  {DataManager} dm\r\n     * @param  {Query} query\r\n     * @param  {Object[]} hierarchyFilters?\r\n     * @returns application\r\n     */\r\n    WebMethodAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\r\n        var obj = new UrlAdaptor().processQuery(dm, query, hierarchyFilters);\r\n        var getData = 'data';\r\n        var data = DataUtil.parse.parseJson(obj[getData]);\r\n        var result = {};\r\n        var value = 'value';\r\n        if (data.param) {\r\n            for (var i = 0; i < data.param.length; i++) {\r\n                var param = data.param[i];\r\n                var key = Object.keys(param)[0];\r\n                result[key] = param[key];\r\n            }\r\n        }\r\n        result[value] = data;\r\n        var pvtData = 'pvtData';\r\n        var url = 'url';\r\n        return {\r\n            data: JSON.stringify(result),\r\n            url: obj[url],\r\n            pvtData: obj[pvtData],\r\n            type: 'POST',\r\n            contentType: 'application/json; charset=utf-8'\r\n        };\r\n    };\r\n    return WebMethodAdaptor;\r\n}(UrlAdaptor));\r\nexport { WebMethodAdaptor };\r\n/**\r\n * RemoteSaveAdaptor, extended from JsonAdaptor and it is used for binding local data and performs all DataManager queries in client-side.\r\n * It interacts with server-side only for CRUD operations.\r\n * @hidden\r\n */\r\nvar RemoteSaveAdaptor = /** @class */ (function (_super) {\r\n    __extends(RemoteSaveAdaptor, _super);\r\n    /**\r\n     * @hidden\r\n     */\r\n    function RemoteSaveAdaptor() {\r\n        var _this = _super.call(this) || this;\r\n        setValue('beforeSend', UrlAdaptor.prototype.beforeSend, _this);\r\n        return _this;\r\n    }\r\n    RemoteSaveAdaptor.prototype.insert = function (dm, data, tableName, query, position) {\r\n        this.pvt.position = position;\r\n        this.updateType = 'add';\r\n        return {\r\n            url: dm.dataSource.insertUrl || dm.dataSource.crudUrl || dm.dataSource.url,\r\n            data: JSON.stringify(extend({}, {\r\n                value: data,\r\n                table: tableName,\r\n                action: 'insert'\r\n            }, DataUtil.getAddParams(this, dm, query)))\r\n        };\r\n    };\r\n    RemoteSaveAdaptor.prototype.remove = function (dm, keyField, val, tableName, query) {\r\n        _super.prototype.remove.call(this, dm, keyField, val);\r\n        return {\r\n            type: 'POST',\r\n            url: dm.dataSource.removeUrl || dm.dataSource.crudUrl || dm.dataSource.url,\r\n            data: JSON.stringify(extend({}, {\r\n                key: val,\r\n                keyColumn: keyField,\r\n                table: tableName,\r\n                action: 'remove'\r\n            }, DataUtil.getAddParams(this, dm, query)))\r\n        };\r\n    };\r\n    RemoteSaveAdaptor.prototype.update = function (dm, keyField, val, tableName, query) {\r\n        this.updateType = 'update';\r\n        this.updateKey = keyField;\r\n        return {\r\n            type: 'POST',\r\n            url: dm.dataSource.updateUrl || dm.dataSource.crudUrl || dm.dataSource.url,\r\n            data: JSON.stringify(extend({}, {\r\n                value: val,\r\n                action: 'update',\r\n                keyColumn: keyField,\r\n                key: val[keyField],\r\n                table: tableName\r\n            }, DataUtil.getAddParams(this, dm, query)))\r\n        };\r\n    };\r\n    RemoteSaveAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes, e) {\r\n        var i;\r\n        var newData = request ? JSON.parse(request.data) : data;\r\n        data = newData.action === 'batch' ? DataUtil.parse.parseJson(data) : data;\r\n        if (this.updateType === 'add') {\r\n            _super.prototype.insert.call(this, ds, data, null, null, this.pvt.position);\r\n        }\r\n        if (this.updateType === 'update') {\r\n            _super.prototype.update.call(this, ds, this.updateKey, data);\r\n        }\r\n        this.updateType = undefined;\r\n        if (data.added) {\r\n            for (i = 0; i < data.added.length; i++) {\r\n                _super.prototype.insert.call(this, ds, data.added[i]);\r\n            }\r\n        }\r\n        if (data.changed) {\r\n            for (i = 0; i < data.changed.length; i++) {\r\n                _super.prototype.update.call(this, ds, e.key, data.changed[i]);\r\n            }\r\n        }\r\n        if (data.deleted) {\r\n            for (i = 0; i < data.deleted.length; i++) {\r\n                _super.prototype.remove.call(this, ds, e.key, data.deleted[i]);\r\n            }\r\n        }\r\n        return data;\r\n    };\r\n    /**\r\n     * Prepare the request body based on the newly added, removed and updated records.\r\n     * Also perform the changes in the locally cached data to sync with the remote data.\r\n     * The result is used by the batch request.\r\n     * @param  {DataManager} dm\r\n     * @param  {CrudOptions} changes\r\n     * @param  {RemoteArgs} e\r\n     */\r\n    RemoteSaveAdaptor.prototype.batchRequest = function (dm, changes, e, query, original) {\r\n        return {\r\n            type: 'POST',\r\n            url: dm.dataSource.batchUrl || dm.dataSource.crudUrl || dm.dataSource.url,\r\n            contentType: 'application/json; charset=utf-8',\r\n            dataType: 'json',\r\n            data: JSON.stringify(extend({}, {\r\n                changed: changes.changedRecords,\r\n                added: changes.addedRecords,\r\n                deleted: changes.deletedRecords,\r\n                action: 'batch',\r\n                table: e.url,\r\n                key: e.key\r\n            }, DataUtil.getAddParams(this, dm, query)))\r\n        };\r\n    };\r\n    RemoteSaveAdaptor.prototype.addParams = function (options) {\r\n        var urlParams = new UrlAdaptor();\r\n        urlParams.addParams(options);\r\n    };\r\n    return RemoteSaveAdaptor;\r\n}(JsonAdaptor));\r\nexport { RemoteSaveAdaptor };\r\n/**\r\n * Ajax Adaptor that is extended from URL Adaptor, is used for handle data operations with user defined functions.\r\n * @hidden\r\n */\r\nvar CustomDataAdaptor = /** @class */ (function (_super) {\r\n    __extends(CustomDataAdaptor, _super);\r\n    function CustomDataAdaptor(props) {\r\n        var _this = _super.call(this) || this;\r\n        // options replaced the default adaptor options\r\n        _this.options = extend({}, _this.options, {\r\n            getData: new Function(),\r\n            addRecord: new Function(),\r\n            updateRecord: new Function(),\r\n            deleteRecord: new Function(),\r\n            batchUpdate: new Function()\r\n        });\r\n        extend(_this.options, props || {});\r\n        return _this;\r\n    }\r\n    CustomDataAdaptor.prototype.getModuleName = function () {\r\n        return 'CustomDataAdaptor';\r\n    };\r\n    return CustomDataAdaptor;\r\n}(UrlAdaptor));\r\nexport { CustomDataAdaptor };\r\n/**\r\n * The GraphqlAdaptor that is extended from URL Adaptor, is used for retrieving data from the Graphql server.\r\n * It interacts with the Graphql server with all the DataManager Queries and performs CRUD operations.\r\n * @hidden\r\n */\r\nvar GraphQLAdaptor = /** @class */ (function (_super) {\r\n    __extends(GraphQLAdaptor, _super);\r\n    function GraphQLAdaptor(options) {\r\n        var _this = _super.call(this) || this;\r\n        _this.opt = options;\r\n        _this.schema = _this.opt.response;\r\n        _this.query = _this.opt.query;\r\n        _this.getVariables = _this.opt.getVariables ? _this.opt.getVariables : function () { };\r\n        _this.getQuery = function () { return _this.query; };\r\n        return _this;\r\n    }\r\n    GraphQLAdaptor.prototype.getModuleName = function () {\r\n        return 'GraphQLAdaptor';\r\n    };\r\n    /**\r\n     * Process the JSON data based on the provided queries.\r\n     * @param  {DataManager} dm\r\n     * @param  {Query} query?\r\n     */\r\n    GraphQLAdaptor.prototype.processQuery = function (datamanager, query) {\r\n        var urlQuery = _super.prototype.processQuery.apply(this, arguments);\r\n        var dm = JSON.parse(urlQuery.data);\r\n        // constructing GraphQL parameters\r\n        var keys = ['skip', 'take', 'sorted', 'table', 'select', 'where',\r\n            'search', 'requiresCounts', 'aggregates', 'params'];\r\n        var temp = {};\r\n        var str = 'searchwhereparams';\r\n        keys.filter(function (e) {\r\n            temp[e] = str.indexOf(e) > -1 ? JSON.stringify(dm[e]) : dm[e];\r\n        });\r\n        var vars = this.getVariables() || {};\r\n        vars['datamanager'] = temp;\r\n        var data = JSON.stringify({\r\n            query: this.getQuery(),\r\n            variables: vars\r\n        });\r\n        urlQuery.data = data;\r\n        return urlQuery;\r\n    };\r\n    /**\r\n     * Returns the data from the query processing.\r\n     * It will also cache the data for later usage.\r\n     * @param  {DataResult} data\r\n     * @param  {DataManager} ds?\r\n     * @param  {Query} query?\r\n     * @param  {XMLHttpRequest} xhr?\r\n     * @param  {Object} request?\r\n     * @returns DataResult\r\n     */\r\n    GraphQLAdaptor.prototype.processResponse = function (resData, ds, query, xhr, request) {\r\n        var res = resData;\r\n        var count;\r\n        var aggregates;\r\n        var result = getValue(this.schema.result, res.data);\r\n        if (this.schema.count) {\r\n            count = getValue(this.schema.count, res.data);\r\n        }\r\n        if (this.schema.aggregates) {\r\n            aggregates = getValue(this.schema.aggregates, res.data);\r\n            aggregates = !isNullOrUndefined(aggregates) ? DataUtil.parse.parseJson(aggregates) : aggregates;\r\n        }\r\n        var pvt = request.pvtData || {};\r\n        var args = { result: result, aggregates: aggregates };\r\n        var data = args;\r\n        if (pvt && pvt.groups && pvt.groups.length) {\r\n            this.getAggregateResult(pvt, data, args, null, query);\r\n        }\r\n        return !isNullOrUndefined(count) ? { result: args.result, count: count, aggregates: aggregates } : args.result;\r\n    };\r\n    /**\r\n     * Prepare and returns request body which is used to insert a new record in the table.\r\n     */\r\n    GraphQLAdaptor.prototype.insert = function () {\r\n        var inserted = _super.prototype.insert.apply(this, arguments);\r\n        return this.generateCrudData(inserted, 'insert');\r\n    };\r\n    /**\r\n     * Prepare and returns request body which is used to update a new record in the table.\r\n     */\r\n    GraphQLAdaptor.prototype.update = function () {\r\n        var inserted = _super.prototype.update.apply(this, arguments);\r\n        return this.generateCrudData(inserted, 'update');\r\n    };\r\n    /**\r\n     * Prepare and returns request body which is used to remove a new record in the table.\r\n     */\r\n    GraphQLAdaptor.prototype.remove = function () {\r\n        var inserted = _super.prototype.remove.apply(this, arguments);\r\n        return this.generateCrudData(inserted, 'remove');\r\n    };\r\n    /**\r\n     * Prepare the request body based on the newly added, removed and updated records.\r\n     * The result is used by the batch request.\r\n     * @param  {DataManager} dm\r\n     * @param  {CrudOptions} changes\r\n     * @param  {Object} e\r\n     * @param  {Query} query\r\n     * @param  {Object} original\r\n     */\r\n    GraphQLAdaptor.prototype.batchRequest = function (dm, changes, e, query, original) {\r\n        var batch = _super.prototype.batchRequest.apply(this, arguments);\r\n        var bData = JSON.parse(batch.data);\r\n        bData.key = e.key;\r\n        batch.data = JSON.stringify(bData);\r\n        return this.generateCrudData(batch, 'batch');\r\n    };\r\n    GraphQLAdaptor.prototype.generateCrudData = function (crudData, action) {\r\n        var parsed = JSON.parse(crudData.data);\r\n        crudData.data = JSON.stringify({\r\n            query: this.opt.getMutation(action),\r\n            variables: parsed\r\n        });\r\n        return crudData;\r\n    };\r\n    return GraphQLAdaptor;\r\n}(UrlAdaptor));\r\nexport { GraphQLAdaptor };\r\n/**\r\n * Cache Adaptor is used to cache the data of the visited pages. It prevents new requests for the previously visited pages.\r\n * You can configure cache page size and duration of caching by using cachingPageSize and timeTillExpiration properties of the DataManager\r\n * @hidden\r\n */\r\nvar CacheAdaptor = /** @class */ (function (_super) {\r\n    __extends(CacheAdaptor, _super);\r\n    /**\r\n     * Constructor for CacheAdaptor class.\r\n     * @param  {CacheAdaptor} adaptor?\r\n     * @param  {number} timeStamp?\r\n     * @param  {number} pageSize?\r\n     * @hidden\r\n     */\r\n    function CacheAdaptor(adaptor, timeStamp, pageSize) {\r\n        var _this = _super.call(this) || this;\r\n        _this.isCrudAction = false;\r\n        _this.isInsertAction = false;\r\n        if (!isNullOrUndefined(adaptor)) {\r\n            _this.cacheAdaptor = adaptor;\r\n        }\r\n        _this.pageSize = pageSize;\r\n        _this.guidId = DataUtil.getGuid('cacheAdaptor');\r\n        var obj = { keys: [], results: [] };\r\n        window.localStorage.setItem(_this.guidId, JSON.stringify(obj));\r\n        var guid = _this.guidId;\r\n        if (!isNullOrUndefined(timeStamp)) {\r\n            setInterval(function () {\r\n                var data;\r\n                data = DataUtil.parse.parseJson(window.localStorage.getItem(guid));\r\n                var forDel = [];\r\n                for (var i = 0; i < data.results.length; i++) {\r\n                    var currentTime = +new Date();\r\n                    var requestTime = +new Date(data.results[i].timeStamp);\r\n                    data.results[i].timeStamp = currentTime - requestTime;\r\n                    if (currentTime - requestTime > timeStamp) {\r\n                        forDel.push(i);\r\n                    }\r\n                }\r\n                for (var i = 0; i < forDel.length; i++) {\r\n                    data.results.splice(forDel[i], 1);\r\n                    data.keys.splice(forDel[i], 1);\r\n                }\r\n                window.localStorage.removeItem(guid);\r\n                window.localStorage.setItem(guid, JSON.stringify(data));\r\n            }, timeStamp);\r\n        }\r\n        return _this;\r\n    }\r\n    /**\r\n     * It will generate the key based on the URL when we send a request to server.\r\n     * @param  {string} url\r\n     * @param  {Query} query?\r\n     * @hidden\r\n     */\r\n    CacheAdaptor.prototype.generateKey = function (url, query) {\r\n        var queries = this.getQueryRequest(query);\r\n        var singles = Query.filterQueryLists(query.queries, ['onSelect', 'onPage', 'onSkip', 'onTake', 'onRange']);\r\n        var key = url;\r\n        var page = 'onPage';\r\n        if (page in singles) {\r\n            key += singles[page].pageIndex;\r\n        }\r\n        queries.sorts.forEach(function (obj) {\r\n            key += obj.e.direction + obj.e.fieldName;\r\n        });\r\n        queries.groups.forEach(function (obj) {\r\n            key += obj.e.fieldName;\r\n        });\r\n        queries.searches.forEach(function (obj) {\r\n            key += obj.e.searchKey;\r\n        });\r\n        for (var filter = 0; filter < queries.filters.length; filter++) {\r\n            var currentFilter = queries.filters[filter];\r\n            if (currentFilter.e.isComplex) {\r\n                var newQuery = query.clone();\r\n                newQuery.queries = [];\r\n                for (var i = 0; i < currentFilter.e.predicates.length; i++) {\r\n                    newQuery.queries.push({ fn: 'onWhere', e: currentFilter.e.predicates[i], filter: query.queries.filter });\r\n                }\r\n                key += currentFilter.e.condition + this.generateKey(url, newQuery);\r\n            }\r\n            else {\r\n                key += currentFilter.e.field + currentFilter.e.operator + currentFilter.e.value;\r\n            }\r\n        }\r\n        return key;\r\n    };\r\n    /**\r\n     * Process the query to generate request body.\r\n     * If the data is already cached, it will return the cached data.\r\n     * @param  {DataManager} dm\r\n     * @param  {Query} query?\r\n     * @param  {Object[]} hierarchyFilters?\r\n     */\r\n    CacheAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\r\n        var key = this.generateKey(dm.dataSource.url, query);\r\n        var cachedItems;\r\n        cachedItems = DataUtil.parse.parseJson(window.localStorage.getItem(this.guidId));\r\n        var data = cachedItems ? cachedItems.results[cachedItems.keys.indexOf(key)] : null;\r\n        if (data != null && !this.isCrudAction && !this.isInsertAction) {\r\n            return data;\r\n        }\r\n        this.isCrudAction = null;\r\n        this.isInsertAction = null;\r\n        return this.cacheAdaptor.processQuery.apply(this.cacheAdaptor, [].slice.call(arguments, 0));\r\n    };\r\n    /**\r\n     * Returns the data from the query processing.\r\n     * It will also cache the data for later usage.\r\n     * @param  {DataResult} data\r\n     * @param  {DataManager} ds?\r\n     * @param  {Query} query?\r\n     * @param  {XMLHttpRequest} xhr?\r\n     * @param  {Ajax} request?\r\n     * @param  {CrudOptions} changes?\r\n     */\r\n    CacheAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\r\n        if (this.isInsertAction || (request && this.cacheAdaptor.options.batch &&\r\n            DataUtil.endsWith(request.url, this.cacheAdaptor.options.batch) && request.type.toLowerCase() === 'post')) {\r\n            return this.cacheAdaptor.processResponse(data, ds, query, xhr, request, changes);\r\n        }\r\n        data = this.cacheAdaptor.processResponse.apply(this.cacheAdaptor, [].slice.call(arguments, 0));\r\n        var key = query ? this.generateKey(ds.dataSource.url, query) : ds.dataSource.url;\r\n        var obj = {};\r\n        obj = DataUtil.parse.parseJson(window.localStorage.getItem(this.guidId));\r\n        var index = obj.keys.indexOf(key);\r\n        if (index !== -1) {\r\n            obj.results.splice(index, 1);\r\n            obj.keys.splice(index, 1);\r\n        }\r\n        obj.results[obj.keys.push(key) - 1] = { keys: key, result: data.result, timeStamp: new Date(), count: data.count };\r\n        while (obj.results.length > this.pageSize) {\r\n            obj.results.splice(0, 1);\r\n            obj.keys.splice(0, 1);\r\n        }\r\n        window.localStorage.setItem(this.guidId, JSON.stringify(obj));\r\n        return data;\r\n    };\r\n    /**\r\n     * Method will trigger before send the request to server side. Used to set the custom header or modify the request options.\r\n     * @param  {DataManager} dm\r\n     * @param  {XMLHttpRequest} request\r\n     * @param  {Ajax} settings?\r\n     */\r\n    CacheAdaptor.prototype.beforeSend = function (dm, request, settings) {\r\n        if (!isNullOrUndefined(this.cacheAdaptor.options.batch) && DataUtil.endsWith(settings.url, this.cacheAdaptor.options.batch)\r\n            && settings.type.toLowerCase() === 'post') {\r\n            request.setRequestHeader('Accept', this.cacheAdaptor.options.multipartAccept);\r\n        }\r\n        if (!dm.dataSource.crossDomain) {\r\n            request.setRequestHeader('Accept', this.cacheAdaptor.options.accept);\r\n        }\r\n    };\r\n    /**\r\n     * Updates existing record and saves the changes to the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {Object} value\r\n     * @param  {string} tableName\r\n     */\r\n    CacheAdaptor.prototype.update = function (dm, keyField, value, tableName) {\r\n        this.isCrudAction = true;\r\n        return this.cacheAdaptor.update(dm, keyField, value, tableName);\r\n    };\r\n    /**\r\n     * Prepare and returns request body which is used to insert a new record in the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {Object} data\r\n     * @param  {string} tableName?\r\n     */\r\n    CacheAdaptor.prototype.insert = function (dm, data, tableName) {\r\n        this.isInsertAction = true;\r\n        return this.cacheAdaptor.insert(dm, data, tableName);\r\n    };\r\n    /**\r\n     * Prepare and return request body which is used to remove record from the table.\r\n     * @param  {DataManager} dm\r\n     * @param  {string} keyField\r\n     * @param  {Object} value\r\n     * @param  {string} tableName?\r\n     */\r\n    CacheAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\r\n        this.isCrudAction = true;\r\n        return this.cacheAdaptor.remove(dm, keyField, value, tableName);\r\n    };\r\n    /**\r\n     * Prepare the request body based on the newly added, removed and updated records.\r\n     * The result is used by the batch request.\r\n     * @param  {DataManager} dm\r\n     * @param  {CrudOptions} changes\r\n     * @param  {RemoteArgs} e\r\n     */\r\n    CacheAdaptor.prototype.batchRequest = function (dm, changes, e) {\r\n        return this.cacheAdaptor.batchRequest(dm, changes, e);\r\n    };\r\n    return CacheAdaptor;\r\n}(UrlAdaptor));\r\nexport { CacheAdaptor };\r\n"]},"metadata":{},"sourceType":"module"}