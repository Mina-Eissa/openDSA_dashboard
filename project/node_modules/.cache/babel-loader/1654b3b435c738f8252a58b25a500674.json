{"ast":null,"code":"import { classNames } from './list-view';\nimport { EventHandler, append, isNullOrUndefined, detach, removeClass, addClass, compile, formatUnit } from '@syncfusion/ej2-base';\nimport { ListBase } from '../common/list-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nvar listElementCount = 1.5;\nvar windowElementCount = 3;\n\nvar Virtualization =\n/** @class */\nfunction () {\n  function Virtualization(instance) {\n    this.elementDifference = 0;\n    this.listViewInstance = instance;\n  }\n  /**\r\n   * For internal use only.\r\n   *\r\n   * @private\r\n   */\n\n\n  Virtualization.prototype.isNgTemplate = function () {\n    return !isNullOrUndefined(this.listViewInstance.templateRef) && typeof this.listViewInstance.templateRef !== 'string';\n  };\n  /**\r\n   * For internal use only.\r\n   *\r\n   * @private\r\n   */\n\n\n  Virtualization.prototype.uiVirtualization = function () {\n    this.wireScrollEvent(false);\n    var curViewDS = this.listViewInstance.curViewDS;\n    var firstDs = curViewDS.slice(0, 1);\n    this.listViewInstance.ulElement = this.listViewInstance.curUL = ListBase.createList( // eslint-disable-next-line\n    this.listViewInstance.createElement, firstDs, this.listViewInstance.listBaseOption, null, this.listViewInstance);\n    this.listViewInstance.contentContainer = this.listViewInstance.createElement('div', {\n      className: classNames.content\n    });\n    this.listViewInstance.element.appendChild(this.listViewInstance.contentContainer);\n    this.listViewInstance.contentContainer.appendChild(this.listViewInstance.ulElement);\n    this.listItemHeight = this.listViewInstance.ulElement.firstElementChild.getBoundingClientRect().height;\n    this.expectedDomItemCount = this.ValidateItemCount(10000);\n    this.domItemCount = this.ValidateItemCount(Object.keys(this.listViewInstance.curViewDS).length);\n    this.uiFirstIndex = 0;\n    this.uiLastIndex = this.domItemCount - 1;\n    var otherDs = curViewDS.slice(1, this.domItemCount);\n    var listItems = ListBase.createListItemFromJson( // eslint-disable-next-line\n    this.listViewInstance.createElement, otherDs, this.listViewInstance.listBaseOption, null, null, this.listViewInstance);\n    append(listItems, this.listViewInstance.ulElement);\n    this.listViewInstance.liCollection = this.listViewInstance.curUL.querySelectorAll('li');\n    this.topElement = this.listViewInstance.createElement('div');\n    this.listViewInstance.ulElement.insertBefore(this.topElement, this.listViewInstance.ulElement.firstElementChild);\n    this.bottomElement = this.listViewInstance.createElement('div');\n    this.listViewInstance.ulElement.insertBefore(this.bottomElement, null);\n    this.totalHeight = Object.keys(curViewDS).length * this.listItemHeight - this.domItemCount * this.listItemHeight;\n    this.topElement.style.height = 0 + 'px';\n    this.bottomElement.style.height = this.totalHeight + 'px';\n    this.topElementHeight = 0;\n    this.bottomElementHeight = this.totalHeight;\n    this.listDiff = 0;\n    this.uiIndicesInitialization();\n  };\n\n  Virtualization.prototype.wireScrollEvent = function (destroy) {\n    if (!destroy) {\n      if (this.listViewInstance.isWindow) {\n        this.onVirtualScroll = this.onVirtualUiScroll.bind(this);\n        window.addEventListener('scroll', this.onVirtualScroll);\n      } else {\n        EventHandler.add(this.listViewInstance.element, 'scroll', this.onVirtualUiScroll, this);\n      }\n    } else {\n      if (this.listViewInstance.isWindow === true) {\n        window.removeEventListener('scroll', this.onVirtualScroll);\n        window.removeEventListener('scroll', this.updateUl);\n      } else {\n        EventHandler.remove(this.listViewInstance.element, 'scroll', this.onVirtualUiScroll);\n        EventHandler.remove(this.listViewInstance.element, 'scroll', this.updateUlContainer);\n      }\n    }\n  };\n\n  Virtualization.prototype.updateUlContainer = function (e) {\n    var listDiff;\n    var virtualElementContainer = this.listViewInstance.ulElement.querySelector('.' + classNames.virtualElementContainer);\n\n    if (isNullOrUndefined(this.listViewInstance.liElementHeight)) {\n      this.listViewInstance.updateLiElementHeight();\n    }\n\n    if (this.listViewInstance.isWindow) {\n      // eslint-disable-next-line\n      listDiff = Math.round(e.target.documentElement.scrollTop / this.listViewInstance.liElementHeight) - 2;\n    } else {\n      // eslint-disable-next-line\n      listDiff = Math.round(e.target.scrollTop / this.listViewInstance.liElementHeight) - 2;\n    }\n\n    if ((listDiff - 1) * this.listViewInstance.liElementHeight < 0) {\n      virtualElementContainer.style.top = '0px';\n    } else {\n      virtualElementContainer.style.top = listDiff * this.listViewInstance.liElementHeight + 'px';\n    }\n  };\n\n  Virtualization.prototype.ValidateItemCount = function (dataSourceLength) {\n    var height = parseFloat(formatUnit(this.listViewInstance.height));\n    var itemCount;\n\n    if (this.listViewInstance.isWindow) {\n      itemCount = Math.round(window.innerHeight / this.listItemHeight * windowElementCount);\n    } else {\n      if (typeof this.listViewInstance.height === 'string' && this.listViewInstance.height.indexOf('%') !== -1) {\n        // eslint-disable-next-line max-len\n        itemCount = Math.round(this.listViewInstance.element.getBoundingClientRect().height / this.listItemHeight * listElementCount);\n      } else {\n        itemCount = Math.round(height / this.listItemHeight * listElementCount);\n      }\n    }\n\n    if (itemCount > dataSourceLength) {\n      itemCount = dataSourceLength;\n    }\n\n    return itemCount;\n  };\n\n  Virtualization.prototype.uiIndicesInitialization = function () {\n    this.uiIndices = {\n      'activeIndices': [],\n      'disabledItemIndices': [],\n      'hiddenItemIndices': []\n    };\n    var data = this.listViewInstance.curViewDS;\n\n    for (var i = 0; i < data.length; i++) {\n      if (this.listViewInstance.showCheckBox && data[i][this.listViewInstance.fields.isChecked]) {\n        this.uiIndices.activeIndices.push(i);\n      } // eslint-disable-next-line\n\n\n      if (!isNullOrUndefined(data[i][this.listViewInstance.fields.enabled]) && !data[i][this.listViewInstance.fields.enabled]) {\n        // eslint-disable-next-line\n        this.uiIndices.disabledItemIndices.push(i);\n      }\n    }\n\n    if (this.isNgTemplate()) {\n      var items = this.listViewInstance.element.querySelectorAll('.' + classNames.listItem);\n\n      for (var index = 0; index < items.length; index++) {\n        items[index].context = this.listViewInstance.viewContainerRef.get(index).context;\n      }\n    }\n  };\n\n  Virtualization.prototype.refreshItemHeight = function () {\n    if (this.listViewInstance.curViewDS.length) {\n      var curViewDS = this.listViewInstance.curViewDS;\n      this.listItemHeight = this.topElement.nextSibling.getBoundingClientRect().height;\n      this.totalHeight = Object.keys(curViewDS).length * this.listItemHeight - this.domItemCount * this.listItemHeight;\n      this.bottomElementHeight = this.totalHeight;\n      this.bottomElement.style.height = this.totalHeight + 'px';\n    }\n  };\n\n  Virtualization.prototype.getscrollerHeight = function (startingHeight) {\n    return this.listViewInstance.isWindow ? pageYOffset - startingHeight <= 0 ? 0 : pageYOffset - startingHeight : this.listViewInstance.element.scrollTop - startingHeight <= 0 ? 0 : this.listViewInstance.element.scrollTop - startingHeight;\n  };\n\n  Virtualization.prototype.onVirtualUiScroll = function (e) {\n    var _a;\n\n    var startingHeight;\n\n    if (this.listViewInstance.isWindow) {\n      startingHeight = this.listViewInstance.ulElement.getBoundingClientRect().top - document.documentElement.getBoundingClientRect().top;\n    } else {\n      startingHeight = this.listViewInstance.headerEle ? this.listViewInstance.headerEle.getBoundingClientRect().height : 0;\n    }\n\n    this.scrollPosition = isNullOrUndefined(this.scrollPosition) ? 0 : this.scrollPosition;\n    var scroll = this.getscrollerHeight(startingHeight);\n    this.topElementHeight = this.listItemHeight * Math.floor(scroll / this.listItemHeight);\n    this.bottomElementHeight = this.totalHeight - this.topElementHeight;\n    _a = scroll <= this.totalHeight ? [this.topElementHeight, this.bottomElementHeight] : [this.totalHeight, 0], this.topElementHeight = _a[0], this.bottomElementHeight = _a[1];\n\n    if (this.topElementHeight !== parseFloat(this.topElement.style.height)) {\n      this.topElement.style.height = this.topElementHeight + 'px';\n      this.bottomElement.style.height = this.bottomElementHeight + 'px';\n\n      if (scroll > this.scrollPosition) {\n        var listDiff = Math.round(this.topElementHeight / this.listItemHeight - this.listDiff);\n\n        if (listDiff > this.expectedDomItemCount + 5) {\n          this.onLongScroll(listDiff, true);\n        } else {\n          this.onNormalScroll(listDiff, true);\n        }\n      } else {\n        var listDiff = Math.round(this.listDiff - this.topElementHeight / this.listItemHeight);\n\n        if (listDiff > this.expectedDomItemCount + 5) {\n          this.onLongScroll(listDiff, false);\n        } else {\n          this.onNormalScroll(listDiff, false);\n        }\n      }\n    }\n\n    this.listDiff = Math.round(this.topElementHeight / this.listItemHeight);\n\n    if (typeof this.listViewInstance.onUIScrolled === 'function') {\n      this.listViewInstance.onUIScrolled();\n    }\n\n    this.scrollPosition = scroll;\n  };\n\n  Virtualization.prototype.onLongScroll = function (listDiff, isScrollingDown) {\n    var index = isScrollingDown ? this.uiFirstIndex + listDiff : this.uiFirstIndex - listDiff;\n    var elements = this.listViewInstance.ulElement.querySelectorAll('li');\n\n    for (var i = 0; i < elements.length; i++) {\n      this.updateUI(elements[i], index);\n      index++;\n    }\n\n    this.uiLastIndex = isScrollingDown ? this.uiLastIndex + listDiff : this.uiLastIndex - listDiff;\n    this.uiFirstIndex = isScrollingDown ? this.uiFirstIndex + listDiff : this.uiFirstIndex - listDiff;\n  };\n\n  Virtualization.prototype.onNormalScroll = function (listDiff, isScrollingDown) {\n    if (isScrollingDown) {\n      for (var i = 0; i < listDiff; i++) {\n        var index = ++this.uiLastIndex;\n        this.updateUI(this.topElement.nextElementSibling, index, this.bottomElement);\n        this.uiFirstIndex++;\n      }\n    } else {\n      for (var i = 0; i < listDiff; i++) {\n        var index = --this.uiFirstIndex;\n        var target = this.topElement.nextSibling;\n        this.updateUI(this.bottomElement.previousElementSibling, index, target);\n        this.uiLastIndex--;\n      }\n    }\n  };\n\n  Virtualization.prototype.updateUiContent = function (element, index) {\n    var curViewDs = this.listViewInstance.curViewDS;\n\n    if (typeof this.listViewInstance.dataSource[0] === 'string' || typeof this.listViewInstance.dataSource[0] === 'number') {\n      element.dataset.uid = ListBase.generateId();\n      element.getElementsByClassName(classNames.listItemText)[0].innerHTML = this.listViewInstance.curViewDS[index].toString();\n    } else {\n      // eslint-disable-next-line\n      element.dataset.uid = curViewDs[index][this.listViewInstance.fields.id] ? // eslint-disable-next-line\n      curViewDs[index][this.listViewInstance.fields.id] : ListBase.generateId();\n      element.getElementsByClassName(classNames.listItemText)[0].innerHTML = // eslint-disable-next-line\n      curViewDs[index][this.listViewInstance.fields.text];\n    }\n\n    if (this.listViewInstance.showIcon) {\n      if (element.querySelector('.' + classNames.listIcon)) {\n        detach(element.querySelector('.' + classNames.listIcon));\n      }\n\n      if (this.listViewInstance.curViewDS[index][this.listViewInstance.fields.iconCss]) {\n        var textContent = element.querySelector('.' + classNames.textContent);\n        var target = this.listViewInstance.createElement('div', {\n          className: classNames.listIcon + ' ' + this.listViewInstance.curViewDS[index][this.listViewInstance.fields.iconCss]\n        });\n        textContent.insertBefore(target, element.querySelector('.' + classNames.listItemText));\n      }\n    }\n\n    if (this.listViewInstance.showCheckBox && this.listViewInstance.fields.groupBy) {\n      if (!this.checkListWrapper) {\n        this.checkListWrapper = this.listViewInstance.curUL.querySelector('.' + classNames.checkboxWrapper).cloneNode(true);\n      }\n\n      var textContent = element.querySelector('.' + classNames.textContent);\n\n      if (this.listViewInstance.curViewDS[index].isHeader) {\n        if (element.querySelector('.' + classNames.checkboxWrapper)) {\n          element.classList.remove(classNames.checklist);\n          textContent.classList.remove(classNames.checkbox);\n          detach(element.querySelector('.' + classNames.checkboxWrapper));\n        }\n      } else {\n        if (!element.querySelector('.' + classNames.checkboxWrapper)) {\n          element.classList.add(classNames.checklist);\n          textContent.classList.add(classNames.checkbox);\n          textContent.insertBefore(this.checkListWrapper.cloneNode(true), element.querySelector('.' + classNames.listItemText));\n        }\n      }\n    }\n  };\n\n  Virtualization.prototype.changeElementAttributes = function (element, index) {\n    element.classList.remove(classNames.disable);\n\n    if (this.uiIndices.disabledItemIndices.length && this.uiIndices.disabledItemIndices.indexOf(index) !== -1) {\n      element.classList.add(classNames.disable);\n    }\n\n    element.style.display = '';\n\n    if (this.uiIndices.hiddenItemIndices.length && this.uiIndices.hiddenItemIndices.indexOf(index) !== -1) {\n      element.style.display = 'none';\n    }\n\n    if (this.listViewInstance.showCheckBox) {\n      var checklistElement = element.querySelector('.' + classNames.checkboxWrapper);\n      element.classList.remove(classNames.selected);\n      element.classList.remove(classNames.focused);\n\n      if (checklistElement) {\n        checklistElement.removeAttribute('aria-checked');\n        checklistElement.firstElementChild.classList.remove(classNames.checked);\n      }\n\n      if (this.uiIndices.activeIndices.length && this.uiIndices.activeIndices.indexOf(index) !== -1 && !this.listViewInstance.curUL.querySelector(classNames.selected)) {\n        element.classList.add(classNames.selected);\n        checklistElement.firstElementChild.classList.add(classNames.checked);\n        checklistElement.setAttribute('aria-checked', 'true');\n\n        if (this.activeIndex === index) {\n          element.classList.add(classNames.focused);\n        }\n      }\n    } else {\n      element.classList.remove(classNames.selected);\n      element.removeAttribute('aria-selected');\n\n      if (!isNullOrUndefined(this.activeIndex) && this.activeIndex === index && !this.listViewInstance.curUL.querySelector(classNames.selected)) {\n        element.classList.add(classNames.selected);\n        element.setAttribute('aria-selected', 'true');\n      }\n    }\n\n    if (this.listViewInstance.fields.groupBy) {\n      if (this.listViewInstance.curViewDS[index].isHeader) {\n        if (element.classList.contains(classNames.listItem)) {\n          element.classList.remove(classNames.listItem);\n          element.setAttribute('role', 'group');\n          element.classList.add(classNames.groupListItem);\n        }\n      } else {\n        if (element.classList.contains(classNames.groupListItem)) {\n          element.classList.remove(classNames.groupListItem);\n          element.setAttribute('role', 'listitem');\n          element.classList.add(classNames.listItem);\n        }\n      }\n    }\n  };\n\n  Virtualization.prototype.findDSAndIndexFromId = function (ds, fields) {\n    var _this = this;\n\n    var resultJSON = {};\n    fields = this.listViewInstance.getElementUID(fields);\n\n    if (!isNullOrUndefined(fields)) {\n      ds.some(function (data, index) {\n        if (fields[_this.listViewInstance.fields.id] && // eslint-disable-next-line\n        fields[_this.listViewInstance.fields.id] // eslint-disable-next-line\n        === (data[_this.listViewInstance.fields.id] && data[_this.listViewInstance.fields.id]) || fields === data) {\n          resultJSON.index = index;\n          resultJSON.data = data;\n          return true;\n        } else {\n          return false;\n        }\n      });\n    }\n\n    return resultJSON;\n  };\n\n  Virtualization.prototype.getSelectedItems = function () {\n    var _this = this;\n\n    if (!isNullOrUndefined(this.activeIndex) || this.listViewInstance.showCheckBox && this.uiIndices.activeIndices.length) {\n      var dataCollection = [];\n      var textCollection = [];\n\n      if (typeof this.listViewInstance.dataSource[0] === 'string' || typeof this.listViewInstance.dataSource[0] === 'number') {\n        var curViewDS_1 = this.listViewInstance.curViewDS;\n\n        if (this.listViewInstance.showCheckBox) {\n          var indices = this.uiIndices.activeIndices;\n\n          for (var i = 0; i < indices.length; i++) {\n            dataCollection.push(curViewDS_1[indices[i]]);\n          }\n\n          return {\n            text: dataCollection,\n            // eslint-disable-next-line\n            data: dataCollection,\n            index: this.uiIndices.activeIndices.map(function (index) {\n              return _this.listViewInstance.dataSource.indexOf(curViewDS_1[index]);\n            })\n          };\n        } else {\n          return {\n            text: curViewDS_1[this.activeIndex],\n            data: curViewDS_1[this.activeIndex],\n            index: this.listViewInstance.dataSource.indexOf(curViewDS_1[this.activeIndex])\n          };\n        }\n      } else {\n        var curViewDS_2 = this.listViewInstance.curViewDS;\n        var text = this.listViewInstance.fields.text;\n\n        if (this.listViewInstance.showCheckBox) {\n          var indexArray = this.uiIndices.activeIndices;\n\n          for (var i = 0; i < indexArray.length; i++) {\n            textCollection.push(curViewDS_2[indexArray[i]][text]);\n            dataCollection.push(curViewDS_2[indexArray[i]]);\n          }\n\n          var dataSource_1 = this.listViewInstance.dataSource instanceof DataManager ? curViewDS_2 : this.listViewInstance.dataSource;\n          return {\n            text: textCollection,\n            // eslint-disable-next-line\n            data: dataCollection,\n            index: this.uiIndices.activeIndices.map(function (index) {\n              return dataSource_1.indexOf(curViewDS_2[index]);\n            })\n          };\n        } else {\n          var dataSource = this.listViewInstance.dataSource instanceof DataManager ? curViewDS_2 : this.listViewInstance.dataSource;\n          return {\n            text: curViewDS_2[this.activeIndex][this.listViewInstance.fields.text],\n            // eslint-disable-next-line\n            data: curViewDS_2[this.activeIndex],\n            index: dataSource.indexOf(curViewDS_2[this.activeIndex])\n          };\n        }\n      }\n    } else {\n      return undefined;\n    }\n  };\n\n  Virtualization.prototype.selectItem = function (obj) {\n    var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\n\n    if (Object.keys(resutJSON).length) {\n      var isSelected = this.activeIndex === resutJSON.index;\n      var isChecked = void 0;\n      this.activeIndex = resutJSON.index;\n\n      if (this.listViewInstance.showCheckBox) {\n        if (this.uiIndices.activeIndices.indexOf(resutJSON.index) === -1) {\n          isChecked = true;\n          this.uiIndices.activeIndices.push(resutJSON.index);\n        } else {\n          isChecked = false;\n          this.uiIndices.activeIndices.splice(this.uiIndices.activeIndices.indexOf(resutJSON.index), 1);\n        }\n\n        if (this.listViewInstance.curUL.querySelector('.' + classNames.focused)) {\n          this.listViewInstance.curUL.querySelector('.' + classNames.focused).classList.remove(classNames.focused);\n        }\n      }\n\n      if (this.listViewInstance.getLiFromObjOrElement(obj)) {\n        if (this.listViewInstance.showCheckBox) {\n          this.listViewInstance.setCheckboxLI(this.listViewInstance.getLiFromObjOrElement(obj));\n        } else {\n          this.listViewInstance.setSelectLI(this.listViewInstance.getLiFromObjOrElement(obj));\n        }\n      } else {\n        var eventArgs = void 0;\n\n        if (typeof this.listViewInstance.dataSource[0] === 'string' || typeof this.listViewInstance.dataSource[0] === 'number') {\n          eventArgs = {\n            text: this.listViewInstance.curViewDS[this.activeIndex],\n            data: this.listViewInstance.curViewDS[this.activeIndex],\n            index: this.activeIndex\n          };\n        } else {\n          var curViewDS = this.listViewInstance.curViewDS;\n          eventArgs = {\n            text: curViewDS[this.activeIndex][this.listViewInstance.fields.text],\n            data: curViewDS[this.activeIndex],\n            index: this.activeIndex\n          };\n        }\n\n        if (this.listViewInstance.showCheckBox) {\n          eventArgs.isChecked = isChecked;\n          this.listViewInstance.trigger('select', eventArgs);\n        } else if (!isSelected) {\n          this.listViewInstance.removeSelect();\n          this.listViewInstance.trigger('select', eventArgs);\n        }\n      }\n    } else if (isNullOrUndefined(obj) && !this.listViewInstance.showCheckBox) {\n      this.listViewInstance.removeSelect();\n      this.activeIndex = undefined;\n    }\n  };\n\n  Virtualization.prototype.enableItem = function (obj) {\n    var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\n\n    if (Object.keys(resutJSON).length) {\n      this.uiIndices.disabledItemIndices.splice(this.uiIndices.disabledItemIndices.indexOf(resutJSON.index), 1);\n    }\n  };\n\n  Virtualization.prototype.disableItem = function (obj) {\n    var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\n\n    if (Object.keys(resutJSON).length && this.uiIndices.disabledItemIndices.indexOf(resutJSON.index) === -1) {\n      this.uiIndices.disabledItemIndices.push(resutJSON.index);\n    }\n  };\n\n  Virtualization.prototype.showItem = function (obj) {\n    var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\n\n    if (Object.keys(resutJSON).length) {\n      this.uiIndices.hiddenItemIndices.splice(this.uiIndices.hiddenItemIndices.indexOf(resutJSON.index), 1);\n    }\n  };\n\n  Virtualization.prototype.hideItem = function (obj) {\n    var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\n\n    if (Object.keys(resutJSON).length && this.uiIndices.hiddenItemIndices.indexOf(resutJSON.index) === -1) {\n      this.uiIndices.hiddenItemIndices.push(resutJSON.index);\n    }\n  };\n\n  Virtualization.prototype.removeItem = function (obj) {\n    var dataSource;\n    var curViewDS = this.listViewInstance.curViewDS;\n    var resutJSON = this.findDSAndIndexFromId(curViewDS, obj);\n\n    if (Object.keys(resutJSON).length) {\n      dataSource = resutJSON.data;\n\n      if (curViewDS[resutJSON.index - 1] && curViewDS[resutJSON.index - 1].isHeader && curViewDS[resutJSON.index - 1].items.length === 1) {\n        this.removeUiItem(resutJSON.index - 1);\n        this.removeUiItem(resutJSON.index - 1);\n      } else {\n        this.removeUiItem(resutJSON.index);\n      }\n    }\n\n    var listDataSource = this.listViewInstance.dataSource instanceof DataManager ? this.listViewInstance.localData : this.listViewInstance.dataSource;\n    var index = listDataSource.indexOf(dataSource);\n\n    if (index !== -1) {\n      listDataSource.splice(index, 1);\n      this.listViewInstance.setViewDataSource(listDataSource);\n    } // recollect all the list item into collection\n\n\n    this.listViewInstance.liCollection = this.listViewInstance.curUL.querySelectorAll('li');\n  }; // eslint-disable-next-line\n\n\n  Virtualization.prototype.setCheckboxLI = function (li, e) {\n    var index = Array.prototype.indexOf.call(this.listViewInstance.curUL.querySelectorAll('li'), li) + this.uiFirstIndex;\n    this.activeIndex = Array.prototype.indexOf.call(this.listViewInstance.curUL.querySelectorAll('li'), li) + this.uiFirstIndex;\n\n    if (li.classList.contains(classNames.selected)) {\n      if (this.uiIndices.activeIndices.indexOf(index) === -1) {\n        this.uiIndices.activeIndices.push(index);\n      }\n    } else {\n      this.uiIndices.activeIndices.splice(this.uiIndices.activeIndices.indexOf(index), 1);\n    }\n  }; // eslint-disable-next-line\n\n\n  Virtualization.prototype.setSelectLI = function (li, e) {\n    this.activeIndex = Array.prototype.indexOf.call(this.listViewInstance.curUL.querySelectorAll('li'), li) + this.uiFirstIndex;\n  };\n\n  Virtualization.prototype.checkedItem = function (checked) {\n    if (checked) {\n      this.uiIndices.activeIndices = [];\n      this.activeIndex = undefined;\n      var data = this.listViewInstance.curViewDS;\n\n      for (var index = 0; index < data.length; index++) {\n        if (!data[index].isHeader) {\n          this.uiIndices.activeIndices.push(index);\n        }\n      }\n    } else {\n      this.activeIndex = undefined;\n      this.uiIndices.activeIndices = [];\n    }\n  };\n\n  Virtualization.prototype.addUiItem = function (index) {\n    // virtually new add list item based on the scollbar position\n    // if the scroll bar is at the top, just pretend the new item has been added since no UI\n    // change is required for the item that has been added at last but when scroll bar is at the bottom\n    // just detach top and inject into bottom to mimic new item is added\n    var curViewDs = this.listViewInstance.curViewDS;\n    this.changeUiIndices(index, true);\n\n    if (this.activeIndex && this.activeIndex >= index) {\n      this.activeIndex++;\n    }\n\n    if (this.listViewInstance.showCheckBox && curViewDs[index][this.listViewInstance.fields.isChecked]) {\n      this.uiIndices.activeIndices.push(index);\n    }\n\n    if (!parseFloat(this.bottomElement.style.height) && !parseFloat(this.topElement.style.height)) {\n      this.bottomElement.style.height = parseFloat(this.bottomElement.style.height) + this.listItemHeight + 'px';\n    }\n\n    if (parseFloat(this.bottomElement.style.height)) {\n      var liItem = this.listViewInstance.curUL.lastElementChild.previousSibling;\n      var target = this.listViewInstance.getLiFromObjOrElement(curViewDs[index + 1]) || this.listViewInstance.getLiFromObjOrElement(curViewDs[index + 2]);\n\n      if (target) {\n        this.bottomElement.style.height = parseFloat(this.bottomElement.style.height) + this.listItemHeight + 'px';\n        this.updateUI(liItem, index, target);\n      }\n    } else {\n      var liItem = this.listViewInstance.curUL.firstElementChild.nextSibling;\n      var target = void 0;\n\n      if (Object.keys(this.listViewInstance.curViewDS).length - 1 === index) {\n        target = this.listViewInstance.curUL.lastElementChild;\n      } else {\n        target = this.listViewInstance.getLiFromObjOrElement(curViewDs[index + 1]) || this.listViewInstance.getLiFromObjOrElement(curViewDs[index + 2]);\n      }\n\n      this.topElement.style.height = parseFloat(this.topElement.style.height) + this.listItemHeight + 'px';\n      this.uiFirstIndex++;\n      this.uiLastIndex++;\n\n      if (target) {\n        this.updateUI(liItem, index, target);\n\n        if (this.listViewInstance.isWindow === true) {\n          window.scrollTo(0, pageYOffset + this.listItemHeight);\n        } else {\n          this.listViewInstance.element.scrollTop += this.listItemHeight;\n        }\n      }\n    }\n\n    this.totalHeight += this.listItemHeight;\n    this.listDiff = Math.round(parseFloat(this.topElement.style.height) / this.listItemHeight);\n  };\n\n  Virtualization.prototype.removeUiItem = function (index) {\n    this.totalHeight -= this.listItemHeight;\n    var curViewDS = this.listViewInstance.curViewDS[index];\n    var liItem = this.listViewInstance.getLiFromObjOrElement(curViewDS);\n    this.listViewInstance.curViewDS.splice(index, 1);\n\n    if (this.activeIndex && this.activeIndex >= index) {\n      this.activeIndex--;\n    }\n\n    if (liItem) {\n      if (this.domItemCount > Object.keys(this.listViewInstance.curViewDS).length) {\n        detach(liItem);\n        this.domItemCount--;\n        this.uiLastIndex--;\n        this.totalHeight = 0;\n      } else {\n        if (liItem.classList.contains(classNames.disable)) {\n          liItem.classList.remove(classNames.disable);\n          this.uiIndices.disabledItemIndices.splice(this.uiIndices.disabledItemIndices.indexOf(index), 1);\n        }\n\n        if (liItem.style.display === 'none') {\n          liItem.style.display = '';\n          this.uiIndices.hiddenItemIndices.splice(this.uiIndices.hiddenItemIndices.indexOf(index), 1);\n        }\n\n        if (this.listViewInstance.showCheckBox && liItem.classList.contains(classNames.selected)) {\n          this.listViewInstance.removeSelect();\n          this.uiIndices.activeIndices.splice(this.uiIndices.activeIndices.indexOf(index), 1);\n          var checklistElement = liItem.querySelector('.' + classNames.checkboxWrapper);\n          checklistElement.removeAttribute('aria-checked');\n          checklistElement.firstElementChild.classList.remove(classNames.checked);\n\n          if (liItem.classList.contains(classNames.focused)) {\n            liItem.classList.remove(classNames.focused);\n            this.activeIndex = undefined;\n          }\n        } else if (liItem.classList.contains(classNames.selected)) {\n          this.listViewInstance.removeSelect();\n          this.activeIndex = undefined;\n        }\n\n        if (!parseFloat(this.bottomElement.style.height) && !parseFloat(this.topElement.style.height)) {\n          this.updateUI(liItem, this.uiLastIndex, this.bottomElement);\n        } else if (parseFloat(this.bottomElement.style.height)) {\n          this.bottomElement.style.height = parseFloat(this.bottomElement.style.height) - this.listItemHeight + 'px';\n          this.updateUI(liItem, this.uiLastIndex, this.bottomElement);\n        } else {\n          this.topElement.style.height = parseFloat(this.topElement.style.height) - this.listItemHeight + 'px';\n          this.updateUI(liItem, this.uiFirstIndex - 1, this.topElement.nextSibling);\n          this.uiLastIndex--;\n          this.uiFirstIndex--;\n        }\n      }\n    }\n\n    this.changeUiIndices(index, false);\n    this.listDiff = Math.round(parseFloat(this.topElement.style.height) / this.listItemHeight);\n  };\n\n  Virtualization.prototype.changeUiIndices = function (index, increment) {\n    var keys = Object.keys(this.uiIndices);\n\n    for (var ind = 0; ind < keys.length; ind++) {\n      this.uiIndices[keys[ind]] = this.uiIndices[keys[ind]].map(function (i) {\n        if (i >= index) {\n          return increment ? ++i : --i;\n        } else {\n          return i;\n        }\n      });\n    }\n  };\n\n  Virtualization.prototype.addItem = function (data, fields, dataSource) {\n    for (var i = 0; i < data.length; i++) {\n      var currentItem = data[i]; // push the given data to main data array\n\n      dataSource.push(currentItem); // recalculate all the group data or other datasource related things\n\n      this.listViewInstance.setViewDataSource(dataSource); // render list items for first time due to no datasource present earlier\n\n      if (!this.domItemCount) {\n        // fresh rendering for first time\n        if ((this.listViewInstance.template || this.listViewInstance.groupTemplate) && !this.isNgTemplate()) {\n          this.listViewInstance.listBaseOption.template = null;\n          this.listViewInstance.listBaseOption.groupTemplate = null;\n          this.listViewInstance.listBaseOption.itemCreated = this.createUIItem.bind(this);\n        }\n\n        this.uiVirtualization(); // when expected expected DOM count doesn't meet the condition we need to create and inject new item into DOM\n      } else if (this.domItemCount < this.expectedDomItemCount) {\n        var ds = this.listViewInstance.findItemFromDS(dataSource, fields);\n\n        if (ds instanceof Array) {\n          if (this.listViewInstance.ulElement) {\n            var index = this.listViewInstance.curViewDS.indexOf(currentItem); // inject new list item into DOM\n\n            this.createAndInjectNewItem(currentItem, index); // check for group header item\n\n            var curViewDS = this.listViewInstance.curViewDS[index - 1];\n\n            if (curViewDS && curViewDS.isHeader && curViewDS.items.length === 1) {\n              // target group item index in datasource\n              --index; // inject new group header into DOM for previously created list item\n\n              this.createAndInjectNewItem(curViewDS, index);\n            }\n          } // recollect all the list item into collection\n\n\n          this.listViewInstance.liCollection = this.listViewInstance.curUL.querySelectorAll('li');\n        }\n      } else {\n        var index = this.listViewInstance.curViewDS.indexOf(currentItem); // virtually new add list item based on the scollbar position\n\n        this.addUiItem(index); // check for group header item needs to be added\n\n        var curViewDS = this.listViewInstance.curViewDS[index - 1];\n\n        if (curViewDS && curViewDS.isHeader && curViewDS.items.length === 1) {\n          this.addUiItem(index - 1);\n        }\n      }\n    }\n  };\n\n  Virtualization.prototype.createAndInjectNewItem = function (itemData, index) {\n    // generate li item for given datasource\n    var target;\n    var li = ListBase.createListItemFromJson(this.listViewInstance.createElement, // eslint-disable-next-line\n    [itemData], this.listViewInstance.listBaseOption, null, null, this.listViewInstance); // check for target element whether to insert before last item or group item\n\n    if (Object.keys(this.listViewInstance.curViewDS).length - 1 === index) {\n      target = this.listViewInstance.curUL.lastElementChild;\n    } else {\n      // target group header's first child item to append its header\n      target = this.listViewInstance.getLiFromObjOrElement(this.listViewInstance.curViewDS[index + 1]) || this.listViewInstance.getLiFromObjOrElement(this.listViewInstance.curViewDS[index + 2]);\n    }\n\n    if (this.listViewInstance.fields.groupBy && this.listViewInstance.curViewDS[index + 1] && this.listViewInstance.curViewDS[index + 1].isHeader) {\n      var targetEle = this.listViewInstance.getLiFromObjOrElement(this.listViewInstance.curViewDS[index - 1]);\n\n      if (targetEle) {\n        target = targetEle.nextElementSibling;\n      }\n    } // insert before the target element\n\n\n    this.listViewInstance.ulElement.insertBefore(li[0], target); // increment internal DOM count, last index count for new element\n\n    this.domItemCount++;\n\n    if (this.bottomElementHeight <= 0) {\n      this.uiLastIndex++;\n    } // recalculate the current item height, to avoid jumpy scroller\n\n\n    this.refreshItemHeight();\n  };\n\n  Virtualization.prototype.createUIItem = function (args) {\n    var virtualTemplate = this.listViewInstance.template;\n    var template = this.listViewInstance.createElement('div');\n    var commonTemplate = '<div class=\"e-text-content\" role=\"presentation\"> ' + '<span class=\"e-list-text\"> ${' + this.listViewInstance.fields.text + '} </span></div>';\n\n    if (this.listViewInstance.isReact) {\n      commonTemplate = null;\n    }\n\n    if (this.listViewInstance.showCheckBox) {\n      // eslint-disable-next-line\n      this.listViewInstance.renderCheckbox(args);\n\n      if (!isNullOrUndefined(this.listViewInstance.virtualCheckBox) && !isNullOrUndefined(this.listViewInstance.virtualCheckBox.outerHTML)) {\n        var div = document.createElement('div');\n        div.innerHTML = this.listViewInstance.template || commonTemplate;\n\n        if (div.children && div.children[0]) {\n          div.children[0].classList.add('e-checkbox');\n\n          if (this.listViewInstance.checkBoxPosition === 'Left') {\n            div.children[0].classList.add('e-checkbox-left');\n          } else {\n            div.children[0].classList.add('e-checkbox-right');\n          }\n\n          if (this.listViewInstance.checkBoxPosition === 'Left') {\n            div.children[0].insertBefore(this.listViewInstance.virtualCheckBox, div.childNodes[0].children[0]);\n          } else {\n            div.children[0].appendChild(this.listViewInstance.virtualCheckBox);\n          }\n\n          this.listViewInstance.template = div.innerHTML;\n        }\n      }\n\n      template.innerHTML = this.listViewInstance.template;\n      this.listViewInstance.template = virtualTemplate;\n    } else {\n      template.innerHTML = this.listViewInstance.template || commonTemplate;\n    } // eslint-disable-next-line\n\n\n    var templateElements = template.getElementsByTagName('*');\n    var groupTemplate = this.listViewInstance.createElement('div');\n\n    if (this.listViewInstance.fields.groupBy) {\n      groupTemplate.innerHTML = this.listViewInstance.groupTemplate || commonTemplate;\n    } // eslint-disable-next-line\n\n\n    var groupTemplateElements = groupTemplate.getElementsByTagName('*');\n\n    if (args.curData.isHeader) {\n      this.headerData = args.curData;\n    }\n\n    this.templateData = args.curData.isHeader ? args.curData.items[0] : args.curData;\n\n    if (!this.listViewInstance.isReact || typeof this.listViewInstance.template == \"string\" && !args.item.classList.contains(\"e-list-group-item\") || typeof this.listViewInstance.groupTemplate == \"string\" && args.item.classList.contains(\"e-list-group-item\")) {\n      args.item.innerHTML = '';\n    }\n\n    args.item.context = {\n      data: args.curData,\n      nodes: {\n        flatTemplateNodes: [],\n        groupTemplateNodes: []\n      }\n    };\n\n    for (var i = 0; i < templateElements.length; i++) {\n      this.compileTemplate(templateElements[i], args.item, false);\n    }\n\n    for (var i = 0; i < groupTemplateElements.length; i++) {\n      this.compileTemplate(groupTemplateElements[i], args.item, true);\n    }\n\n    args.item.context.template = args.curData.isHeader ? template.firstElementChild : groupTemplate.firstElementChild;\n    args.item.context.type = args.curData.isHeader ? 'flatList' : 'groupList';\n    var element = args.curData.isHeader ? groupTemplate : template;\n\n    if (element.firstElementChild) {\n      args.item.insertBefore(element.firstElementChild, null);\n    }\n  };\n\n  Virtualization.prototype.compileTemplate = function (element, item, isHeader) {\n    this.textProperty(element, item, isHeader);\n    this.classProperty(element, item, isHeader);\n    this.attributeProperty(element, item, isHeader);\n  };\n\n  Virtualization.prototype.onChange = function (newData, listElement) {\n    listElement.context.data = newData; // eslint-disable-next-line max-len\n\n    var groupTemplateNodes = listElement.context.nodes.groupTemplateNodes; // eslint-disable-next-line max-len\n\n    var flatTemplateNodes = listElement.context.nodes.flatTemplateNodes; // eslint-disable-next-line\n\n    if (!isNullOrUndefined(newData.isHeader) && newData.isHeader && listElement.context.type === 'groupList') {\n      // eslint-disable-next-line\n      var element = listElement.firstElementChild;\n      detach(listElement.firstElementChild);\n      listElement.insertBefore(listElement.context.template, null);\n      listElement.context.template = element;\n      listElement.context.type = 'flatList';\n\n      for (var i = 0; i < groupTemplateNodes.length; i++) {\n        // eslint-disable-next-line\n        groupTemplateNodes[i].onChange(newData);\n      }\n    } else if (!newData.isHeader && listElement.context.type === 'flatList') {\n      var element = listElement.firstElementChild;\n      detach(listElement.firstElementChild);\n      listElement.insertBefore(listElement.context.template, null);\n      listElement.context.template = element;\n      listElement.context.type = 'groupList';\n\n      for (var i = 0; i < flatTemplateNodes.length; i++) {\n        // eslint-disable-next-line\n        flatTemplateNodes[i].onChange(newData);\n      }\n    } else if (!newData.isHeader) {\n      for (var i = 0; i < flatTemplateNodes.length; i++) {\n        // eslint-disable-next-line\n        flatTemplateNodes[i].onChange(newData);\n      }\n    } else {\n      for (var i = 0; i < groupTemplateNodes.length; i++) {\n        // eslint-disable-next-line\n        groupTemplateNodes[i].onChange(newData);\n      }\n    }\n  }; // eslint-disable-next-line\n\n\n  Virtualization.prototype.updateContextData = function (listElement, node, isHeader) {\n    if (isHeader) {\n      listElement.context.nodes.groupTemplateNodes.push(node);\n    } else {\n      listElement.context.nodes.flatTemplateNodes.push(node);\n    }\n  };\n\n  Virtualization.prototype.classProperty = function (element, listElement, isHeader) {\n    var regex = new RegExp('\\\\${([^}]*)}', 'g');\n    var resultantOutput = [];\n    var regexMatch;\n\n    while (regexMatch !== null) {\n      var match = regex.exec(element.className);\n      resultantOutput.push(match);\n      regexMatch = match;\n\n      if (regexMatch === null) {\n        resultantOutput.pop();\n      }\n    }\n\n    if (resultantOutput && resultantOutput.length) {\n      var _loop_1 = function (i) {\n        var classNameMatch = resultantOutput[i]; // eslint-disable-next-line\n\n        var classFunction;\n\n        if (classNameMatch[1].indexOf('?') !== -1 && classNameMatch[1].indexOf(':') !== -1) {\n          // tslint:disable-next-line:no-function-constructor-with-string-args\n          classFunction = new Function('data', 'return ' + classNameMatch[1].replace(/\\$/g, 'data.'));\n        } else {\n          // tslint:disable-next-line:no-function-constructor-with-string-args\n          classFunction = new Function('data', 'return ' + 'data.' + classNameMatch[1]);\n        } // eslint-disable-next-line\n\n\n        var subNode = {};\n\n        if (isHeader) {\n          subNode.bindedvalue = classFunction(this_1.headerData);\n        } else {\n          subNode.bindedvalue = classFunction(this_1.templateData);\n        }\n\n        subNode.onChange = function (value) {\n          if (subNode.bindedvalue) {\n            removeClass([element], subNode.bindedvalue.split(' ').filter(function (css) {\n              return css;\n            }));\n          }\n\n          var newCss = classFunction(value);\n\n          if (newCss) {\n            addClass([element], newCss.split(' ').filter(function (css) {\n              return css;\n            }));\n          }\n\n          subNode.bindedvalue = newCss;\n        };\n\n        var className = classNameMatch[0].split(' ');\n\n        for (var i_1 = 0; i_1 < className.length; i_1++) {\n          element.classList.remove(className[i_1]);\n        }\n\n        if (subNode.bindedvalue) {\n          addClass([element], subNode.bindedvalue.split(' ').filter(function (css) {\n            return css;\n          }));\n        }\n\n        this_1.updateContextData(listElement, subNode, isHeader);\n      };\n\n      var this_1 = this;\n\n      for (var i = 0; i < resultantOutput.length; i++) {\n        _loop_1(i);\n      }\n    }\n  };\n\n  Virtualization.prototype.attributeProperty = function (element, listElement, isHeader) {\n    var attributeNames = [];\n\n    for (var i = 0; i < element.attributes.length; i++) {\n      attributeNames.push(element.attributes[i].nodeName);\n    }\n\n    if (attributeNames.indexOf('class') !== -1) {\n      attributeNames.splice(attributeNames.indexOf('class'), 1);\n    }\n\n    var _loop_2 = function (i) {\n      var attributeName = attributeNames[i];\n      var attrNameMatch = new RegExp('\\\\${([^}]*)}', 'g').exec(attributeName) || [];\n      var attrValueMatch = new RegExp('\\\\${([^}]*)}', 'g').exec(element.getAttribute(attributeName)) || []; // eslint-disable-next-line\n\n      var attributeNameFunction; // eslint-disable-next-line\n\n      var attributeValueFunction;\n\n      if (attrNameMatch.length || attrValueMatch.length) {\n        if (attrNameMatch[1]) {\n          // tslint:disable-next-line:no-function-constructor-with-string-args\n          attributeNameFunction = new Function('data', 'return ' + 'data.' + attrNameMatch[1]);\n        }\n\n        if (attrValueMatch[1]) {\n          if (attrValueMatch[1].indexOf('?') !== -1 && attrValueMatch[1].indexOf(':') !== -1) {\n            // tslint:disable-next-line:no-function-constructor-with-string-args\n            attributeValueFunction = new Function('data', 'return ' + attrValueMatch[1].replace(/\\$/g, 'data.'));\n          } else {\n            // tslint:disable-next-line:no-function-constructor-with-string-args\n            attributeValueFunction = new Function('data', 'return ' + 'data.' + attrValueMatch[1]);\n          }\n        } // eslint-disable-next-line @typescript-eslint/ban-types\n\n\n        var subNode_1 = {};\n\n        if (isHeader) {\n          subNode_1.bindedvalue = [attrNameMatch[1] === undefined ? undefined : attributeNameFunction(this_2.headerData), attrValueMatch[1] === undefined ? undefined : attributeValueFunction(this_2.headerData)];\n        } else {\n          subNode_1.bindedvalue = [attrNameMatch[1] === undefined ? undefined : attributeNameFunction(this_2.templateData), attrValueMatch[1] === undefined ? undefined : attributeValueFunction(this_2.templateData)];\n        }\n\n        subNode_1.attrName = subNode_1.bindedvalue[0] === undefined ? attributeName : subNode_1.bindedvalue[0];\n\n        subNode_1.onChange = function (value) {\n          var bindedvalue = subNode_1.bindedvalue[1] === undefined ? element.getAttribute(subNode_1.attrName) : attributeValueFunction(value);\n          element.removeAttribute(subNode_1.attrName);\n          subNode_1.attrName = subNode_1.bindedvalue[0] === undefined ? subNode_1.attrName : attributeNameFunction(value);\n          element.setAttribute(subNode_1.attrName, bindedvalue);\n          subNode_1.bindedvalue = [subNode_1.bindedvalue[0] === undefined ? undefined : attributeNameFunction(value), subNode_1.bindedvalue[1] === undefined ? undefined : attributeValueFunction(value)];\n        };\n\n        var attributeValue = subNode_1.bindedvalue[1] === undefined ? element.getAttribute(attributeName) : subNode_1.bindedvalue[1];\n        element.removeAttribute(attributeName);\n        element.setAttribute(subNode_1.attrName, attributeValue);\n        this_2.updateContextData(listElement, subNode_1, isHeader);\n      }\n    };\n\n    var this_2 = this;\n\n    for (var i = 0; i < attributeNames.length; i++) {\n      _loop_2(i);\n    }\n  };\n\n  Virtualization.prototype.textProperty = function (element, listElement, isHeader) {\n    var regex = new RegExp('\\\\${([^}]*)}', 'g');\n    var resultantOutput = [];\n    var regexMatch;\n\n    while (regexMatch !== null) {\n      var match = regex.exec(element.innerText);\n      resultantOutput.push(match);\n      regexMatch = match;\n\n      if (regexMatch === null) {\n        resultantOutput.pop();\n      }\n    }\n\n    var isChildHasTextContent = Array.prototype.some.call(element.children, function (element) {\n      if (new RegExp('\\\\${([^}]*)}', 'g').exec(element.innerText)) {\n        return true;\n      } else {\n        return false;\n      }\n    });\n\n    if (resultantOutput && resultantOutput.length && !isChildHasTextContent) {\n      var _loop_3 = function (i) {\n        var textPropertyMatch = resultantOutput[i]; // eslint-disable-next-line\n\n        var subNode = {}; // eslint-disable-next-line\n\n        var textFunction;\n\n        if (textPropertyMatch[1].indexOf('?') !== -1 && textPropertyMatch[1].indexOf(':') !== -1) {\n          // tslint:disable-next-line:no-function-constructor-with-string-args\n          textFunction = new Function('data', 'return ' + textPropertyMatch[1].replace(/\\$/g, 'data.'));\n        } else {\n          // tslint:disable-next-line:no-function-constructor-with-string-args\n          textFunction = new Function('data', 'return ' + 'data.' + textPropertyMatch[1]);\n        }\n\n        if (isHeader) {\n          subNode.bindedvalue = textFunction(this_3.headerData);\n        } else {\n          subNode.bindedvalue = textFunction(this_3.templateData);\n        }\n\n        subNode.onChange = function (value) {\n          element.innerText = element.innerText.replace(subNode.bindedvalue, textFunction(value));\n          subNode.bindedvalue = textFunction(value);\n        };\n\n        element.innerText = element.innerText.replace(textPropertyMatch[0], subNode.bindedvalue);\n        this_3.updateContextData(listElement, subNode, isHeader);\n      };\n\n      var this_3 = this;\n\n      for (var i = 0; i < resultantOutput.length; i++) {\n        _loop_3(i);\n      }\n    }\n  };\n\n  Virtualization.prototype.reRenderUiVirtualization = function () {\n    this.wireScrollEvent(true);\n\n    if (this.listViewInstance.contentContainer) {\n      detach(this.listViewInstance.contentContainer);\n    }\n\n    this.listViewInstance.preRender(); // resetting the dom count to 0, to avoid edge case of dataSource suddenly becoming zero\n    // and then manually adding item using addItem API\n\n    this.domItemCount = 0;\n    this.listViewInstance.header();\n    this.listViewInstance.setLocalData();\n  };\n\n  Virtualization.prototype.updateUI = function (element, index, targetElement) {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    var onChange = this.isNgTemplate() ? this.onNgChange : this.onChange;\n\n    if (this.listViewInstance.template || this.listViewInstance.groupTemplate) {\n      var curViewDS = this.listViewInstance.curViewDS[index]; // eslint-disable-next-line\n\n      element.dataset.uid = curViewDS[this.listViewInstance.fields.id] ? // eslint-disable-next-line\n      curViewDS[this.listViewInstance.fields.id] : ListBase.generateId();\n      onChange(curViewDS, element, this);\n    } else {\n      this.updateUiContent(element, index);\n    }\n\n    this.changeElementAttributes(element, index);\n\n    if (targetElement) {\n      this.listViewInstance.ulElement.insertBefore(element, targetElement);\n    }\n  };\n\n  Virtualization.prototype.onNgChange = function (newData, listElement, virtualThis) {\n    // compile given target element with template for new data\n    // eslint-disable-next-line\n    var templateCompiler = compile(virtualThis.listViewInstance.template);\n    var resultElement = templateCompiler(newData);\n\n    while (listElement.lastChild) {\n      listElement.removeChild(listElement.lastChild);\n    }\n\n    listElement.appendChild(resultElement[0]);\n  };\n\n  Virtualization.prototype.getModuleName = function () {\n    return 'virtualization';\n  };\n\n  Virtualization.prototype.destroy = function () {\n    this.wireScrollEvent(true);\n  };\n\n  return Virtualization;\n}();\n\nexport { Virtualization };","map":{"version":3,"sources":["C:/Users/x/Desktop/openDSA/openDSA_dashboard/project/node_modules/@syncfusion/ej2-lists/src/list-view/virtualization.js"],"names":["classNames","EventHandler","append","isNullOrUndefined","detach","removeClass","addClass","compile","formatUnit","ListBase","DataManager","listElementCount","windowElementCount","Virtualization","instance","elementDifference","listViewInstance","prototype","isNgTemplate","templateRef","uiVirtualization","wireScrollEvent","curViewDS","firstDs","slice","ulElement","curUL","createList","createElement","listBaseOption","contentContainer","className","content","element","appendChild","listItemHeight","firstElementChild","getBoundingClientRect","height","expectedDomItemCount","ValidateItemCount","domItemCount","Object","keys","length","uiFirstIndex","uiLastIndex","otherDs","listItems","createListItemFromJson","liCollection","querySelectorAll","topElement","insertBefore","bottomElement","totalHeight","style","topElementHeight","bottomElementHeight","listDiff","uiIndicesInitialization","destroy","isWindow","onVirtualScroll","onVirtualUiScroll","bind","window","addEventListener","add","removeEventListener","updateUl","remove","updateUlContainer","e","virtualElementContainer","querySelector","liElementHeight","updateLiElementHeight","Math","round","target","documentElement","scrollTop","top","dataSourceLength","parseFloat","itemCount","innerHeight","indexOf","uiIndices","data","i","showCheckBox","fields","isChecked","activeIndices","push","enabled","disabledItemIndices","items","listItem","index","context","viewContainerRef","get","refreshItemHeight","nextSibling","getscrollerHeight","startingHeight","pageYOffset","_a","document","headerEle","scrollPosition","scroll","floor","onLongScroll","onNormalScroll","onUIScrolled","isScrollingDown","elements","updateUI","nextElementSibling","previousElementSibling","updateUiContent","curViewDs","dataSource","dataset","uid","generateId","getElementsByClassName","listItemText","innerHTML","toString","id","text","showIcon","listIcon","iconCss","textContent","groupBy","checkListWrapper","checkboxWrapper","cloneNode","isHeader","classList","checklist","checkbox","changeElementAttributes","disable","display","hiddenItemIndices","checklistElement","selected","focused","removeAttribute","checked","setAttribute","activeIndex","contains","groupListItem","findDSAndIndexFromId","ds","_this","resultJSON","getElementUID","some","getSelectedItems","dataCollection","textCollection","curViewDS_1","indices","map","curViewDS_2","indexArray","dataSource_1","undefined","selectItem","obj","resutJSON","isSelected","splice","getLiFromObjOrElement","setCheckboxLI","setSelectLI","eventArgs","trigger","removeSelect","enableItem","disableItem","showItem","hideItem","removeItem","removeUiItem","listDataSource","localData","setViewDataSource","li","Array","call","checkedItem","addUiItem","changeUiIndices","liItem","lastElementChild","previousSibling","scrollTo","increment","ind","addItem","currentItem","template","groupTemplate","itemCreated","createUIItem","findItemFromDS","createAndInjectNewItem","itemData","targetEle","args","virtualTemplate","commonTemplate","isReact","renderCheckbox","virtualCheckBox","outerHTML","div","children","checkBoxPosition","childNodes","templateElements","getElementsByTagName","groupTemplateElements","curData","headerData","templateData","item","nodes","flatTemplateNodes","groupTemplateNodes","compileTemplate","type","textProperty","classProperty","attributeProperty","onChange","newData","listElement","updateContextData","node","regex","RegExp","resultantOutput","regexMatch","match","exec","pop","_loop_1","classNameMatch","classFunction","Function","replace","subNode","bindedvalue","this_1","value","split","filter","css","newCss","i_1","attributeNames","attributes","nodeName","_loop_2","attributeName","attrNameMatch","attrValueMatch","getAttribute","attributeNameFunction","attributeValueFunction","subNode_1","this_2","attrName","attributeValue","innerText","isChildHasTextContent","_loop_3","textPropertyMatch","textFunction","this_3","reRenderUiVirtualization","preRender","header","setLocalData","targetElement","onNgChange","virtualThis","templateCompiler","resultElement","lastChild","removeChild","getModuleName"],"mappings":"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","sourcesContent":["import { classNames } from './list-view';\r\nimport { EventHandler, append, isNullOrUndefined, detach, removeClass, addClass, compile, formatUnit } from '@syncfusion/ej2-base';\r\nimport { ListBase } from '../common/list-base';\r\nimport { DataManager } from '@syncfusion/ej2-data';\r\nvar listElementCount = 1.5;\r\nvar windowElementCount = 3;\r\nvar Virtualization = /** @class */ (function () {\r\n    function Virtualization(instance) {\r\n        this.elementDifference = 0;\r\n        this.listViewInstance = instance;\r\n    }\r\n    /**\r\n     * For internal use only.\r\n     *\r\n     * @private\r\n     */\r\n    Virtualization.prototype.isNgTemplate = function () {\r\n        return !isNullOrUndefined(this.listViewInstance.templateRef) && typeof this.listViewInstance.templateRef !== 'string';\r\n    };\r\n    /**\r\n     * For internal use only.\r\n     *\r\n     * @private\r\n     */\r\n    Virtualization.prototype.uiVirtualization = function () {\r\n        this.wireScrollEvent(false);\r\n        var curViewDS = this.listViewInstance.curViewDS;\r\n        var firstDs = curViewDS.slice(0, 1);\r\n        this.listViewInstance.ulElement = this.listViewInstance.curUL = ListBase.createList(\r\n        // eslint-disable-next-line\r\n        this.listViewInstance.createElement, firstDs, this.listViewInstance.listBaseOption, null, this.listViewInstance);\r\n        this.listViewInstance.contentContainer = this.listViewInstance.createElement('div', { className: classNames.content });\r\n        this.listViewInstance.element.appendChild(this.listViewInstance.contentContainer);\r\n        this.listViewInstance.contentContainer.appendChild(this.listViewInstance.ulElement);\r\n        this.listItemHeight = this.listViewInstance.ulElement.firstElementChild.getBoundingClientRect().height;\r\n        this.expectedDomItemCount = this.ValidateItemCount(10000);\r\n        this.domItemCount = this.ValidateItemCount(Object.keys(this.listViewInstance.curViewDS).length);\r\n        this.uiFirstIndex = 0;\r\n        this.uiLastIndex = this.domItemCount - 1;\r\n        var otherDs = curViewDS.slice(1, this.domItemCount);\r\n        var listItems = ListBase.createListItemFromJson(\r\n        // eslint-disable-next-line\r\n        this.listViewInstance.createElement, otherDs, this.listViewInstance.listBaseOption, null, null, this.listViewInstance);\r\n        append(listItems, this.listViewInstance.ulElement);\r\n        this.listViewInstance.liCollection = this.listViewInstance.curUL.querySelectorAll('li');\r\n        this.topElement = this.listViewInstance.createElement('div');\r\n        this.listViewInstance.ulElement.insertBefore(this.topElement, this.listViewInstance.ulElement.firstElementChild);\r\n        this.bottomElement = this.listViewInstance.createElement('div');\r\n        this.listViewInstance.ulElement.insertBefore(this.bottomElement, null);\r\n        this.totalHeight = (Object.keys(curViewDS).length * this.listItemHeight) - (this.domItemCount * this.listItemHeight);\r\n        this.topElement.style.height = 0 + 'px';\r\n        this.bottomElement.style.height = this.totalHeight + 'px';\r\n        this.topElementHeight = 0;\r\n        this.bottomElementHeight = this.totalHeight;\r\n        this.listDiff = 0;\r\n        this.uiIndicesInitialization();\r\n    };\r\n    Virtualization.prototype.wireScrollEvent = function (destroy) {\r\n        if (!destroy) {\r\n            if (this.listViewInstance.isWindow) {\r\n                this.onVirtualScroll = this.onVirtualUiScroll.bind(this);\r\n                window.addEventListener('scroll', this.onVirtualScroll);\r\n            }\r\n            else {\r\n                EventHandler.add(this.listViewInstance.element, 'scroll', this.onVirtualUiScroll, this);\r\n            }\r\n        }\r\n        else {\r\n            if (this.listViewInstance.isWindow === true) {\r\n                window.removeEventListener('scroll', this.onVirtualScroll);\r\n                window.removeEventListener('scroll', this.updateUl);\r\n            }\r\n            else {\r\n                EventHandler.remove(this.listViewInstance.element, 'scroll', this.onVirtualUiScroll);\r\n                EventHandler.remove(this.listViewInstance.element, 'scroll', this.updateUlContainer);\r\n            }\r\n        }\r\n    };\r\n    Virtualization.prototype.updateUlContainer = function (e) {\r\n        var listDiff;\r\n        var virtualElementContainer = this.listViewInstance.ulElement.querySelector('.' + classNames.virtualElementContainer);\r\n        if (isNullOrUndefined(this.listViewInstance.liElementHeight)) {\r\n            this.listViewInstance.updateLiElementHeight();\r\n        }\r\n        if (this.listViewInstance.isWindow) {\r\n            // eslint-disable-next-line\r\n            listDiff = Math.round(e.target.documentElement.scrollTop / this.listViewInstance.liElementHeight) - 2;\r\n        }\r\n        else {\r\n            // eslint-disable-next-line\r\n            listDiff = Math.round(e.target.scrollTop / this.listViewInstance.liElementHeight) - 2;\r\n        }\r\n        if (((listDiff - 1) * this.listViewInstance.liElementHeight) < 0) {\r\n            virtualElementContainer.style.top = '0px';\r\n        }\r\n        else {\r\n            virtualElementContainer.style.top = (listDiff) * this.listViewInstance.liElementHeight + 'px';\r\n        }\r\n    };\r\n    Virtualization.prototype.ValidateItemCount = function (dataSourceLength) {\r\n        var height = parseFloat(formatUnit(this.listViewInstance.height));\r\n        var itemCount;\r\n        if (this.listViewInstance.isWindow) {\r\n            itemCount = Math.round((window.innerHeight / this.listItemHeight) * windowElementCount);\r\n        }\r\n        else {\r\n            if (typeof this.listViewInstance.height === 'string' && this.listViewInstance.height.indexOf('%') !== -1) {\r\n                // eslint-disable-next-line max-len\r\n                itemCount = Math.round((this.listViewInstance.element.getBoundingClientRect().height / this.listItemHeight) * listElementCount);\r\n            }\r\n            else {\r\n                itemCount = Math.round((height / this.listItemHeight) * listElementCount);\r\n            }\r\n        }\r\n        if (itemCount > dataSourceLength) {\r\n            itemCount = dataSourceLength;\r\n        }\r\n        return itemCount;\r\n    };\r\n    Virtualization.prototype.uiIndicesInitialization = function () {\r\n        this.uiIndices = { 'activeIndices': [], 'disabledItemIndices': [], 'hiddenItemIndices': [] };\r\n        var data = this.listViewInstance.curViewDS;\r\n        for (var i = 0; i < data.length; i++) {\r\n            if (this.listViewInstance.showCheckBox && data[i][this.listViewInstance.fields.isChecked]) {\r\n                this.uiIndices.activeIndices.push(i);\r\n            }\r\n            // eslint-disable-next-line\r\n            if (!isNullOrUndefined(data[i][this.listViewInstance.fields.enabled]) &&\r\n                !data[i][this.listViewInstance.fields.enabled]) {\r\n                // eslint-disable-next-line\r\n                (this.uiIndices.disabledItemIndices.push(i));\r\n            }\r\n        }\r\n        if (this.isNgTemplate()) {\r\n            var items = this.listViewInstance.element.querySelectorAll('.' + classNames.listItem);\r\n            for (var index = 0; index < items.length; index++) {\r\n                items[index].context = this.listViewInstance.viewContainerRef.get(index).context;\r\n            }\r\n        }\r\n    };\r\n    Virtualization.prototype.refreshItemHeight = function () {\r\n        if (this.listViewInstance.curViewDS.length) {\r\n            var curViewDS = this.listViewInstance.curViewDS;\r\n            this.listItemHeight = this.topElement.nextSibling.getBoundingClientRect().height;\r\n            this.totalHeight = (Object.keys(curViewDS).length * this.listItemHeight) - (this.domItemCount * this.listItemHeight);\r\n            this.bottomElementHeight = this.totalHeight;\r\n            this.bottomElement.style.height = this.totalHeight + 'px';\r\n        }\r\n    };\r\n    Virtualization.prototype.getscrollerHeight = function (startingHeight) {\r\n        return this.listViewInstance.isWindow ? (((pageYOffset - startingHeight) <= 0) ? 0 :\r\n            (pageYOffset - startingHeight)) : ((this.listViewInstance.element.scrollTop - startingHeight) <= 0) ? 0 :\r\n            (this.listViewInstance.element.scrollTop - startingHeight);\r\n    };\r\n    Virtualization.prototype.onVirtualUiScroll = function (e) {\r\n        var _a;\r\n        var startingHeight;\r\n        if (this.listViewInstance.isWindow) {\r\n            startingHeight = this.listViewInstance.ulElement.getBoundingClientRect().top -\r\n                document.documentElement.getBoundingClientRect().top;\r\n        }\r\n        else {\r\n            startingHeight = this.listViewInstance.headerEle ? this.listViewInstance.headerEle.getBoundingClientRect().height : 0;\r\n        }\r\n        this.scrollPosition = isNullOrUndefined(this.scrollPosition) ? 0 : this.scrollPosition;\r\n        var scroll = this.getscrollerHeight(startingHeight);\r\n        this.topElementHeight = this.listItemHeight * Math.floor(scroll / this.listItemHeight);\r\n        this.bottomElementHeight = this.totalHeight - this.topElementHeight;\r\n        _a = scroll <= this.totalHeight ?\r\n            [this.topElementHeight, this.bottomElementHeight] : [this.totalHeight, 0], this.topElementHeight = _a[0], this.bottomElementHeight = _a[1];\r\n        if (this.topElementHeight !== parseFloat(this.topElement.style.height)) {\r\n            this.topElement.style.height = this.topElementHeight + 'px';\r\n            this.bottomElement.style.height = this.bottomElementHeight + 'px';\r\n            if (scroll > this.scrollPosition) {\r\n                var listDiff = Math.round(((this.topElementHeight / this.listItemHeight) - this.listDiff));\r\n                if (listDiff > (this.expectedDomItemCount + 5)) {\r\n                    this.onLongScroll(listDiff, true);\r\n                }\r\n                else {\r\n                    this.onNormalScroll(listDiff, true);\r\n                }\r\n            }\r\n            else {\r\n                var listDiff = Math.round((this.listDiff - (this.topElementHeight / this.listItemHeight)));\r\n                if (listDiff > (this.expectedDomItemCount + 5)) {\r\n                    this.onLongScroll(listDiff, false);\r\n                }\r\n                else {\r\n                    this.onNormalScroll(listDiff, false);\r\n                }\r\n            }\r\n        }\r\n        this.listDiff = Math.round(this.topElementHeight / this.listItemHeight);\r\n        if (typeof this.listViewInstance.onUIScrolled === 'function') {\r\n            this.listViewInstance.onUIScrolled();\r\n        }\r\n        this.scrollPosition = scroll;\r\n    };\r\n    Virtualization.prototype.onLongScroll = function (listDiff, isScrollingDown) {\r\n        var index = isScrollingDown ? (this.uiFirstIndex + listDiff) : (this.uiFirstIndex - listDiff);\r\n        var elements = this.listViewInstance.ulElement.querySelectorAll('li');\r\n        for (var i = 0; i < elements.length; i++) {\r\n            this.updateUI(elements[i], index);\r\n            index++;\r\n        }\r\n        this.uiLastIndex = isScrollingDown ? (this.uiLastIndex + listDiff) : (this.uiLastIndex - listDiff);\r\n        this.uiFirstIndex = isScrollingDown ? (this.uiFirstIndex + listDiff) : (this.uiFirstIndex - listDiff);\r\n    };\r\n    Virtualization.prototype.onNormalScroll = function (listDiff, isScrollingDown) {\r\n        if (isScrollingDown) {\r\n            for (var i = 0; i < listDiff; i++) {\r\n                var index = ++this.uiLastIndex;\r\n                this.updateUI(this.topElement.nextElementSibling, index, this.bottomElement);\r\n                this.uiFirstIndex++;\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0; i < listDiff; i++) {\r\n                var index = --this.uiFirstIndex;\r\n                var target = this.topElement.nextSibling;\r\n                this.updateUI(this.bottomElement.previousElementSibling, index, target);\r\n                this.uiLastIndex--;\r\n            }\r\n        }\r\n    };\r\n    Virtualization.prototype.updateUiContent = function (element, index) {\r\n        var curViewDs = this.listViewInstance.curViewDS;\r\n        if (typeof this.listViewInstance.dataSource[0] === 'string' ||\r\n            typeof this.listViewInstance.dataSource[0] === 'number') {\r\n            element.dataset.uid = ListBase.generateId();\r\n            element.getElementsByClassName(classNames.listItemText)[0].innerHTML =\r\n                this.listViewInstance.curViewDS[index].toString();\r\n        }\r\n        else {\r\n            // eslint-disable-next-line\r\n            element.dataset.uid = (curViewDs[index][this.listViewInstance.fields.id]) ?\r\n                // eslint-disable-next-line\r\n                (curViewDs[index][this.listViewInstance.fields.id]) : ListBase.generateId();\r\n            element.getElementsByClassName(classNames.listItemText)[0].innerHTML =\r\n                // eslint-disable-next-line\r\n                (curViewDs[index][this.listViewInstance.fields.text]);\r\n        }\r\n        if (this.listViewInstance.showIcon) {\r\n            if (element.querySelector('.' + classNames.listIcon)) {\r\n                detach(element.querySelector('.' + classNames.listIcon));\r\n            }\r\n            if (this.listViewInstance.curViewDS[index][this.listViewInstance.fields.iconCss]) {\r\n                var textContent = element.querySelector('.' + classNames.textContent);\r\n                var target = this.listViewInstance.createElement('div', {\r\n                    className: classNames.listIcon + ' ' +\r\n                        this.listViewInstance.curViewDS[index][this.listViewInstance.fields.iconCss]\r\n                });\r\n                textContent.insertBefore(target, element.querySelector('.' + classNames.listItemText));\r\n            }\r\n        }\r\n        if (this.listViewInstance.showCheckBox && this.listViewInstance.fields.groupBy) {\r\n            if (!this.checkListWrapper) {\r\n                this.checkListWrapper = this.listViewInstance.curUL.querySelector('.' + classNames.checkboxWrapper).cloneNode(true);\r\n            }\r\n            var textContent = element.querySelector('.' + classNames.textContent);\r\n            if (this.listViewInstance.curViewDS[index].isHeader) {\r\n                if (element.querySelector('.' + classNames.checkboxWrapper)) {\r\n                    element.classList.remove(classNames.checklist);\r\n                    textContent.classList.remove(classNames.checkbox);\r\n                    detach(element.querySelector('.' + classNames.checkboxWrapper));\r\n                }\r\n            }\r\n            else {\r\n                if (!element.querySelector('.' + classNames.checkboxWrapper)) {\r\n                    element.classList.add(classNames.checklist);\r\n                    textContent.classList.add(classNames.checkbox);\r\n                    textContent.insertBefore(this.checkListWrapper.cloneNode(true), element.querySelector('.' + classNames.listItemText));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Virtualization.prototype.changeElementAttributes = function (element, index) {\r\n        element.classList.remove(classNames.disable);\r\n        if (this.uiIndices.disabledItemIndices.length && this.uiIndices.disabledItemIndices.indexOf(index) !== -1) {\r\n            element.classList.add(classNames.disable);\r\n        }\r\n        element.style.display = '';\r\n        if (this.uiIndices.hiddenItemIndices.length && this.uiIndices.hiddenItemIndices.indexOf(index) !== -1) {\r\n            element.style.display = 'none';\r\n        }\r\n        if (this.listViewInstance.showCheckBox) {\r\n            var checklistElement = element.querySelector('.' + classNames.checkboxWrapper);\r\n            element.classList.remove(classNames.selected);\r\n            element.classList.remove(classNames.focused);\r\n            if (checklistElement) {\r\n                checklistElement.removeAttribute('aria-checked');\r\n                checklistElement.firstElementChild.classList.remove(classNames.checked);\r\n            }\r\n            if (this.uiIndices.activeIndices.length && this.uiIndices.activeIndices.indexOf(index) !== -1 &&\r\n                !this.listViewInstance.curUL.querySelector(classNames.selected)) {\r\n                element.classList.add(classNames.selected);\r\n                checklistElement.firstElementChild.classList.add(classNames.checked);\r\n                checklistElement.setAttribute('aria-checked', 'true');\r\n                if (this.activeIndex === index) {\r\n                    element.classList.add(classNames.focused);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            element.classList.remove(classNames.selected);\r\n            element.removeAttribute('aria-selected');\r\n            if (!isNullOrUndefined(this.activeIndex) && this.activeIndex === index &&\r\n                !this.listViewInstance.curUL.querySelector(classNames.selected)) {\r\n                element.classList.add(classNames.selected);\r\n                element.setAttribute('aria-selected', 'true');\r\n            }\r\n        }\r\n        if (this.listViewInstance.fields.groupBy) {\r\n            if (this.listViewInstance.curViewDS[index].isHeader) {\r\n                if (element.classList.contains(classNames.listItem)) {\r\n                    element.classList.remove(classNames.listItem);\r\n                    element.setAttribute('role', 'group');\r\n                    element.classList.add(classNames.groupListItem);\r\n                }\r\n            }\r\n            else {\r\n                if (element.classList.contains(classNames.groupListItem)) {\r\n                    element.classList.remove(classNames.groupListItem);\r\n                    element.setAttribute('role', 'listitem');\r\n                    element.classList.add(classNames.listItem);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Virtualization.prototype.findDSAndIndexFromId = function (ds, fields) {\r\n        var _this = this;\r\n        var resultJSON = {};\r\n        fields = this.listViewInstance.getElementUID(fields);\r\n        if (!isNullOrUndefined(fields)) {\r\n            ds.some(function (data, index) {\r\n                if ((fields[_this.listViewInstance.fields.id] &&\r\n                    // eslint-disable-next-line\r\n                    fields[_this.listViewInstance.fields.id]\r\n                        // eslint-disable-next-line\r\n                        === (data[_this.listViewInstance.fields.id] && data[_this.listViewInstance.fields.id]) || fields === data)) {\r\n                    resultJSON.index = index;\r\n                    resultJSON.data = data;\r\n                    return true;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            });\r\n        }\r\n        return resultJSON;\r\n    };\r\n    Virtualization.prototype.getSelectedItems = function () {\r\n        var _this = this;\r\n        if (!isNullOrUndefined(this.activeIndex) || (this.listViewInstance.showCheckBox && this.uiIndices.activeIndices.length)) {\r\n            var dataCollection = [];\r\n            var textCollection = [];\r\n            if (typeof this.listViewInstance.dataSource[0] === 'string' ||\r\n                typeof this.listViewInstance.dataSource[0] === 'number') {\r\n                var curViewDS_1 = this.listViewInstance.curViewDS;\r\n                if (this.listViewInstance.showCheckBox) {\r\n                    var indices = this.uiIndices.activeIndices;\r\n                    for (var i = 0; i < indices.length; i++) {\r\n                        dataCollection.push(curViewDS_1[indices[i]]);\r\n                    }\r\n                    return {\r\n                        text: dataCollection,\r\n                        // eslint-disable-next-line\r\n                        data: dataCollection,\r\n                        index: this.uiIndices.activeIndices.map(function (index) {\r\n                            return _this.listViewInstance.dataSource.indexOf(curViewDS_1[index]);\r\n                        })\r\n                    };\r\n                }\r\n                else {\r\n                    return {\r\n                        text: curViewDS_1[this.activeIndex],\r\n                        data: curViewDS_1[this.activeIndex],\r\n                        index: this.listViewInstance.dataSource.indexOf(curViewDS_1[this.activeIndex])\r\n                    };\r\n                }\r\n            }\r\n            else {\r\n                var curViewDS_2 = this.listViewInstance.curViewDS;\r\n                var text = this.listViewInstance.fields.text;\r\n                if (this.listViewInstance.showCheckBox) {\r\n                    var indexArray = this.uiIndices.activeIndices;\r\n                    for (var i = 0; i < indexArray.length; i++) {\r\n                        textCollection.push(curViewDS_2[indexArray[i]][text]);\r\n                        dataCollection.push(curViewDS_2[indexArray[i]]);\r\n                    }\r\n                    var dataSource_1 = this.listViewInstance.dataSource instanceof DataManager\r\n                        ? curViewDS_2 : this.listViewInstance.dataSource;\r\n                    return {\r\n                        text: textCollection,\r\n                        // eslint-disable-next-line\r\n                        data: dataCollection,\r\n                        index: this.uiIndices.activeIndices.map(function (index) {\r\n                            return dataSource_1.indexOf(curViewDS_2[index]);\r\n                        })\r\n                    };\r\n                }\r\n                else {\r\n                    var dataSource = this.listViewInstance.dataSource instanceof DataManager\r\n                        ? curViewDS_2 : this.listViewInstance.dataSource;\r\n                    return {\r\n                        text: curViewDS_2[this.activeIndex][this.listViewInstance.fields.text],\r\n                        // eslint-disable-next-line\r\n                        data: curViewDS_2[this.activeIndex],\r\n                        index: dataSource.indexOf(curViewDS_2[this.activeIndex])\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return undefined;\r\n        }\r\n    };\r\n    Virtualization.prototype.selectItem = function (obj) {\r\n        var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\r\n        if (Object.keys(resutJSON).length) {\r\n            var isSelected = this.activeIndex === resutJSON.index;\r\n            var isChecked = void 0;\r\n            this.activeIndex = resutJSON.index;\r\n            if (this.listViewInstance.showCheckBox) {\r\n                if (this.uiIndices.activeIndices.indexOf(resutJSON.index) === -1) {\r\n                    isChecked = true;\r\n                    this.uiIndices.activeIndices.push(resutJSON.index);\r\n                }\r\n                else {\r\n                    isChecked = false;\r\n                    this.uiIndices.activeIndices.splice(this.uiIndices.activeIndices.indexOf(resutJSON.index), 1);\r\n                }\r\n                if (this.listViewInstance.curUL.querySelector('.' + classNames.focused)) {\r\n                    this.listViewInstance.curUL.querySelector('.' + classNames.focused).classList.remove(classNames.focused);\r\n                }\r\n            }\r\n            if (this.listViewInstance.getLiFromObjOrElement(obj)) {\r\n                if (this.listViewInstance.showCheckBox) {\r\n                    this.listViewInstance.setCheckboxLI(this.listViewInstance.getLiFromObjOrElement(obj));\r\n                }\r\n                else {\r\n                    this.listViewInstance.setSelectLI(this.listViewInstance.getLiFromObjOrElement(obj));\r\n                }\r\n            }\r\n            else {\r\n                var eventArgs = void 0;\r\n                if (typeof this.listViewInstance.dataSource[0] === 'string' ||\r\n                    typeof this.listViewInstance.dataSource[0] === 'number') {\r\n                    eventArgs = {\r\n                        text: this.listViewInstance.curViewDS[this.activeIndex],\r\n                        data: this.listViewInstance.curViewDS[this.activeIndex],\r\n                        index: this.activeIndex\r\n                    };\r\n                }\r\n                else {\r\n                    var curViewDS = this.listViewInstance.curViewDS;\r\n                    eventArgs = {\r\n                        text: curViewDS[this.activeIndex][this.listViewInstance.fields.text],\r\n                        data: curViewDS[this.activeIndex],\r\n                        index: this.activeIndex\r\n                    };\r\n                }\r\n                if (this.listViewInstance.showCheckBox) {\r\n                    eventArgs.isChecked = isChecked;\r\n                    this.listViewInstance.trigger('select', eventArgs);\r\n                }\r\n                else if (!isSelected) {\r\n                    this.listViewInstance.removeSelect();\r\n                    this.listViewInstance.trigger('select', eventArgs);\r\n                }\r\n            }\r\n        }\r\n        else if (isNullOrUndefined(obj) && !this.listViewInstance.showCheckBox) {\r\n            this.listViewInstance.removeSelect();\r\n            this.activeIndex = undefined;\r\n        }\r\n    };\r\n    Virtualization.prototype.enableItem = function (obj) {\r\n        var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\r\n        if (Object.keys(resutJSON).length) {\r\n            this.uiIndices.disabledItemIndices.splice(this.uiIndices.disabledItemIndices.indexOf(resutJSON.index), 1);\r\n        }\r\n    };\r\n    Virtualization.prototype.disableItem = function (obj) {\r\n        var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\r\n        if (Object.keys(resutJSON).length && this.uiIndices.disabledItemIndices.indexOf(resutJSON.index) === -1) {\r\n            this.uiIndices.disabledItemIndices.push(resutJSON.index);\r\n        }\r\n    };\r\n    Virtualization.prototype.showItem = function (obj) {\r\n        var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\r\n        if (Object.keys(resutJSON).length) {\r\n            this.uiIndices.hiddenItemIndices.splice(this.uiIndices.hiddenItemIndices.indexOf(resutJSON.index), 1);\r\n        }\r\n    };\r\n    Virtualization.prototype.hideItem = function (obj) {\r\n        var resutJSON = this.findDSAndIndexFromId(this.listViewInstance.curViewDS, obj);\r\n        if (Object.keys(resutJSON).length && this.uiIndices.hiddenItemIndices.indexOf(resutJSON.index) === -1) {\r\n            this.uiIndices.hiddenItemIndices.push(resutJSON.index);\r\n        }\r\n    };\r\n    Virtualization.prototype.removeItem = function (obj) {\r\n        var dataSource;\r\n        var curViewDS = this.listViewInstance.curViewDS;\r\n        var resutJSON = this.findDSAndIndexFromId(curViewDS, obj);\r\n        if (Object.keys(resutJSON).length) {\r\n            dataSource = resutJSON.data;\r\n            if (curViewDS[resutJSON.index - 1] &&\r\n                curViewDS[resutJSON.index - 1].isHeader &&\r\n                (curViewDS[resutJSON.index - 1])\r\n                    .items.length === 1) {\r\n                this.removeUiItem(resutJSON.index - 1);\r\n                this.removeUiItem(resutJSON.index - 1);\r\n            }\r\n            else {\r\n                this.removeUiItem(resutJSON.index);\r\n            }\r\n        }\r\n        var listDataSource = this.listViewInstance.dataSource instanceof DataManager\r\n            ? this.listViewInstance.localData : this.listViewInstance.dataSource;\r\n        var index = listDataSource.indexOf(dataSource);\r\n        if (index !== -1) {\r\n            listDataSource.splice(index, 1);\r\n            this.listViewInstance.setViewDataSource(listDataSource);\r\n        }\r\n        // recollect all the list item into collection\r\n        this.listViewInstance.liCollection =\r\n            this.listViewInstance.curUL.querySelectorAll('li');\r\n    };\r\n    // eslint-disable-next-line\r\n    Virtualization.prototype.setCheckboxLI = function (li, e) {\r\n        var index = Array.prototype.indexOf.call(this.listViewInstance.curUL.querySelectorAll('li'), li) + this.uiFirstIndex;\r\n        this.activeIndex = Array.prototype.indexOf.call(this.listViewInstance.curUL.querySelectorAll('li'), li) + this.uiFirstIndex;\r\n        if (li.classList.contains(classNames.selected)) {\r\n            if (this.uiIndices.activeIndices.indexOf(index) === -1) {\r\n                this.uiIndices.activeIndices.push(index);\r\n            }\r\n        }\r\n        else {\r\n            this.uiIndices.activeIndices.splice(this.uiIndices.activeIndices.indexOf(index), 1);\r\n        }\r\n    };\r\n    // eslint-disable-next-line\r\n    Virtualization.prototype.setSelectLI = function (li, e) {\r\n        this.activeIndex = Array.prototype.indexOf.call(this.listViewInstance.curUL.querySelectorAll('li'), li) + this.uiFirstIndex;\r\n    };\r\n    Virtualization.prototype.checkedItem = function (checked) {\r\n        if (checked) {\r\n            this.uiIndices.activeIndices = [];\r\n            this.activeIndex = undefined;\r\n            var data = this.listViewInstance.curViewDS;\r\n            for (var index = 0; index < data.length; index++) {\r\n                if (!data[index].isHeader) {\r\n                    this.uiIndices.activeIndices.push(index);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.activeIndex = undefined;\r\n            this.uiIndices.activeIndices = [];\r\n        }\r\n    };\r\n    Virtualization.prototype.addUiItem = function (index) {\r\n        // virtually new add list item based on the scollbar position\r\n        // if the scroll bar is at the top, just pretend the new item has been added since no UI\r\n        // change is required for the item that has been added at last but when scroll bar is at the bottom\r\n        // just detach top and inject into bottom to mimic new item is added\r\n        var curViewDs = this.listViewInstance.curViewDS;\r\n        this.changeUiIndices(index, true);\r\n        if (this.activeIndex && this.activeIndex >= index) {\r\n            this.activeIndex++;\r\n        }\r\n        if (this.listViewInstance.showCheckBox &&\r\n            curViewDs[index][this.listViewInstance.fields.isChecked]) {\r\n            this.uiIndices.activeIndices.push(index);\r\n        }\r\n        if (!parseFloat(this.bottomElement.style.height) && !parseFloat(this.topElement.style.height)) {\r\n            this.bottomElement.style.height = parseFloat(this.bottomElement.style.height) + this.listItemHeight + 'px';\r\n        }\r\n        if (parseFloat(this.bottomElement.style.height)) {\r\n            var liItem = this.listViewInstance.curUL.lastElementChild.previousSibling;\r\n            var target = this.listViewInstance.getLiFromObjOrElement(curViewDs[index + 1]) ||\r\n                this.listViewInstance.getLiFromObjOrElement(curViewDs[index + 2]);\r\n            if (target) {\r\n                this.bottomElement.style.height = parseFloat(this.bottomElement.style.height) + this.listItemHeight + 'px';\r\n                this.updateUI(liItem, index, target);\r\n            }\r\n        }\r\n        else {\r\n            var liItem = this.listViewInstance.curUL.firstElementChild.nextSibling;\r\n            var target = void 0;\r\n            if ((Object.keys(this.listViewInstance.curViewDS).length - 1) === index) {\r\n                target = this.listViewInstance.curUL.lastElementChild;\r\n            }\r\n            else {\r\n                target = this.listViewInstance.getLiFromObjOrElement(curViewDs[index + 1]) ||\r\n                    this.listViewInstance.getLiFromObjOrElement(curViewDs[index + 2]);\r\n            }\r\n            this.topElement.style.height = parseFloat(this.topElement.style.height) + this.listItemHeight + 'px';\r\n            this.uiFirstIndex++;\r\n            this.uiLastIndex++;\r\n            if (target) {\r\n                this.updateUI(liItem, index, target);\r\n                if (this.listViewInstance.isWindow === true) {\r\n                    window.scrollTo(0, (pageYOffset + this.listItemHeight));\r\n                }\r\n                else {\r\n                    this.listViewInstance.element.scrollTop += this.listItemHeight;\r\n                }\r\n            }\r\n        }\r\n        this.totalHeight += this.listItemHeight;\r\n        this.listDiff = Math.round(parseFloat(this.topElement.style.height) / this.listItemHeight);\r\n    };\r\n    Virtualization.prototype.removeUiItem = function (index) {\r\n        this.totalHeight -= this.listItemHeight;\r\n        var curViewDS = this.listViewInstance.curViewDS[index];\r\n        var liItem = this.listViewInstance.getLiFromObjOrElement(curViewDS);\r\n        this.listViewInstance.curViewDS.splice(index, 1);\r\n        if (this.activeIndex && this.activeIndex >= index) {\r\n            this.activeIndex--;\r\n        }\r\n        if (liItem) {\r\n            if (this.domItemCount > Object.keys(this.listViewInstance.curViewDS).length) {\r\n                detach(liItem);\r\n                this.domItemCount--;\r\n                this.uiLastIndex--;\r\n                this.totalHeight = 0;\r\n            }\r\n            else {\r\n                if (liItem.classList.contains(classNames.disable)) {\r\n                    liItem.classList.remove(classNames.disable);\r\n                    this.uiIndices.disabledItemIndices.splice(this.uiIndices.disabledItemIndices.indexOf(index), 1);\r\n                }\r\n                if (liItem.style.display === 'none') {\r\n                    liItem.style.display = '';\r\n                    this.uiIndices.hiddenItemIndices.splice(this.uiIndices.hiddenItemIndices.indexOf(index), 1);\r\n                }\r\n                if (this.listViewInstance.showCheckBox && liItem.classList.contains(classNames.selected)) {\r\n                    this.listViewInstance.removeSelect();\r\n                    this.uiIndices.activeIndices.splice(this.uiIndices.activeIndices.indexOf(index), 1);\r\n                    var checklistElement = liItem.querySelector('.' + classNames.checkboxWrapper);\r\n                    checklistElement.removeAttribute('aria-checked');\r\n                    checklistElement.firstElementChild.classList.remove(classNames.checked);\r\n                    if (liItem.classList.contains(classNames.focused)) {\r\n                        liItem.classList.remove(classNames.focused);\r\n                        this.activeIndex = undefined;\r\n                    }\r\n                }\r\n                else if (liItem.classList.contains(classNames.selected)) {\r\n                    this.listViewInstance.removeSelect();\r\n                    this.activeIndex = undefined;\r\n                }\r\n                if (!parseFloat(this.bottomElement.style.height) && !parseFloat(this.topElement.style.height)) {\r\n                    this.updateUI(liItem, this.uiLastIndex, this.bottomElement);\r\n                }\r\n                else if (parseFloat(this.bottomElement.style.height)) {\r\n                    this.bottomElement.style.height = parseFloat(this.bottomElement.style.height) - this.listItemHeight + 'px';\r\n                    this.updateUI(liItem, this.uiLastIndex, this.bottomElement);\r\n                }\r\n                else {\r\n                    this.topElement.style.height = parseFloat(this.topElement.style.height) - this.listItemHeight + 'px';\r\n                    this.updateUI(liItem, (this.uiFirstIndex - 1), this.topElement.nextSibling);\r\n                    this.uiLastIndex--;\r\n                    this.uiFirstIndex--;\r\n                }\r\n            }\r\n        }\r\n        this.changeUiIndices(index, false);\r\n        this.listDiff = Math.round(parseFloat(this.topElement.style.height) / this.listItemHeight);\r\n    };\r\n    Virtualization.prototype.changeUiIndices = function (index, increment) {\r\n        var keys = Object.keys(this.uiIndices);\r\n        for (var ind = 0; ind < keys.length; ind++) {\r\n            this.uiIndices[keys[ind]] = this.uiIndices[keys[ind]].map(function (i) {\r\n                if (i >= index) {\r\n                    return increment ? ++i : --i;\r\n                }\r\n                else {\r\n                    return i;\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Virtualization.prototype.addItem = function (data, fields, dataSource) {\r\n        for (var i = 0; i < data.length; i++) {\r\n            var currentItem = data[i];\r\n            // push the given data to main data array\r\n            dataSource.push(currentItem);\r\n            // recalculate all the group data or other datasource related things\r\n            this.listViewInstance.setViewDataSource(dataSource);\r\n            // render list items for first time due to no datasource present earlier\r\n            if (!this.domItemCount) {\r\n                // fresh rendering for first time\r\n                if ((this.listViewInstance.template || this.listViewInstance.groupTemplate) && !this.isNgTemplate()) {\r\n                    this.listViewInstance.listBaseOption.template = null;\r\n                    this.listViewInstance.listBaseOption.groupTemplate = null;\r\n                    this.listViewInstance.listBaseOption.itemCreated = this.createUIItem.bind(this);\r\n                }\r\n                this.uiVirtualization();\r\n                // when expected expected DOM count doesn't meet the condition we need to create and inject new item into DOM\r\n            }\r\n            else if (this.domItemCount < this.expectedDomItemCount) {\r\n                var ds = this.listViewInstance.findItemFromDS(dataSource, fields);\r\n                if (ds instanceof Array) {\r\n                    if (this.listViewInstance.ulElement) {\r\n                        var index = this.listViewInstance.curViewDS.indexOf(currentItem);\r\n                        // inject new list item into DOM\r\n                        this.createAndInjectNewItem(currentItem, index);\r\n                        // check for group header item\r\n                        var curViewDS = this.listViewInstance.curViewDS[index - 1];\r\n                        if (curViewDS && curViewDS.isHeader && curViewDS.items.length === 1) {\r\n                            // target group item index in datasource\r\n                            --index;\r\n                            // inject new group header into DOM for previously created list item\r\n                            this.createAndInjectNewItem(curViewDS, index);\r\n                        }\r\n                    }\r\n                    // recollect all the list item into collection\r\n                    this.listViewInstance.liCollection =\r\n                        this.listViewInstance.curUL.querySelectorAll('li');\r\n                }\r\n            }\r\n            else {\r\n                var index = this.listViewInstance.curViewDS.indexOf(currentItem);\r\n                // virtually new add list item based on the scollbar position\r\n                this.addUiItem(index);\r\n                // check for group header item needs to be added\r\n                var curViewDS = this.listViewInstance.curViewDS[index - 1];\r\n                if (curViewDS && curViewDS.isHeader && curViewDS.items.length === 1) {\r\n                    this.addUiItem(index - 1);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Virtualization.prototype.createAndInjectNewItem = function (itemData, index) {\r\n        // generate li item for given datasource\r\n        var target;\r\n        var li = ListBase.createListItemFromJson(this.listViewInstance.createElement, \r\n        // eslint-disable-next-line\r\n        [itemData], this.listViewInstance.listBaseOption, null, null, this.listViewInstance);\r\n        // check for target element whether to insert before last item or group item\r\n        if ((Object.keys(this.listViewInstance.curViewDS).length - 1) === index) {\r\n            target = this.listViewInstance.curUL.lastElementChild;\r\n        }\r\n        else {\r\n            // target group header's first child item to append its header\r\n            target = this.listViewInstance.getLiFromObjOrElement(this.listViewInstance.curViewDS[index + 1]) ||\r\n                this.listViewInstance.getLiFromObjOrElement(this.listViewInstance.curViewDS[index + 2]);\r\n        }\r\n        if (this.listViewInstance.fields.groupBy && this.listViewInstance.curViewDS[index + 1] && this.listViewInstance.curViewDS[index + 1].isHeader) {\r\n            var targetEle = this.listViewInstance.getLiFromObjOrElement(this.listViewInstance.curViewDS[index - 1]);\r\n            if (targetEle) {\r\n                target = targetEle.nextElementSibling;\r\n            }\r\n        }\r\n        // insert before the target element\r\n        this.listViewInstance.ulElement.insertBefore(li[0], target);\r\n        // increment internal DOM count, last index count for new element\r\n        this.domItemCount++;\r\n        if (this.bottomElementHeight <= 0) {\r\n            this.uiLastIndex++;\r\n        }\r\n        // recalculate the current item height, to avoid jumpy scroller\r\n        this.refreshItemHeight();\r\n    };\r\n    Virtualization.prototype.createUIItem = function (args) {\r\n        var virtualTemplate = this.listViewInstance.template;\r\n        var template = this.listViewInstance.createElement('div');\r\n        var commonTemplate = '<div class=\"e-text-content\" role=\"presentation\"> ' +\r\n            '<span class=\"e-list-text\"> ${' + this.listViewInstance.fields.text + '} </span></div>';\r\n        if (this.listViewInstance.isReact) {\r\n            commonTemplate = null;\r\n        }\r\n        if (this.listViewInstance.showCheckBox) {\r\n            // eslint-disable-next-line\r\n            this.listViewInstance.renderCheckbox(args);\r\n            if ((!isNullOrUndefined(this.listViewInstance.virtualCheckBox)) &&\r\n                (!isNullOrUndefined(this.listViewInstance.virtualCheckBox.outerHTML))) {\r\n                var div = document.createElement('div');\r\n                div.innerHTML = this.listViewInstance.template || commonTemplate;\r\n                if (div.children && div.children[0]) {\r\n                    div.children[0].classList.add('e-checkbox');\r\n                    if (this.listViewInstance.checkBoxPosition === 'Left') {\r\n                        div.children[0].classList.add('e-checkbox-left');\r\n                    }\r\n                    else {\r\n                        div.children[0].classList.add('e-checkbox-right');\r\n                    }\r\n                    if (this.listViewInstance.checkBoxPosition === 'Left') {\r\n                        div.children[0].insertBefore(this.listViewInstance.virtualCheckBox, div.childNodes[0].children[0]);\r\n                    }\r\n                    else {\r\n                        div.children[0].appendChild(this.listViewInstance.virtualCheckBox);\r\n                    }\r\n                    this.listViewInstance.template = div.innerHTML;\r\n                }\r\n            }\r\n            template.innerHTML = this.listViewInstance.template;\r\n            this.listViewInstance.template = virtualTemplate;\r\n        }\r\n        else {\r\n            template.innerHTML = this.listViewInstance.template || commonTemplate;\r\n        }\r\n        // eslint-disable-next-line\r\n        var templateElements = template.getElementsByTagName('*');\r\n        var groupTemplate = this.listViewInstance.createElement('div');\r\n        if (this.listViewInstance.fields.groupBy) {\r\n            groupTemplate.innerHTML = this.listViewInstance.groupTemplate || commonTemplate;\r\n        }\r\n        // eslint-disable-next-line\r\n        var groupTemplateElements = groupTemplate.getElementsByTagName('*');\r\n        if (args.curData.isHeader) {\r\n            this.headerData = args.curData;\r\n        }\r\n        this.templateData = args.curData.isHeader ? args.curData.items[0] :\r\n            args.curData;\r\n        if (!this.listViewInstance.isReact || (typeof this.listViewInstance.template == \"string\" && !args.item.classList.contains(\"e-list-group-item\")) ||\r\n            (typeof this.listViewInstance.groupTemplate == \"string\" && args.item.classList.contains(\"e-list-group-item\"))) {\r\n            args.item.innerHTML = '';\r\n        }\r\n        args.item.context = { data: args.curData, nodes: { flatTemplateNodes: [], groupTemplateNodes: [] } };\r\n        for (var i = 0; i < templateElements.length; i++) {\r\n            this.compileTemplate(templateElements[i], args.item, false);\r\n        }\r\n        for (var i = 0; i < groupTemplateElements.length; i++) {\r\n            this.compileTemplate(groupTemplateElements[i], args.item, true);\r\n        }\r\n        args.item.context.template = args.curData.isHeader ? template.firstElementChild :\r\n            groupTemplate.firstElementChild;\r\n        args.item.context.type = args.curData.isHeader ? 'flatList' : 'groupList';\r\n        var element = args.curData.isHeader ? groupTemplate : template;\r\n        if (element.firstElementChild) {\r\n            args.item.insertBefore(element.firstElementChild, null);\r\n        }\r\n    };\r\n    Virtualization.prototype.compileTemplate = function (element, item, isHeader) {\r\n        this.textProperty(element, item, isHeader);\r\n        this.classProperty(element, item, isHeader);\r\n        this.attributeProperty(element, item, isHeader);\r\n    };\r\n    Virtualization.prototype.onChange = function (newData, listElement) {\r\n        listElement.context.data = newData;\r\n        // eslint-disable-next-line max-len\r\n        var groupTemplateNodes = listElement.context.nodes.groupTemplateNodes;\r\n        // eslint-disable-next-line max-len\r\n        var flatTemplateNodes = listElement.context.nodes.flatTemplateNodes;\r\n        // eslint-disable-next-line\r\n        if (!isNullOrUndefined(newData.isHeader) && newData.isHeader && listElement.context.type === 'groupList') {\r\n            // eslint-disable-next-line\r\n            var element = listElement.firstElementChild;\r\n            detach(listElement.firstElementChild);\r\n            listElement.insertBefore(listElement.context.template, null);\r\n            listElement.context.template = element;\r\n            listElement.context.type = 'flatList';\r\n            for (var i = 0; i < groupTemplateNodes.length; i++) {\r\n                // eslint-disable-next-line\r\n                groupTemplateNodes[i].onChange(newData);\r\n            }\r\n        }\r\n        else if (!newData.isHeader && listElement.context.type === 'flatList') {\r\n            var element = listElement.firstElementChild;\r\n            detach(listElement.firstElementChild);\r\n            listElement.insertBefore(listElement.context.template, null);\r\n            listElement.context.template = element;\r\n            listElement.context.type = 'groupList';\r\n            for (var i = 0; i < flatTemplateNodes.length; i++) {\r\n                // eslint-disable-next-line\r\n                flatTemplateNodes[i].onChange(newData);\r\n            }\r\n        }\r\n        else if (!newData.isHeader) {\r\n            for (var i = 0; i < flatTemplateNodes.length; i++) {\r\n                // eslint-disable-next-line\r\n                flatTemplateNodes[i].onChange(newData);\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0; i < groupTemplateNodes.length; i++) {\r\n                // eslint-disable-next-line\r\n                groupTemplateNodes[i].onChange(newData);\r\n            }\r\n        }\r\n    };\r\n    // eslint-disable-next-line\r\n    Virtualization.prototype.updateContextData = function (listElement, node, isHeader) {\r\n        if (isHeader) {\r\n            listElement.context.nodes.groupTemplateNodes.push(node);\r\n        }\r\n        else {\r\n            listElement.context.nodes.flatTemplateNodes.push(node);\r\n        }\r\n    };\r\n    Virtualization.prototype.classProperty = function (element, listElement, isHeader) {\r\n        var regex = new RegExp('\\\\${([^}]*)}', 'g');\r\n        var resultantOutput = [];\r\n        var regexMatch;\r\n        while (regexMatch !== null) {\r\n            var match = regex.exec(element.className);\r\n            resultantOutput.push(match);\r\n            regexMatch = match;\r\n            if (regexMatch === null) {\r\n                resultantOutput.pop();\r\n            }\r\n        }\r\n        if (resultantOutput && resultantOutput.length) {\r\n            var _loop_1 = function (i) {\r\n                var classNameMatch = resultantOutput[i];\r\n                // eslint-disable-next-line\r\n                var classFunction;\r\n                if (classNameMatch[1].indexOf('?') !== -1 && classNameMatch[1].indexOf(':') !== -1) {\r\n                    // tslint:disable-next-line:no-function-constructor-with-string-args\r\n                    classFunction = new Function('data', 'return ' + classNameMatch[1].replace(/\\$/g, 'data.'));\r\n                }\r\n                else {\r\n                    // tslint:disable-next-line:no-function-constructor-with-string-args\r\n                    classFunction = new Function('data', 'return ' + 'data.' + classNameMatch[1]);\r\n                }\r\n                // eslint-disable-next-line\r\n                var subNode = {};\r\n                if (isHeader) {\r\n                    subNode.bindedvalue = classFunction(this_1.headerData);\r\n                }\r\n                else {\r\n                    subNode.bindedvalue = classFunction(this_1.templateData);\r\n                }\r\n                subNode.onChange = function (value) {\r\n                    if (subNode.bindedvalue) {\r\n                        removeClass([element], subNode.bindedvalue.split(' ').filter(function (css) { return css; }));\r\n                    }\r\n                    var newCss = classFunction(value);\r\n                    if (newCss) {\r\n                        addClass([element], (newCss).split(' ').filter(function (css) { return css; }));\r\n                    }\r\n                    subNode.bindedvalue = newCss;\r\n                };\r\n                var className = classNameMatch[0].split(' ');\r\n                for (var i_1 = 0; i_1 < className.length; i_1++) {\r\n                    element.classList.remove(className[i_1]);\r\n                }\r\n                if (subNode.bindedvalue) {\r\n                    addClass([element], subNode.bindedvalue.split(' ').filter(function (css) { return css; }));\r\n                }\r\n                this_1.updateContextData(listElement, subNode, isHeader);\r\n            };\r\n            var this_1 = this;\r\n            for (var i = 0; i < resultantOutput.length; i++) {\r\n                _loop_1(i);\r\n            }\r\n        }\r\n    };\r\n    Virtualization.prototype.attributeProperty = function (element, listElement, isHeader) {\r\n        var attributeNames = [];\r\n        for (var i = 0; i < element.attributes.length; i++) {\r\n            attributeNames.push(element.attributes[i].nodeName);\r\n        }\r\n        if (attributeNames.indexOf('class') !== -1) {\r\n            attributeNames.splice(attributeNames.indexOf('class'), 1);\r\n        }\r\n        var _loop_2 = function (i) {\r\n            var attributeName = attributeNames[i];\r\n            var attrNameMatch = new RegExp('\\\\${([^}]*)}', 'g').exec(attributeName) || [];\r\n            var attrValueMatch = new RegExp('\\\\${([^}]*)}', 'g').exec(element.getAttribute(attributeName))\r\n                || [];\r\n            // eslint-disable-next-line\r\n            var attributeNameFunction;\r\n            // eslint-disable-next-line\r\n            var attributeValueFunction;\r\n            if (attrNameMatch.length || attrValueMatch.length) {\r\n                if (attrNameMatch[1]) {\r\n                    // tslint:disable-next-line:no-function-constructor-with-string-args\r\n                    attributeNameFunction = new Function('data', 'return ' + 'data.' + attrNameMatch[1]);\r\n                }\r\n                if (attrValueMatch[1]) {\r\n                    if (attrValueMatch[1].indexOf('?') !== -1 && attrValueMatch[1].indexOf(':') !== -1) {\r\n                        // tslint:disable-next-line:no-function-constructor-with-string-args\r\n                        attributeValueFunction = new Function('data', 'return ' + attrValueMatch[1].replace(/\\$/g, 'data.'));\r\n                    }\r\n                    else {\r\n                        // tslint:disable-next-line:no-function-constructor-with-string-args\r\n                        attributeValueFunction = new Function('data', 'return ' + 'data.' + attrValueMatch[1]);\r\n                    }\r\n                }\r\n                // eslint-disable-next-line @typescript-eslint/ban-types\r\n                var subNode_1 = {};\r\n                if (isHeader) {\r\n                    subNode_1.bindedvalue = [attrNameMatch[1] === undefined ? undefined : attributeNameFunction(this_2.headerData),\r\n                        attrValueMatch[1] === undefined ? undefined : attributeValueFunction(this_2.headerData)];\r\n                }\r\n                else {\r\n                    subNode_1.bindedvalue = [attrNameMatch[1] === undefined ? undefined : attributeNameFunction(this_2.templateData),\r\n                        attrValueMatch[1] === undefined ? undefined : attributeValueFunction(this_2.templateData)];\r\n                }\r\n                subNode_1.attrName = subNode_1.bindedvalue[0] === undefined ?\r\n                    attributeName : subNode_1.bindedvalue[0];\r\n                subNode_1.onChange = function (value) {\r\n                    var bindedvalue = subNode_1.bindedvalue[1] === undefined ?\r\n                        element.getAttribute(subNode_1.attrName) : attributeValueFunction(value);\r\n                    element.removeAttribute(subNode_1.attrName);\r\n                    subNode_1.attrName = subNode_1.bindedvalue[0] === undefined ? subNode_1.attrName : attributeNameFunction(value);\r\n                    element.setAttribute(subNode_1.attrName, bindedvalue);\r\n                    subNode_1.bindedvalue = [subNode_1.bindedvalue[0] === undefined ? undefined : attributeNameFunction(value),\r\n                        subNode_1.bindedvalue[1] === undefined ? undefined : attributeValueFunction(value)];\r\n                };\r\n                var attributeValue = subNode_1.bindedvalue[1] === undefined ? element.getAttribute(attributeName) :\r\n                    subNode_1.bindedvalue[1];\r\n                element.removeAttribute(attributeName);\r\n                element.setAttribute(subNode_1.attrName, attributeValue);\r\n                this_2.updateContextData(listElement, subNode_1, isHeader);\r\n            }\r\n        };\r\n        var this_2 = this;\r\n        for (var i = 0; i < attributeNames.length; i++) {\r\n            _loop_2(i);\r\n        }\r\n    };\r\n    Virtualization.prototype.textProperty = function (element, listElement, isHeader) {\r\n        var regex = new RegExp('\\\\${([^}]*)}', 'g');\r\n        var resultantOutput = [];\r\n        var regexMatch;\r\n        while (regexMatch !== null) {\r\n            var match = regex.exec(element.innerText);\r\n            resultantOutput.push(match);\r\n            regexMatch = match;\r\n            if (regexMatch === null) {\r\n                resultantOutput.pop();\r\n            }\r\n        }\r\n        var isChildHasTextContent = Array.prototype.some.call(element.children, function (element) {\r\n            if (new RegExp('\\\\${([^}]*)}', 'g').exec(element.innerText)) {\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        });\r\n        if (resultantOutput && resultantOutput.length && !isChildHasTextContent) {\r\n            var _loop_3 = function (i) {\r\n                var textPropertyMatch = resultantOutput[i];\r\n                // eslint-disable-next-line\r\n                var subNode = {};\r\n                // eslint-disable-next-line\r\n                var textFunction;\r\n                if (textPropertyMatch[1].indexOf('?') !== -1 && textPropertyMatch[1].indexOf(':') !== -1) {\r\n                    // tslint:disable-next-line:no-function-constructor-with-string-args\r\n                    textFunction = new Function('data', 'return ' + textPropertyMatch[1].replace(/\\$/g, 'data.'));\r\n                }\r\n                else {\r\n                    // tslint:disable-next-line:no-function-constructor-with-string-args\r\n                    textFunction = new Function('data', 'return ' + 'data.' + textPropertyMatch[1]);\r\n                }\r\n                if (isHeader) {\r\n                    subNode.bindedvalue = textFunction(this_3.headerData);\r\n                }\r\n                else {\r\n                    subNode.bindedvalue = textFunction(this_3.templateData);\r\n                }\r\n                subNode.onChange = function (value) {\r\n                    element.innerText = element.innerText.replace(subNode.bindedvalue, textFunction(value));\r\n                    subNode.bindedvalue = textFunction(value);\r\n                };\r\n                element.innerText = element.innerText.replace(textPropertyMatch[0], subNode.bindedvalue);\r\n                this_3.updateContextData(listElement, subNode, isHeader);\r\n            };\r\n            var this_3 = this;\r\n            for (var i = 0; i < resultantOutput.length; i++) {\r\n                _loop_3(i);\r\n            }\r\n        }\r\n    };\r\n    Virtualization.prototype.reRenderUiVirtualization = function () {\r\n        this.wireScrollEvent(true);\r\n        if (this.listViewInstance.contentContainer) {\r\n            detach(this.listViewInstance.contentContainer);\r\n        }\r\n        this.listViewInstance.preRender();\r\n        // resetting the dom count to 0, to avoid edge case of dataSource suddenly becoming zero\r\n        // and then manually adding item using addItem API\r\n        this.domItemCount = 0;\r\n        this.listViewInstance.header();\r\n        this.listViewInstance.setLocalData();\r\n    };\r\n    Virtualization.prototype.updateUI = function (element, index, targetElement) {\r\n        // eslint-disable-next-line @typescript-eslint/ban-types\r\n        var onChange = this.isNgTemplate() ? this.onNgChange : this.onChange;\r\n        if (this.listViewInstance.template || this.listViewInstance.groupTemplate) {\r\n            var curViewDS = this.listViewInstance.curViewDS[index];\r\n            // eslint-disable-next-line\r\n            element.dataset.uid = (curViewDS[this.listViewInstance.fields.id]) ?\r\n                // eslint-disable-next-line\r\n                (curViewDS[this.listViewInstance.fields.id]) : ListBase.generateId();\r\n            onChange(curViewDS, element, this);\r\n        }\r\n        else {\r\n            this.updateUiContent(element, index);\r\n        }\r\n        this.changeElementAttributes(element, index);\r\n        if (targetElement) {\r\n            this.listViewInstance.ulElement.insertBefore(element, targetElement);\r\n        }\r\n    };\r\n    Virtualization.prototype.onNgChange = function (newData, listElement, virtualThis) {\r\n        // compile given target element with template for new data\r\n        // eslint-disable-next-line\r\n        var templateCompiler = compile(virtualThis.listViewInstance.template);\r\n        var resultElement = templateCompiler(newData);\r\n        while (listElement.lastChild) {\r\n            listElement.removeChild(listElement.lastChild);\r\n        }\r\n        listElement.appendChild(resultElement[0]);\r\n    };\r\n    Virtualization.prototype.getModuleName = function () {\r\n        return 'virtualization';\r\n    };\r\n    Virtualization.prototype.destroy = function () {\r\n        this.wireScrollEvent(true);\r\n    };\r\n    return Virtualization;\r\n}());\r\nexport { Virtualization };\r\n"]},"metadata":{},"sourceType":"module"}